sensorsdata.AddictionBase=function(e){sensorsdata.BasePage.call(this),this.events=(e||{}).events||$.extend(!0,[],sensorsdata.cache.events),"ALL"===sensorsdata.authority.eventPermission.type&&this.events.unshift(sensorsdata.CONSTSET.everyEvent),this.paramObj={},this.propObj={},this.userProperties=[],this.durations=[{name:"day",cname:sensorsdata.languages.get("一天内<!--{en}in one day-->"),shortCname:sensorsdata.languages.get("天<!--{en}Day-->"),unitCname:sensorsdata.languages.get("小时<!--{en}Hour-->"),unit:"hour",value:23},{name:"week",cname:sensorsdata.languages.get("一周内<!--{en}In one week-->"),shortCname:sensorsdata.languages.get("周<!--{en}Week-->"),unitCname:sensorsdata.languages.get("天<!--{en}Day-->"),unit:"day",value:6},{name:"month",cname:sensorsdata.languages.get("一个月内<!--{en}In one month-->"),shortCname:sensorsdata.languages.get("月<!--{en}Month-->"),unitCname:sensorsdata.languages.get("天<!--{en}Day-->"),unit:"day",value:30}]},sensorsdata.inherits(sensorsdata.AddictionBase,sensorsdata.BasePage),sensorsdata.AddictionBase.prototype.getDuration=function(e){if(!e)return this.durations[0];var t=this.durations.filter(function(t){return t.name===e});return 1===t.length?t[0]:this.durations[0]},sensorsdata.AddictionBase.prototype.buildMeasureName=function(e){if("period"===e.measure_type){var t=this.getDuration(e.unit);return t.unitCname+sensorsdata.languages.get("数<!--{en}Number-->")}if("times"===e.measure_type&&$.isEmptyObject(e.measure))return sensorsdata.languages.get("次数<!--{en}Times-->");if(!$.isEmptyObject(e.measure)){var s=sensorsdata.findProperty(e.measure.field,this.propObj).cname;return s+sensorsdata.languages.get("的<!--{en} . -->")+sensorsdata.CONSTSET.measureFunctions[e.measure.aggregator].cname}return""},sensorsdata.AddictionBase.prototype.buildMeasureUnit=function(){var e=this.paramObj;if("period"===e.measure_type){var t=this.getDuration(e.unit);return t.unitCname}if($.isEmptyObject(e.measure))return sensorsdata.languages.get("次<!--{en}Times-->");var s=sensorsdata.CONSTSET.measureFunctions;if(e.measure.field&&!s[e.measure.aggregator].unit){var a=sensorsdata.findProperty(e.measure.field,this.propObj);return $.isEmptyObject(a)?"":a.unit||""}return s[e.measure.aggregator].unit},sensorsdata.AddictionBase.prototype.buildLabel=function(e,t){var s=this.buildMeasureUnit(),a=this.paramObj.measure_type,n=this.paramObj.measure||{};return $.isNumeric(e.bucket_start)&&$.isNumeric(e.bucket_end)?e.bucket_end-e.bucket_start!==1||!$.isEmptyObject(n)&&"uniqCount"!==n.aggregator?e.bucket_start+s+"~"+e.bucket_end+s+sensorsdata.languages.get("(不含<!--{en}(exclude-->")+e.bucket_end+s+")":e.bucket_start+s:$.isNumeric(e.bucket_start)?"period"===a?sensorsdata.languages.get("至少<!--{en}at least-->")+e.bucket_start+s:e.bucket_start+s+sensorsdata.languages.get("以上(含<!--{en}Above(include-->")+e.bucket_start+s+")":$.isNumeric(e.bucket_end)?e.bucket_end+s+sensorsdata.languages.get("以下(不含<!--{en}the following(exclude-->")+e.bucket_end+s+")":t?sensorsdata.CONSTSET.unknownByValue:sensorsdata.CONSTSET.unknownByValueText},sensorsdata.AddictionBase.prototype.padRetentions=function(e,t,s){s=s||{};var a=t.measure_type,n=sensorsdata.CONSTSET.timeFormat,r=this.getDuration(t.unit),i=sensorsdata.getBeginDate(r.unit),u=function(e,t){var s=moment(e,n);return s.isValid()?i.diff(s,r.unit):t},o=0;if("period"===a){if(t.by_field){var d=sensorsdata.getBeginDate(r.unit,t.from_date);o=i.diff(d,r.unit)}else o=u(e.rows[0].by_value,(e.rows[0].cells||[]).length);o=o<r.value?o:r.value}return e.rows.map(sensorsdata.bind(function(e){if(e.by_value=sensorsdata.formatByValue(e.by_value,s.data_type,"",t.bucket_param),"times"!==a){var n=o;if(t.by_field)e.cells.splice(o);else{var i=u(e.by_value,(e.cells||[]).length);n=r.value<i?r.value:i,e.cells.splice(n)}for(var d=e.cells.length;o>d;d++)e.cells.push(n>d?{people:0,percent:0,bucket_start:d+2}:{})}},this)),e},sensorsdata.AddictionBase.prototype.getProperties=function(e,t){sensorsdata.ajax({useCache:!0,url:"event/"+e+"/properties",success:sensorsdata.bind(function(e){if($.isEmptyObject(e)||!$.isArray(e.event)||!$.isArray(e.user))throw"ajax return error json.";this.propObj={event:e.event},this.userProperties=e.user,t()},this)})};