(function(c){var b={tagClass:function(j){return"label label-info"},itemValue:function(j){return j?j.toString():j},itemText:function(j){return this.itemValue(j)},itemTitle:function(j){return null},freeInput:true,addOnBlur:true,maxTags:undefined,maxChars:undefined,confirmKeys:[13],splitChar:"",onTagExists:function(k,j){j.hide().fadeIn()},trimValue:false,allowDuplicates:false};function g(k,j){this.itemsArray=[];this.$element=c(k);this.$element.hide();this.isSelect=(k.tagName==="SELECT");this.multiple=(this.isSelect&&k.hasAttribute("multiple"));this.objectItems=j&&j.itemValue;this.placeholderText=k.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=c('<div class="bootstrap-tagsinput"></div>');this.$widthTester=c('<span style="display:none;"></span>').appendTo(this.$container);this.$input=c('<input size="1" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.before(this.$container);this.build(j)}g.prototype={constructor:g,add:function(u,r,x){var v=this;if(v.options.maxTags&&v.itemsArray.length>=v.options.maxTags){return}if(u!==false&&!u){return}if(typeof u==="string"&&v.options.trimValue){u=c.trim(u)}if(typeof u==="object"&&!v.objectItems){throw ("Can't add objects when itemValue option is not set")}if(u.toString().match(/^\s*$/)){return}if(v.isSelect&&!v.multiple&&v.itemsArray.length>0){v.remove(v.itemsArray[0])}if(typeof u==="string"&&this.$element[0].tagName==="INPUT"){var s=v.options.splitChar?u.split(v.options.splitChar):[u];if(s.length>1){for(var p=0;p<s.length;p++){this.add(s[p],true)}if(!r){v.pushVal()}return}}var m=v.options.itemValue(u),t=v.options.itemText(u),o=v.options.tagClass(u),l=v.options.itemTitle(u);var k=c.grep(v.itemsArray,function(y){return v.options.itemValue(y)===m})[0];if(k&&!v.options.allowDuplicates){if(v.options.onTagExists){var n=c(".tag",v.$container).filter(function(){return c(this).data("item")===k});v.options.onTagExists(u,n)}return}if(v.items().toString().length+u.length+1>v.options.maxInputLength){return}var w=c.Event("beforeItemAdd",{item:u,cancel:false,options:x});v.$element.trigger(w);if(w.cancel){return}v.itemsArray.push(u);var q=c('<span class="tag '+f(o)+(l!==null?('" title="'+l):"")+'">'+f(t)+'<span data-role="remove"></span></span>');q.data("item",u);v.findInputWrapper().before(q);q.after(" ");if(v.isSelect&&!c('option[value="'+encodeURIComponent(m)+'"]',v.$element)[0]){var j=c("<option selected>"+f(t)+"</option>");j.data("item",u);j.attr("value",m);v.$element.append(j)}if(!r){v.pushVal()}if(v.options.maxTags===v.itemsArray.length||v.items().toString().length===v.options.maxInputLength){v.$container.addClass("bootstrap-tagsinput-max")}v.$element.trigger(c.Event("itemAdded",{item:u,options:x}))},remove:function(l,m,k){var j=this;if(j.objectItems){if(typeof l==="object"){l=c.grep(j.itemsArray,function(o){return j.options.itemValue(o)==j.options.itemValue(l)})}else{l=c.grep(j.itemsArray,function(o){return j.options.itemValue(o)==l})}l=l[l.length-1]}if(l){var n=c.Event("beforeItemRemove",{item:l,cancel:false,options:k});j.$element.trigger(n);if(n.cancel){return}c(".tag",j.$container).filter(function(){return c(this).data("item")===l}).remove();c("option",j.$element).filter(function(){return c(this).data("item")===l}).remove();if(c.inArray(l,j.itemsArray)!==-1){j.itemsArray.splice(c.inArray(l,j.itemsArray),1)}}if(!m){j.pushVal()}if(j.options.maxTags>j.itemsArray.length){j.$container.removeClass("bootstrap-tagsinput-max")}j.$element.trigger(c.Event("itemRemoved",{item:l,options:k}))},removeAll:function(){var j=this;c(".tag",j.$container).remove();c("option",j.$element).remove();while(j.itemsArray.length>0){j.itemsArray.pop()}j.pushVal()},refresh:function(){var j=this;c(".tag",j.$container).each(function(){var l=c(this),n=l.data("item"),o=j.options.itemValue(n),k=j.options.itemText(n),p=j.options.tagClass(n);l.attr("class",null);l.addClass("tag "+f(p));l.contents().filter(function(){return this.nodeType==3})[0].nodeValue=f(k);if(j.isSelect){var m=c("option",j.$element).filter(function(){return c(this).data("item")===n});m.attr("value",o)}})},items:function(){return this.itemsArray},pushVal:function(){var j=this,k=c.map(j.items(),function(l){return j.options.itemValue(l).toString()});j.$element.val(k,true).trigger("change")},build:function(k){var j=this;j.options=c.extend({},b,k);if(j.objectItems){j.options.freeInput=false}a(j.options,"itemValue");a(j.options,"itemText");h(j.options,"tagClass");if(j.options.typeahead){var n=j.options.typeahead||{};h(n,"source");j.$input.typeahead(c.extend({},n,{source:function(r,t){function p(u){var w=[];for(var v=0;v<u.length;v++){var x=j.options.itemText(u[v]);s[x]=u[v];w.push(x)}t(w)}this.map={};var s=this.map,q=n.source(r);if(q){if(c.isFunction(q.success)){q.success(p)}else{if(c.isFunction(q.then)){q.then(p)}else{c.when(q).then(p)}}}},updater:function(p){j.add(this.map[p]);return this.map[p]},matcher:function(p){return(p.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(p){return p.sort()},highlighter:function(q){var p=new RegExp("("+this.query+")","gi");return q.replace(p,"<strong>$1</strong>")}}))}if(j.options.typeaheadjs){var m=null;var o={};var l=j.options.typeaheadjs;if(c.isArray(l)){m=l[0];o=l[1]}else{o=l}j.$input.typeahead(m,o).on("typeahead:selected",c.proxy(function(q,p){if(o.valueKey){j.add(p[o.valueKey])}else{j.add(p)}j.$input.typeahead("val","")},j))}j.$container.on("click",c.proxy(function(p){if(!j.$element.attr("disabled")){j.$input.removeAttr("disabled")}j.$input.focus()},j));if(j.options.addOnBlur&&j.options.freeInput){j.$input.on("focusout",c.proxy(function(q){var p=j.$container.find("ul.typeahead.dropdown-menu");if(p.is(":visible")&&p.find("li.active").size()===1){j.add(p.find("li.active a").text());j.$input.val("")}else{j.add(j.$input.val());j.$input.val("")}},j))}j.$container.on("keydown","input",c.proxy(function(u){var v=c(u.target),r=j.findInputWrapper();if(j.$element.attr("disabled")){j.$input.attr("disabled","disabled");return}switch(u.which){case 8:if(e(v[0])===0){var t=r.prev();if(t){j.remove(t.data("item"))}}break;case 46:if(e(v[0])===0){var q=r.next();if(q){j.remove(q.data("item"))}}break;case 37:var p=r.prev();if(v.val().length===0&&p[0]){p.before(r);v.focus()}break;case 39:var s=r.next();if(v.val().length===0&&s[0]){s.after(r);v.focus()}break;default:}},j));j.$container.on("keyup keydown blur update","input",c.proxy(function(q){if(q.keyCode===229){return}var p=String.fromCharCode(q.keyCode);var r=c(q.target);j.$widthTester.text(r.val()+p);r.width(j.$widthTester.width()+10)},j));j.$container.on("keypress","input",c.proxy(function(r){var t=c(r.target);if(j.$element.attr("disabled")){j.$input.attr("disabled","disabled");return}var s=t.val(),q=j.options.maxChars&&s.length>=j.options.maxChars;if(j.options.freeInput&&(d(r,j.options.confirmKeys)||q)){var p=j.$container.find("ul.typeahead.dropdown-menu");if(!p.is(":visible")||p.find("li.active").size()===0){j.add(q?s.substr(0,j.options.maxChars):s);t.val("");r.preventDefault()}}},j));j.$container.on("click","[data-role=remove]",c.proxy(function(p){if(j.$element.attr("disabled")){return}j.remove(c(p.target).closest(".tag").data("item"))},j));if(j.options.itemValue===b.itemValue){if(j.$element[0].tagName==="INPUT"){j.add(j.$element.val())}else{c("option",j.$element).each(function(){j.add(c(this).attr("value"),true)})}}},destroy:function(){var j=this;j.$container.off("keypress","input");j.$container.off("click","[role=remove]");j.$container.remove();j.$element.removeData("tagsinput");j.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var k=this.$input[0],j=this.$container[0];while(k&&k.parentNode!==j){k=k.parentNode}return c(k)}};c.fn.tagsinput=function(l,k,j){var m=[];this.each(function(){var o=c(this).data("tagsinput");if(!o){o=new g(this,l);c(this).data("tagsinput",o);m.push(o);if(this.tagName==="SELECT"){c("option",c(this)).attr("selected","selected")}c(this).val(c(this).val())}else{if(!l&&!k){m.push(o)}else{if(o[l]!==undefined){if(o[l].length===3&&j!==undefined){var n=o[l](k,null,j)}else{var n=o[l](k)}if(n!==undefined){m.push(n)}}}}});if(typeof l=="string"){return c.extend(true,[],m.length>1?m:m[0])}else{return c.extend(true,[],m)}};c.fn.tagsinput.Constructor=g;function a(k,l){if(typeof k[l]!=="function"){var j=k[l];k[l]=function(m){return m[j]}}}function h(j,k){if(typeof j[k]!=="function"){var l=j[k];j[k]=function(){return l}}}var i=c("<div />");function f(j){if(j){return i.text(j).html()}else{return""}}function e(k){var l=0;if(document.selection){k.focus();var j=document.selection.createRange();j.moveStart("character",-k.value.length);l=j.text.length}else{if(k.selectionStart||k.selectionStart=="0"){l=k.selectionStart}}return(l)}function d(j,l){var k=false;c.each(l,function(o,n){if(typeof(n)==="number"&&j.which===n){k=true;return false}if(j.which===n.which){var q=!n.hasOwnProperty("altKey")||j.altKey===n.altKey,m=!n.hasOwnProperty("shiftKey")||j.shiftKey===n.shiftKey,p=!n.hasOwnProperty("ctrlKey")||j.ctrlKey===n.ctrlKey;if(q&&m&&p){k=true;return false}}});return k}c(function(){c("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);