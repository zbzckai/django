!function(){var t=[];sensorsdata.TagsModel=$.extend(!0,{},sensorsdata.EventsModule,{data:[],get:function(e){var a=t.filter(function(t){return String(t.id)===String(e)})[0];return a||{}},getAll:function(e){var a=this;return this.data.length?($.isFunction(e)&&e($.extend(!0,[],this.data)),this.data):void sensorsdata.ajax({url:sensorsdata.api.get("tag"),isCommonError:!1,success:function(s){t=s,a.data=s,$.isFunction(e)&&e($.extend(!0,[],s))}})},create:function(){},updateAll:function(t){var e=this;sensorsdata.ajax({url:sensorsdata.api.get("tag"),isCommonError:!1,success:function(a){e.data=a,$.isFunction(t)&&t($.extend(!0,[],a))}})}}),sensorsdata.MetaModel=$.extend(!0,{},sensorsdata.EventsModule,{type:"",data:null,request:function(t,e){var a=this,s=null,n=null;sensorsdata.ajax({url:sensorsdata.api.get(t),isCommonError:!1,queueEnable:!0,queueKey:"GET-META",success:function(o){a.data=$.extend(!0,[],o),s?$.isFunction(e)&&e(t,o,s):n=o}}),sensorsdata.ajax({url:sensorsdata.api.get("tag"),isCommonError:!1,success:function(o){a.tags=$.extend(!0,o),n?$.isFunction(e)&&e(t,n,o):s=o}})},show:function(t,e,a,s){var n=$.extend(!0,[],this.data);if(n=n.filter(function(a){return a.visible=!0,a.is_in_use=!0,"profile"===t||"event"===t?a.property_id=a.id:a.event_id=a.id,e.indexOf(a.id)>-1}),0!==n.length){var o=$.extend(!0,[],n),i=n.map(function(t){return t.cname||t.name});("profile"===t||"event"===t)&&(o={property:n}),sensorsdata.ajax({url:sensorsdata.api.get(t+"_multi"),method:"POST",data:JSON.stringify(o),success:function(){$.isFunction(a)&&a(),sensorsdata.info.show("成功显示"+i.join(","))},error:function(){$.isFunction(s)&&s()}})}},hide:function(t,e,a,s){var n=$.extend(!0,[],this.data);if(n=n.filter(function(a){return a.visible=!1,a.is_in_use=!1,"profile"===t||"event"===t?a.property_id=a.id:a.event_id=a.id,e.indexOf(a.id)>-1}),0!==n.length){var o=$.extend(!0,[],n),i=n.map(function(t){return t.cname});("profile"===t||"event"===t)&&(o={property:n});var r={success:!0,operation_type:sensorsdata.languages.get("修改<!--{en}Edit-->")};sensorsdata.ajax({url:sensorsdata.api.get(t+"_multi"),method:"POST",data:JSON.stringify(o),success:function(){$.isFunction(a)&&a(),sensorsdata.info.show("成功隐藏"+i.join(",")),sensorsdata.track("edit_user_profile",r)},error:function(t){$.isFunction(s)&&s(),r.success=!1,r.fail_reason=t.status,sensorsdata.track("edit_user_profile",r)}})}},"delete":function(t,e,a){var s=this.data.filter(function(t){return t.id===e[0]})[0],n={success:!0,operation_type:sensorsdata.languages.get("删除<!--{en}Delete failed-->")},o=!0,i="";switch(t){case"meta":i="edit_event_meta";break;case"session":n.is_all_events=s&&s.event_list?s.event_list.length===sensorsdata.cache.events.length:!1,n.session_interval=s&&s.session_rule&&s.session_rule.params?s.session_rule.params[0]:null,i="session_operation";break;case"profile":i="edit_user_profile";break;case"virtual":n.is_all_events=s&&s.virtual_define?s.virtual_define.length===sensorsdata.cache.events.length:!1,i="virtual_event_operation";break;default:o=!1}sensorsdata.ajax({type:"delete",url:sensorsdata.api.get(t+"_multi"),async:!1,data:JSON.stringify(e),success:function(){$.isFunction(a)&&a(),sensorsdata.info.show("删除成功!"),sensorsdata.track(i,n)},error:function(t){o&&(n.success=!1,n.fail_reason=t.status,sensorsdata.track(i,n))}})},update:function(t,e,a){if(!$.isArray(e)||0!==e.length){var s=$.extend(!0,[],this.data),n=e=e.map(function(e){var a=s.filter(function(t){return String(t.id)===String(e.id)})[0];for(var n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);return"profile"===t||"event"===t?a.property_id=a.id:"session"===t?a.session_id=a.id:a.event_id=a.event_id||a.id,a});("profile"===t||"event"===t)&&(n={property:e});var o={success:!0,operation_type:sensorsdata.languages.get("修改<!--{en}Edit-->")},i=!0,r="";switch(t){case"meta":r="edit_event_meta";break;case"session":o.is_all_events=n[0]&&n[0].event_list?n[0].event_list.length===sensorsdata.cache.events.length:!1,o.session_interval=n[0]&&n[0].session_rule&&n[0].session_rule.params?n[0].session_rule.params[0]:null,r="session_operation";break;case"profile":r="edit_user_profile";break;case"virtual":o.is_all_events=n[0]&&n[0].virtual_define?n[0].virtual_define.length===sensorsdata.cache.events.length:!1,r="virtual_event_operation";break;default:i=!1}sensorsdata.ajax({type:"post",url:sensorsdata.api.get(t+"_multi"),data:JSON.stringify(n),success:function(){$.isFunction(a)&&a(),sensorsdata.info.show("更新成功！"),i&&sensorsdata.track(r,o)},error:function(t){i&&(o.success=!1,o.fail_reason=t.status,sensorsdata.track(r,o))}})}},create:function(t,e,a){if(!$.isArray(e)||0!==e.length){var s={success:!0,operation_type:sensorsdata.languages.get("创建<!--{en}Create-->")},n=!0,o="";switch(t){case"meta":o="edit_event_meta";break;case"session":s.is_all_events=e[0]&&e[0].event_list?e[0].event_list.length===sensorsdata.cache.events.length:!1,s.session_interval=e[0]&&e[0].session_rule&&e[0].session_rule.params?e[0].session_rule.params[0]:null,o="session_operation";break;case"profile":o="edit_user_profile";break;case"virtual":s.is_all_events=e[0]&&e[0].virtual_define?e[0].virtual_define.length===sensorsdata.cache.events.length:!1,o="virtual_event_operation";break;default:n=!1}sensorsdata.ajax({type:"post",url:sensorsdata.api.get(t+"_create"),data:JSON.stringify(e[0]),success:function(){$.isFunction(a)&&a(),sensorsdata.info.show("添加成功"),n&&sensorsdata.track(o,s)},error:function(t){n&&(s.success=!1,s.fail_reason=t.status,sensorsdata.track(o,s))}})}}}),sensorsdata.DictModel=$.extend(!0,{},sensorsdata.EventsModule,{download:function(t,e,a){var s="property/dict/txt/"+e;sensorsdata.download(s,null,a)},upload:function(t,e,a){var s=sensorsdata.AJAX_CONST.BASE_URL+"property/dict/upload";sensorsdata.cache.project.name&&-1===s.indexOf("project=")&&(s=s+"?project="+sensorsdata.cache.project.name),$.ajax({url:s,type:"POST",data:e,async:!1,cache:!1,contentType:!1,processData:!1,success:function(){sensorsdata.info.show(sensorsdata.languages.get("上传成功<!--{en}Upload successfully-->")),$.isFunction(a)&&a()},error:function(t){var e=sensorsdata.languages.get("上传失败<!--{en}Upload failed-->");if(t&&410===t.status){var a=t.responseJSON||{};a.error&&(e+="："+(a.error||""))}sensorsdata.error.show(e)}})},"delete":function(t,e,a){var s=sensorsdata.AJAX_CONST.BASE_URL+"property/dict/empty?";sensorsdata.cache.project.name&&-1===s.indexOf("project=")&&(s=s+"project="+sensorsdata.cache.project.name),"event"===t&&(t="property"),sensorsdata.ajax({url:s+"&propertyName="+e+"&type="+t,type:"post",error:function(){sensorsdata.error.show(sensorsdata.languages.get("删除失败<!--{en}Delete failed-->"))},success:function(){sensorsdata.info.show(sensorsdata.languages.get("删除成功<!--{en}Delete successfully-->")),$.isFunction(a)&&a()}})}});var e=$("#tpl-sa-nav-item").html();sensorsdata.NavManage=function(t){this.defaultOptions={container:"body",items:[],clickHandle:null,selected:null},this.options=$.extend(!0,{},this.defaultOptions,t),this.options.container.html(Mustache.render(e,{items:this.options.items||[]})),this.init()},sensorsdata.NavManage.prototype=$.extend(!0,sensorsdata.NavManage.prototype,sensorsdata.EventsModule),sensorsdata.NavManage.prototype.init=function(){var t=this;this.options.container.delegate("[data-nav]","click",function(e){e.preventDefault(),e.$target=$(this);var a=$(this).attr("data-nav");t.options.selected!==a&&(t.select(a),$.isFunction(t.options.clickHandle)&&t.options.clickHandle(e))});var e=this.options.selected||this.options.container.find("[data-nav]:first-child").attr("data-nav");this.select(e)},sensorsdata.NavManage.prototype.select=function(t){this.options.container.find('[data-nav="'+t+'"]').addClass("on").siblings("[data-nav]").removeClass("on"),this.options.selected=t};var a=$("#tpl-meta-toolbox").html();sensorsdata.ToolBox=function(t){this.defaultOptions={container:"body",tpl:a,type:"meta",total:0},this.options=$.extend(!0,{},this.defaultOptions,t),this.selected=[],this.init()},sensorsdata.ToolBox.prototype=$.extend(!0,sensorsdata.ToolBox.prototype,sensorsdata.EventsModule),sensorsdata.ToolBox.prototype.init=function(){var t=this;this.options.container.html(Mustache.render($("#tpl-"+this.options.type+"-toolbox").html())),this.options.container.find("[data-method]").off("click").on("click",function(e){switch(e.$target=$(this),e.method=$(this).attr("data-method"),e.status=t.val(),e.method){case"cancel":t.toggleHeader(!1),t.selected=[],t.trigger("change",e);break;case"show":case"hide":case"toggle-display":case"create-session":case"create-virtual":t.selected=[],t.trigger("change",e);break;case"delete":sensorsdata.popover({ele:e.$target,footer:$("#tpl_popover_footer_state_3").html(),showNow:!0,content:'确认删除吗？<div class="remark">本操作无法撤销</div>',successAfter:function(){t.trigger("change",{status:{selected:t.val().selected},method:e.method})}})}}),this.options.container.find("input").off("keyup").on("keyup",function(e){e.$target=$(this),e.method=$(this).attr("data-method"),e.$value=$(this).val(),e.status=t.val(),t.trigger("change",e)}),this.off("selected").on("selected",function(e){t.selected=e.ids||[],console.log(e),t.common=[],t.toggleHeader(t.selected.length>0);var a=this.options.container.find('[data-method="setTagDropdown"]'),s=a.next("ul");if(s.find("li").removeClass("tag-checked"),t.selected.length>0&&a.length>0){for(var n={},o=e.data,i=o.length,r=null,d=0;d<o.length;d++)for(var l=0;l<o[d].tags.length;l++)r=o[d].tags[l],n[r]=n.hasOwnProperty(r)?n[r]+1:1;for(var c in n)n.hasOwnProperty(c)&&n[c]===i&&(t.common.push(Number(c)),s.find('span.detail[data-id="'+c+'"]').parent().addClass("tag-checked"))}}),this.off("total").on("total",function(e){t.options.container.find("span.total").html(e.rows?e.rows.length:0)}),this.options.container.find('[data-method="tagDropdown"]').saTagsDropdown({onSelected:function(e){e.preventDefault(),e.status=t.val(),t.trigger("change",e)},editable:!1}),this.options.container.find('[data-method="setTagDropdown"]').saTagsDropdown({onDeleted:function(){var e={};e.status=t.val(),e.method="deleted.tag",t.trigger("change",e)},onApply:function(e){console.log(e);var a=e.map(function(t){return t.id});console.log(t.selected,a),t.trigger("change",{newTags:a,common:t.common,method:"tags-set",status:{selected:t.selected}})},editable:!0,type:"set"}),$(document).off("click.saTagsDropdown").on("click.saTagsDropdown",function(e){var a=$(e.target||e.srcElement),s=t.options.container.find('[data-method="tagDropdown"]'),n=t.options.container.find('[data-method="setTagDropdown"]');0!==a.closest(".tag_dropdown").size()||a.closest("button").is(n)||a.closest("button").is(s)||1!==a.parents("body").size()||t.options.container.find("ul").hide()})},sensorsdata.ToolBox.prototype.toggleHeader=function(t){this.options.container.find("header:nth-child(2)").toggle(t),this.options.container.find("header:nth-child(1)").toggle(!t),this.options.container.find('[data-method="tagDropdown"]:visible');var e=this.options.container.find('[data-method="tagDropdown"]');this.options.container.find("span.selected-count").html(this.selected.length),e.next("ul").toggle(!1),e.data("saTagsDropdown")&&e.data("saTagsDropdown").clear();var a=this.options.container.find('[data-method="setTagDropdown"]');a.next("ul").toggle(!1),a.data("saTagsDropdown")&&a.data("saTagsDropdown").clear()},sensorsdata.ToolBox.prototype.val=function(){var t={inputFilter:this.options.container.find('input[type="text"]:visible').val(),selected:this.selected,tags:[],visible:!1},e=this.options.container.find('[data-method="toggle-display"]');e.is(":visible")&&(t.visible=e.is(":checked"));var a=this.options.container.find('[data-method="tagDropdown"]:visible');return a.length&&a.data("saTagsDropdown")&&(t.tags=a.data("saTagsDropdown").val()),t},$.fn.saTagsDropdown=function(t){return $(this).data("saTagsDropdown",new sensorsdata.saTagsDropdown($(this),t)),this};var s=$("#tpl-tag-select").html(),n=$("#tpl-tag-create").html();sensorsdata.saTagsDropdown=function(t,e){this.$btn=t,0===t.next("ul:first").length&&t.parent().append('<ul class="tag_dropdown dropdown-menu"></ul>'),this.$ul=t.next("ul:first"),this.tplTagDropdownSelect_=s,this.tplTagDropdownCreate_=n,this.options=null;var a={value:"",onSelected:null,onDeleted:null,tags:[],type:"filter",editable:!0,autoshow:!1};this.selected=[],this.tags=[],$.isFunction(e)?a.onSelected=e:$.isEmptyObject(e)||(this.options=$.extend(!0,a,e));var o=this;sensorsdata.ajax({url:sensorsdata.api.get("tag"),success:function(t){o.options.tags=t,o.$ul.html(Mustache.render(o.tplTagDropdownSelect_,{tags:t||[],type:a.type,flag:!1,editable:a.editable})),o.$ul.toggle(o.options.autoshow),o.select(a.value),o.initEvents_()}})},sensorsdata.saTagsDropdown.prototype.initEvents_=function(){var t=this,e=t.$ul;this.$btn.off("click.tags").on("click.tags",function(){t.$ul.toggle()}),t.$ul.unbind("click").bind("click",function(a){var s=$(a.target||a.srcElement);s.attr("data-method")||(s=s.parents("[data-method]:first"));var n=s.attr("data-method");a.method=n;var o=t.$ul.attr("data-id"),i=s.find("span[data-id]");switch(n){case"tags-filter":case"tags-set":if(0===i.length)return;if(s.hasClass("disabled"))return;if($.isFunction(t.options.onSelect)&&t.options.onSelect(s)===!1)return;t.select(i.attr("data-id")),a.value=t.val(),t.selected=t.val(),$.isFunction(t.options.onSelected)&&t.options.onSelected(a);break;case"add-tag":var r=t.$ul.find("li").size()-1;20===r?sensorsdata.info.show(sensorsdata.languages.get("最多允许创建 20 个标签<!--{en}Allowed to create up to 20 tags-->")):(t.$ul.removeAttr("data-id").html(Mustache.render(t.tplTagDropdownCreate_,{edit:!1})).find(".delete").hide(),sensorsdata.authority.isAdmin||t.$ul.find("button, input").prop("disabled",!0));break;case"selectColor":s.addClass("icon-selected").siblings("[data-color]").removeClass("icon-selected");break;case"edit-tag":var d=s.parent().find("span.detail"),l=d.text(),c=d.attr("data-color"),u=d.attr("data-id");e.html(Mustache.render(t.tplTagDropdownCreate_,{edit:!0})),e.attr("data-id",u).find(".delete").show(),e.find("input[type=text]").val(l),e.find(".body .icon-selected").removeClass("icon-selected"),e.find(".body ."+c).addClass("icon-selected"),sensorsdata.authority.isAdmin||e.find("button,ul input").prop("disabled",!0);break;case"cancel-tag":case"return-tag":t.showAllTags();break;case"clear-tag":t.$ul.find("li").removeClass("tag-checked"),a.value=t.val(),t.$btn.attr("data-value",a.value),$.isFunction(t.options.onSelected)&&(console.log(a.value),t.options.onSelected(a));break;case"confirm-tag":var p={name:e.find('input[name="tag_name"]').val().trim(),color:e.find(".icon-selected").attr("data-color")};if(!p.name)return void sensorsdata.form.addError(e.find('input[name="tag_name"]'),sensorsdata.languages.get("标签名称不能为空<!--{en}Name of the tag can not be null-->"),!0);sensorsdata.form.removeError(e.find('input[name="tag_name"]'));var h="tag";o&&(h+="/"+o),sensorsdata.ajax({url:h,type:"post",data:JSON.stringify(p),success:function(){e.find("input[name=tag_name]").val(""),t.showAllTags()}});break;case"delete-tag":sensorsdata.popover({ele:s,footer:$("#tpl_popover_footer_state_3").html(),showNow:!0,content:'确认删除吗？<div class="remark">本操作无法撤销</div>',successAfter:function(){sensorsdata.ajax({type:"delete",url:"tag/"+o,success:function(e){$.isEmptyObject(e)&&(sensorsdata.info.show(sensorsdata.languages.get("标签删除成功<!--{en}Delete the tag successfully-->")),t.showAllTags(function(){$.isFunction(t.options.onDeleted)&&t.options.onDeleted()}))}})}});break;case"apply-tag":var f=t.val(),g=t.options.tags.filter(function(t){return-1!==f.indexOf(String(t.id))});console.log(g),$.isFunction(t.options.onApply)&&t.options.onApply(g),t.$ul.hide()}})},sensorsdata.saTagsDropdown.prototype.showAllTags=function(t){var e=this;sensorsdata.ajax({url:sensorsdata.api.get("tag"),success:function(a){var s=!0;e.options.tags=a.map(function(t){return console.log(t,e.selected),-1!==e.selected.indexOf(String(t.id))&&(t.checked=!0),t}),e.$ul.html(Mustache.render(e.tplTagDropdownSelect_,{tags:e.options.tags||[],type:e.options.type,flag:s,editable:e.options.editable})),$.isFunction(t)&&t(e.tags)}})},sensorsdata.saTagsDropdown.prototype.select=function(t){"string"==typeof t&&(t=[t]);var e=this;t.forEach(function(t){var a=e.$ul.find('[data-id="'+t+'"]').parent("li.tag-list:first");a.toggleClass("tag-checked")}),this.$btn.attr("data-value",e.val())},sensorsdata.saTagsDropdown.prototype.clear=function(){this.$btn.attr("data-value",null),this.$ul.find(".tag-list").removeClass("tag-checked")},sensorsdata.saTagsDropdown.prototype.val=function(){var t=[];return this.$ul.find("li").each(function(){$(this).hasClass("tag-checked")&&t.push($(this).find("[data-id]").attr("data-id"))}),t};var o=$("#tpl-meta-table").html(),i=$("#tpl-meta-table-body").html();sensorsdata.MetaTable=function(t){this.defaultOptions={tableData_:{heads:[],rows:[]},currentPage_:1,tpl:o,tplBody:i,container:"body",type:"",onRendered:null},this.options=$.extend(!0,{},this.defaultOptions,t),this.data=this.options.data||{},this.tableData_=this.options.tableData_||{heads:[],rows:[]},this.$tableContainer=this.options.container,this.currentPage_=1,this.checked=[],this.filter={},this.init()},sensorsdata.MetaTable.prototype=$.extend(!0,sensorsdata.MetaTable.prototype,sensorsdata.EventsModule),sensorsdata.MetaTable.prototype.init=function(){this.destroy(),this.filterTable_({}),this.initEvents_()},sensorsdata.MetaTable.prototype.initEvents_=function(){var t=this;this.$tableContainer.delegate("span.icon-edit","click.edit",function(){var t=$(this).prev("span").text(),e=$(this).parent();e.hide(),e.next("span").find("input").val(t).show().focus()}),this.$tableContainer.delegate('[data-method="select-all"]',"mouseover",function(){var e=$(this);t.$tableContainer.find('input[type="checkbox"]').each(function(){$(this).is(e)||$(this).removeClass("opacity-input")})}),this.$tableContainer.delegate('[data-method="select-all"]',"mouseout",function(){var e=$(this);t.$tableContainer.find('input[type="checkbox"]').each(function(){$(this).is(e)||$(this).addClass("opacity-input")})}),this.$tableContainer.delegate("thead tr th [data-method]","click.head",function(e){var a=$(this),s=a.parents("th:first"),n=a.attr("data-method"),o=a.attr("data-value");switch(n){case"sort":a.saDropdown({tpl:$("#tpl-header-sort-dropdown").html(),changeText:!1,value:o,onSelected:function(e){t.sort(s.index()-1,e)}});break;case"toggle-display":a.saDropdown({tpl:$("#tpl-header-toggle-dropdown").html(),changeText:!1,value:o||"all",onSelected:function(a){e.status={visible:a},t.toggleFilterTable(e)}})}}),this.$tableContainer.delegate("span.icon-add","click.icon-add",function(e){var a=$(this);if(!a.data("saTagsDropdown")){var s=$(this).parents("tr:first"),n=a.parents("td:first"),o=s.attr("data-index"),i=[];n.find("[data-id]").each(function(){i.push($(this).attr("data-id"))}),$(this).saTagsDropdown({value:i,onApply:function(a){console.log(a);var s=a.map(function(t){return t.id}),n=[{id:o,tag:s}];e.newValue=n,console.log(e),t.trigger("update",e)},onDeleted:function(){var e={};e.method="deleted.tag",t.trigger("change",e)},editable:!0,autoshow:!0,type:"set"})}}),this.$tableContainer.delegate('.edit-content input[type="text"]:visible',"blur.edit",function(e){var a=$(this).parents("td:visible:first"),s=$(this).val();if(!s)return void sensorsdata.form.addError($(this),sensorsdata.languages.get("请输入中文<!--{en}Please input Chinese-->"));var n=a.find("span.show-content > span:first-child"),o=n.text();if(n.text(s),a.find("span.show-content").show(),a.find("span.edit-content > input").val(s).hide(),o!==s){var i=a.parents("tr:first");e.$id=Number(i.attr("data-index")),e.newValue=[{cname:s,id:Number(i.attr("data-index"))}],t.trigger("update",e)}}),this.$tableContainer.delegate('.edit-unit input[type="text"]:visible',"blur.unit",function(e){var a=$(this).parents("td:visible:first"),s=$(this).val(),n=a.find("span.prop-unit > span:first-child"),o=n.text();if(n.text(s),a.find("span.prop-unit").show(),a.find("span.edit-unit > input").val(s).hide(),o!==s){var i=a.parents("tr:first");e.$id=Number(i.attr("data-index")),e.newValue=[{unit:s,id:Number(i.attr("data-index"))}],t.trigger("update",e)}}),this.$tableContainer.delegate('input[type="checkbox"]',"change",function(e){var a=[];"select-all"===$(this).attr("data-method")&&t.$tableContainer.find('input[type="checkbox"]').prop("checked",$(this).is(":checked")),t.$tableContainer.find('table tbody input[type="checkbox"]:checked').each(function(){a.push(Number($(this).attr("data-id")))}),e.ids=a,t.checked=a;var s=t.tableData_.rows,n=s.filter(function(t){return-1!==a.indexOf(t.id)}).map(function(t){var e={id:t.id};return t.tags&&(e.tags=t.tags.map(function(t){return t.id})),e});e.data=n,a.length>0?t.$tableContainer.find('input[type="checkbox"]').removeClass("opacity-input"):t.$tableContainer.find('input[type="checkbox"]').addClass("opacity-input"),t.trigger("selected",e)}),this.on("filter",function(e){t.filterTable_(e.status)}),this.$tableContainer.delegate("td.data-edit","click.data-edit",function(e){var a=$(this).parents("tr:first"),s=a.data("index");e.index=s,t.trigger("edit",e)}),this.$tableContainer.delegate('.visible-edit [data-method="toggle"]',"click.toggle",function(e){var a=$(this).parents("tr:first"),s=a.data("index");e.ids=[s],$(this).saDropdown({value:$(this).attr("data-value"),onSelected:function(a){e.method="true"===a?"show":"hide",t.trigger("toggle",e)}})}),this.$tableContainer.delegate('[data-method="time-truncate"]',"click.truncate",function(e){var a=$(this).parents("td:visible:first"),s=a.parents("tr:first");$(this).saDropdown({value:$(this).attr("data-value"),onSelected:function(a){e.$id=Number(s.attr("data-index")),e.newValue=[{is_truncated:"true"===a,id:Number(s.attr("data-index"))}],t.trigger("update",e)}})}),this.$tableContainer.delegate('[data-dict="true"]',"click.dict",function(e){var a=$(this),s=a.parents("tr:first"),n=a.attr("data-method");e.method=n,e.$id=s.attr("data-index"),e.$name=a.attr("data-name"),e.$cname=a.attr("data-cname"),"delete"===n?a.data("bs.popover")||(e.name="",sensorsdata.popover({className:"popover-edit-dashboard-delete",ele:a,showNow:!0,footer:$("#tpl_popover_footer_state_3").html(),content:sensorsdata.languages.get("确认删除吗？<!--{en}Are you sure to delete it?-->"),success:function(){t.trigger("dict",e)}})):t.trigger("dict",e)})},sensorsdata.MetaTable.prototype.toggleFilterTable=function(t){this.filterTable_(t.status,!1),this.$tableContainer.find('thead tr th span[data-method="toggle-display"]').attr("data-value",t.status.visible)},sensorsdata.MetaTable.prototype.reset=function(){this.currentPage_=1,this.checked=[]},sensorsdata.MetaTable.prototype.sort=function(t,e){var a=this.tableData_.heads[t].key,s=$.extend(!0,[],this.tableData_.rows);s=s.sort(function(t,e){return t[a].localeCompare(e[a])}),"descend"===e&&(s=s.reverse()),this.tableData_.rows=s,this.render(!1);var n=this.$tableContainer.find("thead tr th:nth-child("+(t+2)+")");n.find('span[data-method="sort"]').attr("data-value",e)},sensorsdata.MetaTable.prototype.render=function(t){var e=10,a=this,s=this.tableData_,n=s.rows,o=n.length/e+1;a.currentPage_=o>a.currentPage_?a.currentPage_:o;var i=sensorsdata.bind(function(n,o){n-=1,a.currentPage_=Math.ceil(o/e);var i=s.rows.slice(n,o);i.forEach(function(t){t.checked=a.checked.indexOf(t.id)>-1}),a.$tableContainer.find('[data-toggle="tooltip"]').tooltip("destroy");var r="";"boolean"!=typeof t||t?(r=Mustache.render(a.options.tpl,{rows:i,heads:s.heads}),a.$tableContainer.find("table").html(r)):(r=Mustache.render(a.options.tplBody,i),a.$tableContainer.find("table > tbody").html(r)),a.$tableContainer.find('[data-toggle="tooltip"]').tooltip(),a.checked.length?a.$tableContainer.find('input[type="checkbox"]').removeClass("opacity-input"):a.$tableContainer.find('input[type="checkbox"]').addClass("opacity-input"),sensorsdata.authority.isAdmin||a.$tableContainer.find('input[type="checkbox"], span.icon-edit, span.icon-add, [data-dict="true"]').remove(),$.isFunction(a.options.onRendered)&&a.options.onRendered(a.tableData_)},this);0===s.rows.length?(a.$tableContainer.find("table").html($("#tpl-table-nodata").html()),a.$tableContainer.find("#meta-table-pagination").html("").hide(),$.isFunction(a.options.onRendered)&&a.options.onRendered(a.tableData_)):s.rows.length<=e?(a.$tableContainer.find("#meta-table-pagination").html("").hide(),i(1,s.length)):sensorsdata.pagination({tableElement:a.$tableContainer.find("#meta-table-pagination").show(),totalItems:n.length,pageItems:e,pageIndex:a.currentPage_,clickHandle:sensorsdata.bind(function(t){i(t.range[0],t.range[1])},this)})},sensorsdata.MetaTable.prototype.reload=function(t,e){this.checked=e||[],this.options.tableData_=$.extend(!0,{},t),this.tableData_=this.filterData_(this.filter),this.render(!1)},sensorsdata.MetaTable.prototype.filterData_=function(t){var e=$.extend(!0,{},this.options.tableData_);for(var a in t)t.hasOwnProperty(a)&&(this.filter[a]=t[a]);var s=$.extend(!0,{},this.filter);if($.isArray(e.rows)&&e.rows.length>0){var n=function(t){return-1!==t.cname.toLowerCase().indexOf(s.inputFilter.toLowerCase())||-1!==t.name.toLowerCase().indexOf(s.inputFilter.toLowerCase())};return"visible"===s.visible?e.rows=e.rows.filter(function(t){return t.visible||t.is_in_use}):"invisible"===s.visible&&(e.rows=e.rows.filter(function(t){return!t.visible&&!t.is_in_use})),s.inputFilter&&(e.rows=e.rows.filter(function(t){return n(t)})),$.isArray(s.tags)&&s.tags.length>0&&(e.rows=e.rows.filter(function(t){return t.tags.some(function(t){return s.tags.indexOf(String(t.id))>-1})})),e}return{heads:e.heads,rows:[]}},sensorsdata.MetaTable.prototype.filterTable_=function(t,e){this.tableData_=this.filterData_(t),this.reset(),this.render(e)},sensorsdata.MetaTable.prototype.destroy=function(){this.$tableContainer.off("click.add"),this.$tableContainer.off("click.edit"),this.off("edit"),this.$tableContainer.off("click.dict"),this.$tableContainer.off("click.data-edit"),this.$tableContainer.off("blur",'input[type="text"]:visible'),this.$tableContainer.off("reload"),this.$tableContainer.off("update"),this.$tableContainer.off("change",'input[type="checkbox"]'),this.$tableContainer.off("click.head"),this.$tableContainer.off("mouseover"),this.$tableContainer.off("mouseout")}}();