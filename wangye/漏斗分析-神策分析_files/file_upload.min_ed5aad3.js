(function(){var b=0;function f(j){if(!(this instanceof f)){return new f(j)}if(a(j)){j={trigger:j}}var k={trigger:null,name:null,action:null,data:null,accept:null,change:null,error:null,multiple:true,success:null};if(j){$.extend(k,j)}var i=$(k.trigger);k.action=k.action||i.data("action")||"/upload";k.name=k.name||i.attr("name")||i.data("name")||"file";k.data=k.data||e(i.data("data"));k.accept=k.accept||i.data("accept");k.success=k.success||i.data("success");this.settings=k;this.setup();this.bind()}f.prototype.setup=function(){this.form=$('<form method="post" enctype="multipart/form-data"target="" action="'+this.settings.action+'" />');this.iframe=c();this.form.attr("target",this.iframe.attr("name"));var k=this.settings.data;this.form.append(h(k));if(window.FormData){this.form.append(h({_uploader_:"formdata"}))}else{this.form.append(h({_uploader_:"iframe"}))}var j=document.createElement("input");j.type="file";j.name=this.settings.name;if(this.settings.accept){j.accept=this.settings.accept}if(this.settings.multiple){j.multiple=true;j.setAttribute("multiple","multiple")}this.input=$(j);var i=$(this.settings.trigger);this.input.attr("hidefocus",true).css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",height:i.outerHeight(),fontSize:Math.max(64,i.outerHeight()*5)});this.form.append(this.input);this.form.css({position:"absolute",top:i.offset().top,left:i.offset().left,overflow:"hidden",width:i.outerWidth(),height:i.outerHeight(),zIndex:g(i)+10}).appendTo("body");return this};f.prototype.bind=function(){var j=this;var i=$(j.settings.trigger);i.mouseenter(function(){j.form.css({top:i.offset().top,left:i.offset().left,width:i.outerWidth(),height:i.outerHeight()})});j.bindInput()};f.prototype.bindInput=function(){var i=this;i.input.change(function(k){i._files=this.files||[{name:k.target.value}];var j=i.input.val();if(i.settings.change){i.settings.change.call(i,i._files)}else{if(j){return i.submit()}}})};f.prototype.submit=function(){var i=this;if(window.FormData&&i._files){var k=new FormData(i.form.get(0));k.append(i.settings.name,i._files);var l;if(i.settings.progress){var j=i._files;l=function(){var m=$.ajaxSettings.xhr();if(m.upload){m.upload.addEventListener("progress",function(q){var p=0;var n=q.loaded||q.position;var o=q.total;if(q.lengthComputable){p=Math.ceil(n/o*100)}i.settings.progress(q,n,o,p,j)},false)}return m}}$.ajax({url:i.settings.action,type:"post",processData:false,contentType:false,data:k,xhr:l,context:this,success:i.settings.success,error:i.settings.error});return this}else{i.iframe=c();i.form.attr("target",i.iframe.attr("name"));$("body").append(i.iframe);i.iframe.one("load",function(){$('<iframe src="javascript:false;"></iframe>').appendTo(i.form).remove();var m;try{m=$(this).contents().find("body").html()}catch(n){m="cross-domain"}$(this).remove();if(!m){if(i.settings.error){i.settings.error(i.input.val())}}else{if(i.settings.success){i.settings.success(m)}}});i.form.submit()}return this};f.prototype.refreshInput=function(){var i=this.input.clone();this.input.before(i);this.input.off("change");this.input.remove();this.input=i;this.bindInput()};f.prototype.change=function(i){if(!i){return this}this.settings.change=i;return this};f.prototype.success=function(j){var i=this;this.settings.success=function(k){i.refreshInput();if(j){j(k)}};return this};f.prototype.error=function(j){var i=this;this.settings.error=function(k){if(j){i.refreshInput();j(k)}};return this};f.prototype.enable=function(){this.input.prop("disabled",false);this.input.css("cursor","pointer")};f.prototype.disable=function(){this.input.prop("disabled",true);this.input.css("cursor","not-allowed")};function a(i){return Object.prototype.toString.call(i)==="[object String]"}function h(m){if(!m){return[]}var j=[],l;for(var k in m){l=document.createElement("input");l.type="hidden";l.name=k;l.value=m[k];j.push(l)}return j}function e(q){if(!q){return{}}var j={};var m=q.split("&");var n=function(i){return decodeURIComponent(i.replace(/\+/g," "))};for(var l=0;l<m.length;l++){var p=m[l].split("=");var k=n(p[0]);var o=n(p[1]);j[k]=o}return j}function g(j){var k=j.parentsUntil("body");var n=0;for(var l=0;l<k.length;l++){var m=k.eq(l);if(m.css("position")!=="static"){n=parseInt(m.css("zIndex"),10)||n}}return n}function c(){var j="iframe-uploader-"+b;var i=$('<iframe name="'+j+'" />').hide();b+=1;return i}function d(j){if(!(this instanceof d)){return new d(j)}if(a(j)){j={trigger:j}}var i=$(j.trigger);var k=[];i.each(function(l,m){j.trigger=m;k.push(new f(j))});this._uploaders=k}d.prototype.submit=function(){$.each(this._uploaders,function(j,k){k.submit()});return this};d.prototype.change=function(i){$.each(this._uploaders,function(j,k){k.change(i)});return this};d.prototype.success=function(i){$.each(this._uploaders,function(j,k){k.success(i)});return this};d.prototype.error=function(i){$.each(this._uploaders,function(j,k){k.error(i)});return this};d.prototype.enable=function(){$.each(this._uploaders,function(j,k){k.enable()});return this};d.prototype.disable=function(){$.each(this._uploaders,function(j,k){k.disable()});return this};d.Uploader=f;window.Uploader=f;window.MultipleUploader=d})();