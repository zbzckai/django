;/*!components/basicTable/basicTable.js*/
define("components/basicTable/basicTable",function(n,t){var a={decimal:"",emptyTable:"没有查找到数据",info:"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",infoEmpty:"显示第 0 至 0 项结果，共 0 项",infoFiltered:"(由 _MAX_ 项结果过滤)",infoPostFix:"",thousands:",",loadingRecords:"载入中...",processing:"载入中...",search:"搜索:",zeroRecords:"没有匹配结果",paginate:{first:"首页",last:"末页",next:'<span class="icon-collapse-up icon-collapse"></span>',previous:'<span class="icon-expand-down icon-collapse"></span>'},aria:{sortAscending:": 以升序排列此列",sortDescending:": 以降序排列此列"}},e={},i={bLengthChange:!1,fixedColumns:!1,fixedHeader:{header:!1,footer:!1},language:a,searching:!1,responsive:!1,iDisplayLength:50,info:!0},o=function(n){if($.fn.dataTable.ext.errMode="none",!n.container)throw new Error("无效的表格容器");if(!n.data)throw new Error("无效的数据结构");this.$container=n.container,n.tpl=$.extend(!0,{},e,n.tpl||{}),n.container.html(n.tpl.table()),n.container.find("table thead").html(n.tpl.header(n.data.header)),n.dataTableOption=$.extend(!0,{},i,n.dataTableOption||{}),n.dataTableOption.data=n.data.body||[],n.dataTableOption.drawCallback=function(){$.isFunction(n.customDrawCallback)&&n.customDrawCallback()},this.options=n,this.init()};o.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.instance=this.$container.find("table").DataTable(this.options.dataTableOption),this.bindEvents()},bindEvents:function(){var n=this;this.instance.on("page.dt",function(){var t=n.$container.offset().top;$(window).scrollTop(t-55)})},destroy:function(){this.instance&&$.isFunction(this.instance.destroy)&&this.instance.destroy()}}),t.create=function(n){return new o(n)}});
;/*!components/bookMarkSave/bookMarkSave.js*/
define("components/bookMarkSave/bookMarkSave",function(a,t){var e=function(a){if($.isEmptyObject(a))throw"options is empty when call New BookmarkSave(options)";this.defaultBookmark_={related_events:[]},this.defaultOptions_={disabled:sensorsdata.authority.isNormal,saveBarDisplay:!0,dialogTitleDisplay:!1,samplingDisplay:!0,refreshDisplay:!0,downloadDisplay:!0,container:$("#sa-main"),placement:"before",dialogAttachElement:null,dialogContainer:"body",dialogViewport:"",bookmarkId:"",showSessionDropdown:!1,sessionDropdownValue:"event",onSampleChanged:null,onRefreshClick:null,onDownloadClick:null,onBookmarkAdded:null,onBookmarkUpdated:null,onBookmarkDeleted:null,onSessionChanged:null,onBookmarkNameChanged:null,algDropdownDisplay:!1,onAlgChanged:null,dashboardDisplay:!0},this.options_=$.extend(!0,{},this.defaultOptions_,a),this.options_.samplingFactor=$.isNumeric(this.options_.samplingFactor)?parseInt(this.options_.samplingFactor,10):64,this.saveBar_=$($("#tpl-bookmark-save-bar").html()),this.btnRefresh_=this.saveBar_.find('button[data-method="refresh"]'),this.options_.saveBarDisplay===!0&&this.options_.container.prepend(this.saveBar_),this.tplDialog_=$("#tpl-bookmark-save-dialog").html(),this.dialog_=null,this.saveBarStyle_={add:{className:"glyphicon glyphicon-star-empty",text:sensorsdata.languages.get("保存为书签<!--{en}Save as bookmark-->")},update:{className:"glyphicon glyphicon-star",text:sensorsdata.languages.get("已保存<!--{en}Already saved-->")}},this.newBookmark_=$.extend(!0,{},this.defaultBookmark_),this.bookmark_={},this.options_.bookmarkId&&(this.bookmark_.id=this.options_.bookmarkId),this.dashboards_=[],this.samplingSlider_=null,this.init_()};e.prototype.setRefresh=function(a){this.setRefreshButton(this.saveBar_.find('button[data-method="refresh"]'),a)},e.prototype.show=function(){var a=this.options_.dialogAttachElement;this.getDialogId()||this.getDashboards_(sensorsdata.bind(function(t){this.dashboards_=t,this.renderDashboards_(t,this.bookmark_.dashboards),a.popover("show")},this))},e.prototype.close=function(a){var t=this.options_.dialogAttachElement;$.isFunction(a)&&t.bind("hidden.bs.popover",function(){a(),t.unbind("hidden.bs.popover")}),t.popover("hide")},e.prototype.getDialogId=function(){return this.options_.dialogAttachElement.attr("aria-describedby")},e.prototype.setName=function(a){a=a||"",this.dialog_.find("#bookmark-name").val(a),this.defaultBookmark_.name=a,this.bookmark_.id||(this.bookmark_.name=a),this.newBookmark_&&(this.newBookmark_.name=a)},e.prototype.clear=function(){this.bookmark_=$.extend(!0,{},this.defaultBookmark_),this.newBookmark_=$.extend(!0,{},this.defaultBookmark_),this.setSaveBar_(this.newBookmark_),this.dialog_.find("#bookmark-save-dialog-title").hide(),this.options_.dialogTitleDisplay=!1},e.prototype.initAlgDropDown_=function(a){var t=this;t.saveBar_.find("#alg-dropdown").toggleClass("disabled",sensorsdata.authority.isNormal),t.saveBar_.find("#alg-dropdown button").toggleClass("disabled",sensorsdata.authority.isNormal);var e=t.saveBar_.find('#alg-dropdown span[data-toggle="tooltip"]');"approximate"===a.algDropdownValue&&e.show().tooltip("destroy").tooltip({placement:"bottom",container:"body"}),t.saveBar_.find("#alg-dropdown button").saDropdown({value:a.algDropdownValue,onSelected:function(t){a.onAlgChanged(t),"approximate"===t?e.show().tooltip("destroy").tooltip({placement:"bottom",container:"body"}):e.hide().tooltip("destroy")}})},e.prototype.init_=function(){var a=this.options_;if(a.saveBarDisplay===!0){if(a.container instanceof jQuery!=!0)throw"saveBarDisplay is true, you must set container, and container must be a jQuery object.";this.saveBar_.find('[data-toggle="tooltip"]').tooltip()}else if(a.dialogAttachElement instanceof jQuery!=!0)throw"saveBarDisplay is false, you must set dialogAttachElement, and dialogAttachElement must be a jQuery object.";a.dialogAttachElement||(a.dialogAttachElement=this.saveBar_.find('[data-method="open-dialog"]'),a.dialogViewport="#sa-main"),this.dialog_=this.initDialog_(a.dialogAttachElement,a.dialogViewport),a.showSessionDropdown&&this.initSessionDropDown_(a),a.algDropdownDisplay&&this.initAlgDropDown_(a),this.saveBar_.bind("click",sensorsdata.bind(this.saveBarClick_,this)),this.dialog_.bind("click",sensorsdata.bind(this.dialogClick_,this)),this.saveBar_.is(":visible")&&(a.container.find("#sampling").toggle(a.samplingDisplay).next().toggle(a.samplingDisplay),a.samplingDisplay&&this.initSampleSlider_(),a.container.find('[data-method="refresh"]').toggle(a.refreshDisplay).prev().toggle(a.refreshDisplay),a.container.find('[data-method="download"]').toggle(a.downloadDisplay).prev().toggle(a.downloadDisplay),a.container.find("#alg-dropdown").toggle(a.algDropdownDisplay).next().toggle(a.algDropdownDisplay)),this.bookmark_.id?(this.dialog_.find('[data-method="delete"]').show(),sensorsdata.ajax({url:"bookmarks/bookmark/"+this.bookmark_.id,success:sensorsdata.bind(function(a){$.isEmptyObject(a)?sensorsdata.error.show(sensorsdata.languages.get("此书签不存在<!--{en}This bookmark does not exist-->")):(this.bookmark_=a,this.renderInput_(this.bookmark_,this.dashboards_),this.setSaveBar_(this.bookmark_),a.user_id!==sensorsdata.authority.userId&&this.dialog_.find("#bookmark-save-dialog-title").find('a[data-method="switch-add"]').addClass("active").siblings().removeClass("active"))},this)})):(this.dialog_.find('[data-method="delete"]').hide(),this.renderInput_(this.bookmark_,this.dashboards_),this.setSaveBar_(this.bookmark_))},e.prototype.initSessionDropDown_=function(a){var t=this;t.saveBar_.find("#session-dropdown").toggleClass("disabled",sensorsdata.authority.isNormal).show().prev().show(),t.saveBar_.find("#session-dropdown button").toggleClass("disabled",sensorsdata.authority.isNormal),sensorsdata.ajax({useCache:!0,url:"sessions/all",success:function(e){$.isArray(e)||(e=[]),t.saveBar_.find("#session-dropdown button").saDropdown({value:a.sessionDropdownValue,onSelect:function(){return 0===e.length&&sensorsdata.info.show(sensorsdata.languages.get('请先在“元数据”中创建 Session<!--{en}Please create Session in "metadata"-->')),e.length>0},onSelected:function(e){a.onSessionChanged(e),$.isFunction(t.options_.onBookmarkNameChanged)&&t.options_.onBookmarkNameChanged()}})}})},e.prototype.initSampleSlider_=function(){var a=this,t=this.options_,e=sensorsdata.BookmarkSave.dealSamplingValue(t.samplingFactor);e=Math.log(e)/Math.log(2);var o="#sampling-factor-slider",s=this.saveBar_.find(o),i=this.saveBar_.find("#sampling-factor-label"),n=function(a){return 64===a?sensorsdata.languages.get("全量<!--{en}Total-->"):"1/"+64/a};i.text(n(t.samplingFactor)),s.val(e),this.samplingSlider_=new Slider(o,{value:e,tooltip_position:"bottom",formatter:function(t){return 6===t?sensorsdata.languages.get("对全量数据计算<!--{en}Total data calculation-->"):(t=a.getSamplingValue(t),sensorsdata.util.format(sensorsdata.languages.get("对全量数据抽样1/#{value}计算<!--{en}1/#{value} random sample of total data calculation-->"),{value:64/t}))}}),sensorsdata.authority.isNormal&&this.samplingSlider_.disable(),s.on("change",function(){var e=a.getSamplingValue();i.text(n(e)),$.isFunction(a.options_.onSampleChanged)&&t.onSampleChanged(e),sensorsdata.track("sampling")})},e.prototype.initDialog_=function(a,t){var e=this.options_,o=$(this.tplDialog_),s=$($("#tpl-bookmark-save-dialog-content").html()),i={trigger:"manual",container:e.dialogContainer,content:s,template:o,html:!0,placement:"auto bottom"};return t&&(i.viewport={selector:t,padding:5}),a.popover(i).on("shown.bs.popover",sensorsdata.bind(function(){$("body").bind("click.bookmarksave",sensorsdata.bind(function(a){var t=$(a.target||a.srcElement),e=this.getDialogId();e&&0===t.parents('div[id="'+e+'"]').size()&&this.close()},this))},this)).on("hide.bs.popover",function(){$("body").unbind("click.bookmarksave")}).on("hidden.bs.popover",sensorsdata.bind(function(){this.dialog_.find("#bookmark-save-dialog-form").show(),this.dialog_.find("#bookmark-save-dialog-footer").show(),this.dialog_.find("#bookmark-save-dialog-delete").hide(),this.dialog_.find("#bookmark-save-dialog-footer-delete").hide()},this)),o.add(s)},e.prototype.setSaveBar_=function(a){var t=this.saveBarStyle_[a.id?"update":"add"],e=this.saveBar_.find('a[data-method="open-dialog"]');e.find("span:first").attr("class",t.className),e.find("span").eq(1).text(a.id?a.name:t.text),this.options_.disabled===!0&&(e.addClass("disabled").removeAttr("data-method"),e.find("span:first").attr("class",t.className).addClass("disabled"))},e.prototype.toggleDisabledStatus=function(a){var t=this.saveBar_.find("div.bookmark-save-wrap > a");a?(t.addClass("disabled").removeAttr("data-method"),t.find("span:first").addClass("disabled")):(t.removeClass("disabled").attr("data-method","open-dialog"),t.find("span:first").removeClass("disabled"))},e.prototype.renderInput_=function(a,t){if(this.dialog_.find("#bookmark-save-dialog-title").toggle(!($.isEmptyObject(a)||a.id)),$.isEmptyObject(a))return this.dialog_.find("#bookmark-save-dialog-title").toggle(!1),!1;var e=this.dialog_.find("#bookmark-save-dialog-title");return e.toggle(this.options_.dialogTitleDisplay===!0),this.dialog_.find('div[data-for="bookmark-id"]').toggle(!!a.id),this.dialog_.find("#bookmark-save-dialog-title").toggle(!!a.id),a.id&&this.dialog_.find('div[data-for="bookmark-id"] #bookmark-id').val(a.id),this.dialog_.find("#bookmark-name").val(a.name||""),this.renderDashboards_(t,a.dashboards),!0},e.prototype.renderDashboards_=function(a,t){if($.isArray(a)){if(!this.options_.dashboardDisplay)return this.dialog_.find("div.form-group:last-child").hide(),void this.dialog_.find("div.form-group > p.help-block").show();var e=Mustache.render($("#tpl-bookmark-save-dialog-dashboards").html(),{dashboards:a}),o=this.dialog_.find("#bookmark-dashboard").html(e).find("select");o.multiselect("destroy"),o.multiselect({nonSelectedText:sensorsdata.languages.get(0===a.length?"请先创建数据概览<!--{en}Please create a dashboard first-->":"请选择数据概览<!--{en}Select dashboard-->"),enableCaseInsensitiveFiltering:!1}),$.isArray(t)&&t.length>0?o.multiselect("select",t):o.multiselect("deselectAll",!1)}},e.prototype.saveBarClick_=function(a){var t=$(a.target||a.srcElement);t.attr("data-method")||(t=t.parents("[data-method]:first"));var e=t.attr("data-method");switch(e){case"open-dialog":var o=this.dialog_.find("#bookmark-save-dialog-title a.active").attr("data-method"),s=this.bookmark_;this.options_.dialogTitleDisplay===!0&&"switch-add"===o&&(s=this.newBookmark_);var i=sensorsdata.bind(function(a){this.dashboards_=a,this.renderInput_(s,this.dashboards_),this.show()},this);$.isArray(this.dashboards_)&&this.dashboards_.length>0?i(this.dashboards_):this.getDashboards_(i);break;case"refresh":!t.hasClass("refreshing")&&$.isFunction(this.options_.onRefreshClick)&&(this.btnRefresh_.addClass("refreshing"),sensorsdata.disableReportAjaxCache(),this.options_.onRefreshClick(sensorsdata.bind(function(){this.btnRefresh_.removeClass("refreshing")},this)),sensorsdata.enableReportAjaxCache());break;case"download":$.isFunction(this.options_.onDownloadClick)&&this.options_.onDownloadClick()}},e.prototype.dialogClick_=function(a){var t=$(a.target||a.srcElement);t.attr("data-method")||(t=t.parents("[data-method]:first"));var e=this.options_,o=this.bookmark_.id,s=this.dialog_.find("#bookmark-save-dialog-form"),i=this.dialog_.find("#bookmark-save-dialog-footer"),n=this.dialog_.find("#bookmark-save-dialog-delete"),r=this.dialog_.find("#bookmark-save-dialog-footer-delete"),d=t.attr("data-method");switch(d){case"switch-add":$.extend(!0,this.bookmark_,this.buildBookmark_()),this.newBookmark_.name||(this.newBookmark_.name=this.bookmark_.name),this.getBookmarks_(function(a){this.newBookmark_.name=this.buildBookmarkName_(a,this.newBookmark_),this.renderInput_(this.newBookmark_,this.dashboards_)}),t.addClass("active").siblings().removeClass("active"),this.dialog_.find('[data-method="delete"]').hide();break;case"switch-update":this.newBookmark_=this.buildBookmark_(),this.renderInput_(this.bookmark_,this.dashboards_),this.dialog_.find('[data-method="delete"]').show(),t.addClass("active").siblings().removeClass("active");break;case"delete":n.find("#name-delete").text(this.bookmark_.name),$.isArray(this.bookmark_.dashboards)&&this.bookmark_.dashboards.length>0?n.find("#dashboard-delete").text(this.dialog_.find("#bookmark-dashboard span.multiselect-selected-text").text()).parent().show():n.find("#dashboard-delete").parent().hide(),this.dialog_.find("#bookmark-save-dialog-title").hide(),n.height(s.height()+15),s.hide(),i.hide(),n.show(),r.show();break;case"confirm-delete":sensorsdata.ajax({method:"DELETE",url:"bookmarks/bookmark/"+o,success:sensorsdata.bind(function(){this.close();var a=sensorsdata.unparam(window.location.hash);if("/dashboard/"===window.pageName){var t=this.bookmark_.dashboards||[];$.isNumeric(a.dashid)&&-1!==t.indexOf(parseInt(a.dashid,10))&&sensorsdata.indexPage.refresh()}this.newBookmark_=$.extend(!0,{},this.defaultBookmark_),this.bookmark_=$.extend(!0,{},this.defaultBookmark_),this.renderInput_(this.bookmark_,this.dashboards_),this.setSaveBar_(this.bookmark_),$.isFunction(e.onBookmarkDeleted)&&e.onBookmarkDeleted(o);var d=sensorsdata.CONSTSET.bookmarkId;delete a[d];var l="#"+$.param(a);window.history.pushState(l,"",l),$.isFunction(e.onBookmarkNameChanged)&&e.onBookmarkNameChanged(),this.options_.dialogTitleDisplay=!1,s.show(),i.show(),n.hide(),r.hide()},this)});break;case"cancel-delete":case"cancel":this.close();break;case"save":var l=null,h=1===this.dialog_.find('a.active[data-method="switch-update"]').size();if(h===!0){if(this.bookmark_.id&&this.bookmark_.user_id&&this.bookmark_.user_id!==sensorsdata.authority.userId)return void sensorsdata.info.show(sensorsdata.languages.get("无权更新其他人的书签，你可以保存为新书签<!--{en}No permission to update other people's bookmarks, you can save as a new bookmark-->"));this.bookmark_.dashboards=[],l=$.extend(!0,this.bookmark_,this.buildBookmark_())}else l=$.extend(!0,this.newBookmark_,this.buildBookmark_());this.save_(l);break;case"dashboard":case"bookmark-item":t.parent().hasClass("disabled")||(t.parents("ul:first").find("li.active").removeClass("active"),t.parents("li:first").addClass("active"),t.parents("div:first").find("span.selected").text(t.text()).attr("data-value",t.attr("data-value")))}},e.prototype.save_=function(a){var t=sensorsdata.bind(function(a,t){var e=sensorsdata.unparam(window.location.hash),o=a.id+"",s=sensorsdata.CONSTSET.bookmarkId,i="";t?(e[s]=a.id,i="#"+$.param(e),window.history.pushState(i,"",i)):e[s]&&e[s]===o&&(i="#"+$.param(e),window.history.pushState(i,"",i))},this),e=sensorsdata.bind(function(a){if(a.id)sensorsdata.ajax({method:"POST",url:"bookmarks/bookmark/"+a.id,data:JSON.stringify(a),success:sensorsdata.bind(function(){this.close(),this.setSaveBar_(a),$.isFunction(this.options_.onBookmarkUpdated)&&this.options_.onBookmarkUpdated(a),t(a),$.isFunction(this.options_.onBookmarkNameChanged)&&this.options_.onBookmarkNameChanged()},this)});else{var e={success:!0,add_dashboard:a.dashboards.length>0,from_analytics:sensorsdata.CONSTSET.urlMap[a.type]};sensorsdata.ajax({method:"POST",url:"bookmarks/bookmark",data:JSON.stringify(a),error:function(a){e.success=!1,e.fail_reason=a.status,sensorsdata.track("create_bookmark",e)},success:sensorsdata.bind(function(o){return sensorsdata.track("create_bookmark",e),$.isEmptyObject(o)||!$.isNumeric(o.id)?void sensorsdata.error.show(sensorsdata.languages.get("保存书签失败，数据格式错误，请联系技术人员<!--{en}Fail to save the bookmark, the data format is error, please contact with the technicians-->")):(a.id=o.id,this.close(),this.bookmark_=a,this.setSaveBar_(a),this.dialog_.find('[data-method="delete"]').show(),this.newBookmark_=$.extend(!0,{},this.defaultBookmark_),this.dialog_.find("#bookmark-save-dialog-title").find('a[data-method="switch-update"]').addClass("active").siblings().removeClass("active"),this.options_.dialogTitleDisplay=!0,$.isFunction(this.options_.onBookmarkAdded)&&this.options_.onBookmarkAdded(a),t(a,!0),void($.isFunction(this.options_.onBookmarkNameChanged)&&this.options_.onBookmarkNameChanged()))},this)})}},this);a.name&&this.getBookmarks_(function(t){a.name=this.buildBookmarkName_(t,a),e(a)})},e.prototype.buildRelatedEvents_=function(a){var t=JSON.parse(a.data),e=[];if("/segmentation/"===a.type){var o=new sensorsdata.SegmentationBase;t=o.dealParam(t),e=o.getEventNamesFromParam(t.measures)}else if("/retention/"===a.type){var s=new sensorsdata.RetentionBase;t=s.dealParam(t),e.push(t.first_event.event_name),e.push(t.second_event.event_name)}else"/addiction/"===a.type&&(t=sensorsdata.RetentionAddictionPage.dealParam(t),e.push(t.event_name));return e},e.prototype.buildBookmarkName_=function(a,t){var e=t.name,o=/^(\S+)\((\d+)\)$/,s=o.exec(e),i=0;$.isArray(s)&&3===s.length&&(e=s[1],i=parseInt(s[2],10)-1);for(var n in a)if(a.hasOwnProperty(n))for(var r=0,d=a[n].length;d>r;r++){var l=a[n][r];if(t.id&&t.id===l.id&&t.name===l.name)break;var h=a[n][r].name,m=a[n][r].id.toString();s=o.exec(h),$.isArray(s)&&3===s.length?(h=s[1],e===h&&(t.id||"").toString()!==m&&(i=parseInt(s[2],10)>i?parseInt(s[2],10):i)):0===i&&e===h&&(i=1)}return 0!==i?(e=e+"("+(parseInt(i,10)+1)+")",this.setName(e),e):t.name},e.prototype.getBookmarks_=function(a){$.isFunction(a)&&(a=sensorsdata.bind(a,this),sensorsdata.ajax({url:"bookmarks/all",success:sensorsdata.bind(function(t){$.isPlainObject(t)&&a(t)},this)}))},e.prototype.getDashboards_=function(a){$.isFunction(a)&&sensorsdata.ajax({url:"dashboards",success:sensorsdata.bind(function(t){$.isArray(t)&&a(t.filter(function(a){return a.user_id===sensorsdata.authority.userId}))},this)})},e.prototype.getSamplingValue=function(a){return(!$.isNumeric(a)||0>a||a>6)&&(a=parseInt(this.saveBar_.find("#sampling-factor-slider").val(),10)),(0>a||a>6)&&(a=6),Math.pow(2,a)},e.dealSamplingValue=function(a){return $.isNumeric(a)?(a=parseInt(a,10),Math.log(a)/Math.log(2)%1!==0?64:a>64?64:a):64},e.prototype.buildBookmark_=function(){var a=$.extend(!0,{},this.defaultBookmark_);return a.name=this.dialog_.find("#bookmark-name").val(),this.options_.saveBarDisplay!==!0&&this.bookmark_.id||(a.type=window.location.pathname,a.data=this.buildBookmarkData_(),a.related_events=this.buildRelatedEvents_(a)),a.dashboards=[],this.dialog_.find("#bookmark-dashboard :checkbox:checked").each(function(t,e){var o=$(e).val();$.isNumeric(o)&&a.dashboards.push(parseInt(o,10))}),a},e.prototype.buildBookmarkData_=function(){var a=window.location.pathname,t=sensorsdata.unparam(window.location.hash);if("/segmentation/"===a)t=(new sensorsdata.SegmentationBase).dealParam(t);else if("/retention/"===a){var e=new sensorsdata.RetentionBase;t=e.dealParam(t)}else"/addiction/"===a?t=sensorsdata.RetentionAddictionPage.dealParam(t):"/user_analytics/"===a?t=sensorsdata.UserAnalyticsIndexPage.dealParam(t):$.isArray(t.bucket_param)&&(t.bucket_param=sensorsdata.buildBucketPopoverValue(t.bucket_param),t.sampling_factor&&(t.sampling_factor=sensorsdata.BookmarkSave.dealSamplingValue(t.sampling_factor)));return JSON.stringify(t)},e.buildTimeText=function(a){if(a.time)return sensorsdata.convertRelativeTimeLabel(a.time);var t=JSON.parse(a.data);if(t.from_date&&t.to_date){if("/segmentation/"===a.type){var e=sensorsdata.CONSTSET,o="hour"!==t.unit&&"minute"!==t.unit||t.compare_from_date||t.compare_to_date?e.dateFormat:sensorsdata.languages.get("YYYY-MM-DD HH时<!--{en}YYYY-MM-DD HH time-->");return moment(t.from_date,e.timeFormat).format(o)+e.dateRangeSplit+moment(t.to_date,e.timeFormat).format(o)}return t.from_date+sensorsdata.CONSTSET.dateRangeSplit+t.to_date}return""},e.setRefreshButton=function(a,t){function e(){var a=sensorsdata.languages.get("数据更新时间：<!--{en}Data update time: -->")+n.format("M-D H:mm:ss")+" ";return r&&(a+=sensorsdata.languages.get("由于数据变化较小，系统没有更新数据。<!--{en}Because the data change is less than 1%, the system does not update the data.-->")),a+=sensorsdata.languages.get("点击按钮，强制刷新。<!--{en}Click on the button to force refresh.-->")}function o(){a.parents("body").length<=0?sensorsdata.languages.off("change",o):a.attr("data-original-title",e())}if(t.data_update_time&&t.report_update_time){var s=sensorsdata.CONSTSET.timeFormat,i=moment(t.data_update_time,s),n=moment(t.report_update_time,s);if(moment.isMoment(i)&&moment.isMoment(n)){var r=i.isAfter(n);sensorsdata.languages.on("change",o),a.toggleClass("changed",r).attr("data-original-title",e())}}},t.create=function(a){return new e(a)}});
;/*!components/bookmarkSetDialog/bookmarkSetDialog.js*/
define("components/bookmarkSetDialog/bookmarkSetDialog",function(e,a,t){var n={template:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover popover-bookmark" role="tooltip">\n  <div class="arrow"></div>\n  <h3 class="popover-title"></h3>\n  <div class="popover-content"></div>\n  <div class="popover-content-footer clearfix">\n  </div>\n</div>'},useData:!0}),title:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return""},useData:!0}),content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var o,s=a.helperMissing,r="function",l=this.escapeExpression;return'<div>\n  <span class="label-input">书签名<!--{en}Bookmark name--></span>\n  <input type="text" name="name" value="'+l((o=null!=(o=a.title||(null!=e?e.title:e))?o:s,typeof o===r?o.call(e,{name:"title",hash:{},data:n}):o))+'" placeholder="请输入书签名称" data-lang-placeholder="<!--{en}Please input the bookmark name-->" autocomplete="off" />\n</div>\n<div class="bookmark-comment">\n  <span class="label-input">备注<!--{en}Remarks--></span>\n  <textarea rows="5" cols="21" placeholder="可输入备注信息" value="'+l((o=null!=(o=a.comment||(null!=e?e.comment:e))?o:s,typeof o===r?o.call(e,{name:"comment",hash:{},data:n}):o))+'">'+l((o=null!=(o=a.comment||(null!=e?e.comment:e))?o:s,typeof o===r?o.call(e,{name:"comment",hash:{},data:n}):o))+"</textarea>\n</div>"},useData:!0}),footer:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover-footer-right">\n  <button type="button" class="pop-is-cancel btn btn-link btn-small">取消<!--{en}Cancel--></button>\n  <button type="button" class="pop-is-success btn btn-primary btn-small">确定<!--{en}Confirm--></button>\n</div>'},useData:!0})},o=$.extend(!0,{},sensorsdata.EventsModule,{show:function(e){if(!e.ele)throw new Error("无效的触发元素");var a="";e.bookmarkid?a=sensorsdata.languages.get("更新当前书签<!--{en}Update current bookmarks-->"):"save-as"===e.mode?a=sensorsdata.languages.get("另存为新书签<!--{en}Save as a new bookmark-->"):"save"===e.mode?a=sensorsdata.languages.get("保存为书签<!--{en}Save as bookmark-->"):"save-add"===e.mode&&(a=sensorsdata.languages.get("保存为书签并添加到概览<!--{en}Save as bookmark and add to dashboard-->")),sensorsdata.popover({ele:e.ele,container:"body",placement:"bottom",showNow:!0,content:n.content(e),template:n.template(),title:a,footer:n.footer(),onShow:function(a){var t=a.$tip.find("input[name=name]");sensorsdata.form.removeChildrenError(a.$tip),t.focus();var n=t.val().length;t[0].setSelectionRange(n,n),a.$tip.find(".pop-is-success").unbind("click").bind("click",function(){var n=$.trim(t.val());if(!n)return void sensorsdata.form.addError(t,t.attr("placeholder"),!0,{container:a.$tip,placement:"top"});var o=e.bookmarkid||"",s=a.$tip.find("textarea").val().trim();$.isFunction(e.success)&&e.success({bookmarkid:o,title:n,comment:s}),a.destroy()})}})}});t.exports=o});
;/*!components/util/findMinMax.js*/
define("components/util/findMinMax",function(n,a,t){var i=function(n,a){var t=[n[0].data[0][a],n[0].data[0][a]];return n.map(function(n){n.data.map(function(n){n[a]>t[1]&&(t[1]=n[a]),n[a]<t[0]&&(t[0]=n[a])})}),t};t.exports=i});
;/*!components/util/filterRows.js*/
define("components/util/filterRows",function(n,e,a){var t=function(n,e){var a={};$.isArray(n)&&1===n.length&&"saAll"===n[0]?(n=[],e.map(function(e,t){a[e.name]=t,n.push(e.name)})):$.isArray(n)&&n.length>0?e.filter(function(e,t){-1!==n.indexOf(e.name)&&(a[e.name]=t)}):(n=[],e.map(function(e,t){a[e.name]=t,n.push(e.name)}));var t=[];return n.map(function(n){a[n]>=0&&t.push(e[a[n]])}),t};a.exports=t});
;/*!components/util/buildYAxis.js*/
define("components/util/buildYAxis",function(e,t,r){var s=function(e){var t=$.extend(!0,{},sensorsdata.echarts.option.yAxis,{scale:!!e.scale,splitNumber:e.widgetMode?3:5,axisLabel:{formatter:function(t){return e.widgetModel===!0?sensorsdata.formatNumber(t,!0):sensorsdata.formatNumber(t,!0)+(e.isNormalize?"%":"")},textStyle:{color:"#8492A6"}}});return e.isNormalize&&(t.mix=0,t.max=100,t.interval=20,t.scale=!1,delete t.splitNumber),t};r.exports=s});
;/*!components/util/findColor.js*/
define("components/util/findColor",function(n,t,e){var r=function(n,t){var e=sensorsdata.CONSTSET.chartsColors;if(n[t])return n[t];for(var r=Object.keys(n),o=r.map(function(t){return n[t]}),f=0,i=e.length;i>f;f++)if(-1===o.indexOf(e[f]))return n[t]=e[f],e[f];return n[t]=e[(o.length+1)%e.length],e[(o.length+1)%e.length]};e.exports=r});
;/*!components/util/normalize.js*/
define("components/util/normalize",function(n,e,o){var t=function(n,e){return e[0]>0?Math.round(n/e[1]*1e4)/100:n>=0?Math.round(n/e[1]*1e4)/100:-Math.round(n/e[0]*1e4)/100};o.exports=t});
;/*!components/util/formatLineData.js*/
define("components/util/formatLineData",function(e,t,a){var r=e("components/util/findMinMax"),i=e("components/util/filterRows"),o=e("components/util/buildYAxis"),n=e("components/util/findColor"),s=e("components/util/normalize"),l=function(e,t){if(!e.data||$.isEmptyObject(e.data))throw new Error("无效的分析模型数据");if(!e.data.result||$.isEmptyObject(e.data.result))throw new Error("无效的查询结果");if(!e.type||"string"!=typeof e.type)throw new Error("无效的模块名");var a={},l={},m=e.config||{},d=e.data,u=e.queryParams;switch(e.type){case"segmentation":if($.isEmptyObject(u))throw new Error("无效的查询参数");if(!u.unit)throw new Error("无效的时间单位");var c=d.result||{};if($.isEmptyObject(c))throw new Error("无效的空数据");var f=d.compareResult||{};m.byFields=$.isArray(m.byFields)?$.extend(!0,[],m.byFields):[];var y=$.isArray(m.measureIndexs)?$.extend(!0,[],m.measureIndexs):[],h=sensorsdata.CONSTSET,p=sensorsdata.echarts,b=c.series,w=f.series,x=i(m.byFields,c.rows),g=[],v=u.unit,S=!!m.widgetMode,A=!$.isEmptyObject(f)&&$.isArray(f.series)&&f.series.length>0&&$.isArray(f.rows)&&f.rows.length>0;if(A)for(var E=null,O=null,L=0;L<b.length||L<w.length;L++){var N=moment(b[L],h.timeFormat),F=moment(w[L],h.timeFormat);N.isValid()||(N=E.add(1,v)),F.isValid()||(F=O.add(1,v)),g.push(sensorsdata.formatTime([N,F],v,!1,!1)),E=N,O=F}else g=b.map(function(e){return sensorsdata.formatTime(moment(e,h.timeFormat),v,!1,!1)});var T={data:[]},z=[],C=S&&g.length<=10||!S&&g.length<=20,I=["solid","dashed","dotted"],j=[],M=S?6:9,V=S?1.4:1.6,k=u.measures.length>1,H=(u.by_fields||[]).length>0,U=m.axisConfig||{right:[],left:[]},P=U.isNormalize;if(A){var Z=i(m.byFields,f.rows);u.measures.map(function(e,t){var a=0;if(-1!==y.indexOf(t)){-1!==U.right.indexOf(t)&&(a=1,U.type="double");var i=I[y.indexOf(t)],m=e.text.join("的"),d=e.unit;z.push(o({scale:!0,widgetMode:S,isNormalize:P}));var u=P?r(x,t):[],c=P?r(Z,t):[];x.map(function(e,r){var o=n(l,e.name),f="";f=H?k?sensorsdata.trimConstHtml(e.name)+"-"+m:sensorsdata.trimConstHtml(e.name):m,T.data.push({name:f,icon:p.createLineLegendIcon(i,o)}),j.push({name:f,type:"line",yAxisIndex:P?0:a,showAllSymbol:C,symbol:"circle",symbolSize:M,itemStyle:{normal:{color:o}},lineStyle:{normal:{type:i,color:o,width:V}},data:e.data.map(function(e,a){var r=P?s(e[t],u):e[t];return{value:r,rawValue:e[t],itemStyle:{normal:{color:o}},measureName:m,measureUnit:d,xLabel:sensorsdata.formatTime(b[a],v,!0)}})}),j.push({name:f,type:"line",yAxisIndex:P?0:a,showAllSymbol:C,symbol:"circle",symbolSize:M,itemStyle:{normal:{color:o,opacity:"0.4"}},lineStyle:{normal:{type:i,color:o,width:V,opacity:"0.4"}},data:Z[r].data.map(function(e,a){var r=P?s(e[t],c):e[t];return{value:r,rawValue:e[t],itemStyle:{normal:{color:o}},measureName:m,measureUnit:d,xLabel:sensorsdata.formatTime(w[a],v,!0)}})})})}})}else u.measures.map(function(e,t){var a=0;if(-1!==y.indexOf(t)){-1!==U.right.indexOf(t)&&(a=1,U.type="double");var i=I[y.indexOf(t)],m=e.text.join("的"),d=e.unit;z.push(o({widgetMode:S,scale:!0,isNormalize:P}));var u=U.isNormalize?r(x,t):[];x.map(function(e){var r=n(l,e.name),o="";o=H?k?sensorsdata.trimConstHtml(e.name)+"-"+m:sensorsdata.trimConstHtml(e.name):m,T.data.push({name:o,icon:p.createLineLegendIcon(i,r)}),j.push({name:o,type:"line",yAxisIndex:P?0:a,showAllSymbol:C,symbol:"circle",symbolSize:M,itemStyle:{normal:{color:r}},lineStyle:{normal:{type:i,color:r,width:V}},data:e.data.map(function(e,a){var i=P?s(e[t],u):e[t];return{value:i,itemStyle:{normal:{color:r}},rawValue:e[t],measureName:m,measureUnit:d,xLabel:sensorsdata.formatTime(b[a],v,!0)}})})})}});var R={show:!1};if(!S){var q=b.length;A&&w.length>q&&(q=w.length);var D=p.sets.dataZoom;q>D&&(R.show=!0,R.start=0,R.end=100)}var W=function(e){return e.data.xLabel+"</br>"+Mustache.escape(p.truncateLabel(e.seriesName,50))+"："+sensorsdata.formatNumber(e.data.rawValue)+" "+e.data.measureUnit},Y={trigger:"axis",axisPointer:{lineStyle:{width:0}},formatter:function(e){if($.isArray(e))for(var t=0,a=e.length;a>t;t++)if(e[t]&&e[t].data){e=e[t];break}return sensorsdata.echarts.wrapTriangleTooltip(W(e))}};if(S&&(Y.axisPointer={lineStyle:{width:1,color:"#aaa"}},Y.formatter=function(){return""},Y.backgroundColor="rgba(50,50,50,0)",Y.borderWidth=0,delete Y.position),a={tooltip:Y,legend:T,dataZoom:R,xAxis:{data:g},series:j},S||(a.grid={bottom:20,left:10}),a=$.extend(!0,{},p.option,a),P)z=z.slice(0,1);else{var _=!1,B=!1;y.forEach(function(e){-1!==U.left.indexOf(e)&&(_=!0),-1!==U.right.indexOf(e)&&(B=!0)}),_&&B?(z=z.slice(0,2),z[1].splitLine.show=!1):!_&&B?(z=z.slice(-1),z[0].position="right",a.series.forEach(function(e){e.yAxisIndex=0})):z=z.slice(0,1)}a.yAxis=z,a.dataZoom.show&&(a.legend.bottom=40,a.grid.bottom=90);break;case"funnel":break;case"retention":break;case"addiction":}$.isFunction(t)&&t(a)};a.exports=l});
;/*!components/util/float.js*/
define("components/util/float",function(t,n,e){var r=function(t){return-1!==(t+"").toString().indexOf(".")},i=function(t,n){var e,r,i;t+="",n+="";try{r=t.split(".")[1].length}catch(a){r=0}try{i=n.split(".")[1].length}catch(a){i=0}return e=Math.pow(10,Math.max(r,i)),(t*e+n*e)/e};sensorsdata.isNumeric=function(t){return $.isNumeric(t)?!0:(t=(t+"").replace(/,/g,""),"%"===t[t.length-1]&&(t=t.substring(0,t.length-1)),$.isNumeric(t))},e.exports={isFloat:r,addNumber:i}});
;/*!components/util/formatStackData.js*/
define("components/util/formatStackData",function(t,e,o){var a=t("components/util/filterRows"),r=t("components/util/buildYAxis"),n=t("components/util/findColor"),i=t("components/util/float").addNumber,s=function(t,e){if(!t||$.isEmptyObject(t.config))throw new Error("无效的配置参数");if(!t.data||$.isEmptyObject(t.data))throw new Error("无效的分析模型数据");if(!t.type||"string"!=typeof t.type)throw new Error("无效的模块名");var o={},s=t.config,l=sensorsdata.echarts,m=sensorsdata.CONSTSET,d={},c=t.data,p=t.queryParams;switch(t.type){case"segmentation":if($.isEmptyObject(p))throw new Error("无效的查询参数");var u=c.result||{};if($.isEmptyObject(u))throw new Error("无效的空数据");var y=c.compareResult||{};if(!$.isEmptyObject(y))throw new Error("累积图不支持对比");s.byFields=$.isArray(s.byFields)?$.extend(!0,[],s.byFields):[];var f=(p.by_fields.length||[]).length>0,h=p.unit,w=u.series,b=a(s.names_,u.rows),g=w.map(function(t){return sensorsdata.formatTime(moment(t,m.timeFormat),h,!1,!1)}),E=!!s.widgetMode,v={show:!E,data:[]},x=[],S=E&&g.length<=10||!E&&g.length<=30,j=E?6:8,O=[];s.queryData.measures.map(function(t,e){var o=t.text.join(),a=t.unit;x.push(r(!0,!1)),b.map(function(t){var r=f?sensorsdata.trimConstHtml(t.name):o,s=n(d,t.name);v.push({name:r,icon:l.createLineLegendIcon("solid",s)});var m=0;O.push({name:r,type:"line",showAllSymbol:S,symbol:"circle",symbolSize:j,stack:o,areaStyle:{normal:{opacity:.4}},itemStyle:{normal:{color:s}},lineStyle:{normal:{type:"solid",color:s}},data:t.data.map(function(t,r){var n=i(t[e],m);return m=n,{value:n,rawValue:t[e],measureName:o,measureUnit:a,xLabel:sensorsdata.formatTime(w[r],h,!0)}})})})});var F={show:!1};o={legend:v,dataZoom:F,aAxis:{boundaryGap:!0,data:g},series:O,tooltip:{textStyle:{fontWeight:"normal",fontSize:13},trigger:"axis",axisPointer:{type:"line",label:{show:!1}}}},E&&(o.tooltip.axisPointer={lineStyle:{width:1,color:"#aaa"}},o.tooltip.formatter=function(){return""},o.tooltip.backgroundColor="rgba(50,50,50,0)",o.tooltip.borderWidth=0,delete o.tooltip.position,o.grid={bottom:0,left:10}),o=$.extend(!0,{},l.option,o),$.isFunction(e)&&e(o)}};o.exports=s});
;/*!components/util/formatColumnData.js*/
define("components/util/formatColumnData",function(a,t,e){var r=a("components/util/findMinMax"),n=a("components/util/filterRows"),o=a("components/util/buildYAxis"),i=a("components/util/findColor"),s=a("components/util/normalize"),m=function(a,t){if("function"!=typeof t)throw new Error("formatColumnData 方法的第二个参数必须是 function 类型");var e=a.data,r=a.config,n=a.queryParams;if("object"!=typeof e||"object"!=typeof r||"string"!=typeof a.type||!n||"object"!=typeof n.measures)throw new Error("无效的配置")},l=function(a,t){m(a,t);var e=sensorsdata.echarts,l={measureIndexs:[],byFields:[],axisConfig:{}};$.extend(!0,l,a.config);var u=a.queryParams,d=a.data.result,f=a.data.compareResult,c=u.measures,p=l.measureIndexs,h=l.byFields,x=$.extend(!0,{left:[],right:[],isNormalize:!1},l.axisConfig),v=l.widgetModel,g=[],y=[],b=!$.isEmptyObject(f)&&$.isArray(f.series)&&f.series.length>0&&$.isArray(f.rows)&&f.rows.length>0,w=(u.by_fields||[]).length>0,N={};c.map(function(a){var t=a.text.join("的");a.unit&&(t+="("+a.unit+")"),g.push(t)});var M=[];p.map(function(a){M.push(c[a]),y.push(g[a])}),h=$.isArray(h)&&h.length>0?$.extend(!0,[],h):g.length>1?[g.join("，")]:g;var A;switch(a.type){case"segmentation":var C=x.isNormalize,V=sensorsdata.CONSTSET,j=d.series,S=b?f.series:[],O=n(h,d.rows),E={show:!0,data:O.map(function(a){return{name:sensorsdata.trimConstHtml(a.name)}})};w||1===p.length||(E.formatter=function(){return sensorsdata.languages.get("从左至右依次是<!--{en}From left to right-->")+y.join("、")},E.itemWidth=0);var T=[],F=u.unit;if(b)for(var I=null,U=null,k=0;k<j.length||k<S.length;k++){var z=moment(j[k],V.timeFormat),L=moment(S[k],V.timeFormat);z.isValid()||(z=I.add(1,F)),L.isValid()||(L=U.add(1,F)),T.push(sensorsdata.formatTime([z,L],F,!1,!1)),I=z,U=L}else T=j.map(function(a){return sensorsdata.formatTime(moment(a,V.timeFormat),F,!1,!1)});var W=[],G=[];if(b){var H=n(h,f.rows);c.map(function(a,t){var e=0;if(-1!==p.indexOf(t)){-1!==x.right.indexOf(t)&&(e=1);var n=c[t].text.join("的"),m=c[t].unit;W.push(o({widgetModel:v,scale:!0,isNormalize:C}));var l=j.map(function(a,e){var r=0;return O.map(function(a){r+=a.data[e][t]}),r}),u=S.map(function(a,e){var r=0;return H.map(function(a){r+=a.data[e][t]}),r}),d=C?r(O,t):[],f=C?r(H,t):[];O.map(function(a,r){var o=sensorsdata.trimConstHtml(a.name),c=i(N,a.name);G.push({name:o,type:"bar",barGap:"10%",barMaxWidth:"40%",yAxisIndex:C?0:e,itemStyle:{normal:{color:c}},stack:n,data:a.data.map(function(a,e){var r=a[t];if(C){var o=s(l[e],d);r=Math.round(o*r/l[e]*100)/100}return{value:r,rawValue:a[t],itemStyle:{normal:{color:c}},measureName:n,measureUnit:m,xLabel:sensorsdata.formatTime(j[e],F,!1),totalValue:l[e]}})}),G.push({name:o,type:"bar",barGap:"10%",barMaxWidth:"40%",yAxisIndex:C?0:e,stack:n+"-compare",itemStyle:{normal:{opacity:.6,color:c}},data:H[r].data.map(function(a,e){var r=a[t];if(C){var o=s(u[e],f);r=Math.round(o*r/u[e]*100)/100}return{value:r,rawValue:a[t],itemStyle:{normal:{color:c}},measureName:n,measureUnit:m,xLabel:sensorsdata.formatTime(S[e],F,!1),totalValue:u[e]}})})})}})}else c.map(function(a,t){var e=0;if(-1!==p.indexOf(t)){-1!==x.right.indexOf(t)&&(e=1);var n=c[t].text.join("的"),m=c[t].unit;W.push(o({widgetModel:v,scale:!0,isNormalize:C}));var l=j.map(function(a,e){var r=0;return O.map(function(a){r+=a.data[e][t]}),r}),u=C?r(O,t):[];O.map(function(a){var r=sensorsdata.trimConstHtml(a.name),o=i(N,a.name);G.push({name:r,type:"bar",yAxisIndex:C?0:e,barGap:"10%",barMaxWidth:"40%",itemStyle:{normal:{color:o}},stack:n,data:a.data.map(function(a,e){var r=a[t];if(C){var i=s(l[e],u);r=Math.round(i*r/l[e]*100)/100}return{value:r,rawValue:a[t],itemStyle:{normal:{color:o}},measureName:n,measureUnit:m,rawMeasureUnit:m,xLabel:sensorsdata.formatTime(j[e],F,!0),totalValue:l[e]}})})})}});var P={show:!1};if(!v){var Z=T.length*c.length*(b?2:1),q=e.sets.dataZoomNum;Z>q&&(P.show=!0,P.start=0,P.end=100)}var D={formatter:function(a){$.isArray(a)&&(a=a[0]);var t=a.data.xLabel;return w&&(t+="："+a.seriesName),t+="</br>"+a.data.measureName+"："+sensorsdata.formatNumber(a.data.rawValue)+a.data.measureUnit,w&&(t+="</br>总数："+sensorsdata.formatNumber(a.data.totalValue)+a.data.measureUnit),t}};if(v&&(D.trigger="axis",D.axisPointer={lineStyle:{width:1,color:"#aaa"}},D.formatter=function(){return""},D.backgroundColor="rgba(50,50,50,0)",D.borderWidth=0),A={tooltip:D,legend:E,dataZoom:P,xAxis:{data:T},series:G},v===!0&&(A.grid={bottom:0,left:10}),A=$.extend(!0,{},e.option,A),C)W=W.slice(0,1);else{var R=!1,Y=!1;p.forEach(function(a){-1!==x.left.indexOf(a)&&(R=!0),-1!==x.right.indexOf(a)&&(Y=!0)}),R&&Y?(W=W.slice(0,2),W[1].splitLine.show=!1):!R&&Y?(W=W.slice(1,2),W[0].position="right",A.series.forEach(function(a){a.yAxisIndex=0})):W=W.slice(0,1)}A.yAxis=W,A.dataZoom.show&&(A.legend.bottom=40,A.grid.bottom=90);break;default:throw new Error("暂不支持"+a.type+"模块")}t(A)};e.exports=l});
;/*!components/util/sensorsdataUtil.js*/
define("components/util/sensorsdataUtil",function(e,s,t){t.exports={getBeginDate:sensorsdata.getBeginDate,findEventCname:sensorsdata.findEventCname,findProperty:sensorsdata.findProperty,toNumber:sensorsdata.toNumber,isNumeric:sensorsdata.isNumeric,formatNumber:sensorsdata.formatNumber}});
;/*!components/util/formatNumberData.js*/
define("components/util/formatNumberData",function(e,a,t){var r=e("components/util/sensorsdataUtil"),n={getUnit:function(e,a){var t=r.getBeginDate(a).valueOf(),n=(new Date).valueOf(),o=new Date(e.replace(/-/g,"/")).valueOf(),u=o>=t&&n>=o,s=a,i={minute:"分钟",hour:"小时",day:"日",week:"周",month:"月"};switch(a){case"minute":s="最近一分钟";break;case"hour":s="最近一小时";break;case"day":s="今日";break;case"week":s="本周";break;case"month":s="本月"}u||(s=sensorsdata.formatTime(e,a,!0,!0));var l={unit:i[a],unitName:s};return l},convertDashboardNumberData:function(e){var a=this.getUnit(e.series,e.unit),t=a.unit,r=a.unitName,n=e.result[0],o="合计",u=e.rollupResult[0],s=e.measuresUnit[0],i=e.average[0],l=e.rollupDate;l?(o=r,r="合计",i="",n=e.rollupResult[0],u=e.result[0]):(n=e.result[0],u=e.rollupResult[0]);var m="-1.5%",c=!1,b="+24.9%",p=!0,f={rollupDate:l,unit:t,unitName:r,mainNumber:n,secondName:o,secondNumber:u,measuresUnit:s,average:i,MOM:m,MOMIcon:c,YOY:b,YOYIcon:p};return f},formatNumberData:function(e,a){var t=n;if("function"!=typeof a)throw new Error("formatNumberData 方法的第二个参数必须是 function 类型");if("object"!=typeof e.data||"object"!=typeof e.queryParams||"string"!=typeof e.type)throw new Error("无效的配置，请参照文档 http://gitlab.sensorsdata.cn/document/sensors-data-fewiki/blob/develop/components/util/formatChartData.md");var r=e.queryParams,o=e.data.result,u=e.data.rollupResult,s=o.rows,i={},l={},m=[];switch(e.type){case"segmentation":var c=r.rollup_date,b=r.measures,p=r.unit;s.map(function(e,a){var t=e.data,r=t.length,n=[],s=t[r-1],i=o.series[r-1],l=u.rows[a].data[0],f=[],d="",h="";s.map(function(e,a){n.push((l[a]/r).toFixed(2)),f.push(b[a].unit)}),m.push({rollupDate:c,average:n,result:s,series:i,rollupResult:l,measuresUnit:f,unit:p,MOM:d,YOY:h})});break;case"funnel":break;case"retention":break;case"addiction":break;case"behaviorPath":break;case"interval":break;default:throw new Error("暂不支持"+e.type+"模块")}l=t.convertDashboardNumberData(m[0]),i.originData=m,i.dashboradNumberData=l,a(i)}};t.exports=n.formatNumberData});
;/*!components/util/formatTableData.js*/
define("components/util/formatTableData",function(t,e,a){var r=function(t,e){if("function"!=typeof e)throw new Error("formatTableData 方法的第二个参数必须是 function 类型");if("object"!=typeof t.data||"object"!=typeof t.queryParams||"string"!=typeof t.type)throw new Error("无效的配置，请参照文档 http://gitlab.sensorsdata.cn/document/sensors-data-fewiki/blob/develop/components/util/formatChartData.md");var a=!1,r={};switch(t.type){case"segmentation":var s=t.queryParams,o=s.measures,u=s.by_fields||[];r=1===o.length&&0===u.length?n(t):i(t,a),e(r);break;case"funnel":break;case"retention":break;case"addiction":break;case"behaviorPath":break;case"interval":break;default:throw new Error("暂不支持"+t.type+"模块")}},n=function(t){var e=t.queryParams,a=t.data.result,r=t.data.rollupResult,n=e.unit,i=t.config,s=i.type,o=[],u=[],l={},f=[];"detail"===s?(o=a.rows,u=a.series,u.map(function(t){var e={value:sensorsdata.formatTime(t,n,!0,!0,"</br>"),textAlignRight:!1};f.unshift(e)})):(o=r.rows,u=r.series,f.unshift({value:"合计",textAlignRight:!1})),l.head=f;var p=[],h={};return o.map(function(t){var e=t.data,a=[];e.map(function(t){h={value:t,textAlignRight:!1},a.unshift(h)}),p.push(a)}),l.body=p,l},i=function(t,e){var a=t.queryParams,r=t.data.result,n=t.data.rollupResult,i=a.measures,s=a.by_fields||[],o=a.unit,u=t.config,l=u.type,f=u.slice,p=[],h=[],c={};if(f.length>1)throw new Error("只能显示一组数据");"detail"===l?(p=r.rows,h=r.series,f=[f]):(p=n.rows,h=n.series,f=[0]);var d=[];e&&d.push({value:"日期"}),s.map(function(t,e){var a={value:t.text,index:e,sortDisplay:!0,dataType:"string",textAlignRight:!1};d.push(a)}),i.map(function(t){var e=d.length,a=t.text.join("的");t.unit&&(a+="("+t.unit+")");var r={value:a,index:e,sortDisplay:!0,dataType:"number",textAlignRight:!0};d.push(r)}),c.head=d;var m=[],v={};return f.map(function(t){p.map(function(a){var r=a.by_values,n=a.data[t],i=[];e&&i.push({value:sensorsdata.formatTime(h[t],o,!0,!0,"</br>")}),r.map(function(t){v={value:t,textAlignRight:!1},i.push(v)}),n.map(function(t){v={value:t,textAlignRight:!0},i.push(v)}),m.push(i)})}),c.body=m,c};a.exports=r});
;/*!components/config/chart.js*/
define("components/config/chart",function(e,o){var t={},n={fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:12};t.tooltip={get:function(e){return $.extend(!0,{},{show:!0,backgroundColor:"rgba(255,255,255,0.9)",borderWidth:1,borderColor:"#3398DB",textStyle:{color:"#2e384a",fontSize:n.fontSize,fontFamily:n.fontFamily,fontWeight:300}},e)}},t.pie={get:function(e){return $.extend(!0,{},{itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},radius:["31%","55%"]},e)}},o.get=function(e,o){if(!t[e])throw new Error("config/chart: name 值为 "+e+" 的配置项不存在");return t[e].get(o)}});
;/*!components/util/formatPieData.js*/
define("components/util/formatPieData",function(t,e,a){var r=t("components/config/chart"),n={checkOptions:function(t){var e=[{check:function(){return"object"===$.type(t)},msg:"options 参数必须是 Object 类型"},{check:function(){return"object"===$.type(t.data)&&"object"===$.type(t.queryParams)&&$.isArray(t.queryParams.measures)&&t.queryParams.measures.length&&"object"===$.type(t.data.rollupResult)&&$.isArray(t.data.rollupResult.rows)},msg:"options.data 参数值有误，值的结构必须是 { queryParams: { measures: [] }, rollupResult: {} }"}];e.forEach(function(t){if(!t.check())throw new Error("util/formatPieData: "+t.msg)})},checkCallback:function(t){if(!$.isFunction(t))throw new Error("util/formatPieData: 第 2 个参数必须是 function 类型")}},o={format:function(t,e){t=$.extend(!0,{},t);var a=t.queryParams.measures,r=t.config&&t.config.measureIndexs,n=t.config&&t.config.byFields,o={result:this.processData(t.data.rollupResult,a.length,n),compareResult:$.isArray(t.data.rollupCompareResult)?this.processData(t.data.rollupCompareResult,a.length,n):null};$.isArray(r)&&(o.result=o.result.filter(function(t,e){return r.indexOf(e)>-1}),o.compareResult=o.compareResult.filter(function(t,e){return r.indexOf(e)>-1})),o.result=this.buildItemPie(o.result,a),o.compareResult&&(o.compareResult=this.buildItemPie(o.compareResult,a)),e(o)},processData:function(t,e,a){var r=[],n=t.rows,o=[];$.isArray(a)&&(n=[],t.rows.forEach(function(t){-1!==a.indexOf(t.name)?n.push(t):o.push(t)}));for(var s=0;e>s;s++){var u=n.map(function(t){return{name:sensorsdata.trimConstHtml(t.name),value:t.data[0][s]}});if(o.length){var i=0;o.map(function(t){i+=t.data[0][s]}),u.push({name:sensorsdata.languages.get("其它...<!--{en}Others...-->"),value:Math.round(100*i)/100})}u.sort(function(t,e){return e.value-t.value}),r.push(u)}return this.addItemConfigToData(r),r},addItemConfigToData:function(t){var e=sensorsdata.CONSTSET.chartsColors;t.forEach(function(t){t.forEach(function(t,a){t.itemStyle={normal:{color:e[a]}}})})},buildPies:function(t,e){var a=this;return t.map(function(t,r){return a.buildItemPie(e[r].text.join("的"),t)})},buildItemPie:function(t,e){var a=[];return t.forEach(function(t,n){a.push({tooltip:r.get("tooltip"),series:[$.extend(!0,{type:"pie",name:e[n].text.join(sensorsdata.languages.get("的<!--{en}.-->")),data:t},r.get("pie"))]})}),a}};a.exports=function(t,e){n.checkOptions(t),n.checkCallback(e),o.format(t,e)}});
;/*!components/dataCache/dataCache.js*/
define("components/dataCache/dataCache",function(e,t){function i(e){this.options=$.extend(!0,{expires:12e4},e),this.__id__=sensorsdata.guid(),n[this.__id__]={}}var n={};i.prototype={set:function(e,t,i){n[this.__id__][e]={value:t,date:Date.now(),expires:i||this.options.expires}},get:function(e){var t=n[this.__id__][e];if(t){if(Date.now()-t.date<t.expires){var i=$.type(t.value);return"object"===i||"array"===i?$.extend(!0,"object"===i?{}:[],t.value):t.value}n[this.__id__][e]=null}},del:function(e){delete n[this.__id__][e]},clean:function(){n[this.__id__]={}}},t.create=function(e){return new i(e)}});
;/*!components/model/session.js*/
define("components/model/session",function(e,s,n){var t=e("components/dataCache/dataCache").create,o=t(),a=$.extend(!0,{},sensorsdata.EventsModule,{get:function(e){if("function"!=typeof e)throw new Error("model/session: get 方法的第 1 个参数必须为 function 类型");var s=o.get("sessionList");s?e($.extend(!0,[],s)):sensorsdata.ajax({url:sensorsdata.api.get("session"),success:function(s){e($.extend(!0,[],s)),o.set("sessionList",s)}})}});n.exports=a});
;/*!components/model/properties.js*/
define("components/model/properties",function(e,n,t){var s=e("components/dataCache/dataCache").create,r=s(),o=e("components/model/session"),i=$.extend(!0,{},sensorsdata.EventsModule,{getUsersProp:function(e){if("function"!=typeof e)throw new Error("model/properties: get 方法的第 2 个参数必须为 function 类型");var n=r.get("userProperties");n?e($.extend(!0,[],n)):sensorsdata.ajax({useCache:!0,url:sensorsdata.api.get("userProperties"),success:function(n){r.set("userProperties",n),sensorsdata.cache.userProperties=n,e($.extend(!0,[],n))}})},getEventsProp:function(e,n,t){if("function"==typeof n&&(t=n,n=null),"function"!=typeof t)throw new Error("model/properties: get 方法的第 2 个参数必须为 function 类型");var s=this;this.get(e,function(r){if(n)o.get(function(o){var i=s.formatSessionProp(r,e,n,o);t(i)});else{var i=s.formatSessionProp(r,e,n);t(i)}})},formatSessionProp:function(e,n,t,s){if(!t)return e;n=n.filter(function(e,n,t){return t.indexOf(e)===n});var r=n.filter(function(e){return e!==sensorsdata.CONSTSET.sessionGeneral.name}),o=r.length===n.length,i=0===r.length;for(var a in e.original)e.original.hasOwnProperty(a)&&(e.original[a].event=e.intersection.session.concat(e.original[a].event));var c=[];return $.isEmptyObject(s)||(c=s.filter(function(e){return e.name===t})[0].properties.session.filter(function(e){return e.session_name=t,"$session_id"!==e.name&&"$session_position"!==e.name})),i?(e.intersection.session=c,e.intersection.event=[]):o?e.intersection.session=c:(e.intersection.session=c,e.intersection.event=[]),e.original[sensorsdata.CONSTSET.sessionGeneral.name]={event:c,user:[]},e},get:function(e,n){if("function"!=typeof n)throw new Error("model/properties: get 方法的第 2 个参数必须为 function 类型");e=e.filter(function(e,n,t){return t.indexOf(e)===n});var t=e.filter(function(e){return e!==sensorsdata.CONSTSET.sessionGeneral.name});0===t.length&&t.push(sensorsdata.CONSTSET.eventEmptyValue);var s=r.get(e.join("_"));s?n($.extend(!0,{},s)):sensorsdata.ajax({useCache:!0,url:sensorsdata.api.get("eventProperties",{eventNames:t.join(",")}),success:function(t){r.set(e.join("_"),t),n($.extend(!0,{},t))}})}});t.exports=i});
;/*!components/util/fieldsToText.js*/
define("components/util/fieldsToText",function(e,t,n){var s=e("components/util/sensorsdataUtil"),o=e("components/model/properties"),i={formatFields:function(e,t,n){var o=$.extend(!0,[],sensorsdata.cache.events),i=[];return"ALL"===sensorsdata.authority.eventPermission.type&&o.unshift(sensorsdata.CONSTSET.everyEvent),e.map(function(t,o){i[o]={field:e[o]};var r={};r=s.findProperty(t,n.intersection),i[o].text=r.cname||""}),i},fieldsToText:function(e,t){var n=i,s=$.extend(!0,[],e.measures),r=$.extend(!0,[],e.fields),a=e.sessionName;if("function"!=typeof t)throw new Error("fieldsToText 方法的第二个参数必须是 function 类型");var f=[];s.map(function(e){e.event_name?f.push(e.event_name):$.isEmptyObject(e.events)||(f=f.concat(e.events))}),o.getEventsProp(f,a,function(e){var s=n.formatFields(r,a,e);t($.extend(!0,[],s))})}};n.exports=i.fieldsToText});
;/*!components/util/guid.js*/
define("components/util/guid",function(n,t,e){var i=1;e.exports=function(){return i++}});
;/*!components/util/bind.js*/
define("components/util/bind",function(n,t,e){e.exports=function(n,t){return sensorsdata.bind(n,t)}});
;/*!components/util/getTimeRange.js*/
define("components/util/getTimeRange",function(t,e,a){var r="YYYY-MM-DD",o=[{text:["昨日","Yesterday"],get:function(){var t=moment().subtract(1,"days").format(r);return{from_date:t,to_date:t}},getCompare:function(){var t=moment().subtract(2,"days").format(r);return{compare_from_date:t,compare_to_date:t}}},{text:["今日","Today"],get:function(){var t=moment().format(r);return{from_date:t,to_date:t}},getCompare:function(){var t=moment().subtract(1,"days").format(r);return{compare_from_date:t,compare_to_date:t}}},{text:["上周","Last week"],get:function(){var t=moment().subtract(1,"week");return{from_date:t.startOf("isoWeek").format(r),to_date:t.endOf("isoWeek").format(r)}},getCompare:function(){var t=moment().subtract(2,"week");return{compare_from_date:t.startOf("isoWeek").format(r),compare_to_date:t.endOf("isoWeek").format(r)}}},{text:["本周","This week"],get:function(){return{from_date:moment().startOf("isoWeek").format(r),to_date:moment().format(r)}},getCompare:function(){return{compare_from_date:moment().subtract(1,"week").startOf("isoWeek").format(r),compare_to_date:moment().subtract(1,"week").day(moment().day()).format(r)}}},{text:["上月","Last month"],get:function(){var t=moment().subtract(1,"month");return{from_date:t.startOf("month").format(r),to_date:t.endOf("month").format(r)}},getCompare:function(){var t=moment().subtract(2,"month");return{compare_from_date:t.startOf("month").format(r),compare_to_date:t.endOf("month").format(r)}}},{text:["本月","This month"],get:function(){return{from_date:moment().startOf("month").format(r),to_date:moment().format(r)}},getCompare:function(){var t=moment().subtract(1,"month"),e=moment().date(),a=t.daysInMonth();return{compare_from_date:t.clone().startOf("month").format(r),compare_to_date:t.date(a>e?e:a).format(r)}}},{text:["去年","Last year"],get:function(){var t=moment().subtract(1,"year");return{from_date:t.startOf("year").format(r),to_date:t.endOf("year").format(r)}},getCompare:function(){var t=moment().subtract(2,"year");return{compare_from_date:t.startOf("year").format(r),compare_to_date:t.endOf("year").format(r)}}},{text:["本年","This year"],get:function(){return{from_date:moment().startOf("year").format(r),to_date:moment().format(r)}},getCompare:function(){var t=moment().subtract(1,"year").month(moment().month()),e=moment().date(),a=t.daysInMonth();return{compare_from_date:t.clone().startOf("year").format(r),compare_to_date:t.date(a>e?e:a).format(r)}}},{text:["过去 7 天","Last 7 days"],get:function(){return{from_date:moment().subtract(7,"days").format(r),to_date:moment().subtract(1,"days").format(r)}},getCompare:function(){return{compare_from_date:moment().subtract(14,"days").format(r),compare_to_date:moment().subtract(8,"days").format(r)}}},{text:["过去 30 天","Last 30 days"],get:function(){return{from_date:moment().subtract(30,"days").format(r),to_date:moment().subtract(1,"days").format(r)}},getCompare:function(){return{compare_from_date:moment().subtract(60,"days").format(r),compare_to_date:moment().subtract(31,"days").format(r)}}},{text:["上线至今","So far"],get:function(){return{from_date:moment(sensorsdata.cache.partitions[0]).format(r),to_date:moment().format(r)}},getCompare:function(){return{}}},{reg:/(^最近\s*(\d+)\s*天$)|(^Lately\s*(\d+)\s*day$)/,get:function(t){var e=Number(t.match(this.reg)[2]||t.match(this.reg)[4]);return{from_date:moment().subtract(e-1,"days").format(r),to_date:moment().format(r)}},getCompare:function(t){var e=Number(t.match(this.reg)[2]||t.match(this.reg)[4]);return{compare_from_date:moment().subtract(e+e-1,"days").format(r),compare_to_date:moment().subtract(e,"days").format(r)}}},{reg:/(^过去\s*(\d+)\s*天$)|(^In the past\s*(\d+)\s*day$)/,get:function(t){var e=Number(t.match(this.reg)[2]||t.match(this.reg)[4]);return{from_date:moment().subtract(e,"days").format(r),to_date:moment().subtract(1,"days").format(r)}},getCompare:function(t){var e=Number(t.match(this.reg)[2]||t.match(this.reg)[4]);return{compare_from_date:moment().subtract(e+e,"days").format(r),compare_to_date:moment().subtract(e+1,"days").format(r)}}},{reg:/(^过去\s*(\d+)\s*天\s*-\s*过去\s*(\d+)\s*天$)|(^In the past\s*(\d+)\s*Day\s*-\s*in the past\s*(\d+)\s*day$)/,get:function(t){var e=t.match(this.reg),a=Number(e[3]||e[6]),o=Number(e[2]||e[5]);return{from_date:moment().subtract(a,"days").format(r),to_date:moment().subtract(o,"days").format(r)}},getCompare:function(t){var e=t.match(this.reg),a=Number(e[3]||e[6]),o=Number(e[2]||e[5]),m=a-o+1;return{compare_from_date:moment().subtract(a+m,"days").format(r),compare_to_date:moment().subtract(o+m,"days").format(r)}}}];a.exports=function(t,e,a){for(var m=0,n=o.length;n>m;m++){var f=o[m],s=$.trim(t),d={};if(f.reg&&f.reg.test(s)||f.text&&-1!==f.text.indexOf(s)){var c=f.get(s);if(e){switch(a.compareKey){case"last period":d=f.getCompare(s);break;case"last year":d={compare_from_date:moment(c.from_date,r).clone().startOf("day").subtract(1,"year").format(r),compare_to_date:moment(c.to_date,r).clone().startOf("day").subtract(1,"year").format(r)};break;case"custom":var u=moment(a.from_date,r),_=moment(a.compare_from_date,r),i=moment(a.compare_to_date,r),p=(_.valueOf()-u.valueOf())/864e5,y=(i.valueOf()-_.valueOf())/864e5,g=moment(c.from_date,r).clone().add(p,"days");d={compare_from_date:g.format(r),compare_to_date:g.add(y,"days").format(r)};break;default:d=f.getCompare(s)}$.extend(c,d)}return c}}}});
;/*!components/util/getRangeText.js*/
define("components/util/getRangeText",function(e,t,a){var n={"1 day":"昨日","0 day":"今日","last week":"上周","0 week":"本周","last month":"上月","0 month":"本月","last year":"去年","0 year":"本年","7 day":"过去 7 天","30 day":"过去 30 天","-1 day":"上线至今"};a.exports=function(e){return e&&n[e]}});
;/*!components/util/getEvent.js*/
define("components/util/getEvent",function(e,n,t){t.exports=function(e,n){for(var t=sensorsdata.cache.events,r=0,s=t.length;s>r;r++){var o=t[r];if(o[e]===n)return $.extend(!0,{},o)}return sensorsdata.CONSTSET.everyEvent[e]===n?$.extend(!0,{},sensorsdata.CONSTSET.everyEvent):void 0}});
;/*!components/util/getProperty.js*/
define("components/util/getProperty",function(e,r,t){t.exports=function(e,r,t){var n=sensorsdata.cache.eventProperties||[],o=sensorsdata.cache.userProperties||[];if("event"===t||!t)for(var s=0,a=n.length;a>s;s++){var i=n[s];if(i[e]===r)return i}if("user"===t||!t)for(var f=0,c=o.length;c>f;f++){var u=o[f];if(u[e]===r)return u}}});
;/*!components/util/checkPercent.js*/
define("components/util/checkPercent",function(e,r,t){var n=function(e){return e.expression&&"%2p"===e.format||"bounce_rate"===e.aggregator||"exit_rate"===e.aggregator};t.exports=n});
;/*!components/util/measuresToText.js*/
define("components/util/measuresToText",function(e,n,s){var t=e("components/util/sensorsdataUtil"),r=e("components/model/properties"),a=e("components/util/checkPercent"),o={formatMeasure:function(e,n,s){var r=$.extend(!0,[],sensorsdata.cache.events),o=$.extend(!0,[],sensorsdata.cache.eventProperties),i=[];"ALL"===sensorsdata.authority.eventPermission.type&&r.unshift(sensorsdata.CONSTSET.everyEvent);for(var u=e.length,m=0;u>m;m++){i[m]={measure:e[m]};var f=[],c=e[m],d="",p={};if(c.expression)i[m].text=[c.name],a(c)&&(i[m].unit="%");else{var v=t.findEventCname(c.event_name,r);n?(d=sensorsdata.CONSTSET.sessionFunction[c.aggregator],p=t.findProperty(c.field,s.original[c.event_name]),$.isEmptyObject(p)&&(p=t.findProperty(c.field,s.original.__session__))):p=v?t.findProperty(c.field,{event:o}):t.findProperty(c.field,{user:s}),d=d||sensorsdata.CONSTSET.measureFunctions[c.aggregator].cname;var T=sensorsdata.CONSTSET.measureFunctions[c.aggregator].unit;c.by_session&&(v=sensorsdata.CONSTSET.sessionGeneral.cname),v&&f.push(v),$.isEmptyObject(p)||(f.push(p.cname),T=p.unit||T),f.push(d),i[m].unit=T,i[m].text=f}}return i},measuresToText:function(e,n){var s=o,t=$.extend(!0,[],e.measures),a=e.session_name;if("function"!=typeof n)throw new Error("measuresToText 方法的第二个参数必须是 function 类型");if("userAnalytics"===e.type)r.getUsersProp(function(e){var r=s.formatMeasure(t,a,e);n($.extend(!0,[],r))});else if(a){var i=[];t.map(function(e){i.push(e.event_name)}),r.getEventsProp(i,a,function(e){var r=s.formatMeasure(t,a,e);n($.extend(!0,[],r))})}else{var u=s.formatMeasure(t,a);n($.extend(!0,[],u))}}};s.exports=o.measuresToText});
;/*!components/util/formatByValue.js*/
define("components/util/formatByValue",function(e,o,t){t.exports=sensorsdata.formatByValue});
;/*!components/util/formatDuration.js*/
define("components/util/formatDuration",function(o,t,a){var r=function(o,t){t=t||"second";var a="",r="",e="";if(o&&$.isNumeric(o)){switch(t){case"second":a=Math.floor(o/3600)?Math.floor(o/3600)+" 小时 ":"",r=Math.floor(o%3600/60)?Math.floor(o%3600/60)+" 分钟 ":"",e=(sensorsdata.isFloat(o%60)?(o%60).toFixed(2):o%60)+" 秒 ";break;case"minute":a=Math.floor(o/60)?Math.floor(o/60)+" 小时 ":"",r=(sensorsdata.isFloat(o%60)?(o%60).toFixed(2):o%60)+" 分钟 ";break;case"hour":a=o+" 小时 "}return a+r+e}return"0 秒"};a.exports=r});
;/*!components/util/json.js*/
define("components/util/json",function(n,t){t.parse=function(n){return n?"string"===$.type(n)?JSON.parse(n):n:{}},t.stringify=function(n){return n?JSON.stringify(n):""}});
;/*!components/util/echartsTooltipFormatter.js*/
define("components/util/echartsTooltipFormatter",function(e,t,a){function i(e,t,a,i,r){var n=null,s=null,o=-1,d=-1;if($.isArray(a))for(var l=0,u=a.length;u>l;l++){var g=e.getModel().getSeriesByIndex(a[l].seriesIndex).getData();if(-1!==a[l].dataIndex){var h=g.indexOfRawIndex(a[l].dataIndex),I=g.getRawDataItem(h);if(I&&($.isNumeric(I)||$.isNumeric(I.value))){var f=g.getItemLayout(h);null===n?(n=f,s=a[l],o=a[l].seriesIndex,d=a[l].dataIndex):$.isArray(n)&&$.isNumeric(n[1])&&Math.abs(t[1]-f[1])<Math.abs(t[1]-n[1])&&(n=f,s=a[l],o=a[l].seriesIndex,d=a[l].dataIndex)}}}else n=e.getModel().getSeriesByIndex(a.seriesIndex).getData().getItemLayout(a.dataIndex),s=a;if(!$.isArray(n))return t;var x=r(s),m=$(i);m.find(".sa-tooltip").html(x);var c=$(e.getDom()),v=c.width(),p=c.height(),y=m.width(),b=m.height(),w=n[0]-y/2,D=n[1]+10,M="top";return D+b>=p&&(D=n[1]-10-b,M="bottom"),0>=w?(D=n[1]-b/2-5,w=n[0]+20,M="left"):w+y>v&&(w=n[0]-y-10,D=n[1]-b/2-5,M="right"),m.find(".sa-echarts-tooltip-triangle").removeClass("top right bottom left").addClass(M),[w,D]}function r(e,t){return t=t||20,e=e||"",e.length>t?e.substr(0,t)+"...":e}a.exports={lineTooltipPosition:i,truncateLabel:r}});
;/*!components/util/diff.js*/
define("components/util/diff",function(n,t,f){f.exports=function(n,t){return sensorsdata.util.diff(n,t)}});
;/*!components/util/getRound.js*/
define("components/util/getRound",function(n,t,o){o.exports=function(n,t){n=Number(n);var o=Math.round(n*Math.pow(10,t))/Math.pow(10,t);return o}});
;/*!components/util/toggle.js*/
define("components/util/toggle",function(n,t,e){e.exports=function(n,t,e){return n===t?e:t}});
;/*!components/util/convertTimeText.js*/
define("components/util/convertTimeText",function(e,n,t){t.exports=function(e){return sensorsdata.convertTimeText(e)}});
;/*!components/util/cron.js*/
define("components/util/cron",function(n,r,t){var e={week:"每周",day:"每天",month:"每月"},a="日",o=["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],i={format:function(n){if(!n||"string"!=typeof n)return"";var r=n.split(" ");if(r.length>0){var t="";"*"===r[3]&&"*"===r[4]&&"?"===r[5]?t="day":"?"===r[3]&&"*"===r[4]?t="week":"*"===r[4]&&"?"===r[5]&&(t="month");var e=r[1];e="*"===e?Array.apply(null,{length:59}):e.split(",");var a=r[1];a="*"===a?Array.apply(null,{length:59}):a.split(",");var o=r[2];o="*"===o?Array.apply(null,{length:24}):o.split(",");var i=r[5];i="*"===i?Array.apply(null,{length:7}):i.split(",");var u=r[3];return u="*"===u?"day"===t?[]:Array.apply(null,{length:31}).map(function(n,r){return r+1}):u.split(","),{unit:t,week:i,day:u,hour:o,minute:a,second:e}}throw new Error("无效的 cron 表达式")},toCron:function(n){if(!n)throw new Error("无效的结构输入");var r=["0","0","*","*","*","*","*"];switch(n.unit){case"day":r[3]="*",r[4]="*",r[5]="?";break;case"week":var t=n.week||[];r[5]=t.join(","),r[3]="?",r[4]="*";break;case"month":var e=n.day||[];r[3]=e.join(","),r[4]="*",r[5]="?"}var a=n.hour||[];return r[2]=a.join(","),r.join(" ")},cronToText:function(n){var r=this.format(n);if(!r)return"";var t=[e[r.unit]];switch(r.unit){case"week":t.push(r.week.map(function(n){return o[parseInt(n,10)-1]}).join(","));break;case"month":t.push(r.day.map(function(n){return n+a}).join(","))}var i="0"===r.minute.join(",")?"00":r.minute.join(","),u="0"===r.second.join(",")?"00":r.second.join(",");return t.push(r.hour.join(",")),t.push(": ".concat(i)),t.push(": ".concat(u)),t.join(" ")}};t.exports=i});
;/*!components/util/setURLParams.js*/
define("components/util/setURLParams",function(n,e,r){var t=function(n,e){var r="",t=/([^?&=]+)=([^?&=]*)/g;n.replace(t,function(n,r,t){var o=decodeURIComponent(r),a=decodeURIComponent(t);return e[o]||(e[o]=a),n});for(var o in e)r+=r?"&"+o+"="+e[o]:o+"="+e[o];return r},o=function(n,e){var r="",o="",a=n.split("#"),i=a[0];a.length>1&&(o=a[1]);var c=i.split("?");i=c[0],c.length>1&&(r=c[1]);var u=t(r,e);return i+"?"+u+(o?"#"+o:"")};r.exports=o});
;/*!components/util/fuzzySearch.js*/
define("components/util/fuzzySearch",function(e,n,t){t.exports=function(e,n,t){var r=e.filter(function(e){return e[t].toUpperCase().indexOf(n.toUpperCase())>=0});return r}});
;/*!components/util/resetConfig.js*/
define("components/util/resetConfig",function(e,n,r){var t=function(e){if("string"!=typeof e.config)return e;var n=sensorsdata.CONSTSET.unknownByValue.replace(/(\[|\])/g,function(e){return"\\"+e}).replace(/\"/g,'\\\\"'),r=sensorsdata.CONSTSET.emptyStringByValue.replace(/(\[|\])/g,function(e){return"\\"+e}).replace(/\"/g,'\\\\"'),t=new RegExp("("+n+")|("+r+")","g");return e.config=e.config.replace(t,function(e){return e===sensorsdata.CONSTSET.unknownByValue.replace(/\"/g,'\\"')?sensorsdata.CONSTSET.unknownByValueText:e===sensorsdata.CONSTSET.emptyStringByValue.replace(/\"/g,'\\"')?sensorsdata.CONSTSET.emptyStringByValueText:void 0}),e};r.exports=t});
;/*!components/util/formatDashNumber.js*/
define("components/util/formatDashNumber",function(n,u,t){var e=n("components/util/getRound");t.exports=function(n){if(!$.isNumeric(n))return{originNumber:n,formatNumber:"-"};var u=[{num:5,unit:"万"},{num:7,unit:"千万"},{num:8,unit:"亿"},{num:11,unit:"千亿"},{num:12,unit:"万亿"},{num:16,unit:""}],t=n+"",r=t.split("."),m=r[0],i="0";switch(r.length>1&&(i=r[1]),i.length){case 1:break;case 2:m.length>3&&(t=m);break;case 3:m.length>2&&(t=m)}for(var a="",o=m.length-1,s=u.length,l=!1,b=0;s>b&&!l;b++){var g=u[b];o>=g.num&&u[b+1]&&o<u[b+1].num&&(l=!0),l&&(m=m.slice(0,m.length-(g.num-3)),(7===g.num||8===g.num||11===g.num||12===g.num)&&(m=Number(m)/10),a=g.unit)}var c=sensorsdata.formatNumber(e(m/100,2),!1,!1);l||(m=100*Number(t),a="",c=sensorsdata.formatNumber(e(m/100,i.length),!1,!1));var f={unit:a,originNumber:n,formatNumber:c};return f}});
;/*!components/util/util.js*/
define("components/util/util",function(t,o,e){var n={formatLineData:t("components/util/formatLineData"),formatStackData:t("components/util/formatStackData"),formatColumnData:t("components/util/formatColumnData"),formatNumberData:t("components/util/formatNumberData"),formatTableData:t("components/util/formatTableData"),formatPieData:t("components/util/formatPieData"),"float":t("components/util/float"),fieldsToText:t("components/util/fieldsToText"),guid:t("components/util/guid"),bind:t("components/util/bind"),getTimeRange:t("components/util/getTimeRange"),getRangeText:t("components/util/getRangeText"),getEvent:t("components/util/getEvent"),getProperty:t("components/util/getProperty"),measuresToText:t("components/util/measuresToText"),formatByValue:t("components/util/formatByValue"),formatDuration:t("components/util/formatDuration"),json:t("components/util/json"),echartsTooltipFormatter:t("components/util/echartsTooltipFormatter"),diff:t("components/util/diff"),getRound:t("components/util/getRound"),checkPercent:t("components/util/checkPercent"),toggle:t("components/util/toggle"),convertTimeText:t("components/util/convertTimeText"),cron:t("components/util/cron"),setURLParams:t("components/util/setURLParams"),fuzzySearch:t("components/util/fuzzySearch"),resetConfig:t("components/util/resetConfig"),formatDashNumber:t("components/util/formatDashNumber")};e.exports=n});
;/*!components/router/router.js*/
define("components/router/router",function(n,e,o){var t={nav:function(n,e){sensorsdata.indexPage.initPage(n,e)}};o.exports=t});
;/*!components/model/bookmarks.js*/
define("components/model/bookmarks",function(t,e,s){var a=t("components/dataCache/dataCache").create,o=a(),n={bookmarkid:!0},i=t("components/util/util"),r=$.extend(!0,{},sensorsdata.EventsModule,{getList:function(t){if("function"!=typeof t)throw new Error("model/bookmarks: getList 方法的第 1 个参数必须为 function 类型");var e=o.get("bookmarksList");e?t($.extend(!0,{},e)):sensorsdata.ajax({url:sensorsdata.api.get("allBookmarks"),success:function(e){t($.extend(!0,{},e)),o.set("bookmarksList",e)}})},get:function(t,e){if("function"!=typeof e)throw new Error("model/bookmarks: get 方法的第 2 个参数必须为 function 类型");var s=o.get(t);s?e($.extend(!0,{},s)):sensorsdata.ajax({url:sensorsdata.api.get("bookmarks",{id:t}),success:function(s){s=i.resetConfig(s),e($.extend(!0,{},s)),o.set(t,s)}})},add:function(t,e){var s=this,a=sensorsdata.api.get("bookmarks"),o="add";if(t.data){var n=i.json.parse(t.data),r=n.rangeText||"";r.indexOf("NaN")>-1&&delete n.rangeText,t.data=i.json.stringify(n)}sensorsdata.ajax({method:"POST",url:a,data:JSON.stringify(t),success:function(t){"function"==typeof e&&e(t),s.postProcessingCRUD(o,"",t)}})},set:function(t,e){var s=this,a="set",o=t.id,r=sensorsdata.api.get("bookmarks",{id:t.id});if(t.data){var d=i.json.parse(t.data);for(var f in d)n[f]&&delete d[f];var c=d.rangeText||"";c.indexOf("NaN")>-1&&delete d.rangeText,t.data=i.json.stringify(d)}return o?void this.get(o,function(n){var i=n.config||"{}";"string"==typeof t.config&&(t.config=JSON.parse(t.config));var d=$.extend(JSON.parse(i),t.config);t.config=JSON.stringify(d),t=$.extend(n,t),sensorsdata.ajax({method:"POST",url:r,data:JSON.stringify(t),success:function(n){if("function"==typeof e){var i=$.extend(!0,{},t);e(i)}s.postProcessingCRUD(a,o,n)}})}):void this.add(t,e)},del:function(t,e){var s=this;sensorsdata.ajax({method:"DELETE",url:sensorsdata.api.get("bookmarks",{id:t}),success:function(a){"function"==typeof e&&e(a),s.postProcessingCRUD("del",t,a)}})},postProcessingCRUD:function(t,e,s){var a={data:s};o.del("bookmarksList"),e&&(a.id=e,o.del(e)),this.trigger(t,a)}});s.exports=r});
;/*!components/downloadDialog/downloadDialog.js*/
define("components/downloadDialog/downloadDialog",function(n,o,a){var l={template:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover popover-topBar-download" role="tooltip">\n  <div class="arrow"></div>\n  <div class="popover-content"></div>\n</div>'},useData:!0}),content:Handlebars.template({1:function(){return'  <li data-method="download-current"><span class="icon-table"></span>CSV (下方表格)<!--{en}<span class="icon-table"></span>CSV (Form below)--></li>\n'},3:function(){return'  <li data-method="download-all"><span class="icon-table"></span>CSV (全部表格)<!--{en}<span class="icon-table"></span>CSV (All forms)--></li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(n,o,a,l){var t,e,d,r=o.helperMissing,s="function",i=o.blockHelperMissing,c='<ul class="download-content">\n';return e=null!=(e=o.onShowDownloadCurrent||(null!=n?n.onShowDownloadCurrent:n))?e:r,d={name:"onShowDownloadCurrent",hash:{},fn:this.program(1,l,0),inverse:this.noop,data:l},t=typeof e===s?e.call(n,d):e,o.onShowDownloadCurrent||(t=i.call(n,t,d)),null!=t&&(c+=t),e=null!=(e=o.onShowDownloadAll||(null!=n?n.onShowDownloadAll:n))?e:r,d={name:"onShowDownloadAll",hash:{},fn:this.program(3,l,0),inverse:this.noop,data:l},t=typeof e===s?e.call(n,d):e,o.onShowDownloadAll||(t=i.call(n,t,d)),null!=t&&(c+=t),c+"</ul>"},useData:!0})},t=$.extend(!0,{},sensorsdata.EventsModule,{show:function(n){if(!n.ele)throw new Error("无效的触发元素");sensorsdata.popover({ele:n.ele,container:"body",placement:"bottom",showNow:!0,template:l.template(),content:l.content(n.data),onShow:function(o){o.$tip.find(".download-content li[data-method]").unbind("click").bind("click",function(){var a=$(this).attr("data-method");switch(a){case"download-current":$.isFunction(n.data.onDownloadCurrent)&&n.data.onDownloadCurrent();break;case"download-all":$.isFunction(n.data.onDownloadAll)&&n.data.onDownloadAll()}o.hide()})}})}});a.exports=t});
;/*!components/model/guide.js*/
define("components/model/guide",function(e,t,s){var a=e("components/dataCache/dataCache").create,n=sensorsdata.api.get("dashboardsNav"),o={licenseRemind:!0,dashboardsNav:!0},i=a(),r=null,c=[],u={get:function(e,t){if("string"==typeof e)this.keyChcek(e,"get");else{var s=this;e.forEach(function(e){s.keyChcek(e,"get")})}if("function"!=typeof t)throw new Error("sensorsdata.guideModel: get 参数 callback 必须为 function 类型")},set:function(e,t){if(this.keyChcek(e,"set"),!t)throw new Error("sensorsdata.guideModel: set 参数 value 必须有值")},keyChcek:function(e,t){var s=null;if("string"!=typeof e?s="参数 key 必须为 string 类型":o[e]||(s="参数 key 的值 "+e+" 没有进行备案，不能进行存储"),s)throw new Error("sensorsdata.guideModel: "+t+" "+s)}},d={get:function(e,t){u.get(e,t),r=i.get("data"),r?this.getData(e,t):(c.push([e,t]),this.request())},getData:function(e,t){var s=$.extend(!0,{},r);if("string"==typeof e)t(s[e]);else{var a=[];e.forEach(function(e){a.push(s[e])}),t(a)}},request:function(e){this.isRequesting||(this.isRequesting=!0,sensorsdata.ajax({url:n,showLoader:void 0===e?!0:!1,success:sensorsdata.bind(this.receive,this)}))},receive:function(e){var t=this;i.set("data","object"==typeof e?e:{}),r=i.get("data"),c.length&&(c.forEach(function(e){t.getData(e[0],e[1])}),c.length=0),this.isRequesting=!1},set:function(e,t,s){var a=this;u.set(e,t),sensorsdata.ajax({url:n,showLoader:!1,success:function(o){o[e]=t,sensorsdata.ajax({type:"post",url:n,data:JSON.stringify(o),showLoader:!1,success:function(){i.del("data"),a.request(!1),s&&s()}})}})}};s.exports=d});
;/*!components/model/dashboards.js*/
define("components/model/dashboards",function(a,t,o){function e(){return Date.now()+Math.ceil(1e8*Math.random())}var s=a("components/dataCache/dataCache").create,r=a("components/model/guide"),d=s(),n={checkId:function(a,t,o){if("number"!=typeof a)throw new Error(t+": "+o+" id 参数不能为空且必须为 number 类型")},checkTitle:function(a,t,o){if(!a)throw new Error(t+": "+o+" title 参数不能为空")},checkCallback:function(a,t,o){if("function"!=typeof a)throw new Error(t+": "+o+" callback 参数不能为空，且必须为 function")},checkArray:function(a,t,o){if(!(a instanceof Array))throw new Error(t+": "+o+" data 参数不能为空，且必须为 Array 类型")},checkObject:function(a,t,o){if("object"!=typeof a)throw new Error(t+": "+o+" options 参数不能为空，且必须为 Object 类型")},checkSortNav:function(a,t){var o=function(a){return"number"==typeof a},e=function(a){return a&&"number"==typeof a.newIndex&&"number"==typeof a.oldIndex?!0:!1};if("group"!==a&&"dashboard"!==a)throw new Error("dashboardsNavDB: sort type 参数值只能为 group 或 dashboard");if("group"===a){if(!t||!e(t.update))throw new Error("dashboardsNavDB: sort 分组排序必须设置 options.update 参数，且标识 newIndex 和 oldIndex")}else if(!t||!(e(t.update)&&o(t.update.id)||e(t.add)&&e(t.del)&&o(t.add.id)&&o(t.del.id)))throw new Error("dashboardsNavDB: sort 概览页排序必须设置 options.update 参数或 options.add && options.delete 参数，且标识 id、newIndex、oldIndex")}},i=$.extend({},sensorsdata.EventsModule,{add:function(a,t,o){n.checkTitle(a&&a.name,"dashboardModel","add");var e=this;"function"==typeof t&&(o=t,t=!0),this.checkTitle(a.name,function(s){if(s)return void("function"==typeof o&&o({error:sensorsdata.languages.get("概览名称不能重复<!--{en}Dashboard name cannot be repeated-->")}));var r={success:!0,operation_type:sensorsdata.languages.get("新建<!--{en}New-->")};sensorsdata.ajax({type:"post",url:sensorsdata.api.get("dashboards"),data:JSON.stringify({name:a.name}),showLoader:!1,success:function(a){d.del("dashboards"),e.getMap(function(s){e.postProcessingCRUD({action:"add",dashboard:s[a.id],isTrigger:t,callback:o})}),sensorsdata.track("dashboard_operation",r)},error:function(a){r.success=!1,r.fail_reason=a.status,sensorsdata.track("dashboard_operation",r)}})})},del:function(a,t,o){n.checkId(a,"dashboardModel","del");var e=this;"function"==typeof t&&(o=t,t=!0),this.getMap(function(s){var r=s[a];r?sensorsdata.ajax({type:"delete",showLoader:!1,url:sensorsdata.api.get("dashboards",{id:a}),success:function(){d.del("dashboards"),e.postProcessingCRUD({action:"del",dashboard:r,isTrigger:t,callback:o})}}):"function"==typeof o&&o()})},update:function(a,t,o,e){n.checkId(a,"dashboardModel","update");var s=this;"function"==typeof o&&(e=o,o=!0),this.getItem(a,function(r){return r&&r.name!==t.name?void(t.name?(n.checkTitle(t&&t.name,"dashboardModel","update"),s.checkTitle(t.name,function(r){return r?void("function"==typeof e&&e({error:sensorsdata.languages.get("概览名称不能重复<!--{en}Dashboard name cannot be repeated-->")})):void sensorsdata.ajax({type:"post",url:sensorsdata.api.get("dashboards",{id:a}),data:JSON.stringify(t),showLoader:!1,success:function(){d.del("dashboards"),s.getMap(function(t){s.postProcessingCRUD({action:"update",dashboard:t[a],isTrigger:o,callback:e})})}})})):sensorsdata.ajax({type:"post",url:sensorsdata.api.get("dashboards",{id:a}),data:JSON.stringify(t),showLoader:!1,success:function(){d.del("dashboards"),s.getMap(function(t){s.postProcessingCRUD({action:"update",dashboard:t[a],isTrigger:o,callback:e})})}})):void("function"==typeof e&&e())})},get:function(a,t){var o=this;"boolean"!=typeof a&&(t=a,a=!1),n.checkCallback(t,"dashboardModel","get");var e=d.get("dashboards");e?(e=a?this.filterOwn($.extend(!0,[],e)):$.extend(!0,[],e),t(e)):sensorsdata.ajax({url:sensorsdata.api.get("dashboards"),showLoader:!1,success:function(s){d.set("dashboards",s||[]),e=a?o.filterOwn($.extend(!0,[],s)):$.extend(!0,[],s),t(e)}})},filterOwn:function(a){return a.filter(function(a){return a.user_id===sensorsdata.authority.userId})},getMap:function(a){n.checkCallback(a,"dashboardModel","getMap"),this.get(function(t){a(sensorsdata.util.arrayToMap(t,"id"))})},getItem:function(a,t){n.checkId(a,"dashboardModel","checkId"),n.checkCallback(t,"dashboardModel","checkId"),this.getMap(function(o){t(o[a])})},checkId:function(a,t){n.checkId(a,"dashboardModel","checkId"),n.checkCallback(t,"dashboardModel","checkId"),this.getMap(function(o){t(!!o[a])})},checkTitle:function(a,t){n.checkTitle(a,"dashboardModel","checkTitle"),n.checkCallback(t,"dashboardModel","checkId"),this.get(function(o){for(var e=!1,s=0,r=o.length;r>s;s++)if(o[s].user_id===sensorsdata.authority.userId&&o[s].name===a){e=!0;break}t(e)})},postProcessingCRUD:function(a){var t=this;this.get(function(o){"function"==typeof a.callback&&a.callback(o),a.isTrigger!==!1&&t.trigger("update",{action:a.action,data:o,dashboard:a.dashboard})})}}),c=[],u=$.extend({},sensorsdata.EventsModule,{add:function(a,t,o){n.checkTitle(a,"dashboardsNavDB","add");var s=this;"function"==typeof t&&(o=t,t=null),this.get(function(d){if(s.checkTitltRepeat(d.groups,a))return void("function"==typeof o&&o({error:sensorsdata.languages.get("分组标题不能重复<!--{en}Group title cannot be repeated-->")}));var n={id:e(),title:a,status:"on",dashboards:[]},i=null;t&&(666666===t?i=0:d.groups.forEach(function(a,o){a.id===t&&(i=o+1)})),null!==i?d.groups.splice(i,0,n):d.groups.push(n),r.set("dashboardsNav",d,function(){s.postProcessingCRUD({action:"add",callback:o})})})},del:function(a,t,o){n.checkId(a,"dashboardsNavDB","del"),"function"==typeof t&&(o=t,t=!1);var e=this,s=null,d=null,c=function(){if(s&&d){var n=[],c=null,u=d.default_group.dashboards;d.groups=d.groups.filter(function(o){return o.id===a?(o.dashboards.length&&o.dashboards.forEach(function(a){s[a]&&(s[a].user_id===sensorsdata.authority.userId?t?i.del(a,!1):u.push(a):n.push(a))}),!1):(o.isShare&&(c=o),!0)}),n.length&&(c.dashboards=c.dashboards.concat(n)),r.set("dashboardsNav",d,function(){e.postProcessingCRUD({action:"del",callback:o})})}};i.getMap(function(a){s=a,c()}),this.get(function(a){d=a,c()})},update:function(a,t,o){n.checkId(a,"dashboardsNavDB","update"),n.checkTitle(t,"dashboardsNavDB","update");var e=this;this.get(function(s){var d=s.groups;if(e.checkTitltRepeat(d,t))return void("function"==typeof o&&o({error:sensorsdata.languages.get("分组标题不能重复<!--{en}Group title cannot be repeated-->")}));for(var n=0,i=d.length;i>n;n++)if(d[n].id===a){d[n].title=t;break}r.set("dashboardsNav",s,function(){e.postProcessingCRUD({action:"update",callback:o})})})},updateOrders:function(a,t){n.checkObject(a,"dashboardsNavDB","updateOrders");var o=this;this.get(function(e){var s=null;if((a.groupOrders||a.dashboardsOrders)&&(s=sensorsdata.util.arrayToMap(e.groups,"id")),a.groupOrders){var d=[];a.groupOrders.forEach(function(a){s[a]&&d.push(s[a])}),e.groups=d}if(a.dashboardsOrders){var n=a.dashboardsOrders;for(var i in n)if(n.hasOwnProperty(i)){if(666666===Number(i)){e.default_group.dashboards=n[i];continue}var c=s[i];c&&(c.dashboards=n[i])}}r.set("dashboardsNav",e,function(){o.postProcessingCRUD({action:"sort",callback:t})})})},sort:function(a,t,o){var e=this;n.checkSortNav(a,t),this.get(function(s){r.set("dashboardsNav",e["group"===a?"sortGroup":"sortDashboard"](s,t),function(){e.postProcessingCRUD({action:"sort",callback:o})})})},sortGroup:function(a,t){var o=a.groups,e=t.update;return o[e.oldIndex]&&o[e.newIndex]&&o.splice(e.newIndex,0,o.splice(e.oldIndex,1)[0]),a},sortDashboard:function(a,t){var o=sensorsdata.util.arrayToMap(a.groups,"id");if(o[a.default_group.id]=a.default_group,t.update){var e=t.update,s=o[e.id],r=s&&s.dashboards;r&&r[e.newIndex]&&r[e.oldIndex]&&r.splice(e.newIndex,0,r.splice(e.oldIndex,1)[0])}else{var d=t.add,n=t.del,i=o[d.id],c=i&&i.dashboards,u=o[n.id],h=u&&u.dashboards;c&&h&&h[n.oldIndex]&&c.splice(d.newIndex,0,h.splice(n.oldIndex,1)[0])}return a},get:function(a){n.checkCallback(a,"dashboardModel","get");var t=this;r.get("dashboardsNav",function(o){return t.checkNavData(o)?void a(o):(c.push({action:"get",params:[a]}),console.log(this),void t.initNavData())})},getFull:function(a){n.checkCallback(a,"dashboardModel","getFull");var t=this,o=null,e=null,s=function(){if(o&&e){var s=t.fusionNavAndDashboards(e,o);s.sourceUpdate&&r.set("dashboardsNav",s.sourceUpdate),a(s.data)}};i.getMap(function(a){o=a,s()}),this.get(function(a){e=a,s()})},fusionNavAndDashboards:function(a,t){var o=$.extend(!0,{},a),e={},s=[],r=null;e.data=a=this.trimNavData(a,t),a.default_group.dashboards=a.default_group.dashboards.map(function(a){var o=t[a];return o.isShare=o.user_id!==sensorsdata.authority.userId,s.push(a),o}),a.groups=a.groups.map(function(a){return 999999===a.id&&(r=a),a.dashboards=a.dashboards.map(function(a){var o=t[a];return o.isShare=o.user_id!==sensorsdata.authority.userId,s.push(a),o}),a});var d=[];for(var n in t)-1===s.indexOf(Number(n))&&d.push(Number(n));if(d.length){var i=o.default_group.dashboards,c=null,u=a.default_group.dashboards,h=r.dashboards;o.groups.forEach(function(a){999999===a.id&&(c=a.dashboards)}),d.forEach(function(a){var o=t[a];o.isShare=o.user_id!==sensorsdata.authority.userId,o.isShare?(c.push(a),h.push(o)):(i.push(a),u.push(o))}),e.sourceUpdate=o}return e},trimNavData:function(a,t){return a.default_group.dashboards=a.default_group.dashboards.filter(function(a){return t[a]}),a.groups.forEach(function(a){a.dashboards=a.dashboards.filter(function(a){return t[a]})}),a},addDashboard:function(a,t){n.checkId(a&&a.id,"dashboardsNavDB","addDashboard");var o=this;this.get(function(e){e.default_group.dashboards.push(a.id),r.set("dashboardsNav",e,function(){o.postProcessingCRUD({action:"addDashboard",dashboard:a,callback:t})})})},deleteDashboard:function(a,t){n.checkId(a&&a.id,"dashboardsNavDB","deleteDashboard");var o=this,e=function(a,t){var o=null,e=null,s=null,r=a.default_group.dashboards;for(e=0,s=r.length;s>e;e++)if(r[e]===t){o=e;break}if(o)return void r.splice(o,1);var d=a.groups;for(e=0,s=d.length;s>e;e++){r=d[e].dashboards;for(var n=0,i=r.length;i>n;n++)if(r[n]===t){o=n;break}return void(o&&r.splice(o,1))}};this.get(function(s){e(s,a.id),r.set("dashboardsNav",s,function(){o.postProcessingCRUD({action:"deleteDashboard",dashboard:a,callback:t})})})},setGroupExpand:function(a,t,o){var e=this,s={};a instanceof Array?a.forEach(function(a){s[a[0]]=a[1]}):s[a]=t,this.get(function(a){a.groups.forEach(function(a){var t=s[a.id];("on"===t||"off"===t)&&(a.status=t)}),r.set("dashboardsNav",a,function(){e.postProcessingCRUD({action:"expand",callback:o})})})},postProcessingCRUD:function(a){var t=this;this.getFull(function(o){if("function"==typeof a.callback&&a.callback(o),a.isTrigger!==!1){var e={action:a.action,data:o};a.dashboard&&(e.dashboard=a.dashboard),t.trigger("update",e)}})},checkTitltRepeat:function(a,t){for(var o=0,e=a.length;e>o;o++)if(a[o].title===t)return!0;return!1},checkNavData:function(a){var t=function(a){for(var t=0,o=a.length;o>t;t++)if(999999===a[t].id){if(a[t].dashboards instanceof Array)return!0;break}return!1};return a&&a.default_group&&a.default_group.dashboards instanceof Array&&666666===a.default_group.id&&a.groups instanceof Array&&t(a.groups)?!0:!1},initNavData:function(a){var t=this;i.get(function(o){var e={default_group:{id:666666},groups:[{id:999999,title:sensorsdata.languages.get("分享给我的概览<!--{en}Shared Dashboard-->"),isShare:!0,status:"on"}]},s=e.default_group.dashboards=[],d=e.groups[0].dashboards=[];o.forEach(function(a){a.user_id===sensorsdata.authority.userId?s.push(a.id):d.push(a.id)}),r.set("dashboardsNav",e,function(){"function"==typeof a&&a(),c.length&&(c.forEach(function(a){t[a.action].apply(t,a.params)}),c.length=0)})})}});i.on("update",function(a){if(a)switch(a.action){case"add":u.addDashboard(a.dashboard);break;case"del":u.deleteDashboard(a.dashboard);break;case"update":u.postProcessingCRUD({action:"updateDashboard",dashboard:a.dashboard})}}),o.exports={dashboardModel:i,dashboardsNavModel:u}});
;/*!components/dashboardAddDialog/dashboardAddDialog.js*/
define("components/dashboardAddDialog/dashboardAddDialog",function(e,n,t){var a={template:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover popover-dashboard-add" role="tooltip">\n  <div class="arrow"></div>\n  <h3 class="popover-title"></h3>\n  <div class="popover-content"></div>\n  <div class="popover-content-footer clearfix">\n    <div class="popover-footer-right">\n      <button type="button" class="pop-is-cancel btn btn-link btn-small">取消<!--{en}Cancel--></button>\n      <button type="button" class="pop-is-success btn btn-primary btn-small">确定<!--{en}Confirm--></button>\n    </div>\n  </div>\n</div>'},useData:!0}),content:Handlebars.template({1:function(e,n,t,a){var o,s=n.helperMissing,i="function",l=this.escapeExpression;return'      <option value="'+l((o=null!=(o=n.id||(null!=e?e.id:e))?o:s,typeof o===i?o.call(e,{name:"id",hash:{},data:a}):o))+'">'+l((o=null!=(o=n.name||(null!=e?e.name:e))?o:s,typeof o===i?o.call(e,{name:"name",hash:{},data:a}):o))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,t,a){var o;return'<div>\n  <span class="label-input">选择要添加到的概览<!--{en}Select the dashboard add to --></span>\n  <select multiple="multiple">\n'+(null!=(o=n.each.call(e,null!=e?e.dashboards:e,{name:"each",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?o:"")+"  </select>\n</div>"},useData:!0})},o=e("components/model/dashboards").dashboardModel,s=$.extend(!0,{},sensorsdata.EventsModules,{show:function(e){if(!e.ele)throw new Error("无效的触发元素");if(!e.bookmarkid)throw new Error("无效的书签id");if(!$.isArray(e.dashboardIds))throw new Error("无效的概览id列表");var n=e.dashboardIds,t=!1;if(n.forEach(function(e){t="number"!=typeof e}),t)throw new Error("传入的概览列表包含非数字类型");o.get(!0,function(t){var o=$(a.content({dashboards:t})),s=o.find("select");s.multiselect({nonSelectedText:sensorsdata.languages.get(0===t.length?"请先创建数据概览<!--{en}Please create a dashboard first-->":"请选择数据概览<!--{en}Select dashboard-->"),enableCaseInsensitiveFiltering:!1}),$.isArray(n)&&n.length>0?s.multiselect("select",n):s.multiselect("deselectAll",!1),sensorsdata.popover({ele:e.ele,container:"body",placement:"bottom",showNow:!0,content:o,title:sensorsdata.languages.get("添加到概览<!--{en}Add to dashboard-->"),template:a.template(),onShow:function(n){n.$tip.find(".pop-is-success").unbind("click").bind("click",function(){var t=[];s.find("option").each(function(){$(this).is(":checked")&&t.push(parseInt($(this).val(),10))}),$.isFunction(e.success)&&e.success({ids:t,bookmarkid:e.bookmarkid}),n.hide()})}})})}});t.exports=s});
;/*!components/model/api.js*/
define("components/model/api",function(e,E){var r={SEGMENTER_RULE_LIST:"segmenter/rule/all",SEGMENTER_RULE:"segmenter/rule{{#id}}/{{id}}{{/id}}",SEGMENTER_PARTITION:"segmenter/rule/{{id}}/partition{{#query}}?{{{query}}}{{/query}}",SEGMENTER_RULE_SCHEDULER_STATUS:"segmenter/rule/{{id}}/scheduler_status",SEGMENTER_EXECUTE:"segmenter/execute",SEGMENTER_EXECUTE_STATUS:"segmenter/status",USERS_LIST:"users/list/",USERS_LIST_CSV:"users/list/csv",USER_PROPERTIES:"property/user/properties"};E.get=function(e,E){return r[e]?Mustache.render(r[e],E||{}):sensorsdata.api.get(e,E)}});
;/*!components/dashboardCompatible/dashboardCompatible.js*/
define("components/dashboardCompatible/dashboardCompatible",function(t,e){var i=t("components/util/util"),n=t("components/model/api"),o={process:function(t){var e=$.Deferred();return this.fixUnitConfig(t.items).then(function(){e.resolve()}),e},fixUnitConfig:function(t){var e=$.Deferred(),o={"/funnel/":!0,"/retention/":!0,"/addiction/":!0},a=0;return t.forEach(function(t){var r=t.bookmark;if(o[r.type]){var s=i.json.parse(r.config),d=i.json.parse(r.data),f=!1;"/funnel/"===r.type&&d.unit?(delete d.unit,delete s.oldUnit,delete s.unit,f=!0):s.oldUnit&&(d.unit=s.oldUnit,delete s.oldUnit,delete s.unit,f=!0),f&&(r.data=JSON.stringify(d),r.config=JSON.stringify(s),a++,sensorsdata.ajax({url:n.get("bookmarks",{id:r.id}),method:"post",data:JSON.stringify(r)}).then(function(){0===--a&&e.resolve()}))}}),a||e.resolve(),e}},a={process:function(t,e){var n=$.Deferred(),o=this,a=e&&e.config&&i.json.parse(e.config);return this.dashboardID=t,!e||$.isEmptyObject(e.items)||a&&a.compatible>=3943?n.resolve({result:e,status:!1}):e.user_id===sensorsdata.authority.userId?o.processConfig(i.json.parse(e.config),e).then(function(t){n.resolve({status:t,result:e})}):n.resolve({status:!1,result:o.buildNewResult(e)}),n},buildNewResult:function(t){var e=this,n=i.json.parse(t.config),o=this.getHasConfigItems(n,t.items);return o.forEach(function(t){t.bookmark=e.buildBookmarkData(t),t.config="{}"}),t},processConfig:function(t,e){var i=$.Deferred(),n=this.getHasConfigItems(t,e.items);return n.length?this.updateConfig(t,n,e.items).then(function(){i.resolve(!0)}):(o.process(e).then(function(){i.resolve(!1)}),this.addTag(e)),i},getHasConfigItems:function(t,e){var n={"/segmentation/":!0,"/funnel/":!0,"/retention/":!0,"/addiction/":!0},o=[],a=!(!t.widgetTime&&!t.widgetUnit);return e.forEach(function(e){if(n[e.bookmark.type]){var r=i.json.parse(e.config),s=!1;a?(t.widgetTime&&(r.widgetTime=r.widgetTime||t.widgetTime,s=!0),t.widgetUnit&&"/segmentation/"===e.bookmark.type&&(r.widgetUnit=r.widgetUnit||t.widgetUnit,s=!0)):(r.widgetType||r.widgetUnit||r.widgetTime)&&(s=!0),s&&o.push({bookmark:e.bookmark,config:r})}}),o},updateConfig:function(t,e,i){var n=$.Deferred(),o=2;return this.updateBookmarks(e).then(function(){0===--o&&n.resolve()}),this.cleanWidgetConfig(t,i).then(function(){0===--o&&n.resolve()}),n},updateBookmarks:function(t){var e=this,i=$.Deferred(),o=t.length;return t.forEach(function(t){sensorsdata.ajax({url:n.get("bookmarks",{id:t.bookmark.id}),method:"post",data:JSON.stringify(e.buildBookmarkData(t))}).then(function(){0===--o&&i.resolve()})}),i},buildBookmarkData:function(t){var e=t.bookmark,n=t.config,o=i.json.parse(e.data);return e.config={chartsType:"number"===n.widgetType?"table":n.widgetType||""},(n.widgetTime||n.widgetUnit)&&(n.widgetTime&&$.extend(o,this.widgetTimeToDataTime(n.widgetTime)),n.widgetUnit&&"/segmentation/"===e.type&&(e.config.oldUnit=o.unit||"",o.unit=e.config.unit="rollup"===n.widgetUnit?"day":n.widgetUnit),e.data=i.json.stringify(o)),e.config=i.json.stringify(e.config),e},widgetTimeToDataTime:function(t){var e=t.match(/(\d{4}-\d{1,2}-\d{1,2})至(\d{4}-\d{1,2}-\d{1,2})/),i=!e&&t.match(/(\d+),(\d+),day/),n={"0 day":"今日","1 day":"昨日","0 week":"本周","last week":"上周","0 month":"本月","last month":"上月","0 year":"本年","last year":"去年","7 day":"过去 7 天","30 day":"过去 30 天","-1 day":"上线至今"};return e?{from_date:e[1],to_date:e[2]}:i?{rangeText:"0"===i[2]?"最近"+(Number(i[1])+1)+"天":"1"===i[2]?"过去"+i[1]+"天":"过去"+i[2]+"天 - 过去"+i[1]+"天"}:n[t]?{rangeText:n[t]}:void 0},cleanWidgetConfig:function(t,e){var o=sensorsdata.cache.config.build_version.match(/\d+$/);return o=o?Number(o[0]):3943,sensorsdata.ajax({url:n.get("dashboards",{id:this.dashboardID}),method:"post",data:JSON.stringify({config:i.json.stringify($.isEmptyObject(t)?{compatible:o}:{oldConfig:i.json.stringify(t),compatible:o}),items:e.map(function(t){var e=$.isEmptyObject(i.json.parse(t.config))?{}:{oldConfig:t.config};return{bookmark_id:t.bookmark.id,config:JSON.stringify(e)}})})})},addTag:function(t){var e=i.json.parse(t.config),o=sensorsdata.cache.config.build_version.match(/\d+$/);e.compatible=o?Number(o[0]):3943,sensorsdata.ajax({url:n.get("dashboards",{id:this.dashboardID}),method:"post",data:JSON.stringify({config:JSON.stringify(e)})})}};e.process=function(t,e){return a.process(t,e)}});
;/*!components/model/widgetModel.js*/
define("components/model/widgetModel",function(t,e,s){var n=t("components/dataCache/dataCache").create,o=n(),i=$.extend(!0,{},sensorsdata.EventsModule,{getList:function(t){if("function"!=typeof t)throw new Error("model/customWidgetModel: getList 方法的第 1 个参数必须为 function 类型");var e=o.get("cutomWidgetList");e?t($.extend(!0,{},e)):sensorsdata.ajax({url:sensorsdata.api.get("allWidgets"),success:function(e){t($.extend(!0,{},e)),o.set("cutomWidgetList",e)}})},get:function(t,e){if("function"!=typeof e)throw new Error("model/customWidgetModel: get 方法的第 2 个参数必须为 function 类型");var s=o.get(t);s?e($.extend(!0,{},s)):sensorsdata.ajax({url:sensorsdata.api.get("customWidget",{id:t}),success:function(s){e($.extend(!0,{},s)),o.set(t,s)}})},set:function(t,e){var s=this,n="set",o=t.id,i=sensorsdata.api.get("customWidget",{id:t.id});return o?void this.get(o,function(a){var d=a.config||"{}";"string"==typeof t.config&&(t.config=JSON.parse(t.config));var c=$.extend(JSON.parse(d),t.config);t.config=JSON.stringify(c),t=$.extend(a,t),sensorsdata.ajax({method:"POST",url:i,data:JSON.stringify(t),success:function(i){if("function"==typeof e){var a=$.extend(!0,{},t);e(a)}s.postProcessingCRUD(n,o,i)}})}):void this.add(t,e)},del:function(t,e){var s=this;sensorsdata.ajax({method:"DELETE",url:sensorsdata.api.get("customWidget",{id:t}),success:function(n){"function"==typeof e&&e(n),s.postProcessingCRUD("del",t,n)}})},add:function(t,e){var s=this,n=sensorsdata.api.get("allWidgets"),o="add";sensorsdata.ajax({method:"POST",url:n,data:JSON.stringify(t),success:function(t){"function"==typeof e&&e(t),s.postProcessingCRUD(o,"",t)}})},postProcessingCRUD:function(t,e,s){var n={data:s};o.del("cutomWidgetList"),e&&(n.id=e,o.del(e)),this.trigger(t,n)}});s.exports=i});
;/*!components/model/dashboardWidget.js*/
define("components/model/dashboardWidget",function(t,o,e){var i=t("components/util/util"),r=t("components/model/api"),n=t("components/dashboardCompatible/dashboardCompatible"),a=t("components/model/bookmarks"),s=t("components/model/widgetModel"),d=t("components/dataCache/dataCache").create({expires:6e5}),c={"/utm/":!0},u={checkDashboardID:function(t,o){if(!$.isNumeric(o))throw new Error("dashboardWidget: "+t+" 概览 ID 不能为空且必须为 number 类型")},checkDashboardIDs:function(t,o){if(!$.isNumeric(o)&&!$.isArray(o))throw new Error("dashboardWidget: "+t+" 概览 ID 不能为空且必须为 number 类型或 array 类型")},checkWidget:function(t,o){if("object"!==$.type(o))throw new Error("dashboardWidget: "+t+" widget 参数不能为空且必须为 Object 类型");if(!$.isNumeric(o.id)&&"object"!==$.type(o.bookmark)&&$.isNumeric(o.bookmark.id))throw new Error("dashboardWidget: "+t+" widget ID 不能为空且必须为 number 类型");if("object"!==$.type(o.bookmark)&&"object"!==$.type(o.config))throw new Error("dashboardWidget: "+t+" widget 必须包含书签数据或 widget 配置数据")},checkWidgetID:function(t,o){if(!$.isNumeric(o))throw new Error("dashboardWidget: "+t+" widget ID 不能为空且必须为 number 类型")},checkCallback:function(t,o){if(!$.isFunction(o))throw new Error("dashboardWidget: "+t+" callback 参数不能为空且必须为 Function 类型")},checkArray:function(t,o){if(!$.isArray(o)||!o.length)throw new Error("dashboardWidget: "+t+" 参数不为 Array 类型或数组为空")}},f=$.extend(!0,{},sensorsdata.EventsModule,{add:function(t,o,e){u.checkDashboardIDs("add",t),u.checkWidget("add",o),this.set(t,o,e,{isAdd:!0})},del:function(t,o,e){u.checkDashboardID("del",t),u.checkWidgetID("del",o);var n=this;this.buildDelData(t,o,function(o){sensorsdata.ajax({url:r.get("dashboards",{id:t}),type:"post",data:JSON.stringify({items:o.items.map(function(t){return t.config=i.json.stringify(t.config),t})}),showLoader:!1,success:function(){$.isFunction(e)&&e(!0),n.postProcessingCRUD("del",t,o.widget)}})})},buildDelData:function(t,o,e){this.getList(t,function(t){var i=(t&&t.items||[]).filter(function(t){return t.id!==o});e({items:i.map(function(t){return{bookmark_id:t.id||t.bookmark.id,config:t.config}}),widget:t.map[o]})},!1)},set:function(t,o,e,i){"object"===$.type(e)&&"undefined"===$.type(i)&&(i=e,e=null),i||(i={}),i.isAdd||(u.checkDashboardIDs("set",t),u.checkWidget("set",o));var r=this,n="object"===$.type(o.bookmark)&&"object"===$.type(o.config)?2:1,a=0,s=function(){if(++a===n){$.isFunction(e)&&e(!0);var s=t;$.isArray(t)&&(s=s.join("-")),r.postProcessingCRUD(i.isAdd?"add":"set",s,o,i)}};return i.isAdd?void this.updateBookmark(o.bookmark,t,function(e){a++,d.del(t),e&&e.id&&(o.id=e.id,o.bookmark&&(o.bookmark.id=e.id)),r.updateWidget(o,t,s,!0)===!1&&(a--,s())}):(this.updateBookmark(o.bookmark,t,s),void this.updateWidget(o,t,s))},updateBookmark:function(t,o,e){if("object"===$.type(t)){"object"===$.type(t.config)&&(t.config=JSON.stringify(t.config));var i=$.isArray(o)?o:[o],r=t.dashboards||[];i.forEach(function(t){t=Number(t),-1===r.indexOf(t)&&r.push(t)}),t.dashboards=r,c[t.type]?s.set(t,e):a.set(t,e)}},updateWidget:function(t,o,e){if("object"!==$.type(t.config))return!1;var i=this,n=$.isArray(o)?o:[o],a=n.length,s=0;n.forEach(function(o){i.buildUpdateData(o,t,function(t){sensorsdata.ajax({url:r.get("dashboards",{id:o}),type:"post",data:JSON.stringify(t),showLoader:!1,success:function(){++s===a&&e()}})})})},buildUpdateData:function(t,o,e){var i=this,r=Number(o.id||o.bookmark.id);this.getList(t,function(t){e({items:t.items.map(function(t){return Number(t.id)!==r?i.buildItemData(t.bookmark.id,t.config):i.buildItemData(r,t.config,o.config)})})},!1)},buildItemData:function(t,o,e){return{bookmark_id:t,config:JSON.stringify($.extend(!0,o,e))}},get:function(t,o,e){u.checkDashboardID("get",t),u.checkWidgetID("get",o),u.checkCallback("get",e),this.getList(t,function(t){e(t.map[o])})},getList:function(t,o,e){u.checkDashboardID("getList",t),u.checkCallback("getList",o);var a=d.get(t);return e!==!1&&a?void o(a):void sensorsdata.ajax({url:r.get("dashboards",{id:t}),showLoader:!1,success:function(e){n.process(t,e).then(function(e){var r={items:e.result&&e.result.items||[]},n=r.map={};r.items.forEach(function(t){t.bookmark=i.resetConfig(t.bookmark),t.id=Number(t.bookmark.id),t.config=i.json.parse(t.config),t.bookmark.config=i.json.parse(t.bookmark.config),n[t.id]=t}),r.user_id=e.result.user_id,r.config=i.json.parse(e.result&&e.result.config||""),d.set(t,r),o($.extend(!0,{},r))})}})},sort:function(t,o,e){u.checkDashboardID("sort",t),u.checkArray("sort",o);var n=this;this.getList(t,function(a){var s=o.map(function(t){var o=a.map[t];return o?{bookmark:o.bookmark,bookmark_id:o.bookmark.id,config:o.config}:void 0});s=s.filter(function(t){return t&&"undefined"!==$.type(t.bookmark_id)}),sensorsdata.ajax({url:r.get("dashboards",{id:t}),type:"post",data:JSON.stringify({items:s.map(function(t){return{bookmark_id:t.bookmark_id,config:i.json.stringify(t.config)}})}),showLoader:!1,success:function(){$.isFunction(e)&&e(!0),n.postProcessingCRUD("sort",t)}})},!1)},postProcessingCRUD:function(t,o,e,i){if(d.del(o),!i||i.isTrigger!==!1){var r={dashboardID:o,action:t};"object"===$.type(e)&&(r.widget=e),this.trigger(t,r)}},createProxy:function(t){u.checkDashboardID("createProxy",t);var o=this,e=$.extend(!0,{},sensorsdata.EventsModule),i=["add","del","set","get","getList","sort","reverse"],r=function(o){o.dashboardID===t&&e.trigger(o.action,o)};return i.forEach(function(i){e[i]=function(){for(var e=[t],r=0,n=arguments.length;n>r;r++)e.push(arguments[r]);o[i].apply(o,e)},o.on(i,r)}),e.destroy=function(){i.forEach(function(t){delete e[t],o.off(t,r)})},e}});e.exports=f});
;/*!components/dashboardConfigForm/dashboardConfigForm.js*/
define("components/dashboardConfigForm/dashboardConfigForm",function(e,a){var t=e("components/util/util"),n={template:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return""},useData:!0}),dropdown:Handlebars.template({1:function(e,a,t,n){var o,l=a.helperMissing,r="function",s=this.escapeExpression;return'  <li><a data-value="'+s((o=null!=(o=a.value||(null!=e?e.value:e))?o:l,typeof o===r?o.call(e,{name:"value",hash:{},data:n}):o))+'"><span data-value="'+s((o=null!=(o=a.value||(null!=e?e.value:e))?o:l,typeof o===r?o.call(e,{name:"value",hash:{},data:n}):o))+'">'+s((o=null!=(o=a.text||(null!=e?e.text:e))?o:l,typeof o===r?o.call(e,{name:"text",hash:{},data:n}):o))+"</span></a></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var o;return'<button type="button" class="btn-selector dropdown-toggle" data-toggle="dropdown">\n  <span class="selected"></span>\n</button>\n<ul class="dropdown-menu pull-right" role="menu">\n'+(null!=(o=a.each.call(e,e,{name:"each",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?o:"")+"</ul>\n"},useData:!0}),multiselect:Handlebars.template({1:function(e,a,t,n){var o,l,r=a.helperMissing,s="function",i=this.escapeExpression;return'    <option value="'+i((l=null!=(l=a.value||(null!=e?e.value:e))?l:r,typeof l===s?l.call(e,{name:"value",hash:{},data:n}):l))+'" data-index="'+i((l=null!=(l=a.index||(null!=e?e.index:e))?l:r,typeof l===s?l.call(e,{name:"index",hash:{},data:n}):l))+'" '+(null!=(o=a["if"].call(e,null!=e?e.selected:e,{name:"if",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n}))?o:"")+">"+i((l=null!=(l=a.text||(null!=e?e.text:e))?l:r,typeof l===s?l.call(e,{name:"text",hash:{},data:n}):l))+"</option>\n"},2:function(){return'selected="selected"'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var o;return'<select class="" name="" multiple="multiple">\n'+(null!=(o=a.each.call(e,e,{name:"each",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?o:"")+"</select>\n"},useData:!0}),segmentation:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var o,l=a.helperMissing,r="function",s=this.escapeExpression;return'<form class="dashboard-config-form form-inline">\n  <div class="form-group">\n    <label for="dashboardName">名称<!--{en}Name--></label>\n    <input type="text" class="form-control" id="dashboardName" value="'+s((o=null!=(o=a.name||(null!=e?e.name:e))?o:l,typeof o===r?o.call(e,{name:"name",hash:{},data:n}):o))+'" autocomplete="off">\n  </div>\n  <div class="form-group">\n    <label for="time-range">时间范围<!--{en}Time range--></label>\n    <div class="report-date-picker-wrap">\n      <span class="icon-date-picker"></span>\n      <input id="inputDate" type="text" class="form-control" readonly="readonly" data-placement="top" data-container="body" title="" data-original-title="事件发生的时间范围" >\n    </div>\n  </div>\n  <div class="form-group">\n    <label for="dashboard-unit">聚合时间单位<!--{en}Polymerization time unit--></label>\n    <div class="dropdown" id="dashboard-unit">\n      <button type="button" class="btn-selector dropdown-toggle" data-toggle="dropdown" data-value="'+s((o=null!=(o=a.unit||(null!=e?e.unit:e))?o:l,typeof o===r?o.call(e,{name:"unit",hash:{},data:n}):o))+'">\n        <span class="selected" data-value="'+s((o=null!=(o=a.unit||(null!=e?e.unit:e))?o:l,typeof o===r?o.call(e,{name:"unit",hash:{},data:n}):o))+'"></span>\n      </button>\n      <ul class="dropdown-menu pull-right" role="menu">\n        <li><a data-value="minute">按分钟<!--{en}By minute--></a></li>\n        <li><a data-value="hour">按小时<!--{en}By hour--></a></li>\n        <li><a data-value="day">按天<!--{en}By day--></a></li>\n        <li><a data-value="week">按周<!--{en}By week--></a></li>\n        <li><a data-value="month">按月<!--{en}By month--></a></li>\n      </ul>\n    </div>\n  </div>\n  <div class="form-group">\n    <label for="dashboard-measures">显示指标</label>\n    <div class="selector" id="dashboard-measures"></div>\n  </div>\n  <div class="form-group">\n    <label for="dashboard-fields">显示分组</label>\n    <div class="selector" id="dashboard-fields"></div>\n  </div>\n  <div class="form-group">\n    <label for="dashboard-comment">备注</label>\n    <textarea id="dashboard-comment" placeholder="可输入备注信息" data-lang-placeholder="<!--{en}Please input the note information-->" class="form-control">'+s((o=null!=(o=a.note||(null!=e?e.note:e))?o:l,typeof o===r?o.call(e,{name:"note",hash:{},data:n}):o))+"</textarea>\n  </div>\n</form>\n"},useData:!0}),funnel:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var o,l=a.helperMissing,r="function",s=this.escapeExpression;return'<form class="dashboard-config-form form-inline">\n  <div class="form-group">\n    <label for="dashboardName">名称<!--{en}Name--></label>\n    <input type="text" class="form-control" id="dashboardName" value="'+s((o=null!=(o=a.name||(null!=e?e.name:e))?o:l,typeof o===r?o.call(e,{name:"name",hash:{},data:n}):o))+'">\n  </div>\n  <div class="form-group">\n    <label for="time-range">时间范围<!--{en}Time range--></label>\n    <div class="report-date-picker-wrap">\n      <span class="icon-date-picker"></span>\n      <input id="inputDate" style="width: 100%;" type="text" class="form-control" readonly="readonly" data-placement="top" data-container="body" title="" data-original-title="事件发生的时间范围" data-calendar-status-refresh-time="1516602699">\n    </div>\n  </div>\n  <div class="form-group">\n    <label for="dashboard-fields">显示分组</label>\n    <div class="selector" id="dashboard-fields"></div>\n  </div>\n  <div class="form-group">\n    <label for="dashboard-comment">备注</label>\n    <textarea id="dashboard-comment" class="form-control" placeholder="可输入备注信息" data-lang-placeholder="<!--{en}Please input the note information-->">'+s((o=null!=(o=a.note||(null!=e?e.note:e))?o:l,typeof o===r?o.call(e,{name:"note",hash:{},data:n}):o))+"</textarea>\n  </div>\n</form>\n"},useData:!0}),retention:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var o,l=a.helperMissing,r="function",s=this.escapeExpression;return'<form class="dashboard-config-form form-inline">\n  <div class="form-group">\n    <label for="dashboardName">名称<!--{en}Name--></label>\n    <input type="text" class="form-control" id="dashboardName" value="'+s((o=null!=(o=a.name||(null!=e?e.name:e))?o:l,typeof o===r?o.call(e,{name:"name",hash:{},data:n}):o))+'">\n  </div>\n  <div class="form-group">\n    <label for="time-range">时间范围<!--{en}Time range--></label>\n    <div class="report-date-picker-wrap">\n      <span class="icon-date-picker"></span>\n      <input id="inputDate" style="width: 100%;" type="text" class="form-control" readonly="readonly" data-placement="top" data-container="body" title="" data-original-title="事件发生的时间范围" >\n    </div>\n  </div>\n  <div class="form-group">\n    <label for="dashboard-comment">备注</label>\n    <textarea id="dashboard-comment" placeholder="可输入备注信息" data-lang-placeholder="<!--{en}Please input the note information-->" class="form-control">'+s((o=null!=(o=a.note||(null!=e?e.note:e))?o:l,typeof o===r?o.call(e,{name:"note",hash:{},data:n}):o))+"</textarea>\n  </div>\n</form>\n"},useData:!0}),addiction:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var o,l=a.helperMissing,r="function",s=this.escapeExpression;return'<form class="dashboard-config-form form-inline">\n  <div class="form-group">\n    <label for="dashboardName">名称<!--{en}Name--></label>\n    <input type="text" class="form-control" id="dashboardName" value="'+s((o=null!=(o=a.name||(null!=e?e.name:e))?o:l,typeof o===r?o.call(e,{name:"name",hash:{},data:n}):o))+'">\n  </div>\n  <div class="form-group">\n    <label for="dashboard-type">展示类型<!--{en}Display type--></label>\n    <div class="selector" id="dashboard-type"></div>\n  </div>\n  <div class="form-group">\n    <label for="time-range">时间范围<!--{en}Time range--></label>\n    <div class="report-date-picker-wrap">\n      <span class="icon-date-picker"></span>\n      <input id="inputDate" style="width: 100%;" type="text" class="form-control" readonly="readonly" data-placement="top" data-container="body" title="" data-original-title="事件发生的时间范围" data-calendar-status-refresh-time="1516602699">\n    </div>\n  </div>\n  <div class="form-group">\n    <label for="dashboard-comment">备注<!--{en}Remarks--></label>\n    <textarea id="dashboard-comment" placeholder="可输入备注信息" data-lang-placeholder="<!--{en}Please input the note information-->" class="form-control">'+s((o=null!=(o=a.note||(null!=e?e.note:e))?o:l,typeof o===r?o.call(e,{name:"note",hash:{},data:n}):o))+"</textarea>\n  </div>\n</form>\n"},useData:!0}),user_analytics:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var o,l=a.helperMissing,r="function",s=this.escapeExpression;return'<form class="dashboard-config-form form-inline">\n  <div class="form-group">\n    <label for="dashboardName">名称<!--{en}Name--></label>\n    <input type="text" class="form-control" id="dashboardName" value="'+s((o=null!=(o=a.name||(null!=e?e.name:e))?o:l,typeof o===r?o.call(e,{name:"name",hash:{},data:n}):o))+'">\n  </div>\n  <div class="form-group">\n    <label for="dashboard-comment">备注</label>\n    <textarea id="dashboard-comment" placeholder="可输入备注信息" data-lang-placeholder="<!--{en}Please input the note information-->" class="form-control">'+s((o=null!=(o=a.note||(null!=e?e.note:e))?o:l,typeof o===r?o.call(e,{name:"note",hash:{},data:n}):o))+"</textarea>\n  </div>\n</form>\n"},useData:!0})},o={"/segmentation/":[{value:"rollup",text:sensorsdata.languages.get("合计<!--{en}Total-->")},{value:"minute",text:sensorsdata.languages.get("按分钟<!--{en}By minute-->")},{value:"hour",text:sensorsdata.languages.get("按小时<!--{en}By hour-->")},{value:"day",text:sensorsdata.languages.get("按天<!--{en}By day-->")},{value:"week",text:sensorsdata.languages.get("按周<!--{en}By week-->")},{value:"month",text:sensorsdata.languages.get("按月<!--{en}By month-->")}]},l={},r=function(e){if(!e.container)throw new Error("无效的概览配置表单容器");if(!e.dashboard)throw new Error("无效的概览对象");if(!e.dashboard.bookmark)throw new Error("无效的书签对象");if(!e.chartsData)throw new Error("无效的图表数据");this.$container=e.container,this.options=e,this.type=e.dashboard.bookmark.type,this.init(e)};r.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(e){var a=e.dashboard.bookmark;a=$.extend(!0,{},{config:{}},a);var o=t.json.parse(a.data);l=o,this.chartsType=a.config.chartsType||l.chartsType||"line";var r=a.type.replace(/\//g,""),s=a.name,i=t.json.parse(a.config)||{},d=e.container;if(d.html(n[r]({name:s,type:r,note:i.comment})),this.bindEvents(),"user_analytics"!==r){var m=d.find("#inputDate");this.initInputDate(m,a,o)}this.initTimeUnit(d.find("#dashboard-unit"),a,o),this.initByFields(d.find("#dashboard-fields"),a,o,e.chartsData),this.initMeasures(d.find("#dashboard-measures"),a,o)},bindEvents:function(){var e=this.$container;e.find("#dashboardName").on("keyup",function(){$(this).val().trim()?sensorsdata.form.removeError($(this)):sensorsdata.form.addError($(this),"不能为空")})},initInputDate:function(e,a,n){var o={allowRelative:!0},l=t.json.parse(a.config),r=sensorsdata.CONSTSET.timeFormat;switch(o.startDate=moment(n.from_date,r),o.endDate=moment(n.to_date,r),a.type){case"/segmentation/":if(o.showCompare=!0,o.chosenLabel=n.rangeText,o.rangeLimit=sensorsdata.CONSTSET.dateRangeLimit[n.unit],o.showHour="hour"===n.unit||"minute"===n.unit,n.compare_from_date&&n.compare_from_date){o.compareKey=l.compareKey||"";var s=t.json.parse(a.config),i={compareKey:s.compareKey,from_date:n.from_date,to_date:n.to_date,compare_from_date:n.compare_from_date,compare_to_date:n.compare_to_date},d=t.getTimeRange(n.rangeText,!0,i);n.rangeText&&d?(o.compareStartDate=moment(d.compare_from_date,r),o.compareEndDate=moment(d.compare_to_date,r)):(o.compareStartDate=n.compare_from_date,o.compareEndDate=n.compare_to_date);var m=["昨日","今日","上周","本周","上月","本月","去年","本年"];!o.compareKey&&o.showCompare&&m.indexOf(o.chosenLabel)>-1&&(o.compareKey="last period")}break;case"/funnel/":o.showCompare=!1,o.timeExtend={isLimit:!n.extend_over_end_date,text:sensorsdata.languages.get("限制窗口期在时间范围内<!--{en}Limit the window period to the time range-->"),tooltip:sensorsdata.languages.get("将首步骤之后的步骤的发生时间限定在时间范围内<!--{en}Please limit the occurrence time of the step after the first step to the time range-->")};break;case"/retention/":o.showCompare=!1,o.timeExtend={isLimit:!n.extend_over_end_date,text:sensorsdata.languages.get("限制后续事件在时间范围内<!--{en}Limit subsequent events in the time range-->")};break;case"/addiction/":o.showCompare=!1}sensorsdata.initDateRangeInput(e,o),e.unbind("apply.daterangepicker").bind("apply.daterangepicker",sensorsdata.bind(function(){this.trigger("update")},this))},initTimeUnit:function(e,a,t){var l=n.dropdown(o[a.type]);e.html(l),e.find("button").saDropdown({value:a.config.unit||t.unit,onSelected:sensorsdata.bind(function(){this.trigger("update")},this)})},initMeasures:function(e,a,o){var l=this;switch(a.type){case"/segmentation/":var r=o.measures;t.measuresToText(o,function(o){r=o;var s=t.json.parse(a.config),i=s.measureIndexs?s.measureIndexs:[0];r=r.map(function(e,a){return{text:(e.text||[e.measure.event_name]).join("的"),index:a,selected:-1!==i.indexOf(a),value:(e.measure.event_name?e.measure.event_name:e.measure.name)+a}});var d=n.multiselect(r);e.html(d),e.find("select").multiselect({toggleClose:!1,includeSelectAllOption:!0,selectAllText:"全选",onChange:function(a,t){var n=e.find("select"),o=n.val()||[],r=o.length;if("line"===l.chartsType&&t&&r>3)if(a)n.multiselect("deselect",a.val());else for(var s=3;r>s;s++)n.multiselect("deselect",o[s]);else l.trigger("update")}})});break;case"/funnel/":}},initByFields:function(e,a,o,l){var r=this,s=t.json.parse(a.config),i=s.byFields?s.byFields:[0],d=[],m=!1;o.by_fields&&0!==o.by_fields.length?(d=l.data.result.rows.map(function(e,a){return{index:a,text:e.name,value:e.name,selected:-1!==i.indexOf(e.name)}}),d.unshift({index:-1,text:sensorsdata.languages.get("全部<!--{en}Select all-->"),value:"saAll",selected:-1!==i.indexOf("saAll")})):d.push({index:0,text:"无",value:"none",selected:!0});var c=n.multiselect(d);e.html(c),e.find("select").multiselect({toggleClose:!1,includeSelectAllOption:m,onChange:function(e,a){var t=$(e);"saAll"===t.val()&&"-1"===t.attr("data-index")?(this.$select.multiselect("deselectAll",!1),a&&this.$select.multiselect("select","saAll")):this.$select.multiselect("deselect","saAll"),r.trigger("update")}})},getVal:function(){var e=this.options.dashboard.bookmark,a=this.$container,n=t.json.parse(e.data),o={},l=a.find("#dashboardName").val(),r=a.find("#dashboard-unit button").attr("data-value");o.unit=r,n.unit="rollup"===r?"day":r;var s=a.find("input#inputDate").data("daterangepicker");if(s){var i="hour"===n.unit||"minute"===n.unit?sensorsdata.CONSTSET.timeFormat:sensorsdata.CONSTSET.dateFormat;n.rangeText=s.chosenLabel,n.from_date=s.startDate.format(i),n.to_date=s.endDate.format(i)}switch(this.type){case"/segmentation/":var d=s.compareStartDate,m=s.compareEndDate;moment.isMoment(d)&&moment.isMoment(m)?(n.compare_from_date=d.format(sensorsdata.CONSTSET.dateFormat),n.compare_to_date=m.format(sensorsdata.CONSTSET.dateFormat),o.compareKey=s.compareKey):(delete n.compare_from_date,delete n.compare_to_date),n.chartsType=a.find("#dashboard-type").find("button").attr("data-value");var c=[];a.find("#dashboard-measures select").find("option:selected").each(function(){c.push($(this).index())}),o.measureIndexs=c;break;case"/funnel/":n.extend_over_end_date=!s.isLimit;break;case"/retention/":n.extend_over_end_date=!s.isLimit}var u=[];a.find("#dashboard-fields select").find("option:selected").each(function(){var e=$(this).val();"none"!==e&&u.push($(this).val())}),o.comment=a.find("#dashboard-comment").val(),o.byFields=u;var p=$.extend(!0,{},this.options.dashboard);return $.extend(p.bookmark,{data:JSON.stringify(n),config:o,name:l}),p},setChartsType:function(e){this.chartsType=e||this.chartsType},destroy:function(){this.off("update")}}),a.create=function(e){return new r(e)}});
;/*!components/model/normalizeRetention.js*/
define("components/model/normalizeRetention",function(e,a,n){var t={durations:{addiction:[{name:"day",value:23,cname:sensorsdata.languages.get("一天内<!--{en}in one day-->"),unit:"hour",shortCname:sensorsdata.languages.get("天<!--{en}Day-->"),unitCname:sensorsdata.languages.get("小时<!--{en}Hour-->")},{name:"week",value:6,cname:sensorsdata.languages.get("一周内<!--{en}In one week-->"),unit:"day",shortCname:sensorsdata.languages.get("周<!--{en}Week-->"),unitCname:sensorsdata.languages.get("天<!--{en}Day-->")},{name:"month",value:30,cname:sensorsdata.languages.get("一个月内<!--{en}In one month-->"),unit:"day",shortCname:sensorsdata.languages.get("月<!--{en}Month-->"),unitCname:sensorsdata.languages.get("天<!--{en}Day-->")}],retention:[{name:"1",value:1,cname:sensorsdata.languages.get("次天留存<!--{en}Retention the next day-->"),unit:"day",unitCname:sensorsdata.languages.get("天<!--{en}days-->"),isDay:!0},{name:"2",value:7,cname:sensorsdata.languages.get("7天留存<!--{en}Retention in 7 days -->"),unit:"day",unitCname:sensorsdata.languages.get("天<!--{en}days-->"),isDay:!0},{name:"3",value:14,cname:sensorsdata.languages.get("14天留存<!--{en}Retention in 14 days -->"),unit:"day",unitCname:sensorsdata.languages.get("天<!--{en}days-->"),isDay:!0},{name:"4",value:30,cname:sensorsdata.languages.get("30天留存<!--{en}Retention in 30 days -->"),unit:"day",unitCname:sensorsdata.languages.get("天<!--{en}days-->"),isDay:!0},{name:"5",value:1,cname:sensorsdata.languages.get("次周留存<!--{en}Retention the next week-->"),unit:"week",unitCname:sensorsdata.languages.get("周<!--{en}weeks-->"),isWeek:!0},{name:"6",value:8,cname:sensorsdata.languages.get("8周留存<!--{en}Retention in 8 weeks-->"),unit:"week",unitCname:sensorsdata.languages.get("周<!--{en}weeks-->"),isWeek:!0},{name:"7",value:12,cname:sensorsdata.languages.get("12周留存<!--{en}Retention in 12 weeks-->"),unit:"week",unitCname:sensorsdata.languages.get("周<!--{en}weeks-->"),isWeek:!0},{name:"8",value:24,cname:sensorsdata.languages.get("24周留存<!--{en}Retention in 24 weeks-->"),unit:"week",unitCname:sensorsdata.languages.get("周<!--{en}weeks-->"),isWeek:!0},{name:"9",value:1,cname:sensorsdata.languages.get("次月留存<!--{en}Retention the next month-->"),unit:"month",unitCname:sensorsdata.languages.get("月<!--{en}months-->"),isMonth:!0},{name:"10",value:6,cname:sensorsdata.languages.get("6个月留存<!--{en}Retention in 6 month-->"),unit:"month",unitCname:sensorsdata.languages.get("月<!--{en}months-->"),isMonth:!0},{name:"11",value:12,cname:sensorsdata.languages.get("12个月留存<!--{en}Retention in 12 month-->"),unit:"month",unitCname:sensorsdata.languages.get("月<!--{en}months-->"),isMonth:!0},{name:"12",value:24,cname:sensorsdata.languages.get("24个月留存<!--{en}Retention in 24 month-->"),unit:"month",unitCname:sensorsdata.languages.get("月<!--{en}months-->"),isMonth:!0}]},get:function(e){var a=e.queryParams,n=e.data,t=this;this.options=e,this.queryParams=a,this.config=e.config;var s=this.getDuration(this.config.type,a.duration,a.unit),r=sensorsdata.getBeginDate(s.unit),o=sensorsdata.CONSTSET.timeFormat,g=function(e){var a=moment(e,o);return a.isValid()?r.diff(a,s.unit)+1:0},u=0;if(a.by_field){var i=sensorsdata.getBeginDate(s.unit,a.from_date);u=r.diff(i,s.unit)+1}else u=g(n.rows[0].by_value);u=u<=s.value?u:s.value+1;for(var l=n.rows.map(function(e,a){for(var n=e.cells.length;u>n;n++)e.cells.push({people:0,percent:0});var r={};return r.name=e.by_value,r.rowIndex=a,r.cells=e.cells.map(function(a,n){var r=Math.floor((100-Math.ceil(a.percent))/10)+1;return a.className="hm-"+r,a.tip=t.buildCellTip(e,n,s.unitCname),a}),r.cells.shift(),r.total_people=e.total_people,r}),d=[],m=0;m<l[0].cells.length;m++)d.push(sensorsdata.util.format(sensorsdata.languages.get("第 #{x} #{unitCname}<!--{en}No.#{x} #{unitCname}-->"),{x:m+1,unitCname:s.unitCname}));return{field:a.by_field?a.by_field.text:"初始行为日期",num:l.length,rows:l,series:d}},buildCellTip:function(e,a,n){var t=this.queryParams,s=sensorsdata.languages.get("第<!--{en}No.-->")+a+n,r=sensorsdata.findEventCname(t.first_event.event_name),o=sensorsdata.findEventCname(t.second_event.event_name),g=t.by_field?t.by_field.text:"";if(g)return t.is_wastage?sensorsdata.util.format(sensorsdata.languages.get("在选定时间段内有 #{total_people} 位 #{byName} 是 #{by_value} 的人进行了 #{firstEventName}。其中，有 #{people} 人随后最长持续 #{cellIndex} #{unit} 没有进行过 #{secondEventName}"),{total_people:sensorsdata.formatNumber(e.total_people),byName:g,by_value:sensorsdata.trimConstHtml(e.by_value),firstEventName:r,people:e.cells[a].people,cellIndex:a,unit:n,secondEventName:o}):sensorsdata.languages.get("在选定时间段内有<!--{en}In the selected period of time, there is-->")+sensorsdata.formatNumber(e.total_people)+sensorsdata.languages.get("位<!--{en}people-->")+g+sensorsdata.languages.get("是<!--{en}Yes-->")+sensorsdata.trimConstHtml(e.by_value)+sensorsdata.languages.get("的人进行了<!--{en}people did-->")+r+sensorsdata.languages.get("。其中，有<!--{en}.In which there are-->")+e.cells[a].people+sensorsdata.languages.get("人在进行<!--{en}people did-->")+r+sensorsdata.languages.get("后的<!--{en}after-->")+s+sensorsdata.languages.get("进行<!--{en}did-->")+o;var u=sensorsdata.trimConstHtml(e.by_value),i=sensorsdata.languages.get("在<!--{en}During-->")+u+sensorsdata.languages.get("进行<!--{en}did-->")+r+sensorsdata.languages.get("的<!--{en}of-->")+e.total_people+sensorsdata.languages.get("人中，<!--{en}among people,-->"),l=moment(sensorsdata.trimConstHtml(e.by_value),sensorsdata.CONSTSET.dateFormat).add(a,t.unit),d=moment(new Date(l)).format(sensorsdata.CONSTSET.dateFormat);return t.is_wastage?i+sensorsdata.languages.get("有<!--{en}has-->")+e.cells[a].people+sensorsdata.languages.get("人截至到<!--{en}people by-->")+s+"("+d+")"+sensorsdata.languages.get("都没有进行过<!--{en}did nothing-->")+o:sensorsdata.languages.get("在<!--{en}During-->")+u+sensorsdata.languages.get("进行<!--{en}did-->")+r+sensorsdata.languages.get("的<!--{en}of-->")+e.total_people+sensorsdata.languages.get("人中，有<!--{en}people, in which there are-->")+e.cells[a].people+sensorsdata.languages.get("人随后在<!--{en}people the did-->")+s+"("+d+")"+sensorsdata.languages.get("进行了<!--{en}did-->")+o},getAddiction:function(e){var a=this,n=e.queryParams,t=e.data;this.options=e,this.queryParams=n,this.config=e.config;var s=this.getDuration(this.config.type,n.unit),r=sensorsdata.getBeginDate(s.unit),o=sensorsdata.CONSTSET.timeFormat,g=function(e,a){var n=moment(e,o);return n.isValid()?r.diff(n,s.unit):a},u=0,i=this.queryParams.measure_type;if("period"===i){if(n.by_field){var l=sensorsdata.getBeginDate(s.unit,n.from_date);u=r.diff(l,s.unit)}else u=g(t.rows[0].by_value,(t.rows[0].cells||[]).length);u=u<s.value?u:s.value}u=u<=s.value?u:s.value+1;var d=t.rows.map(function(e,t){for(var r=e.cells.length;u>r;r++)e.cells.push({people:0,percent:0,bucket_start:r+2});var o={};return o.name=e.by_value,o.rowIndex=t,o.cells=e.cells.map(function(t,r){var o=Math.floor((100-Math.ceil(t.percent))/10)+1;return t.className="hm-"+o,t.tip=a.buildAddictionCellTip(e,r,n,s),t}),o.total_people=e.total_people,o}),m=t.rows[0].cells.map(function(e){return a.buildLabel(e,!0)});return{field:n.by_field?n.by_field.text:"初始行为日期",num:d.length,rows:d,series:m}},buildAddictionCellTip:function(e,a,n,t){var s=sensorsdata.findEventCname(n.event_name),r=e.cells[a],o=this.buildLabel(r);if("times"===n.measure_type){var g=n.measure&&n.measure.field?this.buildMeasureName(n):"";return n.rollup_date===!0?sensorsdata.languages.get("在选定时间段内有<!--{en}In the selected period of time, there is-->")+e.total_people+sensorsdata.languages.get("人进行过<!--{en}People did-->")+s+sensorsdata.languages.get("。其中，有<!--{en}.In which there are-->")+r.people+sensorsdata.languages.get("人进行了<!--{en}People did-->")+g+o+"。":n.by_field?sensorsdata.languages.get("在选定时间段内有<!--{en}In the selected period of time, there is-->")+e.total_people+sensorsdata.languages.get("人<!--{en}People-->")+n.by_field.text+sensorsdata.languages.get("是<!--{en}Yes-->")+sensorsdata.trimConstHtml(e.by_value)+sensorsdata.languages.get("的人进行过<!--{en}of people did-->")+s+sensorsdata.languages.get("。其中，有<!--{en}.In which there are-->")+r.people+sensorsdata.languages.get("人进行了<!--{en}People did-->")+g+o+"。":sensorsdata.languages.get("在<!--{en}During-->")+sensorsdata.trimConstHtml(e.by_value)+sensorsdata.languages.get("这<!--{en}Here-->")+t.cname+sensorsdata.languages.get("进行过<!--{en}did-->")+s+sensorsdata.languages.get("的用户有<!--{en}the users are-->")+sensorsdata.formatNumber(e.total_people)+sensorsdata.languages.get("人，其中有<!--{en}people, in which there are-->")+r.people+sensorsdata.languages.get("人进行了<!--{en}People did-->")+g+o}return n.by_field?sensorsdata.languages.get("在选定时间段内有<!--{en}In the selected period of time, there is-->")+e.total_people+sensorsdata.languages.get("位<!--{en}people-->")+n.by_field.text+sensorsdata.languages.get("是<!--{en}Yes-->")+sensorsdata.trimConstHtml(e.by_value)+sensorsdata.languages.get("的人进行了<!--{en}people did-->")+s+sensorsdata.languages.get("。其中，有<!--{en}.In which there are-->")+r.people+sensorsdata.languages.get("人平均每<!--{en}Average per person-->")+t.shortCname+sensorsdata.languages.get("进行了至少<!--{en}did at least-->")+(a+2)+" "+t.unitCname+s+"。":sensorsdata.languages.get("在<!--{en}During-->")+sensorsdata.trimConstHtml(e.by_value)+sensorsdata.languages.get("这<!--{en}Here-->")+t.cname+sensorsdata.languages.get("进行了<!--{en}did-->")+s+sensorsdata.languages.get("的<!--{en}of-->")+sensorsdata.formatNumber(e.total_people)+sensorsdata.languages.get("人中，有<!--{en}people, in which there are-->")+r.people+sensorsdata.languages.get("人在<!--{en}People in-->")+t.cname+sensorsdata.languages.get("进行了至少<!--{en}did at least-->")+(a+2)+" "+t.unitCname+s},buildLabel:function(e,a){var n=this.buildMeasureUnit(),t=this.queryParams.measure_type,s=this.queryParams.measure||{};return $.isNumeric(e.bucket_start)&&$.isNumeric(e.bucket_end)?e.bucket_end-e.bucket_start!==1||!$.isEmptyObject(s)&&"uniqCount"!==s.aggregator?e.bucket_start+n+"~"+e.bucket_end+n+sensorsdata.languages.get("(不含<!--{en}(exclude-->")+e.bucket_end+n+")":e.bucket_start+n:$.isNumeric(e.bucket_start)?"period"===t?sensorsdata.languages.get("至少<!--{en}at least-->")+e.bucket_start+n:e.bucket_start+n+sensorsdata.languages.get("以上(含<!--{en}Above(include-->")+e.bucket_start+n+")":$.isNumeric(e.bucket_end)?e.bucket_end+n+sensorsdata.languages.get("以下(不含<!--{en}the following(exclude-->")+e.bucket_end+n+")":a?sensorsdata.CONSTSET.unknownByValue:sensorsdata.CONSTSET.unknownByValueText},buildMeasureUnit:function(){var e=this.queryParams;if("period"===e.measure_type){var a=this.getDuration(this.config.type,e.unit);return a.unitCname}if($.isEmptyObject(e.measure))return sensorsdata.languages.get("次<!--{en}Times-->");var n=sensorsdata.CONSTSET.measureFunctions;if(e.measure.field&&!n[e.measure.aggregator].unit){var t=sensorsdata.findProperty(e.measure.field,this.propObj);return $.isEmptyObject(t)?"":t.unit||""}return n[e.measure.aggregator].unit},getDuration:function(e,a,n){var t=this.durations[e],s=[];if("addiction"===e){if(!a)return t[0];s=t.filter(function(e){return e.name===a})}else{if(!a||!n)return t[0];s=t.filter(function(e){return e.value.toString()===a.toString()&&e.unit===n})}return 1===s.length?s[0]:null}};n.exports=t});
;/*!components/model/reportNormalize.js*/
define("components/model/reportNormalize",function(e,t,r){function a(e,t){var r=e.bucket_params||{},a=t.by_fields||[],n=a.map(function(e){var t=e.split("."),r=t[t.length-1];return o.getProperty("name",r)||{}});return{series:t.series,rows:t.rows.map(function(e){var t=[];return e.by_values.forEach(function(e,i){var s=o.formatByValue(e,n[i].data_type,sensorsdata.CONSTSET.unknownByValueText,r[a[i]],sensorsdata.CONSTSET.emptyStringByValueText);t.push(s)}),{data:e.values,name:t.join("，"),by_values:t}})}}var o=e("components/util/util"),n=e("components/model/normalizeRetention"),i=e("components/util/fieldsToText"),s=e("components/dataCache/dataCache").create({expires:6e5}),u={};u.segmentation=function(e,t,r){t=$.extend(!0,$.isArray(t)?[]:{},t),e=$.extend(!0,{},e);var n=t,i={};$.isArray(t)&&(n=t[0],i=t[1]);var s={result:n.detail_result,rollupResult:n.rollup_result,compareResult:i.detail_result,rollupCompareResult:i.rollup_result};for(var u in s)s[u]=$.isEmptyObject(s[u])?null:a(e,s[u]);o.measuresToText(e,function(t){e.measures=t,r({queryParams:e,data:s})})},u.retention=function(e,t,r){t=$.extend(!0,$.isArray(t)?[]:{},t),e=$.extend(!0,{},e);var a={config:{type:"retention"},queryParams:e,data:t},o=n.get(a);r({queryParams:e,data:{result:o}})},u.addiction=function(e,t,r){t=$.extend(!0,$.isArray(t)?[]:{},t),e=$.extend(!0,{},e);var a={config:{type:"addiction"},queryParams:e,data:t},o={queryParams:e,data:{}};e.by_field?i({fields:[e.by_field]},function(e){a.queryParams.by_field=e[0],o.data.result=n.getAddiction(a),r(o)}):(o.data.result=n.getAddiction(a),r(o))},r.exports=function(e,t){if("object"!==$.type(e)||"string"!==$.type(e.reportType)||"object"!==$.type(e.queryParams)||"object"!==$.type(e.data)&&!$.isArray(e.data)||!$.isFunction(t))throw new Error("model/reportNormalize: 参数类型错误");if(!u[e.reportType])throw new Error("model/reportNormalize: 不支持从分析模型为 "+e.reportType+" 的数据处理");if($.isEmptyObject(e.queryParams)||"object"!==$.type(e.data)&&!$.isArray(e.data))throw new Error("model/reportNormalize: 必须传入请求分析模型 API 的查询条件和返回数据");var r=e.queryParams,a=e.data;if(e.useCache!==!1){var o=s.get(r.request_id);if(o)return void t($.extend(!0,{},o))}u[e.reportType](r,a,function(e){r.request_id&&s.set(r.request_id,e),t($.extend(!0,{},e))})}});
;/*!components/model/reportModel.js*/
define("components/model/reportModel",function(e,o){var r={checkOptions:function(e){var o=[{check:function(){return"object"===$.type(e)},msg:"options 参数必须为 Object 类型"},{check:function(){return"string"===$.type(e.type)&&e.type},msg:"options.type 参数必须为 string 类型，且不能为空"},{check:function(){return"object"===$.type(e.param)&&!$.isEmptyObject(e.param)},msg:"options.param 参数必须为 Object 类型，且不能为空"},{check:function(){return!(e.config&&e.config.loadCompare&&"segmentation"!==e.type)},msg:"options.config.loadCompare 配置只适用于 segmentation 类型的查询"}];o.forEach(function(e){if(!e.check())throw new Error("model/reportModel: "+e.msg)})}},n={query:function(e,o,r){var n=$.Deferred(),a=this.processQueryParams(e.param),t=this.processConfig(a,e.config),s=sensorsdata.api.get(e.type,{bookmarkid:e.bookmarkid,funnel_id:e.param.funnel_id}),i=null,m=null,c=function(){!i||t.loadCompare&&!m||(m&&($.isArray(i)?i[0].compareDate=m:i.compareDate=m),$.isFunction(o)&&o(i),n.resolve(i))};if(sensorsdata.reportAjax({isAsync:!0,queueEnable:!0,queueKey:"POST-"+s,url:s,method:"POST",showLoader:t.showLoader,showCommonError:t.showCommonError,data:a,success:function(e){i=e,c()},error:r}),"segmentation"===e.type&&t.loadCompare){var u=$.extend(!0,{},a),p=sensorsdata.api.get("compareReport",{bookmarkid:e.bookmarkid});u.detail_and_rollup=!0,delete u.compare_from_date,delete u.compare_to_date,sensorsdata.reportAjax({isAsync:!0,queueEnable:!1,queueKey:"POST-"+p,url:p,method:"POST",data:u,showLoader:!1,showCommonError:t.showCommonError,success:function(e){m=e,c()},error:r})}return n},processQueryParams:function(e){var o=$.extend(!0,{},e);return $.isArray(o.measures)&&o.measures.length&&o.measures.map(function(e){e.event_name===sensorsdata.CONSTSET.sessionGeneral.name&&(e.event_name=sensorsdata.CONSTSET.eventEmptyValue)}),o},processConfig:function(e,o){var r=$.extend(!0,{showCommonError:!0,showLoader:!0,loadCompare:!1},o);return r.loadCompare&&($.isArray(e.measures)&&e.measures.length>1||$.isArray(e.by_fields)&&e.by_fields.length>0)&&(r.loadCompare=!1),r}};o.query=function(e,o,a){return r.checkOptions(e),n.query(e,o,a)}});
;/*!components/config/dashboard.widget.js*/
define("components/config/dashboard.widget",function(e,r,t){function s(e){var r=e.queryParams,t="",s=r.measures||[],a=!("segmentation"!==e.type||1!==s.length||r.compare_from_date&&r.compare_from_date||"SUM"!==s[0].aggregator&&"general"!==s[0].aggregator);return console.log(a),a?(a=!("mini"===e.size||"small"===e.size),a?{support:!0}:(t="当前配置不支持"+i[e.size],{support:a,type:"size",reason:t})):(t="当前配置不支持累积图",{support:a,reason:t,type:"chart"})}function a(e){var r=e.size,t="",s=e.queryParams;return"small"===r&&((s.by_fields||[]).length>0||s.measures.length>1)?(t="当前配置不支持柱图",{support:!1,reason:t,type:"chart"}):"mini"===r?(t="当前配置不支持"+i[r],{support:!1,reason:t,type:"size"}):{support:!0}}function n(e){var r=!0,t=e.size;return r=!("mini"===t||"small"===t),r?{support:!0}:{support:!1,reason:"当前配置不支持"+i[t],type:"size"}}function o(e){var r=e.queryParams,t=r.by_fields||[],s=r.measures||[],a=0===t.length&&1===s.length;return a?{support:!0}:{reason:"当前配置不支持数值",type:"chart",support:!1}}function p(e){var r=!0,t=e.queryParams,s=e.size,a=t.by_fields||[],n=t.measures||[];return"mini"===s?{support:!1,reason:"当前配置不支持小尺寸",type:"chart"}:("small"===s&&(r=1===n.length&&0===a.length),r?{support:!0}:{support:!1,reason:"当前配置不支持线图",type:"chart"})}function u(e){var r=e.size,t=e.queryParams;return"mini"===r||"normal"===r&&t.compare_from_date&&t.compare_to_date?{support:!1,reason:"当前配置不支持"+i[r],type:"size"}:t.by_fields&&t.by_fields.length&&1===t.measures.length?{support:!0}:{support:!1,reason:"当前配置不支持环图",type:"chart"}}var i={mini:"小尺寸",small:"小尺寸",normal:"中尺寸",large:"大尺寸"};t.exports=function(e){switch(e.chartsType){case"stack":return s(e);case"line":return p(e);case"column":return a(e);case"pie":return u(e);case"table":return n(e);case"number":return o(e);case"funnel":return{support:!0};default:return{support:!1}}}});
;/*!components/dashboardConfigType/dashboardConfigType.js*/
define("components/dashboardConfigType/dashboardConfigType",function(e,t){var n={content:Handlebars.template({1:function(e,t,n,a){var i,l,c,o=t.helperMissing,s="function",r=this.escapeExpression,u='<div class="type-block ';return l=null!=(l=t.selected||(null!=e?e.selected:e))?l:o,c={name:"selected",hash:{},fn:this.program(2,a,0),inverse:this.noop,data:a},i=typeof l===s?l.call(e,c):l,t.selected||(i=t.blockHelperMissing.call(e,i,c)),null!=i&&(u+=i),u+'" data-type="'+r((l=null!=(l=t.value||(null!=e?e.value:e))?l:o,typeof l===s?l.call(e,{name:"value",hash:{},data:a}):l))+'">\n  <div class="'+r((l=null!=(l=t.icon||(null!=e?e.icon:e))?l:o,typeof l===s?l.call(e,{name:"icon",hash:{},data:a}):l))+'"></div>\n  <p>'+r((l=null!=(l=t.text||(null!=e?e.text:e))?l:o,typeof l===s?l.call(e,{name:"text",hash:{},data:a}):l))+"</p>\n</div>\n"},2:function(){return"selected"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,a){var i;return null!=(i=t.each.call(e,e,{name:"each",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?i:""},useData:!0})},a={segmentation:[{value:"line",text:"线图",icon:"icon-line-chart"},{value:"column",text:"柱图",icon:"icon-bar-chart"},{value:"pie",text:"环图",icon:"icon-pie-chart"},{value:"stack",text:"累积",icon:"icon-stack-chart"},{value:"table",text:"表格",icon:"icon-table"},{value:"number",text:"数值",icon:"icon-num"}],funnel:[{value:"funnel",text:sensorsdata.languages.get("漏斗图<!--{en}-->")}],retention:[{value:"line",text:"线图",icon:"icon-line-chart"}],addiction:[{value:"table",text:"表格",icon:"icon-table"}],user_analytics:[{value:"line",text:"线图",icon:"icon-line-chart"},{value:"pie",text:"环图",icon:"icon-pie-chart"},{value:"table",text:"表格",icon:"icon-table"},{value:"number",text:"数值",icon:"icon-num"}]},i=function(e){if(!e.type)throw new Error("无效的模块类型");this.container=e.container;var t=$.extend(!0,{},e);t.typeList=$.extend(!0,[],a[e.type]),t.chartsType=e.chartsType||t.typeList[0].value,this.options=t,this.init(t)};i.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(e){e.typeList=e.typeList.map(function(t){return t.value===e.chartsType&&(t.selected=!0),t}),e.container.html(n.content(e.typeList)),this.bindEvents()},bindEvents:function(){var e=this;this.container.find(".type-block").unbind("click").bind("click",function(){var t=$(this);t.hasClass("selected")||(t.addClass("selected").siblings().removeClass("selected"),$.isFunction(e.options.callback)&&e.options.callback({selected:t.attr("data-type")}))})},getType:function(){return this.container.find(".type-block.selected").attr("data-type")}}),t.create=function(e){return new i(e)}});
;/*!components/dashboardConfigSize/dashboardConfigSize.js*/
define("components/dashboardConfigSize/dashboardConfigSize",function(e,n){var t=e("lodash"),a={content:Handlebars.template({1:function(e,n,t,a){var l,s,i,o=n.helperMissing,c="function",r=this.escapeExpression,d='<div class="size-block ';return s=null!=(s=n.selected||(null!=e?e.selected:e))?s:o,i={name:"selected",hash:{},fn:this.program(2,a,0),inverse:this.noop,data:a},l=typeof s===c?s.call(e,i):s,n.selected||(l=n.blockHelperMissing.call(e,l,i)),null!=l&&(d+=l),d+'" data-size="'+r((s=null!=(s=n.value||(null!=e?e.value:e))?s:o,typeof s===c?s.call(e,{name:"value",hash:{},data:a}):s))+'">\n  <div data-size="'+r((s=null!=(s=n.value||(null!=e?e.value:e))?s:o,typeof s===c?s.call(e,{name:"value",hash:{},data:a}):s))+'"></div>\n  <p>'+r((s=null!=(s=n.text||(null!=e?e.text:e))?s:o,typeof s===c?s.call(e,{name:"text",hash:{},data:a}):s))+"</p>\n</div>\n"},2:function(){return"selected"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,t,a){var l;return null!=(l=n.each.call(e,e,{name:"each",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?l:""},useData:!0})},l=[{value:"mini",text:sensorsdata.languages.get("小<!--{en}Small-->")},{value:"normal",text:sensorsdata.languages.get("中<!--{en}Medium-->")},{value:"large",text:sensorsdata.languages.get("大<!--{en}Large-->")}],s=function(e){if(!e.container)throw new Error("无效的容器");this.container=e.container,this.options=e,this.init(e)};s.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(e){var n=e.size||"normal",s=t.cloneDeep(l).map(function(e){return e.value===n&&(e.selected=!0),e});e.container.html(a.content(s)),this.bindEvent()},bindEvent:function(){var e=this;this.container.find(".size-block").unbind("click").bind("click",function(){var n=$(this);n.hasClass("selected")||(n.addClass("selected").siblings().removeClass("selected"),$.isFunction(e.options.callback)&&e.options.callback({selected:n.attr("data-size")}))})},getSize:function(){return this.container.find(".size-block.selected").attr("data-size")}}),n.create=function(e){return new s(e)}});
;/*!components/dashboardConfigPanel/dashboardConfigPanel.js*/
define("components/dashboardConfigPanel/dashboardConfigPanel",function(n,a,e){var o={template:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,e,o){var t;return'<div class="modal fade modal-dashboardconfig" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">设置</h4>\n      </div>\n      <div class="error-info info-container" style="display: none;">\n        <span class="icon-info"></span><span class="error-text">'+this.escapeExpression((t=null!=(t=a.reason||(null!=n?n.reason:n))?t:a.helperMissing,"function"==typeof t?t.call(n,{name:"reason",hash:{},data:o}):t))+'</span>\n      </div>\n      <div class="modal-body">\n\n        <div id="form-container" class="col-md-6">\n\n        </div>\n        <div id="preview-container" class="col-md-6">\n          <div class="" data-method="chart-type">\n            <label class="">图表类型<!--{en}Chart type--></label>\n            <div data-container="type"></div>\n          </div>\n          <div class="" data-method="chart-size">\n            <label class="">窗口尺寸<!--{en}Window size--></label>\n            <div data-container="size"></div>\n          </div>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="pop-is-cancel btn btn-link btn-small" data-dismiss="modal">取消<!--{en}Cancel--></button>\n        <button type="button" class="pop-is-success btn btn-primary btn-small">确定<!--{en}Confirm--></button>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0}),info:Handlebars.template({1:function(){return'  <span class="icon-info"></span>\n'},3:function(){return'  <span class="icon-warning"></span>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,e,o){var t,i;return(null!=(t=a["if"].call(n,null!=n?n.error:n,{name:"if",hash:{},fn:this.program(1,o,0),inverse:this.program(3,o,0),data:o}))?t:"")+'<span class="error-text">\n  '+this.escapeExpression((i=null!=(i=a.text||(null!=n?n.text:n))?i:a.helperMissing,"function"==typeof i?i.call(n,{name:"text",hash:{},data:o}):i))+"\n</span>"},useData:!0})},t=n("components/dashboardConfigForm/dashboardConfigForm"),i=n("components/model/reportNormalize"),s=n("components/model/reportModel"),r=n("components/config/dashboard.widget"),d=n("components/dashboardConfigType/dashboardConfigType"),l=n("components/dashboardConfigSize/dashboardConfigSize"),c=n("components/util/util"),p=null,m={},f={},b={},u=$.extend(!0,{},sensorsdata.EventsModule,{show:function(n,a){var e=this;if($.isEmptyObject(n.widget))throw new Error("无效的概览配置");if($.isEmptyObject(n.widget.bookmark))throw new Error("无效的书签数据");var r=JSON.parse(n.widget.bookmark.data),u=$(o.template());if(r.detail_and_rollup=!0,m=$.extend(!0,{},{config:{size:"normal"}},n.widget),"string"==typeof m.config)try{m.config=JSON.parse(m.config)||{}}catch(g){m.config={}}m.bookmark=$.extend(!0,m.bookmark,n.widget.bookmark),m.bookmark.config=c.json.parse(m.bookmark.config),n.type=n.type?n.type:m.bookmark.type.replace(/\//g,""),s.query({type:n.type,param:r},function(o){var s=u.find("#form-container");i({reportType:n.type,queryParams:r,useCache:!0,data:o},function(a){p=t.create({container:s,dashboard:n.widget,chartsData:a}),p.on("update",function(){e.checkStatus(n,u)}),f=d.create({container:u.find('[data-container="type"]'),type:n.type,chartsType:m.bookmark.config.chartsType,callback:function(){e.checkStatus(n,u)}}),b=l.create({container:u.find('[data-container="size"]'),size:m.config.size,callback:function(){e.checkStatus(n,u)}})}),u.attr("data-id",m.id),u.modal(),u.find("button.pop-is-success").unbind("click.confirm").bind("click.confirm",function(){if(!$(this).hasClass("disabled")&&e.configConfirm()){var n=p.getVal().bookmark,o=f.getType(),t=b.getSize(),i={id:u.attr("data-id"),bookmark:$.extend(!0,{},n,{config:{chartsType:o}}),config:{size:t}};$.isFunction(a)&&a(i),u.modal("hide")}}),u.on("hide.bs.modal",function(){p.destroy(),u.off("hide.bs.modal")});var c=n.widget.bookmark.dashboards;e.checkStatus(n,u,c)})},checkStatus:function(n,a,e){var t={bookmark:$.extend(!0,{},p.getVal().bookmark,{config:{chartsType:f.getType()}}),config:{size:b.getSize()}};a.find("button.pop-is-success").removeClass("disabled");var i=JSON.parse(t.bookmark.data),s=t.bookmark.config.chartsType||i.chartsType||"line";p.setChartsType(s);var d=r({type:n.type,chartsType:s,widgetUnit:t.bookmark.config.unit||i.unit,queryParams:i,size:t.config.size});d.support?(a.find("button.pop-is-success").removeClass("disabled"),"line"===s&&t.bookmark.config.measureIndexs.length>3?(a.find(".error-info").removeClass("info").toggle(!0).html(o.info({error:!0,text:sensorsdata.languages.get("线图暂时不支持超过 3 个指标<!--{en}The line graph does not support more than 3 metrics for the time being-->")})),a.find("button.pop-is-success").addClass("disabled")):(a.find(".error-info").toggle(!1),e=e||t.bookmark.dashboards,$.isArray(e)&&a.find(".error-info").addClass("info").toggle(e.length>0).html(o.info({error:!1,text:sensorsdata.util.format(sensorsdata.languages.get("该更新将同步书签和 #{length} 处概览(不包括窗口尺寸)<!--{en}This update will synchronize bookmarks and #{length} overview (excluding window size).-->"),{length:e.length})})))):(a.find("button.pop-is-success").addClass("disabled"),a.find(".error-info").removeClass("info").toggle(!0).html(o.info({error:!0,text:d.reason})))},configConfirm:function(){var n=p.getVal(),a=n.bookmark.config.measureIndexs||[];return a.length&&n.bookmark.name?!0:!1}});e.exports=u});
;/*!components/bookmarkToolbar/bookmarkToolbar.js*/
define("components/bookmarkToolbar/bookmarkToolbar",function(a,t){var o=a("components/util/util"),n={template:Handlebars.template({1:function(){return"active"},3:function(){return"disabled"},5:function(){return"hide"},7:function(){return'style="display: none;"'},9:function(a,t,o,n){var s;return'    <a data-method="dashboard-add" '+(null!=(s=t.unless.call(a,null!=a?a.id:a,{name:"unless",hash:{},fn:this.program(7,n,0),inverse:this.noop,data:n}))?s:"")+' class="'+(null!=(s=t["if"].call(a,null!=a?a.isShareDash:a,{name:"if",hash:{},fn:this.program(5,n,0),inverse:this.noop,data:n}))?s:"")+'">\n      <span class="icon-add-fill"></span>\n      <span>添加到<!--{en}Add to--></span>\n    </a>\n'},11:function(){return"switch-on"},13:function(){return"switch-off"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,t,o,n){var s,e,i=t.helperMissing,r="function",d=this.escapeExpression;return'<div class="bookmark-tool-bar" data-id="'+d((e=null!=(e=t.id||(null!=a?a.id:a))?e:i,typeof e===r?e.call(a,{name:"id",hash:{},data:n}):e))+'">\n  <div class="from-dashboard-back" style="display:none">\n    <a data-method="from-dash-back">\n      <span class="icon-arrow-left"></span>\n      返回<!--{en}Back-->\n    </a>\n  </div>\n  <div class="analyse-top">\n  <div class="bookmark-title-container">\n    <span class="bookmark-title" contenteditable="false">'+d((e=null!=(e=t.name||(null!=a?a.name:a))?e:i,typeof e===r?e.call(a,{name:"name",hash:{},data:n}):e))+'</span>\n    <span class="icon-help" style="display: none;"></span>\n  </div>\n  <span class="sa-h-split" style="display:none"></span>\n  <div class="report-method-container pull-right">\n    <span class="sa-h-split" style="display: none;"></span>\n    <button style="display: none;" data-toggle="tooltip" title="点击按钮，刷新失效数据，按住 shift 点击，刷新全部数据" data-lang-title="<!--{en}Click the button, refresh the invalid data, press shift to click, refresh all the data.-->" data-method="refresh" type="button" class="btn-refresh btn-link btn-icon" data-placement="bottom" data-container="body"><span class="icon-refresh"></span>\n    </button>\n    <button data-toggle="tooltip" data-original-title="'+d((e=null!=(e=t.downloadTip||(null!=a?a.downloadTip:a))?e:i,typeof e===r?e.call(a,{name:"downloadTip",hash:{},data:n}):e))+'" data-placement="bottom" style="display: none;" data-method="download" type="button" class="btn-link btn-icon">\n      <span class="icon-download"></span>\n    </button>\n    <div class="more-method">\n      <a data-method="more-method"><span class="icon-more '+(null!=(s=t["if"].call(a,null!=a?a.moreMethodActive:a,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?s:"")+'"></span></a>\n    </div>\n  </div>\n  <div class="from-dashboard-save" style="display: none;">\n    <a data-method="from-dash-save">\n      <span class="icon-save"></span>\n      <span>保存<!--{en}Save--></span>\n    </a>\n  </div>\n  <div class="bookmark-content" style="display: none;">\n    <a data-method="bookmark-save" class="'+(null!=(s=t["if"].call(a,null!=a?a.id:a,{name:"if",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?s:"")+" "+(null!=(s=t["if"].call(a,null!=a?a.isShareDash:a,{name:"if",hash:{},fn:this.program(5,n,0),inverse:this.noop,data:n}))?s:"")+'">\n      <span class="icon-save"></span>\n      <span>保存<!--{en}Save--></span>\n    </a>\n    <a data-method="bookmark-save-as" '+(null!=(s=t.unless.call(a,null!=a?a.id:a,{name:"unless",hash:{},fn:this.program(7,n,0),inverse:this.noop,data:n}))?s:"")+'>\n      <span class="icon-save-as"></span>\n      <span>另存为<!--{en}Save As--></span>\n    </a>\n'+(null!=(s=t["if"].call(a,null!=a?a.addDashboard:a,{name:"if",hash:{},fn:this.program(9,n,0),inverse:this.noop,data:n}))?s:"")+'  </div>\n  <div class="more-method-list" style="display: none;">\n    <span class="arrow"></span>\n    <div class="content">\n      <div class="sampling">\n        <div>\n          <span class="sampling-factor-label" data-toggle="tooltip" data-original-title="" data-placement="bottom">全量<!--{en}Total--></span>\n          <input id="sampling-factor-slider" type="text" value="" style="display:none;width:100px;" data-slider-min="0" data-slider-max="6" data-slider-step="1" data-slider-value="" data-slider-orientation="0" data-slider-selection="after">\n        </div>\n      </div>\n      <div class="approximate-btn">\n        <span class="selected">近似计算<!--{en}Accurate--></span>\n        <span class="icon-help" data-placement="bottom" data-toggle="tooltip" title="近似计算开启后，将近似计算触发用户数、人均次数、属性人均值和属性去重数，极大缩短查询时间" data-lang-title="<!--{en}Approximate calculation of the three metrics which are number of trigger users, per capita frequency and property per capita value-->"></span>\n        <span class="'+(null!=(s=t["if"].call(a,null!=a?a.approx:a,{name:"if",hash:{},fn:this.program(11,n,0),inverse:this.program(13,n,0),data:n}))?s:"")+" switch-btn "+(null!=(s=t["if"].call(a,null!=a?a.allowApprox:a,{name:"if",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?s:"")+'"></span>\n      </div>\n    </div>\n  </div>\n  </div>\n</div>\n'},useData:!0}),title:Handlebars.template({1:function(a,t,o,n){var s;return'<span class="icon-edit '+(null!=(s=t["if"].call(a,null!=a?a.isShareDash:a,{name:"if",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n}))?s:"")+'"></span>\n'},2:function(){return"hide"},4:function(){return'<span class="icon-help"></span>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,t,o,n){var s,e,i=t.helperMissing,r="function",d=this.escapeExpression;return'<span class="bookmark-title" contenteditable="false" data-originname="'+d((e=null!=(e=t.name||(null!=a?a.name:a))?e:i,typeof e===r?e.call(a,{name:"name",hash:{},data:n}):e))+'">'+d((e=null!=(e=t.name||(null!=a?a.name:a))?e:i,typeof e===r?e.call(a,{name:"name",hash:{},data:n}):e))+"</span>\n"+(null!=(s=t["if"].call(a,null!=a?a.id:a,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.program(4,n,0),data:n}))?s:"")},useData:!0})},s=a("components/router/router"),e=a("components/model/bookmarks"),i=a("components/downloadDialog/downloadDialog"),r=a("components/bookmarkSetDialog/bookmarkSetDialog"),d=a("components/dashboardAddDialog/dashboardAddDialog"),l=a("components/model/dashboardWidget"),c=a("components/dashboardConfigPanel/dashboardConfigPanel"),m={bookmarkid:!0},p=function(a){if(!a.container)throw new Error("无效的书签工具栏容器");if(!a.type)throw new Error("无效的模块名");var t={dashboardDisplay:!0,showSaveAndAdd:!1,fromDashboard:!1,widgetConfigDisplay:!1,iconHelpDisplay:!1,sessionDropdownDisplay:!1,downloadDisplay:!0,refreshDisplay:!0,bookmarkDisplay:!0,samplingDisplay:!1,algDropdownDisplay:!1};this.options=$.extend(!0,t,a),a.showSaveAndAdd&&(this.options.bookmarkDisplay=!1),this.$container=this.options.container,this.bookmark={id:this.options.bookmarkid||"",name:sensorsdata.CONSTSET.urlMap[this.options.type]||"",dashboards:[]},this.paramsObj=this.options.params||{},this.configParams={},this.init()};p.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){var a=this.options.container,t=this,o=t.options.dashboardDisplay,s=this.paramsObj,i=s.sampling_factor,r=s.approx,d=i&&64!==i||r,l=t.options.downloadTip||sensorsdata.languages.get("下载表格中数据 csv<!--{en}Download CSV-->");this.bookmark.id?e.get(this.bookmark.id,function(s){t.setConfig(s.config),t.bookmark=s;var e={addDashboard:o,isShareDash:s.is_lego||sensorsdata.authority.userId!==s.user_id,id:s.id,name:s.name||sensorsdata.CONSTSET.urlMap[t.options.type],downloadTip:l,disableApprox:sensorsdata.authority.isNormal,approx:r,moreMethodActive:d};a.html(n.template(e)),a.find(".bookmark-title-container").html(n.title(e)),t.compareParams(t.paramsObj,JSON.parse(s.data))||t.$container.find('a[data-method="bookmark-save"]').toggleClass("disabled",!1),t.bindEvents(),t.initMethodBar()}):(a.html(n.template({addDashboard:o,name:sensorsdata.CONSTSET.urlMap[this.options.type],downloadTip:l,disableApprox:sensorsdata.authority.isNormal,approx:r,moreMethodActive:d})),this.bindEvents(),t.initMethodBar())},initMethodBar:function(){var a=this.$container,t=this.options;t.sessionDropdownDisplay&&this.initSessionDropDown(t),a.find(".from-dashboard-back").toggle(t.fromDashboard),a.find(".from-dashboard-save").toggle(t.showSaveAndAdd),a.find(".bookmark-title-container .icon-help").toggle(t.iconHelpDisplay),a.find(".bookmark-content").toggle(t.bookmarkDisplay),a.find(".sampling").toggle(t.samplingDisplay),a.find(".more-method").toggle(t.samplingDisplay||t.algDropdownDisplay),t.samplingDisplay&&this.initSampleSlider(),a.find(".approximate-btn").toggle(t.algDropdownDisplay),a.find('[data-method="refresh"]').toggle(t.refreshDisplay).prev().toggle((t.bookmarkDisplay||t.showSaveAndAdd)&&(t.refreshDisplay||t.downloadDisplay||t.samplingDisplay||t.algDropdownDisplay)),a.find('[data-method="download"]').toggle(t.downloadDisplay),a.bind("click",sensorsdata.bind(this.methodBarClick,this)),a.find('[data-toggle="tooltip"]').tooltip()},checkMethodStatus:function(){var a=this.paramsObj,t=a.sampling_factor,o=a.approx;t&&64!==t||o?this.$container.find('[data-method="more-method"] .icon-more').addClass("active"):this.$container.find('[data-method="more-method"] .icon-more').removeClass("active")},setStatus:function(a){var t=this.$container,o=a.bookmark;t.find('a[data-method="bookmark-save"]').toggleClass("disabled",!0),t.find('a[data-method="bookmark-save"]').siblings().toggle(!!o.id)},setConfig:function(a){this.configParams="string"==typeof a?o.json.parse(a):$.extend(this.configParams,a)},compareParams:function(a,t){if(!a||!t)return!1;for(var n in t)if(!m[n]){if("measures"===n||"by_fields"===n||"filter"===n){if(o.json.stringify(a[n])===o.json.stringify(t[n]))continue;return!1}if(("from_date"!==n&&"to_date"!==n||!t.rangeText||!a.rangeText||t.rangeText!==a.rangeText)&&a[n]!==t[n])return!1}for(var s in a)if(!m[s]){if("measures"===s||"by_fields"===s||"filter"===s){if(o.json.stringify(a[s])===o.json.stringify(t[s]))continue;return!1}if(("from_date"!==s&&"to_date"!==s||!t.rangeText||!a.rangeText||t.rangeText!==a.rangeText)&&a[s]!==t[s])return!1}return!0},setParams:function(a,t){var n=!1;a.data&&(this.compareParams(a.data,this.paramsObj)||(this.paramsObj=$.extend(!0,{},a.data),a.data.chartsType&&this.setConfig({chartsType:a.data.chartsType}),a.data.by_fields&&a.data.by_fields.length||(a.byFields=[]),n=!0)),o.json.stringify(a.measureIndexs)!==o.json.stringify(this.configParams.measureIndexs)&&(this.setConfig({measureIndexs:a.measureIndexs}),n=!0),o.json.stringify(a.byFields)!==o.json.stringify(this.configParams.byFields)&&(this.setConfig({byFields:a.byFields}),n=!0),n&&"init"!==t&&this.$container.find('a[data-method="bookmark-save"]').toggleClass("disabled",!1)},bindEvents:function(){var a=this.options.container,t=this,n=this.options.type;a.find(".refresh_btn .icon-refresh").tooltip(),a.delegate("a[data-method]","click",function(){var a=$(this).attr("data-method"),s=$(this);if(!$(this).hasClass("disabled"))switch(a){case"bookmark-save":var i=$.extend(!0,{},t.bookmark);if(i.data=JSON.stringify(t.paramsObj),i.config=$.extend({},o.json.parse(i.config),o.json.parse(t.configParams)),!$.isEmptyObject(i.dashboards)&&t.options.widgetConfigDisplay){var r={widget:{bookmark:i,config:t.configParams}};c.show(r,function(a){e.set(a.bookmark,function(){sensorsdata.success.show({content:"已更新书签<!--{todo}-->",duration:2e3}),t.bookmark=a.bookmark,t.trigger("update",{action:"updated",bookmark:t.bookmark})}),t.options.fromDashboard&&t.options.dashid&&l.add(t.options.dashid,a,function(){})})}else t.save(s,n);break;case"bookmark-save-as":t.saveAs(s,n);break;case"dashboard-add":t.add(s);break;case"from-dash-back":t.backToDash();break;case"from-dash-save":t.saveAndAdd(s,n);break;case"more-method":t.showMoreMethod(s)}}),this.on("update",function(a){t.setStatus(a),t.setName(a.bookmark)}),a.delegate(".icon-edit","click",function(){var a=$(this);a.hide();var t=a.prev(".bookmark-title");if(t.attr("contenteditable",!0),t.length&&(t[0].focus(),t.scrollLeft(9999),window.getSelection)){var o=window.getSelection();o.selectAllChildren(t[0]),o.collapseToEnd()}}),a.delegate(".bookmark-title","keydown",function(t){var o=$(this),n=Number(t.keyCode);return 13===n?(o.blur(),!1):27===n?(o.text(o.attr("data-originname")),a.find(".icon-edit").show(),o.attr("contenteditable",!1),!1):void 0}),a.delegate(".bookmark-title","blur",function(){var o=$(this),n=o.text().trim();if(a.find(".icon-edit").show(),o.attr("contenteditable",!1),!n)return o.text(o.attr("data-originname")),sensorsdata.info.show({content:sensorsdata.languages.get("请输入书签名称<!--{en}Please input the bookmark name-->"),duration:2e3});if(n!==t.bookmark.name){o.attr("data-originname",n);var s={id:t.bookmark.id,name:n};e.set(s,function(){sensorsdata.success.show({content:"更改成功<!--{todo}-->",duration:2e3}),t.bookmark.name=n,$.isFunction(t.options.onBookmarkNameChanged)&&t.options.onBookmarkNameChanged()})}}),a.delegate(".approximate-btn .switch-btn","click",function(){var a=$(this),o=a.hasClass("switch-on");if(!a.hasClass("disabled")){o?a.removeClass("switch-on").addClass("switch-off"):a.removeClass("switch-off").addClass("switch-on");var n=$(this).hasClass("switch-on")?!0:!1;t.paramsObj.approx=n,t.checkMethodStatus(),t.options.onAlgChanged(n)}})},saveAs:function(a,t){var n=this;e.getList(function(s){var i=JSON.parse(n.bookmark.config||"{}").comment||"",d=n.buildBookmarkName({name:n.bookmark.name},s);r.show({ele:a,comment:i,title:d,mode:"save-as",success:function(a){var s='<a data-method="dashboard-add"><span class="icon-add-fill"></span><span style="margin-left: 4px;">添加到<!--{en}Add to --></span></a>';n.options.container.find("a[data-method=dashboard-add]").replaceWith(s);var i=$.extend(!0,o.json.parse(n.configParams),{comment:a.comment}),r={config:JSON.stringify(i),name:a.title,data:JSON.stringify(n.paramsObj),type:t};e.set(r,function(a){a=$.extend(!0,r,a),sensorsdata.success.show({content:"已存为书签<!--{todo}-->",duration:2e3});var t=sensorsdata.unparam(window.location.hash),o=a.id+"",s=sensorsdata.CONSTSET.bookmarkId,e="";t[s]=o,e="#"+$.param(t),window.history.pushState(e,"",e),n.setParams({data:t},"init"),n.setName(a),n.bookmark=a,$.isFunction(n.options.onBookmarkNameChanged)&&n.options.onBookmarkNameChanged(),$.isFunction(n.options.onBookmarkAdded)&&n.options.onBookmarkAdded(a),n.trigger("update",{action:"saveas",bookmark:n.bookmark}),n.$container.find(".hide").removeClass("hide"),setTimeout(function(){n.$container.find('a[data-method="dashboard-add"]').trigger("click")},100);var i={success:!0,from_analytics:sensorsdata.CONSTSET.urlMap[a.type]};sensorsdata.track("create_bookmark",i)})}})})},showSave:function(a,t){var n=this,s=a.ele,i=a.name,d=a.mode||"save",l=a.type;i||(i=n.bookmark.name);var c=JSON.parse(n.bookmark.config||"{}").comment||"";r.show({ele:s,bookmarkid:n.bookmark.id,title:i,comment:c,mode:d,success:function(s){var i=$.extend(!0,o.json.parse(n.configParams),{comment:s.comment}),r={config:JSON.stringify(i),name:s.title,data:JSON.stringify(n.paramsObj),type:l};s.bookmarkid&&(r.id=s.bookmarkid),a.dashboards&&(r.dashboards=a.dashboards),e.set(r,function(a){var o="",e=$.extend(!0,r,a);n.bookmark=$.extend(!0,{name:r.name},e),"function"==typeof t&&t(),$.isFunction(n.options.onBookmarkNameChanged)&&n.options.onBookmarkNameChanged(),s.bookmarkid?(o="updated",sensorsdata.success.show({content:"已更新书签<!--{todo}-->",duration:2e3})):(o="added",sensorsdata.success.show({content:"已存为书签<!--{todo}-->",duration:2e3}),t||setTimeout(function(){n.$container.find('a[data-method="dashboard-add"]').trigger("click")},100)),n.trigger("update",{action:o,bookmark:n.bookmark});var i={success:!0,from_analytics:sensorsdata.CONSTSET.urlMap[e.type]};sensorsdata.track("create_bookmark",i)})}})},save:function(a,t){var o=this,n=o.dialogName;o.bookmark.id?o.showSave({ele:a,type:t}):e.getList(function(s){var e=o.buildBookmarkName({name:n},s);o.showSave({ele:a,name:e,type:t})})},add:function(a){var t=this;d.show({ele:a,bookmarkid:t.bookmark.id,dashboardIds:t.bookmark.dashboards||[],success:function(a){var o={id:a.bookmarkid,dashboards:a.ids};if($.isEmptyObject(a.ids))return void e.set(o,function(){});if(t.options.widgetConfigDisplay){var n={widget:{bookmark:t.bookmark,config:{}}};c.show(n,function(o){o.bookmark.dashboards=a.ids;var n=[];a.ids.map(function(a){(t.bookmark.dashboards||[]).indexOf(a)<0&&n.push(a)}),e.set(o.bookmark,function(){$.isEmptyObject(n)&&sensorsdata.success.show({content:"更新成功<!--{todo}-->",duration:2e3}),t.bookmark.dashboards=a.ids,t.bookmark=o.bookmark,t.trigger("update",{action:"updated",bookmark:t.bookmark})}),$.isEmptyObject(n)||l.add(n,o,function(){sensorsdata.success.show({content:"成功添加到概览<!--{todo}-->",duration:2e3})})})}else e.set(o,function(){sensorsdata.success.show({content:"成功添加到概览<!--{todo}-->",duration:2e3})})}})},backToDash:function(){var a=this.options.dashid;s.nav("/dashboard/#dashid="+a)},saveAndAdd:function(a,t){var n=this,s=parseInt(this.options.dashid,10);e.getList(function(e){var i=n.buildBookmarkName({name:n.dialogName},e),r={config:"",name:i,data:JSON.stringify(n.paramsObj),type:t};s&&(r.dashboards=[s]);var d=$.extend(!0,r,{});if(n.bookmark=$.extend(!0,{name:r.name},d),n.options.widgetConfigDisplay){var m={widget:{bookmark:n.bookmark,config:{}}};n.configParams&&(n.bookmark.config=o.json.stringify(n.configParams)),c.show(m,function(a){l.add([s],a,function(){sensorsdata.success.show({content:"成功添加到概览<!--{todo}-->",duration:2e3}),n.backToDash()})})}else{var p={ele:a,name:i,mode:"save-add",type:t,dashboards:[s]};n.showSave(p,function(){n.backToDash()})}})},showMoreMethod:function(a){var t=this,o=this.$container.find(".more-method-list");return t.moreMethodListPopupShown?(o.hide(),void(t.moreMethodListPopupShown=!1)):void sensorsdata.showFloatLayer({floatEle:o,clickEleBtn:a,onLoad:function(){o.show(),t.moreMethodListPopupShown=!0},onClose:function(){o.hide(),t.moreMethodListPopupShown=!1}})},buildBookmarkName:function(a,t){var o=a.name,n=/^(\S+)\((\d+)\)$/,s=n.exec(o),e=0;$.isArray(s)&&3===s.length&&(o=s[1],e=parseInt(s[2],10)-1);for(var i in t)if(t.hasOwnProperty(i))for(var r=0,d=t[i].length;d>r;r++){var l=t[i][r];if(a.id&&a.id===l.id&&a.name===l.name)break;var c=t[i][r].name,m=t[i][r].id.toString();s=n.exec(c),$.isArray(s)&&3===s.length?(c=s[1],o===c&&(a.id||"").toString()!==m&&(e=parseInt(s[2],10)>e?parseInt(s[2],10):e)):0===e&&o===c&&(e=1)}return 0!==e?o=o+"("+(parseInt(e,10)+1)+")":a.name},setDialogName:function(a){this.dialogName=a},setName:function(a){var t=a&&a.name?a.name:sensorsdata.CONSTSET.urlMap[this.options.type],o=this.options.container;o.find(".bookmark-title-container").html(n.title({name:t,id:a&&a.id?a.id:""}))},initSessionDropDown:function(a){var t=this,o=this.$container;o.find(".session-dropdown").toggleClass("disabled",sensorsdata.authority.isNormal).show().prev().show(),o.find(".session-dropdown button").toggleClass("disabled",sensorsdata.authority.isNormal),sensorsdata.ajax({useCache:!0,url:"sessions/all",success:function(n){$.isArray(n)||(n=[]),o.find(".session-dropdown button").saDropdown({value:a.sessionDropdownValue,onSelect:function(){return 0===n.length&&sensorsdata.info.show({content:sensorsdata.languages.get('请先在“元数据”中创建 Session<!--{en}Please create Session in "metadata"-->'),duration:2e3}),n.length>0},onSelected:function(o){a.onSessionChanged(o),$.isFunction(t.options.onBookmarkNameChanged)&&t.options.onBookmarkNameChanged()}})}})},setRefresh:function(a){function t(){var a=sensorsdata.languages.get("数据更新时间：<!--{en}Data update time: -->")+i.format("M-D H:mm:ss")+"。";return r&&(a+=sensorsdata.languages.get("由于数据变化较小，系统没有更新数据。<!--{en}Because the data change is little, the system does not update the data.-->")),a+="点击按钮，刷新失效数据，按住 shift 点击，刷新全部数据"}function o(){n.parents("body").length<=0?sensorsdata.languages.off("change",o):n.attr("data-original-title",t())}var n=this.$container.find(".btn-refresh");if(a.data_update_time&&a.report_update_time){var s=sensorsdata.CONSTSET.timeFormat,e=moment(a.data_update_time,s),i=moment(a.report_update_time,s);if(moment.isMoment(e)&&moment.isMoment(i)){var r=e.isAfter(i);sensorsdata.languages.on("change",o),n.toggleClass("changed",r).attr("data-original-title",t())}}},methodBarClick:function(a){var t=this,o=$(a.target||a.srcElement);o.attr("data-method")||(o=o.parents("[data-method]:first"));var n=o.attr("data-method");switch(n){case"refresh":!o.hasClass("refreshing")&&$.isFunction(this.options.onRefreshClick)&&(o.addClass("refreshing"),a.shiftKey?(sensorsdata.disableReportAjaxCache(),this.options.onRefreshClick(sensorsdata.bind(function(){o.removeClass("refreshing")},this)),sensorsdata.enableReportAjaxCache()):(t.trigger("updateParams",{dashboard_cache_policy:"NORMAL"}),this.options.onRefreshClick(sensorsdata.bind(function(){o.removeClass("refreshing")},this)),t.trigger("updateParams",{dashboard_cache_policy:""})));break;case"download":$.isFunction(this.options.onDownloadClick)?this.options.onDownloadClick():$.isEmptyObject(this.options.onDownloadClick)||i.show({ele:o,data:this.options.onDownloadClick})}},dealSamplingValue:function(a){return $.isNumeric(a)?(a=parseInt(a,10),Math.log(a)/Math.log(2)%1!==0?64:a>64?64:a):64},getSamplingValue:function(a){return(!$.isNumeric(a)||0>a||a>6)&&(a=parseInt(this.$container.find("#sampling-factor-slider").val(),10)),(0>a||a>6)&&(a=6),Math.pow(2,a)},initSampleSlider:function(){var a=this,t=this.options,o=this.dealSamplingValue(t.samplingFactor)||"",n="#sampling-factor-slider",s=this.$container.find(n),e=this.$container.find(".sampling-factor-label"),i=this.$container.find('.sampling [data-toggle="tooltip"]');o=Math.log(o)/Math.log(2);var r=function(a){return a=parseInt(a)||64,64===a?sensorsdata.languages.get("全量<!--{en}Total-->"):"1/"+64/a},d=function(a){var t=sensorsdata.languages.get("对全量数据计算<!--{en}Total data calculation-->");return 64!==a&&(t=sensorsdata.util.format(sensorsdata.languages.get("对全量数据抽样1/#{value}计算<!--{en}1/#{value} random sample of total data calculation-->"),{value:64/a})),t};e.text(r(t.samplingFactor)),s.val(o),i.attr("data-original-title",d(t.samplingFactor)).tooltip(),this.samplingSlider_=new Slider(n,{value:o,tooltip:"hide",tooltip_position:"bottom",formatter:function(t){return 6===t?sensorsdata.languages.get("对全量数据计算<!--{en}Total data calculation-->"):(t=a.getSamplingValue(t),sensorsdata.util.format(sensorsdata.languages.get("对全量数据抽样1/#{value}计算<!--{en}1/#{value} random sample of total data calculation-->"),{value:64/t}))}}),sensorsdata.authority.isNormal&&this.samplingSlider_.disable(),s.on("change",function(){var t=a.getSamplingValue();e.text(r(t)),i.attr("data-original-title",d(t)).tooltip()}),s.on("slideStop",function(){var o=a.getSamplingValue();e.text(r(o)),i.attr("data-original-title",d(o)).tooltip(),$.isFunction(a.options.onSampleChanged)&&t.onSampleChanged(o),a.paramsObj.sampling_factor!==o&&(a.paramsObj.sampling_factor=t.samplingFactor=o,sensorsdata.track("sampling"),a.checkMethodStatus(),a.trigger("updateSampling",{sampling_factor:o}))})},refreshDownloadTip:function(a){var t=a||this.options.downloadTip,o=this.$container.find('[data-method="download"]');o.attr("data-original-title",t)},destroy:function(){$.isEmptyObject(this.samplingSlider_)||this.samplingSlider_.destroy(),this.$container.empty()}}),t.create=function(a){return new p(a)}});
;/*!components/boxPlot/boxPlot.js*/
define("components/boxPlot/boxPlot",function(t,a){var i=t("echarts3"),e=t("components/util/util"),o=$.extend(!0,{},sensorsdata.echarts.option,{series:[],dataZoom:{show:!1},legend:{data:[]},tooltip:{trigger:"axis",formatter:function(t){return["分组值: "+t[0].seriesName,"最大值: "+e.formatDuration(t[0].data[5]),"上四分位: "+e.formatDuration(t[0].data[4]),"中位数: "+e.formatDuration(t[0].data[3]),"下四分位: "+e.formatDuration(t[0].data[2]),"最小值: "+e.formatDuration(t[0].data[1]),"平均值: "+e.formatDuration(t[1].data[1])].join("<br/>")}}}),r={noData:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="report-no-data">\n  <div class="report-no-data-msg">\n    <h5>没有查找到数据<!--{en}No data was found--></h5>\n    <p>请尝试调整时间段或筛选条件<!--{en}Please try to adjust the time period or filter condition--></p>\n  </div>\n</div>'},useData:!0})},s=function(t){this.options_=t,this.$container_=t.container||$("body");var a=i.getInstanceByDom(this.$container_[0]);a&&i.dispose(a),this.chart_=i.init(this.$container_[0]),this.init()};s.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){var t=this.prepareData(this.options_.data,this.options_.selected);this.chart_&&this.chart_.hasOwnProperty("isDisposed")&&!this.chart_.isDisposed()&&this.chart_.dispose(),0===t.series.length&&this.$container_.html(r.noData()),this.chart_.showLoading(),t.series.length>2&&this.muiltyData(t),this.dayInterval(t,31)&&(t.dataZoom.show=!0,t.legend.bottom=28),this.chart_.setOption(t),this.chart_.hideLoading(),this.resize()},dayInterval:function(t,a){a=a||31;var i=t.xAxis[0]&&t.xAxis[0].data&&t.xAxis[0]&&t.xAxis[0].data.length||1,e=t.series.length/2;return i*e>a},muiltyData:function(t){var a=t.series,i=a.length%2===0&&a.length/2;if(i){for(var o=0;i>o;o++){var r=a[o].data,s=a[o+i].data;if(!(r[0].length>5)){a[o+i].tooltip={show:!1},a[o+i].itemStyle={normal:{color:t.color[o]}};for(var n=0;n<r.length;n++)r[n].push(s[n][1])}}t.tooltip.trigger="item",t.tooltip.formatter=function(t){return["分组值: "+t.seriesName,"最大值: "+e.formatDuration(t.data[5]),"上四分位: "+e.formatDuration(t.data[4]),"中位数: "+e.formatDuration(t.data[3]),"下四分位: "+e.formatDuration(t.data[2]),"最小值: "+e.formatDuration(t.data[1]),"平均值: "+e.formatDuration(t.data[6])].join("<br/>")}}},prepareData:function(t,a){var i=$.extend(!0,{},o);a=a||[0,1,2];var e={name:"boxplot",type:"boxplot",data:[],barMaxWidth:"40%",itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0)"}}};t.boxData.forEach(function(t,o){if(-1!==a.indexOf(o)){var r=$.extend(!0,{},e);r.data=t.value,r.name=t.key,i.legend.data.push(t.key),i.series.push(r)}});var r=i.series.length;return i.series.forEach(function(a,e){for(var o=[],s=0;s<t.avgData[e].length;s++)o.push([s,t.avgData[e][s]]);var n={name:a.name,type:"pictorialBar",symbolPosition:"end",symbolSize:8,z:1e4,data:o};r&&(n.barGap=1/r*100+"%"),i.series.push(n)}),i.xAxis.data=t.axisData,i.xAxis=[i.xAxis],i},resize:function(){var t=this;this.chart_&&$.isFunction(this.chart_.resize)&&$(window).off("resize.box").on("resize.box",function(){t.chart_.resize()})},show:function(t){var a=this.prepareData(this.options_.data,t);this.chart_&&this.chart_.dispose&&this.chart_.dispose(),0===a.series.length&&this.$container_.html(r.noData()),this.chart_=i.init(this.$container_[0]),a.series.length>2&&this.muiltyData(a),this.chart_.setOption(a)},destroy:function(){$(window).off("resize.box"),$.isFunction(this.chart_.dispose)&&this.chart_.dispose()}}),a.create=function(t){return new s(t)}});
;/*!components/model/channel.js*/
define("components/model/channel",function(n,e,t){var a=n("components/dataCache/dataCache").create,s=a(),o=$.extend(!0,{},sensorsdata.EventsModule,{getChannelLinks:function(n,e){if("function"!=typeof e)throw new Error("model/channel: getChannelLinks 方法的第 2 个参数必须为 function 类型");n=JSON.stringify(n);var t=s.get("channelLinks"+n);t?e(t):sensorsdata.ajax({method:"POST",url:sensorsdata.api.get("channelLinks"),data:n,success:function(t){s.set("channelLinks"+n,t),e(t)}})},getChannelCampaigns:function(n){if("function"!=typeof n)throw new Error("model/channel: getChannelCampaigns 方法的第 1 个参数必须为 function 类型");var e=s.get("channelCampaigns");e?n(e):sensorsdata.ajax({url:sensorsdata.api.get("channelCampaigns"),success:function(e){e=$.isArray(e)?e:[],s.set("channelCampaigns",e),n(e)}})},getChannelSupported:function(n){if("function"!=typeof n)throw new Error("model/channel: channelSupported 方法的第 1 个参数必须为 function 类型");var e=s.get("channelSupported");e?n(e):sensorsdata.ajax({url:sensorsdata.api.get("channelSupported"),success:function(e){s.set("channelSupported",e),n(e)}})},queryShortUrl:function(n,e){if("function"!=typeof e)throw new Error("model/channel: shortUrlQuery 方法的第 2 个参数必须为 function 类型");n=JSON.stringify(n);var t=s.get("queryShortUrl"+n);t?e(t):sensorsdata.ajax({type:"POST",contentType:"application/json",url:sensorsdata.api.get("shortUrlQuery")+"?project="+sensorsdata.cache.project.name,data:n,success:function(t){t=$.isArray(t)?t:[],s.set("queryShortUrl"+n,t),e(t)}})},createLink:function(n,e){var t=this;if("function"!=typeof e)throw new Error("model/channel: createLink 方法的第 2 个参数必须为 function 类型");sensorsdata.ajax({method:"PUT",url:sensorsdata.api.get("channelLinks"),data:JSON.stringify(n),success:function(a){t.postProcessingCRUD("createLink",n,a),e(a)}})},setLinkName:function(n,e,t){var a=this;if("function"!=typeof t)throw new Error("model/channel: setLinkName 方法的第 3 个参数必须为 function 类型");sensorsdata.ajax({method:"POST",url:sensorsdata.api.get("chanelLink",{id:n}),data:JSON.stringify(e),success:function(n){a.postProcessingCRUD("setLinkName",e,n),t(n)}})},createLinksUseExcel:function(n,e){var t=this;if("function"!=typeof e)throw new Error("model/channel: createLinksUseExcel 方法的第 2 个参数必须为 function 类型");sensorsdata.ajax({method:"POST",url:sensorsdata.api.get("shortUrlExcelLoader"),contentType:"application/x-www-form-urlencoded",timeout:6e5,data:n,success:function(a){t.postProcessingCRUD("createLinksUseExcel",n,a),e(a)}})},del:function(n,e){var t=this;sensorsdata.ajax({method:"DELETE",url:sensorsdata.api.get("channelLinks"),data:JSON.stringify(n),success:function(a){t.postProcessingCRUD("del",n,a),"function"==typeof e&&e(a)}})},postProcessingCRUD:function(n,e,t){var a={data:t};s.clean(),this.trigger(n,a)}});t.exports=o});
;/*!components/model/uploadFile.js*/
define("components/model/uploadFile",function(e,i,n){var t=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.stop=!1},uploadCurrentFile:function(e,i){if(!this.stop){this.stop=!1;var n=this,t=e.name,o=e.size,a=1047552,r=Math.ceil(o/a);n.i>=r?n.i=r:n.i++;var p=n.i*a,s=Math.min(o,p+a),d=e.slice(p,s),l=new FormData;l.append("file_size",o),l.append("slice_amount",r),l.append("index",n.i),l.append("file_md5",i),l.append("filename",t),l.append("file_content",d),browserMD5File(d,function(t,o){return t?void console.err(t):(l.append("current_md5",o),void $.ajax({url:"/api/file/upload"+location.search,type:"POST",data:l,async:!0,processData:!1,contentType:!1,success:function(t){var o=t.is_finished,a=0;o?(a="100%",n.i=-1,n.trigger("complete",t.file_name)):(a=n.i/r*100+"%",n.uploadCurrentFile(e,i)),n.trigger("update",a)}}))})}},upload:function(e){var i=this;(!i.i&&0!==i.i||-1===i.i)&&(i.i=-1,i.trigger("update",0)),browserMD5File(e,function(n,t){return n?void console.err(n):void i.uploadCurrentFile(e,t)})},stopUpload:function(){this.stop=!0}});n.exports=t});
;/*!components/uploadInput/uploadInput.js*/
define("components/uploadInput/uploadInput",function(n,i){function e(n){this.$container=n.container,this.accept=n.accept,this.tip=n.tip,this.uploadFile=t,this.init()}var t=n("components/model/uploadFile"),a={uploadInputTpl:Handlebars.template({1:function(n){return'<p class="modal-text-sub">'+this.escapeExpression(this.lambda(n,n))+"</p>"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,i,e,t){var a,o,l,p=i.helperMissing,s="function",d='<div class="common-upload">\n\n  <label class="upload-input-content">\n    <input type="file" name="upload-input-name" class="upload-input" accept="'+this.escapeExpression((o=null!=(o=i.accept||(null!=n?n.accept:n))?o:p,typeof o===s?o.call(n,{name:"accept",hash:{},data:t}):o))+'">\n    <span class="icon-upload"></span>上传文件<!--{en}Upload file-->\n  </label>\n  <div class="upload-info">\n    <span class="icon-file-link"></span>\n    <a class="upload-filename" title=""></a>\n    <span class="icon-remove upload-stop"></span>\n    <div class="upload-progress-whole"></div>\n    <div class="upload-progress"></div>\n  </div>\n  ';return o=null!=(o=i.tip||(null!=n?n.tip:n))?o:p,l={name:"tip",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t},a=typeof o===s?o.call(n,l):o,i.tip||(a=i.blockHelperMissing.call(n,a,l)),null!=a&&(d+=a),d+"\n</div>"},useData:!0})};e.prototype=$.extend({},sensorsdata.EventsModule,{init:function(){this.$container.html(a.uploadInputTpl({accept:this.accept,tip:this.tip})),this.uploadData={},this.bindEvents(),sensorsdata.languages.update()},bindEvents:function(){var n=this,i=this.$container;i.delegate(".upload-input","change",function(){n.initInputStyle();var e=i.find(".upload-input")[0].files[0];e&&(i.find(".upload-filename").text(e.name).attr("title",e.name),n.uploadFile.on("update",function(n){i.find(".upload-info > .upload-progress").css({width:n})}).on("complete",function(i){n.trigger("complete",{data:{filename:i}}),n.resetInputStyle(),n.filename=i}),n.uploadFile.init(),n.uploadFile.upload(e))}),i.delegate(".upload-stop","click",function(){n.uploadFile.stopUpload(),n.$container.find(".upload-info").hide(),n.$container.find(".upload-input").val(""),n.trigger("cancel")})},initInputStyle:function(){var n=this.$container;n.find(".upload-info .icon-remove").show(),n.find(".upload-info > .upload-progress-whole").show(),n.find(".upload-info > .upload-progress").show(),n.find(".upload-info").fadeIn().css("display","inline-block")},resetInputStyle:function(){var n=this.$container;n.find(".upload-info .icon-remove").hide(),setTimeout(function(){n.find(".upload-info > .upload-progress-whole").hide(),n.find(".upload-info > .upload-progress").hide()},1e3)},getVal:function(){return this.filename},destroy:function(){this.trigger("cancel"),this.uploadFile.stopUpload(),this.$container.empty()}}),i.create=function(n){return new e(n)}});
;/*!components/channel/batchBuildLinkForm/batchBuildLinkForm.js*/
define("components/channel/batchBuildLinkForm/batchBuildLinkForm",function(n,e){function a(n){this.options=n,this.$container=n.container,this.init()}var t=n("components/model/channel"),i=n("components/uploadInput/uploadInput"),s={batchBuildLinkFormTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="panel-bd form-content">\n  <div class="batch-build-short-link-form">\n    <h4><span class="iconc-num">1</span>\n      选择基础信息<!--{en}<span class="iconc-num">1</span>\n      Select basic information--></h4>\n    <div class="form-item">\n      <label>广告类型<!--{en}Type of advertisement--></label>\n      <div class="common-select border">\n        <select>\n          <option value="web_normal">网页通用渠道</option>\n          <option value="app_normal">APP 通用渠道</option>\n          <option value="mina_normal">小程序通用渠道</option>\n        </select>\n      </div>\n    </div>\n    <div class="form-item">\n      <label>创建方式<!--{en}Create mode--></label>\n      <div>\n        <label class="common-radio"><input value="file" name="batch-type" type="radio" checked="true"/>\n          <span class="radio-icon"></span>\n          批量上传创建<!--{en}<input value="file" name="batch-type" type="radio" checked="true"/>\n          <span class="radio-icon"></span>\n          Bulk upload creation--></label>\n        <label class="common-radio"><input value="online" name="batch-type" type="radio"/>\n          <span class="radio-icon"></span>\n          线上批量创建<!--{en}<input value="online" name="batch-type" type="radio"/>\n          <span class="radio-icon"></span>\n         Online bulk creation--></label>\n      </div>\n    </div>\n    <div class="file-content">\n      <h4><span class="iconc-num">2</span>\n        批量创建<!--{en}<span class="iconc-num">2</span>\n        Bulk creation--></h4>\n      <div class="form-item">\n        <label>下载模板并填写<!--{en}Download templates and fill in--></label>\n        <div>\n          <a class="download web-template" href="/static/files/web.xls" download="批量上传构建模板（web）.xls"><span class="icon-download"></span><span>下载文件<!--{en}Download--></span></a>\n          <span class="template-name">\n            <span class="icon-file-link"></span>\n            批量上传构建模板（web）.xls\n          </span>\n          <a class="download xcx-template" href="/static/files/xcx.xls" download="批量上传构建模板（小程序）.xls"><span class="icon-download"></span><span>下载文件<!--{en}Download--></span></a>\n          <span class="template-name">\n            <span class="icon-file-link"></span>\n            批量上传构建模板（小程序）.xls\n          </span>\n          <a class="download app-template" href="/static/files/app.xls" download="批量上传构建模板（app）.xls"><span class="icon-download"></span><span>下载文件<!--{en}Download--></span></a>\n          <span class="template-name">\n            <span class="icon-file-link"></span>\n            批量上传构建模板（app）.xls\n          </span>\n        </div>\n      </div>\n      <div class="form-item">\n        <label>上传填写好的模板<!--{en}Upload the completed template--></label>\n        <div class="upload-content"></div>\n      </div>\n    </div>\n    <div class="online-content">\n      <div class="form-item url-address">\n        <label>推广地址<!--{en}Promotion address--></label>\n        <div>\n          <input data-error-reg-exp="(https?|ftp|file)://[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]" class="common-input" data-error-text="请输入http://或https://开头的推广地址" type="text" placeholder="http://或https://开头的推广地址">\n        </div>\n      </div>\n      <div class="form-item app-address">\n        <label>应用地址<!--{en}Application address--></label>\n        <div>\n          <input data-error-reg-exp="(https?|ftp|file)://[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]" class="common-input" data-error-text="请输入 http:// 或 https:// 开头的推广地址" type="text" placeholder="http:// 或 https:// 开头的应用地址">\n          <p>比如 Android 或 iOS 的下载地址、应用宝微下载地址、中间跳转URL，这网址必须以 http:// 或 https:// 开头</p>\n        </div>\n      </div>\n      <h4><span class="iconc-num">2</span>\n        选择基础信息<!--{en}<span class="iconc-num">2</span>\n        Select basic information--></h4>\n      <div>\n        <textarea data-error-text=\'渠道信息不能为空\' data-error-reg-exp="\\S+" class="textarea" rows="5" cols="21" placeholder="例如 &#13;&#10; baidu1,cpc1,shoes1,textlink1,spring1 &#13;&#10; baidu2,cpc2,shoes2,textlink2,spring2 &#13;&#10; baidu3,cpc3,shoes3,textlink3,spring3 &#13;&#10; baidu4,cpc4,shoes4,textlink4,spring4"></textarea><!--\n      --><div>\n          <p>受浏览器性能影响，建议每次生成网址数量不要超过800条。<!--{en}Affected by browser performance, it is recommended that no more than 800 web addresses be generated per time.--></p>\n          <p><label>说明：按顺序填写 5 项渠道信息<!--{en}Description: fill in 5 channel information in sequence.--></label></p>\n          <p><label>1 活动名称<!--{en}1 Activity name--></label><span>（产品、促销代码或标语）;<!--{en}（product, promotion code or slogan）;--></span></p>\n          <p><label>2 广告来源<!--{en}2 Advertisement source--></label><span>（引荐来源网址：baidu、sina、sohu）;<!--{en}（Recommendation source website: baidu、sina、sohu）;--></span></p>\n          <p><label>3 广告媒介<!--{en}2 Advertisement media--></label><span>（营销媒介：cpc、banner、edm）;<!--{en}（Marketing media：cpc、banner、edm）;--></span></p>\n          <p><label>4 关键词<!--{en}4 Key word--></label><span>（标识付费关键字，主要适用于 SEM）;<!--{todo}--></span></p>\n          <p><label>5 广告内容<!--{en}5 Advertisement content--></label><span>（用于区分广告）;<!--{en}（Used to distinguish advertisements）;--></span></p>\n          <p><label>如果某一个参数没有值，参考以下格式：<!--{en}If there is no value for a parameter, refer to the following format:--></label></p>\n          <p>baidu1,,shoes1,textlink1,spring1</p>\n          <p>baidu2,,,textlink2,spring2</p>\n          <p>,,shoes3,textlink3,spring3</p>\n          <p>baidu4,cpc4,shoes4</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="panel-ft clearfix">\n  <button class="btn btn-primary pull-right" data-method="create">点击生成<!--{en}Click to generate--></button>\n  <button class="btn btn-link btn-cancel" data-method="cancel">取消<!--{en}Cancel--></button>\n</div>'},useData:!0})};a.prototype=$.extend({},sensorsdata.EventsModule,{batchType:"file",init:function(){this.$container.html(s.batchBuildLinkFormTpl()),this.render(),this.initEvents(),sensorsdata.languages.update()},render:function(){var n=this;this.$container.find("select").multiselect({enableFiltering:!1,enableCaseInsensitiveFiltering:!1,onChange:function(e){var a=e.val();n.$container.find(".batch-build-short-link-form").removeClass("app").removeClass("xcx"),"app_normal"===a?n.$container.find(".batch-build-short-link-form").addClass("app"):"mina_normal"===a&&n.$container.find(".batch-build-short-link-form").addClass("xcx")}}),this.uploadInput=i.create({container:n.$container.find(".upload-content"),accept:"application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",tip:"只支持excel格式的文件"})},initEvents:function(){var n=this;this.$container.delegate("[data-method]","click",function(e){e.preventDefault();var a=e.$target=$(this);n.handler(a.attr("data-method"),e)}),this.$container.delegate("[data-error-reg-exp]","keyup",function(n){n.preventDefault(),sensorsdata.form.check([$(this)],!0)}),n.$container.delegate(".common-radio","click",function(){var e=$(this).find('[type="radio"]'),a=e.val();n.batchType=a,"online"===a?n.$container.find(".batch-build-short-link-form").addClass("online"):n.$container.find(".batch-build-short-link-form").removeClass("online")}),n.uploadInput.on("complete",function(e){n.filename=e.data.filename})},validation:function(){var n=this.$container;sensorsdata.form.removeChildrenError(n);var e=[],a=!0;return n.find(".app-address").is(":visible")&&e.push(n.find(".app-address input")),n.find(".url-address").is(":visible")&&e.push(n.find(".url-address input")),n.find(".textarea").is(":visible")&&e.push(n.find(".textarea")),sensorsdata.form.check(e,!0,1)?a:a=!1},handler:function(n){var e=this;switch(n){case"create":if("online"===this.batchType){if(!e.validation())return;var a=e.getParams();t.createLink(a,function(n){var a={type:"onlineBatchCreate",length:n.created,repeatLenght:n.duplicated,urlList:n.url_list};return n.created||n.duplicated||!n.failed?void e.trigger("create",{data:a}):void sensorsdata.error.show({content:n.failed+"条链接创建失败",duration:2e3})})}else if("file"===this.batchType){var i=e.filename;if(!i)return sensorsdata.warning.show({content:sensorsdata.languages.get("请先上传文件<!--{todo}-->"),duration:2e3});t.createLinksUseExcel({filename:i,channel_name:e.$container.find(".common-select select").val()},function(n){var a=i.split(".")[0]+"的生成结果."+i.split(".")[1],t={filename:a,fileAddress:"/api/short_url/download/"+n.excel_file+"/"+a,type:"batchCreate",failed:n.failed,length:n.created,repeatLenght:n.duplicated};e.trigger("create",{data:t})})}break;case"cancel":this.trigger("cancel")}},getParams:function(){var n=this.$container,e=n.find(".common-select select").val(),a=n.find(".textarea").val(),t=a.split("\n").length,i=n.find(".app-address input").val(),s="app_address",l=[],o=function(n){var e=n.split(/[,，]/)[0]||"",a=n.split(/[,，]/)[1]||"",t=n.split(/[,，]/)[2]||"",i=n.split(/[,，]/)[3]||"",s=n.split(/[,，]/)[4]||"",l={utm_source:e,utm_medium:a,utm_term:t,utm_content:i,utm_campaign:s};return l};"app_normal"!==e&&(i=n.find(".url-address input").val(),s="target_url");for(var r=0;t>r;r++)if(""!==a.split("\n")[r]){var p=o(a.split("\n")[r],"app"),c={channel_name:e,device_type:"通用",parameters:p};c[s]=i,l.push(c)}return l},destroy:function(){this.uploadInput.destroy(),this.$container.empty()}}),e.create=function(n){return new a(n)}});
;/*!components/channel/tagSelect/tagSelect.js*/
define("components/channel/tagSelect/tagSelect",function(e,n){function t(e){this.options=e,this.$container=e.container,this.data=$.extend(!0,[],e.data),this.init()}var a=e("components/util/util"),i={emptyItemsTpl:Handlebars.template({1:function(e){return"    <div>"+this.escapeExpression(this.lambda(e,e))+"</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,t,a){var i;return'<li class="empty">\n  <img src="/res/img/empty.png">\n  <div>\n'+(null!=(i=n.blockHelperMissing.call(e,this.lambda(e,e),{name:".",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?i:"")+"  </div>\n</li>"},useData:!0}),itemsTpl:Handlebars.template({1:function(e,n,t,a){var i;return null!=(i=n["if"].call(e,null!=e?e.name:e,{name:"if",hash:{},fn:this.program(2,a,0),inverse:this.noop,data:a}))?i:""},2:function(e,n,t,a){var i;return"<li>\n  <label>\n    "+this.escapeExpression((i=null!=(i=n.name||(null!=e?e.name:e))?i:n.helperMissing,"function"==typeof i?i.call(e,{name:"name",hash:{},data:a}):i))+"\n  </label>\n</li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,t,a){var i,s,l,d="";return s=null!=(s=n.data||(null!=e?e.data:e))?s:n.helperMissing,l={name:"data",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a},i="function"==typeof s?s.call(e,l):s,n.data||(i=n.blockHelperMissing.call(e,i,l)),null!=i&&(d+=i),d},useData:!0}),tagSelectTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,t,a){var i;return'<div class="tag-select">\n  <button class="btn-selector common-btn placeholder">'+this.escapeExpression((i=null!=(i=n.placeholder||(null!=e?e.placeholder:e))?i:n.helperMissing,"function"==typeof i?i.call(e,{name:"placeholder",hash:{},data:a}):i))+'</button>\n  <div class="select">\n    <div class="search">\n      <input class="common-input" type="text" placeholder="搜索">\n      <span class="icon-search"></span>\n    </div>\n    <ul class="items">\n    </ul>\n    <div class="ft">\n      <span data-method="add">\n        <span class="icon-add"></span>\n        新建活动<!--{en}</span>\n        create new activity--></span>\n    </div>\n  </div>\n  <div class="add-new">\n    <div class="title">\n      <span class="icon-arrow-left" data-method="back"></span>\n      <div>新建活动<!--{en}create new activity--></div>\n    </div>\n    <div class="content">\n      <label>活动名称<!--{en}Activity name--></label>\n      <input class="common-input" type="text" placeholder="请输入活动名称">\n    </div>\n    <div class="ft">\n      <button class="btn btn-link btn-cancel" data-method="cancel">取消<!--{en}Cancel--></button>\n      <button class="btn btn-primary pull-right" data-method="confirm">确定<!--{en}Confirm--></button>\n    </div>\n  </div>\n</div>'},useData:!0})};t.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.render(),this.initEvents(),sensorsdata.languages.update()},render:function(){var e=this;this.$container.html(i.tagSelectTpl({placeholder:e.options.placeholder})),e.renderItems({data:e.options.data})},renderItems:function(e){var n=this.$container.find(".items");return $.isEmptyObject(e.data)?void n.html(i.emptyItemsTpl(["暂无活动","点击下方“+”新建一个活动"])):void n.html(i.itemsTpl(e))},initEvents:function(){var e=this,n=this.$container;n.off("click.preventdefault").on("click.preventdefault",function(e){return e&&e.preventDefault&&e.preventDefault(),!1}),n.delegate(".btn-selector","click",function(){var n=$(this);n.attr("data-expanded")?e.hide():e.show()}),n.delegate("li","click",function(){var t=$(this);if(!t.hasClass("empty")){t.siblings().removeClass("active"),t.addClass("active"),n.find(".btn-selector").removeClass("placeholder");var a=t.find("label").html();n.find(".btn-selector").html(a),n.find(".btn-selector").val(a),e.hide()}}),n.delegate("[data-method]","click",function(n){n.preventDefault();var t=n.$target=$(this);e.handler(t.attr("data-method"),n)}),n.delegate(".common-input","keydown",function(){var n=$(this),t=n.attr("data-timeout");t&&window.clearTimeout(t),t=window.setTimeout(function(){var t=n.val().trim(),i=a.fuzzySearch(e.data,t,"name");e.renderItems({data:i})},500),n.attr("data-timeout",t)})},handler:function(e){var n=this;switch(e){case"add":n.showAddPanel();break;case"back":n.hideAddPanel();break;case"cancel":n.hideAddPanel();break;case"confirm":var t=n.$container.find(".add-new .common-input"),a=t.val().trim();t.val(""),n.data.unshift({name:a}),n.hideAddPanel(),n.renderItems({data:n.data}),n.show()}},getVal:function(){var e=this.$container.find(".btn-selector").val().trim();return e},bindHideEvent:function(){var e=this;$("body").off("click.tagSelect").on("click.tagSelect",function(n){var t=$(n.target);return t.is(e.$ele)?!1:void e.hide()})},show:function(e){var n=this.$container;n.find(".btn-selector").attr("data-expanded",!0),n.find(".select").addClass("open"),e||this.bindHideEvent()},hide:function(e){var n=this.$container;n.find(".btn-selector").removeAttr("data-expanded"),n.find(".select").removeClass("open"),e||$("body").off("click.tagSelect")},showAddPanel:function(){var e=this.$container;this.hide(!0),e.find(".btn-selector").attr("data-expanded",!0),e.find(".add-new").addClass("open")},hideAddPanel:function(){var e=this.$container;e.find(".btn-selector").removeAttr("data-expanded"),e.find(".add-new").removeClass("open"),this.show(!0)},destroy:function(){this.$container.empty()}}),n.create=function(e){return new t(e)}});
;/*!components/channel/buildShortLinkForm/buildShortLinkForm.js*/
define("components/channel/buildShortLinkForm/buildShortLinkForm",function(e,t){function n(e){this.options=e,this.$container=e.container,this.campaignsList=e.campaignsList,this.channelSupportedList=e.channelSupportedList,this.init()}var a=e("components/model/channel"),i=e("components/channel/tagSelect/tagSelect"),s=["utm_campaign","utm_content","utm_source","utm_medium","utm_term"],r={buildShortLinkFormTpl:Handlebars.template({1:function(e,t,n,a){var i;return null!=(i=t["if"].call(e,null!=e?e.is_show:e,{name:"if",hash:{},fn:this.program(2,a,0),inverse:this.noop,data:a}))?i:""},2:function(e,t,n,a){var i,s=t.helperMissing,r="function",l=this.escapeExpression;return'          <option value="'+l((i=null!=(i=t.name||(null!=e?e.name:e))?i:s,typeof i===r?i.call(e,{name:"name",hash:{},data:a}):i))+'" data-name="'+l((i=null!=(i=t.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:a}):i))+'">'+l((i=null!=(i=t.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:a}):i))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,a){var i;return'<div class="panel-bd form-content">\n  <div class="build-short-link-form">\n    <h4><span class="iconc-num">1</span>\n      选择基础信息<!--{en}<span class="iconc-num">1</span>\n      Select basic information--></h4>\n    <div class="form-item">\n      <label>广告类型<!--{en}Type of advertisement--></label>\n      <div class="common-select border">\n        <select>\n'+(null!=(i=t.blockHelperMissing.call(e,this.lambda(e,e),{name:".",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?i:"")+'        </select>\n      </div>\n    </div>\n    <div class="form-item supported">\n      <label>渠道来源类型<!--{en}Types of channel sources--></label>\n      <div class="type-block selected" data-type="iOS" data-method=\'type-change\'>\n        <div class="icon-mobile"></div>\n        <p>iOS</p>\n        <div class="selected">\n          <span class="icon-selected"></span>\n        </div>\n      </div>\n      <div class="type-block" data-type="Android" data-method="type-change">\n        <div class="icon-web"></div>\n        <p>Android</p>\n        <div class="selected">\n          <span class="icon-selected"></span>\n        </div>\n      </div>\n    </div>\n    <div class="form-item url-address">\n      <label>推广地址<!--{en}Promotion address--></label>\n      <div>\n        <textarea data-error-text=\'请输入 http:// 或 https:// 开头的推广地址\' data-error-reg-exp="(https?|ftp|file)://[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]" class="textarea" rows="3" cols="100" placeholder="http:// 或 https:// 开头的推广地址"></textarea>\n      </div>\n    </div>\n    <div class="form-item app-address">\n      <label>应用地址<!--{en}Application address--></label>\n      <div>\n        <textarea data-error-text=\'请输入 http:// 或 https:// 开头的应用地址\' data-error-reg-exp="(https?|ftp|file)://[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]" class="textarea" rows="3" cols="100" placeholder="http:// 或 https:// 开头的应用地址"></textarea>\n        <p>比如 Android 或 iOS 的下载地址、应用宝微下载地址、中间跳转URL，这网址必须以 http:// 或 https:// 开头<!--{en}For example, the download address of Android or iOS, the download address of Application of treasure, and the intermediate jump URL, which must start with http://or https://--></p>\n      </div>\n    </div>\n    <h4>\n      <span class="iconc-num">2</span>\n      <span>输入渠道信息<!--{en}Input channel information--></span>\n      <a href="https://www.sensorsdata.cn/_manual/channel_management.html" target="channelDocument" class="icon-help" data-toggle="tooltip" data-original-title="点击查看文档" data-lang-data-original-title="<!--{en}Click to view documents-->" data-placement="right"></a>\n    </h4>\n    <div class="form-item">\n      <label>\n        <span>活动名称<!--{en}Activity name--></span>\n        <span class="icon-help" data-toggle="tooltip" data-original-title="广告系列名称 utm_campaign" data-lang-data-original-title="<!--{en}Advertisement series name utm_campaign-->" data-placement="right"></span>\n      </label>\n      <div class="campaign">\n        <input name="utm_campaign" class="common-input" type="text" placeholder="请选择推广活动">\n      </div>\n    </div>\n    <div class="form-item">\n      <label>\n        <span>广告来源<!--{en}Advertisement sources--></span>\n        <span class="icon-help" data-toggle="tooltip" data-original-title="广告系列来源 utm_source" data-lang-data-original-title="<!--{en}Advertisement series sources utm_source-->" data-placement="right"></span>\n      </label>\n      <div>\n        <input name="utm_source" class="common-input" type="text" placeholder="引荐来源网址：baidu、sina、sohu">\n      </div>\n    </div>\n    <div class="form-item">\n      <label>\n        <span>广告媒介<!--{en}Advertisement media--></span>\n        <span class="icon-help" data-toggle="tooltip" data-original-title="广告系列媒介 utm_medium" data-lang-data-original-title="<!--{en}Advertisement series media utm_medium-->" data-placement="right"></span>\n      </label>\n      <div>\n        <input name="utm_medium" class="common-input" type="text" placeholder="营销媒介：cpc、banner、edm">\n      </div>\n    </div>\n    <div class="form-item">\n      <label>\n        <span>关键词<!--{en}Key word--></span>\n        <span class="icon-help" data-toggle="tooltip" data-original-title="广告系列字词 utm_term" data-lang-data-original-title="<!--{en}Advertisement series words utm_term-->" data-placement="right"></span>\n      </label>\n      <div>\n        <input name="utm_term" class="common-input" type="text" placeholder="标识付费关键字，主要适用于 SEM">\n      </div>\n    </div>\n    <div class="form-item">\n      <label>\n        <span>广告内容<!--{en}Advertisement content--></span>\n        <span class="icon-help" data-toggle="tooltip" data-original-title="广告系列内容 utm_content" data-lang-data-original-title="<!--{en}Advertisement series content utm_content-->" data-placement="right"></span>\n      </label>\n      <div>\n        <input name="utm_content" class="common-input" type="text" placeholder="用于区分广告">\n      </div>\n    </div>\n    <a data-method="add-item"><span class="icon-add"></span>\n      添加自定义属性<!--{en}<span class="icon-add"></span>\n      Add custom attributes--></a>\n    <div class="web-nornal-tips">网页通用渠道添加自定义属性，需进行 sdk 修改，<a href="https://www.sensorsdata.cn/manual/js_sdk.html#14-参数配置" target="channelDocument">点击查看文档</a></div>\n    <div class="more-form-items"></div>\n  </div>\n</div>\n<div class="panel-ft clearfix">\n  <button class="btn btn-primary pull-right" data-method="create">点击生成<!--{en}Click to generate--></button>\n  <button class="btn btn-link btn-cancel" data-method="cancel">取消<!--{en}Cancel--></button>\n</div>'},useData:!0}),moreFormItemTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="more-form-item">\n  <input class="common-input customer-item-name" type="text" placeholder="属性名">\n  <input class="common-input customer-item-value" type="text" placeholder="输入自定义属性内容">\n  <span class="icon-remove" data-method="remover-item"></span>\n</div>'},useData:!0})},l=["web_normal","mina_normal"];n.prototype=$.extend({},sensorsdata.EventsModule,{params:{},init:function(){var e=this;$.isEmptyObject(this.channelSupportedList)?a.getChannelSupported(function(t){e.channelSupportedList=t,e.$container.html(r.buildShortLinkFormTpl(e.channelSupportedList))}):this.$container.html(r.buildShortLinkFormTpl(this.channelSupportedList)),this.render(),this.initEvents(),sensorsdata.languages.update()},render:function(){var e=this;this.$container.find("select").multiselect({enableFiltering:!0,enableCaseInsensitiveFiltering:!0,onDropdownShow:function(){this.$filter.find(".multiselect-search").val(""),this.$filter.find("span").hasClass("icon-search")||this.$filter.append('<span class="icon-search"></span>'),$(this.$ul.children("li"),this.$ul).show().removeClass("filter-hidden"),this.updateSelectAll()},onChange:function(t){sensorsdata.form.removeChildrenError(e.$container);var n=t.val();e.$container.find(".web-nornal-tips").toggle("web_normal"===n),l.indexOf(n)<0?e.$container.find(".build-short-link-form").addClass("app-download"):e.$container.find(".build-short-link-form").removeClass("app-download"),e.getAdSupported(n)}}),$.isEmptyObject(this.campaignsList)?a.getChannelCampaigns(function(t){e.campaignsList=t||[],e.renderTagSelect()}):this.renderTagSelect()},renderTagSelect:function(){var e=this.campaignsList.map(function(e){return e.name=e.campaign_name,e});this.tagSelect=i.create({container:this.$container.find(".campaign"),data:e,placeholder:"请选择推广活动"})},getAdSupported:function(e){var t=this.channelSupportedList,n=t.filter(function(t){return t.name===e})[0].supported,a=this.$container.find(".supported");switch(n.length){case 1:if("通用"===n[0])return void a.hide();a.find(".type-block").removeClass("selected").addClass("disabled"),a.find(".type-block[data-type="+n[0]+"]").addClass("selected").removeClass("disabled");break;case 2:a.find(".type-block").removeClass("disabled")}a.show()},initEvents:function(){var e=this;this.$container.delegate("[data-method]","click",function(t){t.preventDefault();var n=t.$target=$(this);e.handler(n.attr("data-method"),t)}),this.$container.find('[data-toggle="tooltip"]').tooltip(),this.$container.delegate("[data-error-reg-exp]","keyup",function(e){e.preventDefault(),sensorsdata.form.check([$(this)],!0)}),this.$container.delegate(".customer-item-name","keyup",function(e){e.preventDefault();var t=$(this),n=t.val().trim(),a=new RegExp("^[a-zA-Z_$][a-zA-Z\\d_$]{0,39}$");n&&s.indexOf(n)>-1?sensorsdata.form.addError(t,"已有这个utm值",!0):a.test(n)?sensorsdata.form.removeError(t):sensorsdata.form.addError(t,"事件名只能包含大小写字母、数字、_ 和 $ ，不能以数字开头，不超过 40 个字符",!0)})},validation:function(){var e=this.$container;sensorsdata.form.removeChildrenError(e);var t=[],n=!0;return e.find(".app-address").is(":visible")&&t.push(e.find(".app-address textarea")),e.find(".url-address").is(":visible")&&t.push(e.find(".url-address textarea")),sensorsdata.form.check(t,!0,1)?(e.find(".more-form-item").each(function(e,t){var a=$(t),i=a.find(".customer-item-name").val().trim(),r=new RegExp("^[a-zA-Z_$][a-zA-Z\\d_$]{0,39}$");i&&s.indexOf(i)>-1&&n?(sensorsdata.form.addError(a.find(".customer-item-name"),"已有这个utm值",!0),n=!1):r.test(i)?sensorsdata.form.removeError(a.find(".customer-item-name")):(sensorsdata.form.addError(a.find(".customer-item-name"),"事件名只能包含大小写字母、数字、_ 和 $ ，不能以数字开头，不超过 40 个字符",!0),n=!1)}),n):n=!1},handler:function(e,t){var n=t.$target,i=this;switch(e){case"create":if(!i.validation())return;var s=i.getParams();a.createLink(s,function(e){var t=e.url_list[0]||{},n={type:"create",length:e.created,repeatLenght:e.duplicated,id:t.id,linkName:t.name,documentName:sensorsdata.CONSTSET.channelDocument+i.$container.find("select option:checked").attr("data-name")},a=s[0].channel_name;if(n.name=a,l.indexOf(a)>-1?(n.shortLink=t.short_url,n.link=t.target_url||t.whole_url):"app_normal"===a?(n.shortLink=t.short_url,n.downloadLink=t.app_address,n.monitorLink=t.target_url||t.whole_url):(n.downloadLink=t.app_address,n.monitorLink=t.target_url||t.whole_url),e.created===e.failed&&e.failed){var r=e.url_list&&e.url_list[0]&&e.url_list[0].error_msg?"，"+e.url_list[0].error_msg:"";return void sensorsdata.error.show({content:e.failed+"条链接创建失败"+r,duration:2e3})}i.trigger("create",{data:n})});break;case"cancel":this.trigger("cancel");break;case"add-item":var o=i.getParams()[0].channel_name;this.$container.find(".web-nornal-tips").toggle("web_normal"===o);var d=this.$container.find(".more-form-items");d.append(r.moreFormItemTpl());break;case"remover-item":n.parent(".more-form-item").remove();break;case"type-change":if(n.hasClass("disabled"))return;n.siblings().removeClass("selected"),n.addClass("selected")}},getParams:function(){var e=this.$container,t={utm_campaign:this.tagSelect.getVal(),utm_content:e.find('input[name="utm_content"]').val().trim(),utm_medium:e.find('input[name="utm_medium"]').val().trim(),utm_source:e.find('input[name="utm_source"]').val().trim(),utm_term:e.find('input[name="utm_term"]').val().trim()},n=e.find("select").val();e.find(".more-form-item").each(function(e,n){var a=$(n),i=a.find(".customer-item-name").val().trim(),s=a.find(".customer-item-value").val().trim();i&&s&&(t[i]=s)});var a={channel_name:n,parameters:t};return a.device_type=e.find(".supported").is(":visible")?e.find(".supported .type-block.selected").attr("data-type"):"通用",l.indexOf(n)>-1?a.target_url=e.find(".url-address textarea").val():a.app_address=e.find(".app-address textarea").val(),[a]},destroy:function(){this.$container.find('[data-toggle="tooltip"]').tooltip("destroy"),this.$container.empty()}}),t.create=function(e){return new n(e)}});
;/*!components/channel/buildSuccessPage/buildSuccessPage.js*/
define("components/channel/buildSuccessPage/buildSuccessPage",function(n,a){function e(n){this.options=n,this.$container=n.container,this.init(),sensorsdata.languages.update()}var t=n("components/model/channel"),s=n("components/basicTable/basicTable"),l={buildSuccessPageTpl:Handlebars.template({1:function(n,a,e,t){var s;return"，"+this.escapeExpression((s=null!=(s=a.repeatLenght||(null!=n?n.repeatLenght:n))?s:a.helperMissing,"function"==typeof s?s.call(n,{name:"repeatLenght",hash:{},data:t}):s))+" 条重复链接已被覆盖"},3:function(n,a,e,t){var s;return"，"+this.escapeExpression((s=null!=(s=a.failed||(null!=n?n.failed:n))?s:a.helperMissing,"function"==typeof s?s.call(n,{name:"failed",hash:{},data:t}):s))+"条链接创建失败"},5:function(n){var a=this.lambda,e=this.escapeExpression;return'    <div>\n      <label>链接名称<!--{en}Link name--></label>\n      <span class="result-link-name">\n        <span class="link-name" data-originname='+e(a(n,n))+">"+e(a(n,n))+'</span>\n        <span data-method="edit-link-name" class="icon-edit"></span>\n      </span>\n    </div>\n'},7:function(n){var a=this.lambda,e=this.escapeExpression;return'    <div>\n      <label>推广地址<!--{en}Promotion address--></label>\n      <span class="result-link">\n        '+e(a(n,n))+'\n        <span data-method="copy-link" class="icon-copy" data-clipboard-text="'+e(a(n,n))+'"></span>\n      </span>\n    </div>\n'},9:function(n){var a=this.lambda,e=this.escapeExpression;return'    <div>\n      <label>短链<!--{en}Short link--></label>\n      <div class="short-link-container">\n        <div>\n          <span class="result-shortLink">\n            '+e(a(n,n))+'\n            <span data-method="copy-link" class="icon-copy" data-clipboard-text="'+e(a(n,n))+'"></span>\n          </span>\n        </div>\n      </div>\n    </div>\n'},11:function(n){var a=this.lambda,e=this.escapeExpression;return'    <div>\n      <label>应用下载地址<!--{en}Application download address--></label>\n      <span class="result-downloadLink">\n        '+e(a(n,n))+'\n        <span data-method="copy-link" class="icon-copy" data-clipboard-text="'+e(a(n,n))+'"></span>\n      </span>\n    </div>\n'},13:function(n){var a=this.lambda,e=this.escapeExpression;return'    <div>\n      <label>监测地址<!--{en}Monitoring address--></label>\n      <span class="result-monitorLink">\n        '+e(a(n,n))+'\n        <span data-method="copy-link" class="icon-copy" data-clipboard-text="'+e(a(n,n))+'"></span>\n      </span>\n    </div>\n'},15:function(n,a,e,t){var s;return"      <p>"+this.escapeExpression((s=null!=(s=a.tip||(null!=n?n.tip:n))?s:a.helperMissing,"function"==typeof s?s.call(n,{name:"tip",hash:{},data:t}):s))+"</p>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,e,t){var s,l,i,o=a.helperMissing,r="function",d=this.escapeExpression,c=a.blockHelperMissing,p='<div class="panel-bd form-content '+d((l=null!=(l=a.type||(null!=n?n.type:n))?l:o,typeof l===r?l.call(n,{name:"type",hash:{},data:t}):l))+'">\n  <div class="icon"><span class="success"><span class="icon-selected"></span></div>\n  <div class="first-tip">您的推广链接创建完成！<!--{en}Your promotional links are created!--></div>\n  <div class="second-tip">总计上传 <span>'+d((l=null!=(l=a.length||(null!=n?n.length:n))?l:o,typeof l===r?l.call(n,{name:"length",hash:{},data:t}):l))+"</span> 条链接"+(null!=(s=a["if"].call(n,null!=n?n.repeatLenght:n,{name:"if",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t}))?s:"")+(null!=(s=a["if"].call(n,null!=n?n.failed:n,{name:"if",hash:{},fn:this.program(3,t,0),inverse:this.noop,data:t}))?s:"")+'\n    <a class="batch-copy" data-method="copy-link" data-clipboard-target=".batch-copy-result">批量复制<!--{en}Bulk copy--></a>\n  </div>\n  <div class="create-content">\n';return l=null!=(l=a.linkName||(null!=n?n.linkName:n))?l:o,i={name:"linkName",hash:{},fn:this.program(5,t,0),inverse:this.noop,data:t},s=typeof l===r?l.call(n,i):l,a.linkName||(s=c.call(n,s,i)),null!=s&&(p+=s),l=null!=(l=a.link||(null!=n?n.link:n))?l:o,i={name:"link",hash:{},fn:this.program(7,t,0),inverse:this.noop,data:t},s=typeof l===r?l.call(n,i):l,a.link||(s=c.call(n,s,i)),null!=s&&(p+=s),l=null!=(l=a.shortLink||(null!=n?n.shortLink:n))?l:o,i={name:"shortLink",hash:{},fn:this.program(9,t,0),inverse:this.noop,data:t},s=typeof l===r?l.call(n,i):l,a.shortLink||(s=c.call(n,s,i)),null!=s&&(p+=s),l=null!=(l=a.downloadLink||(null!=n?n.downloadLink:n))?l:o,i={name:"downloadLink",hash:{},fn:this.program(11,t,0),inverse:this.noop,data:t},s=typeof l===r?l.call(n,i):l,a.downloadLink||(s=c.call(n,s,i)),null!=s&&(p+=s),l=null!=(l=a.monitorLink||(null!=n?n.monitorLink:n))?l:o,i={name:"monitorLink",hash:{},fn:this.program(13,t,0),inverse:this.noop,data:t},s=typeof l===r?l.call(n,i):l,a.monitorLink||(s=c.call(n,s,i)),null!=s&&(p+=s),p+='    <div class="instructions">\n      <p>使用说明<!--{en}Instructions--></p>\n',l=null!=(l=a.instructions||(null!=n?n.instructions:n))?l:o,i={name:"instructions",hash:{},fn:this.program(15,t,0),inverse:this.noop,data:t},s=typeof l===r?l.call(n,i):l,a.instructions||(s=c.call(n,s,i)),null!=s&&(p+=s),p+'      <a target="channelDocument" href="'+d((l=null!=(l=a.documentName||(null!=n?n.documentName:n))?l:o,typeof l===r?l.call(n,{name:"documentName",hash:{},data:t}):l))+'"><span class="icon-help"></span><span>查看详细对接文档<!--{en}View detailed docking files--></span></a>\n    </div>\n  </div>\n  <div class="batch-create-content">\n    <div><a>'+d((l=null!=(l=a.filename||(null!=n?n.filename:n))?l:o,typeof l===r?l.call(n,{name:"filename",hash:{},data:t}):l))+'</a></div>\n    <a class="download web-template" href="'+d((l=null!=(l=a.fileAddress||(null!=n?n.fileAddress:n))?l:o,typeof l===r?l.call(n,{name:"fileAddress",hash:{},data:t}):l))+'" download="'+d((l=null!=(l=a.filename||(null!=n?n.filename:n))?l:o,typeof l===r?l.call(n,{name:"filename",hash:{},data:t}):l))+'"><span class="icon-download"></span><span>下载文件<!--{en}Download the file--></span></a>\n  </div>\n  <div class="batch-copy-result"></div>\n  <div class="common-table online-batch-create-content"></div>\n</div>\n<div class="panel-ft clearfix">\n  <button class="btn btn-primary pull-right" data-method="cancel">完成<!--{en}Complete--></button>\n</div>'},useData:!0}),batchCopyTpl:Handlebars.template({1:function(n,a,e,t){var s;return"<p>"+(null!=(s=a["if"].call(n,null!=n?n.error_msg:n,{name:"if",hash:{},fn:this.program(2,t,0),inverse:this.program(4,t,0),data:t}))?s:"")+"</p>\n"},2:function(n,a,e,t){var s;return"错误信息："+this.escapeExpression((s=null!=(s=a.error_msg||(null!=n?n.error_msg:n))?s:a.helperMissing,"function"==typeof s?s.call(n,{name:"error_msg",hash:{},data:t}):s))},4:function(n,a,e,t){var s,l,i=a.helperMissing,o="function",r=this.escapeExpression;return r((l=null!=(l=a.name||(null!=n?n.name:n))?l:i,typeof l===o?l.call(n,{name:"name",hash:{},data:t}):l))+"，"+(null!=(s=a["if"].call(n,null!=n?n.app_address:n,{name:"if",hash:{},fn:this.program(5,t,0),inverse:this.noop,data:t}))?s:"")+(null!=(s=a["if"].call(n,null!=n?n.whole_url:n,{name:"if",hash:{},fn:this.program(7,t,0),inverse:this.noop,data:t}))?s:"")+(null!=(s=a["if"].call(n,null!=n?n.target_url:n,{name:"if",hash:{},fn:this.program(9,t,0),inverse:this.noop,data:t}))?s:"")+"，"+r((l=null!=(l=a.short_url||(null!=n?n.short_url:n))?l:i,typeof l===o?l.call(n,{name:"short_url",hash:{},data:t}):l))},5:function(n,a,e,t){var s;return this.escapeExpression((s=null!=(s=a.app_address||(null!=n?n.app_address:n))?s:a.helperMissing,"function"==typeof s?s.call(n,{name:"app_address",hash:{},data:t}):s))},7:function(n,a,e,t){var s;return this.escapeExpression((s=null!=(s=a.whole_url||(null!=n?n.whole_url:n))?s:a.helperMissing,"function"==typeof s?s.call(n,{name:"whole_url",hash:{},data:t}):s))},9:function(n,a,e,t){var s;return this.escapeExpression((s=null!=(s=a.target_url||(null!=n?n.target_url:n))?s:a.helperMissing,"function"==typeof s?s.call(n,{name:"target_url",hash:{},data:t}):s))},compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,e,t){var s;return null!=(s=a.blockHelperMissing.call(n,this.lambda(n,n),{name:".",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t}))?s:""},useData:!0}),tdTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,e,t){var s,l=a.helperMissing,i="function",o=this.escapeExpression;return"<span>"+o((s=null!=(s=a.data||(null!=n?n.data:n))?s:l,typeof s===i?s.call(n,{name:"data",hash:{},data:t}):s))+'</span>\n<span data-method="copy-link" class="icon-copy" data-clipboard-text="'+o((s=null!=(s=a.data||(null!=n?n.data:n))?s:l,typeof s===i?s.call(n,{name:"data",hash:{},data:t}):s))+'"></span>'},useData:!0})},i={table:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<table class="display nowrap" width="100%">\n  <thead>\n  </thead>\n  <tbody>\n  </tbody>\n</table>\n'},useData:!0}),header:Handlebars.template({1:function(n){return'  <th class="sortable"><span>'+this.escapeExpression(this.lambda(n,n))+'</span><span class="icon_selector"></span></th>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,e,t){var s;return"<tr>\n"+(null!=(s=a.each.call(n,null!=n?n.header:n,{name:"each",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t}))?s:"")+"</tr>\n"},useData:!0}),body:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return""},useData:!0})},o={web_normal:[{tip:"1. "+sensorsdata.languages.get("创建生成渠道推广链接和短链接<!--{todo}-->")},{tip:"2. "+sensorsdata.languages.get("您可以使用该推广链接或短链进行推广<!--{todo}-->")},{tip:"3. "+sensorsdata.languages.get("用户通过推广链接或短链进入后，可以在神策平台进行数据的监控<!--{todo}-->")}],app_normal:[{tip:"1. "+sensorsdata.languages.get("创建生成渠道监测地址和短链接<!--{todo}-->")},{tip:"2. "+sensorsdata.languages.get("您可以使用该监测地址或短链进行推广<!--{todo}-->")},{tip:"3. "+sensorsdata.languages.get("用户通过监测地址或短链进入后，可以在神策平台进行数据的监控<!--{todo}-->")}],mina_normal:[{tip:"1. "+sensorsdata.languages.get("创建生成渠道推广链接和短链接<!--{todo}-->")},{tip:"2. "+sensorsdata.languages.get("您可以使用该推广链接或短链进行推广<!--{todo}-->")},{tip:"3. "+sensorsdata.languages.get("用户通过推广链接或短链进入后，可以在神策平台进行数据的监控<!--{todo}-->")}],imp_track:[{tip:"1. "+sensorsdata.languages.get("创建生成应用下载链接和监测地址<!--{todo}-->")},{tip:"2. "+sensorsdata.languages.get("进入 InMobi 配置页面<!--{todo}-->")},{tip:"3. "+sensorsdata.languages.get("创建广告，并配置应用下载地址和监测地址<!--{todo}-->")},{tip:"4. "+sensorsdata.languages.get("提交配置，通知神策运维<!--{todo}-->")},{tip:"5. "+sensorsdata.languages.get("联调成功后，可以开始推广，在神策后台进行数据的监控<!--{todo}-->")}]},r=[{tip:"1. "+sensorsdata.languages.get("创建生成应用下载链接和监测地址<!--{todo}-->")},{tip:"2. "+sensorsdata.languages.get("进入对应的渠道商配置页面<!--{todo}-->")},{tip:"3. "+sensorsdata.languages.get("根据渠道商的要求，填写对应的 iOS 或 Android 监测地址，下载地址等信息<!--{todo}-->")},{tip:"4. "+sensorsdata.languages.get("进行联调，并联调成功后，可以开始推广，可以再神策平台进行数据的监控<!--{todo}-->")}];e.prototype=$.extend({},sensorsdata.EventsModule,{init:function(){var n=this.options.data,a=n.name;n.instructions=o[a]||r,this.$container.html(l.buildSuccessPageTpl(n)),"onlineBatchCreate"===n.type&&this.renderTable(n.urlList),this.initEvents()},renderTable:function(n){this.$container.find(".batch-copy-result").html(l.batchCopyTpl(n));var a={container:this.$container.find(".online-batch-create-content"),tpl:i,dataTableOption:{language:{info:"共 _TOTAL_ 行，当前展示 _START_ - _END_ 行",infoEmpty:""},ordering:!1,iDisplayLength:8,columns:[{targets:0,data:"name"},{targets:1,data:"target_url",render:function(n,a,e){var t=e.app_address||e.whole_url||e.target_url;return t?l.tdTpl({data:t}):e.error_msg?"错误信息："+e.error_msg:""}},{targets:2,data:"short_url",render:function(n){return n?l.tdTpl({data:n}):""}}],columnDefs:[{targets:"_all",render:function(n){return n?n:""}}]},data:{header:{header:[sensorsdata.languages.get("名称<!--{todo}-->"),sensorsdata.languages.get("完整链接<!--{todo}-->"),sensorsdata.languages.get("短链<!--{todo}-->")]},body:n}};this.basicTableInstance=s.create(a)},initEvents:function(){var n=this,a=this.$container;a.delegate("[data-method]","click",function(a){a.preventDefault();var e=a.$target=$(this);n.handler(e.attr("data-method"),a)}),a.delegate(".link-name","keydown",function(n){var e=$(this),t=Number(n.keyCode);return 13===t?(e.blur(),!1):27===t?(e.text(e.attr("data-originname")),a.find(".icon-edit").show(),e.attr("contenteditable",!1),!1):void 0}),a.delegate(".link-name","blur",function(){var e=$(this),s=e.text().trim();if(a.find(".icon-edit").show(),e.attr("contenteditable",!1),!s)return e.text(e.attr("data-originname")),sensorsdata.info.show({content:sensorsdata.languages.get("请输入链接名称<!--{en}Please input the link name-->"),duration:2e3});if(s!==e.attr("data-originname")){e.attr("data-originname",s);var l={name:s};t.setLinkName(n.options.data.id,l,function(){sensorsdata.success.show({content:"更改成功<!--{todo}-->",duration:2e3})})}})},handler:function(n,a){var e=a.$target;switch(n){case"cancel":this.trigger("cancel",{refresh:!0});break;case"copy-link":var t='.build-short-link-success [data-method="copy-link"]',s=new Clipboard(t,{container:$(".table-container")[0]});s.on("success",function(n){$(n.trigger).tooltip({container:".build-short-link-success",placement:"bottom",title:sensorsdata.languages.get("复制成功！<!--{en}Copy successful!-->"),trigger:"hover"}).tooltip("show")}),$(t).unbind("mouseleave.copy").bind("mouseleave.copy",function(){$(this).tooltip("destroy")});break;case"edit-link-name":e.hide();var l=e.prev(".link-name");if(l.attr("contenteditable",!0),!l.length)return;if(l[0].focus(),l.scrollLeft(9999),window.getSelection){var i=window.getSelection();i.selectAllChildren(l[0]),i.collapseToEnd()}}},getParams:function(){},destroy:function(){this.$container.empty()}}),a.create=function(n){return new e(n)}});
;/*!components/channel/shortLinkAnalysisForm/shortLinkAnalysisForm.js*/
define("components/channel/shortLinkAnalysisForm/shortLinkAnalysisForm",function(n,a){function t(n){this.options=n,this.$container=n.container,this.init()}var e=n("components/model/channel"),s=n("components/basicTable/basicTable"),i={shortLinkAnalysisFormTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="panel-bd form-content">\n  <div class="short-link-analysis-form">\n    <h4>输入渠道信息<!--{en}Input channel information--></h4>\n    <div>\n      <textarea class="textarea" rows="5" cols="21" placeholder="输入短链"></textarea>\n      <div>\n        <p>直接输入原始链接地址<!--{en}Enter the original link address directly.--></p>\n        <p>例如：<!--{en}For example:--></p>\n        <p>https://edudemo.datasink.sensorsdata.cn/r/ko</p>\n        <p>https://edudemo.datasink.sensorsdata.cn/r/to</p>\n        <p>https://edudemo.datasink.sensorsdata.cn/r/Qo</p>\n        <p>或：<!--{en}or:--></p>\n        <p>ko</p>\n        <p>to</p>\n        <p>Qo</p>\n      </div>\n    </div>\n    <button data-method="analysis" class="btn btn-primary">解析<!--{en}analysis--></button>\n    <div class="analysis-success">\n      <h4><span class="success"><span class="icon-selected"></span></span>您的短链解析完成！<!--{en}<span class="success"><span class="icon-selected"></span></span>Your short link analysis is complete!--></h4>\n      <div class="common-table table-container"></div>\n    </div>\n  </div>\n</div>\n\n'},useData:!0}),tdTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,t,e){var s,i=a.helperMissing,o="function",r=this.escapeExpression;return"<span>"+r((s=null!=(s=a.data||(null!=n?n.data:n))?s:i,typeof s===o?s.call(n,{name:"data",hash:{},data:e}):s))+'</span>\n<span data-method="copy-link" class="icon-copy" data-clipboard-text="'+r((s=null!=(s=a.data||(null!=n?n.data:n))?s:i,typeof s===o?s.call(n,{name:"data",hash:{},data:e}):s))+'"></span>'},useData:!0})},o={table:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<table class="display nowrap" width="100%">\n  <thead>\n  </thead>\n  <tbody>\n  </tbody>\n</table>\n'},useData:!0}),header:Handlebars.template({1:function(n){return'  <th class="sortable"><span>'+this.escapeExpression(this.lambda(n,n))+'</span><span class="icon_selector"></span></th>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,t,e){var s;return"<tr>\n"+(null!=(s=a.each.call(n,null!=n?n.header:n,{name:"each",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?s:"")+"</tr>\n"},useData:!0}),body:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return""},useData:!0})};t.prototype=$.extend({},sensorsdata.EventsModule,{init:function(){this.$container.html(i.shortLinkAnalysisFormTpl()),this.initEvents(),sensorsdata.languages.update()},initEvents:function(){var n=this;this.$container.delegate("[data-method]","click",function(a){a.preventDefault();var t=a.$target=$(this);n.handler(t.attr("data-method"),a)})},handler:function(n){var a=this;switch(n){case"analysis":var t=a.getParams();if($.isEmptyObject(t))return sensorsdata.info.show("请输入合法的短链");e.queryShortUrl(t,function(n){var t=[];for(var e in n)t.push(n[e]);var r={container:a.$container.find(".table-container"),tpl:o,dataTableOption:{language:{info:"共 _TOTAL_ 行，当前展示 _START_ - _END_ 行",infoEmpty:""},paging:!1,ordering:!1,columns:[{targets:0,data:"short_url"},{targets:1,data:"target_url",render:function(n,a,t){return n?(n=t.properties?n+t.properties:n,i.tdTpl({data:n})):""}}],columnDefs:[{targets:"_all",render:function(n){return n?i.tdTpl({data:n}):""}}]},data:{header:{header:["短链","长链"]},body:t}};a.basicTableInstance=s.create(r),a.$container.find(".analysis-success").show()});break;case"copy-link":var r='.analysis-success [data-method="copy-link"]',l=new Clipboard(r,{container:$(".table-container")[0]});l.on("success",function(n){$(n.trigger).tooltip({container:".analysis-success",placement:"bottom",title:sensorsdata.languages.get("复制成功！<!--{en}Copy successful!-->"),trigger:"hover"}).tooltip("show")}),$(r).unbind("mouseleave.copy").bind("mouseleave.copy",function(){$(this).tooltip("destroy")})}},getParams:function(){for(var n=this.$container.find(".textarea").val(),a=n.split("\n").length,t=[],e=0;a>e;e++){var s="";if(""!==n.split("\n")[e])if(-1===n.split("\n")[e].indexOf("http"))s=n.split("\n")[e].split("?")[0],t.push(s);else{var i=n.split("\n")[e].match(/\/[tr]\/([^\/]+$)/);i&&i[1]&&(s=i[1].split("?")[0],t.push(s))}}return t},destroy:function(){this.$container.empty()}}),a.create=function(n){return new t(n)}});
;/*!components/channel/showLinkDetail/showLinkDetail.js*/
define("components/channel/showLinkDetail/showLinkDetail",function(n,a){function e(n){if(!n.ele)throw new Error("无效的触发元素");this.options=n,this.show(),sensorsdata.languages.update()}var l={template:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover popover-link-detail" role="tooltip">\n  <div class="arrow"></div>\n  <h3 class="popover-title"></h3>\n  <div class="popover-content">\n  </div>\n  <div class="popover-content-footer" style="display: none;"></div>\n</div>'},useData:!0}),content:Handlebars.template({1:function(n,a,e,l){var o,t=a.helperMissing,s="function",i=this.escapeExpression;return'<div>\n  <label>应用地址<!--{en}Application address--></label>\n  <span>\n    <span class="app-address">'+i((o=null!=(o=a.app_address||(null!=n?n.app_address:n))?o:t,typeof o===s?o.call(n,{name:"app_address",hash:{},data:l}):o))+'</span>\n    <span data-method="copy-link" class="icon-copy" data-clipboard-text="'+i((o=null!=(o=a.app_address||(null!=n?n.app_address:n))?o:t,typeof o===s?o.call(n,{name:"app_address",hash:{},data:l}):o))+'"></span>\n  </span>\n</div>\n'},3:function(n,a,e,l){var o,t=a.helperMissing,s="function",i=this.escapeExpression;return"<div>\n  <label>"+i((o=null!=(o=a.whole_url_name||(null!=n?n.whole_url_name:n))?o:t,typeof o===s?o.call(n,{name:"whole_url_name",hash:{},data:l}):o))+'</label>\n  <span>\n    <span class="whole-url">'+i((o=null!=(o=a.whole_url||(null!=n?n.whole_url:n))?o:t,typeof o===s?o.call(n,{name:"whole_url",hash:{},data:l}):o))+'</span>\n    <span data-method="copy-link" class="icon-copy" data-clipboard-text="'+i((o=null!=(o=a.whole_url||(null!=n?n.whole_url:n))?o:t,typeof o===s?o.call(n,{name:"whole_url",hash:{},data:l}):o))+'"></span>\n  </span>\n</div>\n'},5:function(n,a,e,l){var o,t=a.helperMissing,s="function",i=this.escapeExpression;return'<div>\n  <label>短链<!--{en}Short link--></label>\n  <span>\n    <span class="short-url">'+i((o=null!=(o=a.short_url||(null!=n?n.short_url:n))?o:t,typeof o===s?o.call(n,{name:"short_url",hash:{},data:l}):o))+'</span>\n    <span data-method="copy-link" class="icon-copy" data-clipboard-text="'+i((o=null!=(o=a.short_url||(null!=n?n.short_url:n))?o:t,typeof o===s?o.call(n,{name:"short_url",hash:{},data:l}):o))+'"></span>\n  </span>\n</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,e,l){var o,t;return(null!=(o=a["if"].call(n,null!=n?n.app_address:n,{name:"if",hash:{},fn:this.program(1,l,0),inverse:this.noop,data:l}))?o:"")+(null!=(o=a["if"].call(n,null!=n?n.whole_url:n,{name:"if",hash:{},fn:this.program(3,l,0),inverse:this.noop,data:l}))?o:"")+(null!=(o=a["if"].call(n,null!=n?n.short_url:n,{name:"if",hash:{},fn:this.program(5,l,0),inverse:this.noop,data:l}))?o:"")+'<div>\n  <a target="channelDocument" href="'+this.escapeExpression((t=null!=(t=a.doc||(null!=n?n.doc:n))?t:a.helperMissing,"function"==typeof t?t.call(n,{name:"doc",hash:{},data:l}):t))+'"><span class="icon-help"></span>查看对接文档<!--{en}<span class="icon-help"></span>View docking documents--></a>\n</div>'},useData:!0})};e.prototype=$.extend(!0,{},sensorsdata.EventsModule,{show:function(){var n=this.options,a=n.data,e=n.channelSupportedList.filter(function(n){return n.name===a.channel_name});$.isEmptyObject(e)&&console.log(e);var o=e[0]?e[0].cname:"";a.doc=sensorsdata.CONSTSET.channelDocument+o;var t=e[0]?e[0].name:"";a.whole_url_name="web_normal"===t||"mina_normal"===t?"推广地址":"监测地址",sensorsdata.popover({ele:n.ele,container:"body",placement:"bottom",showNow:!0,template:l.template(),content:l.content(a),title:"链接",onShow:function(n){n.$tip.find('[data-method="copy-link"]').unbind("click").bind("click",function(){var n='.popover-link-detail [data-method="copy-link"]',a=new Clipboard(n,{container:$(".table-container")[0]});a.on("success",function(n){$(n.trigger).tooltip({container:".popover-link-detail",placement:"bottom",title:sensorsdata.languages.get("复制成功！<!--{en}Copy successful!-->"),trigger:"hover"}).tooltip("show")}),$(n).unbind("mouseleave.copy").bind("mouseleave.copy",function(){$(this).tooltip("destroy")})})}})},hide:function(){this.options.ele.popover("hide")},destroy:function(){var n=this.options.ele;n.data("bs.popover")&&n.popover("destroy")}}),a.create=function(n){return new e(n)}});
;/*!components/chartDataFactory/addiction/preprocessor.js*/
define("components/chartDataFactory/addiction/preprocessor",function(e,a,t){t.exports={process:function(e,a){this.addTheadToData(e),a(e)},addTheadToData:function(e){var a=e.queryParams,t=a.measure_type,n=a.measure||{},r=this.buildUnit(a),s=[function(e,a){return $.isNumeric(e)&&$.isNumeric(a)?a-e!==1||$.isEmptyObject(n)||"uniqCount"===n.aggregator?e+r+"~"+a+r+sensorsdata.languages.get("(不含<!--{en}(exclude-->")+a+r+")":e+r:void 0},function(e){return $.isNumeric(e)?"period"===t?sensorsdata.languages.get("至少<!--{en}at least-->")+e+r:e+r+sensorsdata.languages.get("以上(含<!--{en}Above(include-->")+e+r+")":void 0},function(e,a){return $.isNumeric(a)?a+r+sensorsdata.languages.get("以下(不含<!--{en}the following(exclude-->")+r+")":void 0}],u=s.length;e.data.unit=r,e.data.thead=e.data.rows[0].cells.map(function(e){for(var a=0;u>a;a++){var t=s[a](e.bucket_start,e.bucket_end);if(t)return t}})},buildUnit:function(e){for(var a=[function(){if("period"===e.measure_type){var a={day:sensorsdata.languages.get("小时<!--{en}Hour-->"),week:sensorsdata.languages.get("天<!--{en}Day-->"),month:sensorsdata.languages.get("天<!--{en}Day-->")};return a[e.unit]}},function(){if(!$.isEmptyObject(e.measure)){var a=e.measure,t=sensorsdata.CONSTSET.measureFunctions;if(a.field&&!t[a.aggregator].unit){var n=a.field.split("."),r=sensorsdata.cache.eventPropertiesMap[n[n.length-1]];return r.unit||""}return t[a.aggregator].unit}},function(){return sensorsdata.languages.get("次<!--{en}Times-->")}],t=0,n=a.length;n>t;t++){var r=a[t]();if(r||""===r)return r}}}});
;/*!components/chartDataFactory/addiction/column.js*/
define("components/chartDataFactory/addiction/column",function(t,a,e){e.exports={process:function(t,a){a($.extend(!0,{},sensorsdata.echarts.option,{dataZoom:{show:!1},tooltip:{trigger:"axis",formatter:function(t){return t=t[0],t.name+"<br>总体："+t.value+"%"}},grid:{bottom:0,left:10},legend:{show:!1},xAxis:{data:t.data.thead,axisLabel:{textStyle:{color:"#8492A6"}}},yAxis:{splitNumber:3,axisLabel:{formatter:function(t){return sensorsdata.formatNumber(t,!0)+"%"},textStyle:{color:"#8492A6"}}},series:[{type:"bar",barGap:"10%",barMaxWidth:"40%",data:t.data.rows[0].cells.map(function(t){return t.percent})}]}))}}});
;/*!components/chartDataFactory/addiction/addiction.js*/
define("components/chartDataFactory/addiction/addiction",function(o,t){var a=o("components/chartDataFactory/addiction/preprocessor"),c={column:o("components/chartDataFactory/addiction/column")};t.reportToCharts=function(o,t){return o.data&&o.data.rows&&o.data.rows.length?void a.process(o,function(o){c.column.process(o,t)}):void t()}});
;/*!components/model/compareReport.js*/
define("components/model/compareReport",function(e,o,a){var r=e("components/dataCache/dataCache").create,t=r(),s={showCommonError:!0,showLoader:!1},n=$.extend(!0,{},sensorsdata.EventsModule,{get:function(e,o,a){if($.isFunction(o)&&(a=o,o=null),"function"!=typeof a)throw new Error("model/compareReport: get 方法的 callback 参数不能为空，且必须为 function 类型");if($.isArray(e.measures)&&e.measures.length>1||$.isArray(e.by_fields)&&e.by_fields.length>0)return a({});e.compare_from_date&&delete e.compare_from_date,e.compare_to_date&&delete e.compare_to_date,$.isArray(e.measures)&&e.measures.length>0&&e.measures.map(function(e){e.event_name===sensorsdata.CONSTSET.sessionGeneral.name&&(e.event_name=sensorsdata.CONSTSET.eventEmptyValue)});var r=t.get(JSON.stringify(e));if(r)a($.extend(!0,{},r));else{var n=$.extend({},!0,e);n.detail_and_rollup=!0;var d=sensorsdata.api.get("compareReport",{bookmarkid:o});sensorsdata.reportAjax({queueEnable:!1,queueKey:"POST-"+d,url:d,method:"POST",data:n,showLoader:s.showLoader,showCommonError:s.showCommonError,success:sensorsdata.bind(function(e){a($.extend(!0,{},e))},this)})}}});a.exports=n});
;/*!components/chartDataFactory/segmentation/preprocessor.js*/
define("components/chartDataFactory/segmentation/preprocessor",function(r,e,t){var a=r("components/util/util"),n=r("components/model/compareReport");t.exports={getCompareDate:function(r,e){n.get(r.queryParams,r.bookmarkid,function(r){e(r)})},process:function(r,e){var t=this,n=r.data,o=r.queryParams,s=n,u={};$.isArray(n)&&(s=n[0],u=n[1]);var i={result:s.detail_result,rollupResult:s.rollup_result,compareResult:u.detail_result,rollupCompareResult:u.rollup_result};for(var l in i)i[l]=$.isEmptyObject(i[l])?null:this.buildResult(o,i[l]);a.measuresToText(o,function(a){o.measures=a,e(t.filtrator({compareDate:s.compareDate,queryParams:o,data:i,config:r.config,filter:r.filter}))})},buildResult:function(r,e){var t=r.bucket_params||{};for(var n in t){var o=n.split(".");3===o.length&&(o[1]="$Anything",t[o.join(".")]=t[n])}var s=e.by_fields||[],u=s.map(function(r){var e=r.split("."),t=e[e.length-1];return a.getProperty("name",t)||{}});return{series:e.series,rows:e.rows.map(function(r){var e=[];return r.by_values.forEach(function(r,n){var o=a.formatByValue(r,u[n].data_type,sensorsdata.CONSTSET.unknownByValueText,t[s[n]],sensorsdata.CONSTSET.emptyStringByValueText);e.push(o)}),{data:r.values,name:e.join("，"),by_values:e}})}},filtrator:function(r){if(!r.config)return r;var e,t=r.config.measureIndexs;if($.isArray(t)&&t.length){for(e in r.data)if(r.data.hasOwnProperty(e)&&r.data[e]){var a=r.data[e];a.rows.forEach(function(r){r.data=r.data.map(function(r){return r.filter(function(r,e){return t.indexOf(e)>-1})})})}r.queryParams.measures=r.queryParams.measures.filter(function(r,e){return t.indexOf(e)>-1})}return r}}});
;/*!components/chartDataFactory/segmentation/pie.js*/
define("components/chartDataFactory/segmentation/pie",function(e,t,a){var r=e("components/config/chart"),n=e("components/util/echartsTooltipFormatter");a.exports={process:function(e,t){var a=e.queryParams,r=e.data,n=e.config,o=a.measures,s=n&&n.byFields;r={result:this.buildSeriesData(r.rollupResult,o.length,s),compareResult:$.isEmptyObject(r.rollupCompareResult)?null:this.buildSeriesData(r.rollupCompareResult,o.length,s)};var u=a.from_date+"至"+a.to_date;if(r.label=[u],r.result=this.buildItemPie(r.result,o),r.compareResult){r.compareResult=this.buildItemPie(r.compareResult,o);var l=a.compare_from_date+"至"+a.compare_to_date;r.label.push(l)}t(r)},buildSeriesData:function(e,t,a){var r=[],n=e.rows,o=[];$.isArray(a)&&0===a.length&&(a=e.rows.slice(0,10).map(function(e){return e.name})),$.isArray(a)&&1===a.length&&"saAll"===a[0]&&(a=e.rows.map(function(e){return e.name})),$.isArray(a)&&(n=[],e.rows.forEach(function(e){-1!==a.indexOf(e.name)?n.push(e):o.push(e)}));for(var s=0;t>s;s++){var u=n.map(function(e){return{label:{},name:sensorsdata.trimConstHtml(e.name),value:e.data[0][s]}});if(o.length){var l=0;o.map(function(e){l+=e.data[0][s]}),u.push({label:{},name:sensorsdata.languages.get("其它...<!--{en}Others...-->"),value:Math.round(100*l)/100})}u.sort(function(e,t){return t.value-e.value}),r.push(u)}return this.addItemConfigToData(r),r},addItemConfigToData:function(e){var t=sensorsdata.CONSTSET.chartsColors;e.forEach(function(e){e.forEach(function(e,a){e.itemStyle={normal:{color:t[a]}}})})},buildItemPie:function(e,t){var a=[],o=r.get("tooltip");return o.formatter=function(e){var t=e.seriesName+"<br/>"+e.data.name+"："+sensorsdata.formatNumber(e.data.value)+"，占 "+e.percent+"%";return t},e.forEach(function(e,s){a.push({tooltip:o,series:[$.extend(!0,{type:"pie",name:t[s].text.join(sensorsdata.languages.get("的<!--{en}.-->")),label:{normal:{color:"#475669",formatter:function(e){return n.truncateLabel(e.name,10)+"\n"+e.percent+"%"}}},data:e},r.get("pie"))]})}),a}}});
;/*!components/chartDataFactory/segmentation/column.js*/
define("components/chartDataFactory/segmentation/column",function(a,e,t){var r=a("components/util/findMinMax"),n=a("components/util/filterRows"),o=a("components/util/buildYAxis"),s=a("components/util/findColor"),i=a("components/util/normalize"),m=a("components/util/util").checkPercent,l=function(a,e){var t=sensorsdata.echarts,l={measureIndexs:[],byFields:[]},u=!1;$.extend(!0,l,a.config),l.size=l.size||"normal";var d=l.byFields.length,c="mini"!==l.size&&"small"!==l.size,f=a.queryParams,p=a.data.result,h=a.data.compareResult,x=f.measures,v=l.measureIndexs,g=l.byFields,y=$.extend(!0,{left:[],right:[],isNormalize:!1},f.axis_config),b=l.widgetModel,w=[],A=[],S=f.unit,C="rollup"===l.unit,N=!$.isEmptyObject(h)&&$.isArray(h.series)&&h.series.length>0&&$.isArray(h.rows)&&h.rows.length>0,M=f.measures.length>1,T=(f.by_fields||[]).length>0,F={},V=sensorsdata.formatTime(f.from_date,S,!0,!0),z=sensorsdata.formatTime(f.to_date,S,!0,!0),I="",L="",_=!0;x.map(function(a){m(a.measure)||(_=!1)}),C&&(p=a.data.rollupResult,h=a.data.rollupCompareResult),N&&(I=sensorsdata.formatTime(f.compare_from_date,S,!0,!0),L=sensorsdata.formatTime(f.compare_to_date,S,!0,!0)),x.map(function(a){var e=a.text.join("的");w.push(e)});for(var j=[],O=0;O<x.length;O++)j.push(x[O]),A.push(w[O]);$.isArray(g)&&0===g.length&&p.rows.length>0&&p.rows.map(function(a){g.push(a.name)}),g=$.isArray(g)&&g.length>0?$.extend(!0,[],g):w.length>1?[w.join("，")]:w;var U=y.isNormalize,W=sensorsdata.CONSTSET,k=p.series,E=N?h.series:[],H=d?n(g,p.rows):p.rows.slice(0,10),R={type:"scroll",pageTextStyle:{color:"#8492A6"},pageIconColor:"#C0CCDA",pageIconInactiveColor:"#EFF2F7",textStyle:{color:"#8492A6",fontWeight:300},show:c,data:H.map(function(a){var e=sensorsdata.trimConstHtml(a.name);return T&&(e=sensorsdata.trimConstHtml(M?a.name:a.name)),{name:e}})};T||1===x.length?T||(R.formatter=function(){return A.join("、")}):(R.formatter=function(){return sensorsdata.languages.get("从左至右依次是<!--{en}From left to right-->")+A.join("、")},R.itemWidth=0);var G=[];if(N){for(var P=null,D=null,q=0;q<k.length||q<E.length;q++){var Y=moment(k[q],W.timeFormat),Z=moment(E[q],W.timeFormat);Y.isValid()||(Y=P.add(1,S)),Z.isValid()||(Z=D.add(1,S)),G.push(sensorsdata.formatTime([Y,Z],S,!1,!1)),P=Y,D=Z}C&&(G=[V+"到"+z+"/"+I+"到"+L])}else G=k.map(function(a){return sensorsdata.formatTime(moment(a,W.timeFormat),S,!1,!1)}),C&&(G=[V+"到"+z]);var B=[],J=[];if(N){var K=n(g,h.rows);x.map(function(a,e){var t=0;-1!==y.right.indexOf(v[e])&&(t=1);var n=x[e].text.join("的"),l=x[e].unit||"";m(x[e].measure)&&(l="%");var d=o({widgetModel:b,scale:!0,isNormalize:U});_&&(d.axisLabel={formatter:function(a){return a+"%"},textStyle:{color:"#8492A6"}}),B.push(d);var c=k.map(function(a,t){var r=0;return H.map(function(a){r+=a.data[t][e]}),r}),f=E.map(function(a,t){var r=0;return K.map(function(a){r+=a.data[t][e]}),r}),p=U?r(H,e):[],h=U?r(K,e):[];H.map(function(a,r){var o=sensorsdata.trimConstHtml(a.name),m=s(F,a.name);J.push({name:o,type:"bar",barGap:"10%",barMaxWidth:"40%",yAxisIndex:U?0:t,itemStyle:{normal:{color:m}},stack:n,data:a.data.map(function(a,t){var r=a[e];if(U){var o=i(c[t],p);r=Math.round(o*r/c[t]*100)/100}var s=sensorsdata.formatTime(k[t],S,!1);return C&&(s=V+"到"+z),u=!0,{value:r,rawValue:a[e],itemStyle:{normal:{color:m}},measureName:n,measureUnit:l,xLabel:s,totalValue:c[t]}})}),J.push({name:o,type:"bar",barGap:"10%",barMaxWidth:"40%",yAxisIndex:U?0:t,stack:n+"-compare",itemStyle:{normal:{opacity:.6,color:m}},data:K[r].data.map(function(a,t){var r=a[e];if(U){var o=i(f[t],h);r=Math.round(o*r/f[t]*100)/100}var s=sensorsdata.formatTime(E[t],S,!1);return C&&(s=I+"到"+L),u=!0,{value:r,rawValue:a[e],itemStyle:{normal:{color:m}},measureName:n,measureUnit:l,xLabel:s,totalValue:f[t]}})})})})}else x.map(function(a,e){var t=0;-1!==y.right.indexOf(v[e])&&(t=1);var n=x[e].text.join("的"),l=x[e].unit||"";m(x[e].measure)&&(l="%");var d=$.extend(!0,{},o({widgetModel:b,scale:!1,isNormalize:U}),{show:c,splitNumber:4});_&&(d.axisLabel={formatter:function(a){return a+"%"},textStyle:{color:"#8492A6"}}),B.push(d);var f=k.map(function(a,t){var r=0;return H.map(function(a){r+=a.data[t][e]}),r}),p=U?r(H,e):[];H.map(function(a){var r=sensorsdata.trimConstHtml(a.name),o=s(F,a.name);J.push({name:r,type:"bar",yAxisIndex:U?0:t,barGap:"10%",barMaxWidth:"40%",itemStyle:{normal:{color:o}},stack:n,data:a.data.map(function(a,t){var r=a[e];if(U){var s=i(f[t],p);r=Math.round(s*r/f[t]*100)/100}var m=sensorsdata.formatTime(k[t],S,!0);return C&&(m=V+"到"+z),u=!0,{value:r,rawValue:a[e],itemStyle:{normal:{color:o}},measureName:n,measureUnit:l,rawMeasureUnit:l,xLabel:m,totalValue:f[t]}})})})});var Q={show:!1},X={confine:!0,formatter:function(a){$.isArray(a)&&(a=a[0]);var e=a.data.xLabel;return T&&(e+="："+a.seriesName),e+="</br>"+a.data.measureName+"："+sensorsdata.formatNumber(a.data.rawValue)+" "+a.data.measureUnit,T&&(e+="</br>总数："+sensorsdata.formatNumber(a.data.totalValue)+" "+a.data.measureUnit),e}};b&&(X.trigger="axis",X.axisPointer={lineStyle:{width:1,color:"#aaa"}},X.formatter=function(){return""},X.backgroundColor="rgba(50,50,50,0)",X.borderWidth=0);var ae={tooltip:X,legend:R,dataZoom:Q,xAxis:{data:G,show:c,axisLabel:{textStyle:{color:"#8492A6"}}},series:J};if(ae.grid={bottom:25,left:10},ae=$.extend(!0,{},t.option,ae),U)B=B.slice(0,1);else{var ee=!1,te=!1;v.forEach(function(a){-1!==y.left.indexOf(a)&&(ee=!0),-1!==y.right.indexOf(a)&&(te=!0)}),ee&&te?(B=B.slice(0,2),B[1].splitLine.show=!1):!ee&&te?(B=B.slice(-1),B[0].position="right",ae.series.forEach(function(a){a.yAxisIndex=0})):B=B.slice(0,1)}ae.yAxis=B,u||(ae={}),e(ae)};t.exports={process:l}});
;/*!components/chartDataFactory/segmentation/line.js*/
define("components/chartDataFactory/segmentation/line",function(e,a,t){var r=e("components/util/findMinMax"),o=e("components/util/filterRows"),s=e("components/util/buildYAxis"),i=e("components/util/findColor"),n=e("components/util/normalize"),l=e("components/util/util").checkPercent,m=function(e,a){if(!e.data||$.isEmptyObject(e.data))throw new Error("无效的分析模型数据");if(!e.data.result||$.isEmptyObject(e.data.result))throw new Error("无效的查询结果");var t=!1,m={},d={},u=e.config||{};u.size=u.size||"normal";var c="mini"!==u.size&&"small"!==u.size,f=e.data,p=e.queryParams,h="rollup"===u.unit;if($.isEmptyObject(p))throw new Error("无效的查询参数");if(!p.unit)throw new Error("无效的时间单位");var y=f.result||{};if($.isEmptyObject(y))throw new Error("无效的空数据");var x=f.compareResult||{};u.byFields=$.isArray(u.byFields)?$.extend(!0,[],u.byFields):[];var b=$.isArray(u.measureIndexs)?$.extend(!0,[],u.measureIndexs):p.measures.map(function(e,a){return a}),v=sensorsdata.CONSTSET,g=sensorsdata.echarts,w=y.series,S=x.series,A=u.byFields&&u.byFields.length?o(u.byFields,y.rows):y.rows.slice(0,10),L=[],C=p.unit,E=!!u.widgetMode,F=!$.isEmptyObject(x)&&$.isArray(x.series)&&x.series.length>0&&$.isArray(x.rows)&&x.rows.length>0,I=sensorsdata.formatTime(p.from_date,C,!0,!0),T=sensorsdata.formatTime(p.to_date,C,!0,!0),N="",z="",O=!0;if(p.measures.map(function(e){l(e.measure)||(O=!1)}),h&&(y=e.data.rollupResult,x=e.data.rollupCompareResult),F&&(N=sensorsdata.formatTime(p.compare_from_date,C,!0,!0),z=sensorsdata.formatTime(p.compare_to_date,C,!0,!0)),F){for(var _=null,j=null,V=0;V<w.length||V<S.length;V++){var U=moment(w[V],v.timeFormat),R=moment(S[V],v.timeFormat);U.isValid()||(U=_.add(1,C)),R.isValid()||(R=j.add(1,C)),L.push(sensorsdata.formatTime([U,R],C,!1,!1)),_=U,j=R}h&&(L=[I+"到"+T+"/"+N+"到"+z])}else L=w.map(function(e){return sensorsdata.formatTime(moment(e,v.timeFormat),C,!1,!1)}),h&&(L=[I+"到"+T]);var k={type:"scroll",pageTextStyle:{color:"#8492A6"},pageIconColor:"#C0CCDA",pageIconInactiveColor:"#EFF2F7",textStyle:{color:"#8492A6",fontWeight:300},show:c,data:[],bottom:0},H=[],M=E&&L.length<=10||!E&&L.length<=20,P=["solid","dashed","dotted"],D=[],W=4.8,q=1.4,B=p.measures.length>1,G=(p.by_fields||[]).length>0,Y=$.extend(!0,{right:[],left:[],type:"single"},p.axis_config),Z=!!Y.isNormalize;if(F){var J=o(u.byFields,x.rows);p.measures.map(function(e,a){var o=0;-1!==Y.right.indexOf(b[a])&&(o=1,Y.type="double");var m=P[a],u=e.text.join("的"),c=e.unit||"";l(e.measure)&&(c="%");var f=s({scale:!0,isNormalize:Z});O&&(f.axisLabel={formatter:function(e){return e+"%"},textStyle:{color:"#8492A6"}}),H.push(f);var p=Z?r(A,a):[],y=Z?r(J,a):[],x=function(e,a){var t=e.toLowerCase(),r=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(t&&r.test(t)){if(4===t.length){for(var o="#",s=1;4>s;s+=1)o+=t.slice(s,s+1).concat(t.slice(s,s+1));t=o}for(var i=[],n=1;7>n;n+=2)i.push(parseInt("0x"+t.slice(n,n+2)));return"RGBA("+i.join(",")+","+a+")"}return t};A.map(function(e,r){var s=i(d,e.name),l=x(s,.4),f="";f=G?B?sensorsdata.trimConstHtml(e.name)+"-"+u:sensorsdata.trimConstHtml(e.name):u,k.data.push({name:f,icon:g.createLineLegendIcon(m,s)}),D.push({name:f,type:"line",yAxisIndex:Z?0:o,showAllSymbol:M,symbol:"circle",symbolSize:W,itemStyle:{normal:{color:s}},lineStyle:{normal:{type:m,color:s,width:q}},data:e.data.map(function(e,r){var o=Z?n(e[a],p):e[a],i=sensorsdata.formatTime(w[r],C,!0);return h&&(i=I+"到"+T),t=!0,{value:o,rawValue:e[a],itemStyle:{normal:{color:s}},measureName:u,measureUnit:c,xLabel:i}})}),D.push({name:f,type:"line",yAxisIndex:Z?0:o,showAllSymbol:M,symbol:"circle",symbolSize:W,itemStyle:{normal:{color:l}},lineStyle:{normal:{type:m,color:l,width:q}},data:J[r].data.map(function(e,r){var o=Z?n(e[a],y):e[a],s=sensorsdata.formatTime(S[r],C,!0);return h&&(s=N+"到"+z),t=!0,{value:o,rawValue:e[a],itemStyle:{normal:{color:l}},measureName:u,measureUnit:c,xLabel:s}})});var b={};D.forEach(function(e){e.name in b||(b[e.name]=[]),b[e.name].push(e)});for(var v in b){var A=b[v][0],L=b[v][1];if(A.data.length<L.data.length)for(var $=0,E=L.data.length;E>$;$++){var F=A.data[0];A.data.push({value:void 0,rawValue:void 0,itemStyle:F.itemStyle,measureName:F.measureName,measureUnit:F.measureUnit,xLabel:F.xLabel})}}})})}else p.measures.map(function(e,a){var o=0;-1!==Y.right.indexOf(b[a])&&(o=1,Y.type="double");var m=P[a],u=e.text.join("的"),f=e.unit||"";l(e.measure)&&(f="%");var p=$.extend(!0,{},s({scale:!0,isNormalize:Z}),{show:c,splitNumber:4});O&&(p.axisLabel={formatter:function(e){return e+"%"},textStyle:{color:"#8492A6"}}),H.push(p);var y=Y.isNormalize?r(A,a):[];A.map(function(e){var r=i(d,e.name),s="";s=G?B?sensorsdata.trimConstHtml(e.name)+"-"+u:sensorsdata.trimConstHtml(e.name):u,k.data.push({name:s,icon:g.createLineLegendIcon(m,r)}),D.push({name:s,type:"line",yAxisIndex:Z?0:o,showAllSymbol:M,symbol:"circle",symbolSize:W,itemStyle:{normal:{color:r}},lineStyle:{normal:{type:m,color:r,width:q}},data:e.data.map(function(e,o){var s=Z?n(e[a],y):e[a],i=sensorsdata.formatTime(w[o],C,!0);return h&&(i=I+"到"+T),t=!0,{value:s,itemStyle:{normal:{color:r}},rawValue:e[a],measureName:u,measureUnit:f,xLabel:i}})})})});var K={show:!1},Q={trigger:"axis",axisPointer:{lineStyle:{color:"#C0CCDA"}}};if(!(p.by_fields&&p.by_fields.length>=1&&p.measures&&1===p.measures.length||F)){var X=function(e){var a=["solid","dashed","dotted"];return'<div style="display: inline-block; width: 12px; height: 10px; margin-right: 3px; background: url('+g.createLineLegendIcon(a[e.seriesIndex],e.color).split("//")[1].toString()+');"></div>'+Mustache.escape(g.truncateLabel(e.seriesName,50))+"："+sensorsdata.formatNumber(e.data.rawValue)+" "+e.data.measureUnit};Q.formatter=function(e){var a=[],t="";if($.isArray(e))for(var r=0,o=e.length;o>r;r++)e[r]&&e[r].data&&(t||(t=e[r].data.xLabel),a.push(X(e[r])));else t=e&&e.data?e.data.xLabel:"",a=[X(e)];return a.unshift(t),sensorsdata.echarts.wrapTriangleTooltip(a.join("<br/>"))}}if(E&&(Q.axisPointer={lineStyle:{width:1,color:"#aaa"}},Q.formatter=function(){return""},Q.backgroundColor="rgba(50,50,50,0)",Q.borderWidth=0,delete Q.position),m={tooltip:Q,legend:k,dataZoom:K,xAxis:{data:L,show:c,axisLabel:{textStyle:{color:"#8492A6"}}},series:D,grid:{bottom:25}},m=$.extend(!0,{},g.option,m),Z)H=H.slice(0,1);else{var ea=!1,aa=!1;b.forEach(function(e){-1!==Y.left.indexOf(e)&&(ea=!0),-1!==Y.right.indexOf(e)&&(aa=!0)}),ea&&aa?(H=H.slice(0,2),H[1].splitLine.show=!1):!ea&&aa?(H=H.slice(-1),H[0].position="right",m.series.forEach(function(e){e.yAxisIndex=0})):H=H.slice(0,1)}m.yAxis=H,t||(m={}),$.isFunction(a)&&a(m)};t.exports={process:m}});
;/*!components/chartDataFactory/segmentation/stack.js*/
define("components/chartDataFactory/segmentation/stack",function(e,t,o){var a=e("components/util/filterRows"),r=e("components/util/buildYAxis"),n=e("components/util/findColor"),s=e("components/util/float").addNumber,i=e("components/util/util").checkPercent,l=e("components/config/chart"),m=function(e,t){if(!e.data||$.isEmptyObject(e.data))throw new Error("无效的分析模型数据");var o=!1,m={},c=e.config||{};c.size=c.size||"normal";var u="mini"!==c.size&&"small"!==c.size,d=sensorsdata.echarts,p=sensorsdata.CONSTSET,y={},f=e.data,h=e.queryParams,x=c.byFields||[];if($.isEmptyObject(h))throw new Error("无效的查询参数");var b=f.result||{};if($.isEmptyObject(b))throw new Error("无效的空数据");var w=f.compareResult||{};if(!$.isEmptyObject(w))throw new Error("累积图不支持对比");c.byFields=$.isArray(c.byFields)?$.extend(!0,[],c.byFields):[];var g=$.isArray(c.measureIndexs)?$.extend(!0,[],c.measureIndexs):h.measures.map(function(e,t){return t});$.isArray(x)&&0===x.length&&b.rows.length>0&&b.rows.slice(0,10).map(function(e){x.push(e.name)});var v=(h.by_fields||[]).length>0,A=h.unit,S=b.series,E=a(x,b.rows),F=S.map(function(e){return sensorsdata.formatTime(moment(e,p.timeFormat),A,!1,!1)}),C=!!c.widgetMode,I={type:"scroll",pageTextStyle:{color:"#8492A6"},pageIconColor:"#C0CCDA",pageIconInactiveColor:"#EFF2F7",textStyle:{color:"#8492A6",fontWeight:300},show:!C&&u,data:[]},O=[],j=C&&F.length<=10||!C&&F.length<=30,z=4.8,L=[],T=!0;h.measures.map(function(e){i(e.measure)||(T=!1)}),h.measures.map(function(e,t){if(-1!==g.indexOf(t)){var a=e.text.join("的"),l=e.unit||"";i(e.measure)&&(l="%");var m=$.extend(!0,{},r(!0,!1),{show:u,splitNumber:4});T&&(m.axisLabel={formatter:function(e){return e+"%"},textStyle:{color:"#8492A6"}}),O.push(m),E.map(function(e){var r=v?sensorsdata.trimConstHtml(e.name):a,i=n(y,e.name);I.data.push({name:r,icon:d.createLineLegendIcon("solid",i)});var m=0;L.push({name:r,type:"line",showAllSymbol:j,symbol:"circle",symbolSize:z,stack:a,areaStyle:{normal:{opacity:.4}},itemStyle:{normal:{color:i}},lineStyle:{normal:{type:"solid",color:i}},data:e.data.map(function(e,r){var n=s(e[t],m);return m=n,o=!0,{value:n,rawValue:e[t],measureName:a,measureUnit:l,xLabel:sensorsdata.formatTime(S[r],A,!0)}})})})}});var N={show:!1},P=l.get("tooltip");P.trigger="axis",P.axisPointer={type:"line",label:{show:!1}},m={legend:I,dataZoom:N,xAxis:{boundaryGap:!0,data:F,show:u,axisLabel:{textStyle:{color:"#8492A6"}}},series:L,tooltip:P},m.tooltip.axisPointer={lineStyle:{width:1,color:"#aaa"}},m.grid={bottom:20,left:10},m=$.extend(!0,{},d.option,m),m.yAxis=O.slice(0,1),o||(m={}),$.isFunction(t)&&t(m)};o.exports={process:m}});
;/*!components/chartDataFactory/segmentation/table.js*/
define("components/chartDataFactory/segmentation/table",function(e,t,i){var n=e("components/util/fieldsToText"),r=function(e,t){var i=!1,r="1",h={},d=e.queryParams,p=d.measures||[],g=d.by_fields||[],f=d.session_name||"";s(e);var v=p.map(function(e){return e.measure});n({fields:g,measures:v,sessionName:f},function(n){e.queryParams.by_fields=n,1===p.length&&0===g.length?h=a(e):1===p.length&&g.length?h=u(e,i):p.length>1&&0===g.length?h=l(e):p.length>1&&g.length&&(h=o(e,i,r)),t(h)})},s=function(e){var t=e.data,i=e.config;if(t&&i){var n,r=i&&i.byFields;if($.isArray(r)&&1===r.length&&"saAll"===r[0])for(n in t)t.hasOwnProperty(n)&&t[n]&&t[n].rows&&(t[n].rows=t[n].rows);else if($.isArray(r)&&r.length){var s={};r.forEach(function(e){s[e]=!0});for(n in t)t.hasOwnProperty(n)&&t[n]&&t[n].rows&&(t[n].rows=t[n].rows.filter(function(e){return s[e.name]}))}else for(n in t)t.hasOwnProperty(n)&&t[n]&&t[n].rows&&(t[n].rows=t[n].rows.slice(0,10))}},a=function(e){var t=e.queryParams,i=t.measures||[],n=e.data.result,r=e.data.rollupResult,s=t.unit,a=e.config,u=e.filter||{},l="rollup"===a.unit,o=[],h=[],d={},p=!1;u.unit&&(l="rollup"===u.unit,s=u.unit);var g=[{value:"日期",index:0,sortDisplay:!0,sortType:"descend",dataIndex:0,textAlignRight:!1}];l?(o=r.rows,h=[t.from_date+" ~ "+t.to_date],g.push({value:"合计",textAlignRight:!1,dataIndex:"1"})):(d.series=[],o=n.rows,h=n.series,g.push({value:i[0].text.join("的"),index:1,sortDisplay:!0,dataIndex:1,textAlignRight:!1,showTitle:"minute"===s||"hour"===s})),d.head=g,d.series=n.series;var f=[],v={};return o.forEach(function(e,t){var n=e.data,r=[];n.forEach(function(e,n){var a=i[t]?i[t].unit:"";"%"===a&&(e+="%"),v=[],v.push(l?{value:h,textAlignRight:!1}:{value:h[n],textAlignRight:!1,unit:s}),v.push({value:e,textAlignRight:!1,unit:s}),r.push(v),p=!0}),f=r}),d.body=f,d.hideType=!0,d.timeSort=!0,p||(d={}),d},u=function(e){var t=e.queryParams,i=e.data.result,n=e.data.rollupResult,r=t.measures||[],s=t.by_fields||[],a=t.unit,u=e.config,l=e.filter||{},o="rollup"===u.unit,h=l.date||i.series[i.series.length-1],d=[0],p=[],g=[],f={},v=!1;l.unit&&(o="rollup"===l.unit,a=l.unit),o?(p=n.rows,g=n.series,d=[0]):(f.series=[],p=i.rows,g=i.series.reverse(),d=g.indexOf(h)<0?[g.length-1]:[g.indexOf(h)]),f.series=i.series;var c=[];s.map(function(e,t){var i={value:e.text,index:t,sortDisplay:!0,dataType:"string",textAlignRight:!1};c.push(i)}),o?c.push({value:"合计",index:s.length,sortDisplay:!0,sortType:"descend",dataType:"string",textAlignRight:!1}):g.forEach(function(e,t){var i={value:sensorsdata.formatTime(e,a,!0,!0,"</br>"),index:t+s.length,sortDisplay:!0,dataType:"number",textAlignRight:!1,showTitle:"minute"===a||"hour"===a};0===t&&(i.sortType="descend"),c.push(i)}),f.head=c;var y=[];return p.forEach(function(e){var t=e.data.reverse(),i=e.by_values,n=[];n.push(i.map(function(e){return{value:e,textAlignRight:!1}})),r.forEach(function(e,i){var r=[];t.forEach(function(t){var n=e&&"%"===e.unit?[t[i]]+"%":[t[i]];r.push({value:n,textAlignRight:!1,unit:e.unit})}),n=n[0].concat(r),v=!0}),y.push(n)}),f.body=y,f.hideDate=!0,f.hideType=!0,v||(f={}),f},l=function(e){var t=e.queryParams,i=e.data.result,n=e.data.rollupResult,r=t.measures||[],s=t.by_fields||[],a=t.unit,u=e.config,l=e.filter||{},o="rollup"===u.unit,h=[],d=[],p={},g=!1;l.unit&&(o="rollup"===l.unit,a=l.unit),o?(h=n.rows,d=n.series):(p.series=[],h=i.rows,d=i.series.reverse()),p.series=i.series;var f=[];f.push({value:"指标",index:s.length,sortDisplay:!0,dataType:"string",textAlignRight:!1}),o?f.push({value:"合计",index:s.length,sortDisplay:!0,dataType:"string",sortType:"descend",textAlignRight:!1}):d.forEach(function(e,t){var i={value:sensorsdata.formatTime(e,a,!0,!0,"</br>"),index:t+1,sortDisplay:!0,dataType:"number",textAlignRight:!1,showTitle:"minute"===a||"hour"===a};0===t&&(i.sortType="descend"),f.push(i)}),p.head=f;var v=[];return h.forEach(function(e){var t=e.data.reverse(),i=[];r.forEach(function(e,n){var r=[{value:e.text.join("的"),textAlignRight:!1,unit:e.unit}];t.forEach(function(t){var i=e&&"%"===e.unit?[t[n]]+"%":[t[n]];r.push({value:i,textAlignRight:!1,unit:e.unit})}),i.push(r),g=!0}),v=i}),p.body=v,p.hideDate=!0,p.hideType=!0,g||(p={}),p},o=function(e,t,i){if("1"===i)return h(e,t,i);var n=e.queryParams,r=e.data.result,s=e.data.rollupResult,a=n.measures||[],u=n.by_fields||[],l=n.unit,o=e.config,d=e.filter||{},p="rollup"===o.unit,g=d.date||r.series[r.series.length-1],f=[0],v=[],c=[],y={},x=!1;d.unit&&(p="rollup"===d.unit,l=d.unit),p?(v=s.rows,c=s.series,f=[0]):(y.series=[],v=r.rows,c=r.series.reverse(),f=c.indexOf(g)<0?[c.length-1]:[c.indexOf(g)]),y.series=r.series;var m=[];u.map(function(e,t){var i={};i={value:e.text,index:t,sortDisplay:!0,dataType:"string",textAlignRight:!1},m.push(i)}),m.push({value:"指标",index:u.length,sortDisplay:!0,dataType:"string",textAlignRight:!1}),p?m.push({value:"合计",index:u.length+1,sortDisplay:!0,dataType:"string",sortType:"descend",textAlignRight:!1}):c.forEach(function(e,t){var i={value:sensorsdata.formatTime(e,l,!0,!0,"</br>"),index:t+u.length+1,sortDisplay:!0,dataType:"number",textAlignRight:!1,showTitle:"minute"===l||"hour"===l};0===t&&(i.sortType="descend"),m.push(i)}),y.head=m;var T=[];return v.forEach(function(e){var t=e.data.reverse(),i=e.by_values,n=[];n=n.concat(i.map(function(e){return{value:e,textAlignRight:!1}})),a.forEach(function(e,i){var r=[{value:e.text.join("的"),textAlignRight:!1,unit:e.unit}];t.forEach(function(t){r.push({value:[t[i]],textAlignRight:!1,unit:e.unit})}),r=n.concat(r),x=!0,T.push(r)})}),y.body=T,y.displayType=i,y.hideType=!0,y.hideDate=!0,t&&(y.hideDate=!1),x||(y={}),y},h=function(e,t,i){var n=e.queryParams,r=e.data.result,s=e.data.rollupResult,a=n.measures||[],u=n.by_fields||[],l=n.unit,o=e.config,h=e.filter||{},d="rollup"===o.unit,p=h.date||r.series[r.series.length-1],g=[0],f=[],v=[],c={},y=!1;h.unit&&(d="rollup"===h.unit,l=h.unit),d?(f=s.rows,v=s.series,g=[0]):(c.series=[],f=r.rows,v=r.series,g=v.indexOf(p)<0?[v.length-1]:[v.indexOf(p)]),c.series=r.series;var x=[];t&&x.push({value:"日期"}),u.map(function(e,t){var i={value:e.text,index:t,sortDisplay:!0,dataType:"string",textAlignRight:!1};x.push(i)});var m=u.length>0;a.map(function(e,t){var i=x.length,n=e.text.join("的");e.unit&&(n+="("+e.unit+")");var r={value:n,index:i,sortDisplay:!0,dataType:"number",textAlignRight:m,showTitle:"minute"===l||"hour"===l};0===t&&(r.sortType="descend"),x.push(r)}),c.head=x;var T=[],R={};return g.map(function(e){f.map(function(i){var n=i.by_values,r=i.data[e],s=[];t&&s.push({value:sensorsdata.formatTime(v[e],l,!0,!0,"</br>")}),n.map(function(e){R={value:e,textAlignRight:!1},s.push(R)}),r.map(function(e,t){var i=a[t]?a[t].unit:"";"%"===i&&(e+="%"),R={value:e,textAlignRight:m,unit:i},s.push(R),y=!0}),T.push(s)})}),c.body=T,c.displayType=i,c.hideType=!0,c.hideDate=!1,y||(c={}),c};i.exports={process:r}});
;/*!components/chartDataFactory/segmentation/number.js*/
define("components/chartDataFactory/segmentation/number",function(t,a,e){var s=t("components/util/sensorsdataUtil"),r=t("components/util/util").checkPercent,m={getUnit:function(t,a){var e=s.getBeginDate(a).valueOf(),r=(new Date).valueOf(),m=new Date(t.replace(/-/g,"/")).valueOf(),o=m>=e&&r>=m,n=a,u="",Y="";switch(a){case"minute":n="最近一分钟",u=sensorsdata.formatTime(moment(m).subtract(1,"minute").format("YYYY-MM-DD HH:mm:ss"),a),Y=sensorsdata.formatTime(moment(m).subtract(1,"hours").format("YYYY-MM-DD HH:mm:ss"),a);break;case"hour":n="最近一小时",u=sensorsdata.formatTime(moment(m).subtract(1,"hours").format("YYYY-MM-DD HH:mm:ss"),a),Y=sensorsdata.formatTime(moment(m).subtract(1,"days").format("YYYY-MM-DD HH:mm:ss"),a);break;case"day":n="今日",u=sensorsdata.formatTime(moment(m).subtract(1,"days").format("YYYY-MM-DD"),a),Y=sensorsdata.formatTime(moment(m).subtract(1,"weeks").format("YYYY-MM-DD"),a);break;case"week":n="本周",u=sensorsdata.formatTime(moment(m).subtract(1,"weeks").format("YYYY-MM-DD"),a),Y=sensorsdata.formatTime(moment(m).subtract(1,"months").format("YYYY-MM-DD"),a);break;case"month":n="本月",u=sensorsdata.formatTime(moment(m).subtract(1,"months").format("YYYY-MM-DD"),a),Y=sensorsdata.formatTime(moment(m).subtract(1,"years").format("YYYY-MM-DD"),a)}o||(n=sensorsdata.formatTime(t,a,!0,!0));var i={unitName:n,MOMDate:u,YOYDate:Y};return i},formatNumberData:function(t,a){var e=m,s=t.queryParams;if($.isArray(s.measures)&&s.measures.length>1||$.isArray(s.by_fields)&&s.by_fields.length>0)return a({});var o=t.data.result,n=t.data.rollupResult,u=t.compareDate||{},Y="rollup"===t.config.unit,i=s.measures[0]||{},c=o.rows[0],f=c.data,D=f.length;if(0===D)return a({});var M=f[D-1][0],b=0,d=o.series[D-1],l=n.rows[0].data[0][0],h=i.unit||"";r(i.measure)&&(h="%"),f.map(function(t){b+=t[0]});var p=(b/D).toFixed(2),O=e.getUnit(d,s.unit),T=O.unitName,v=M,y=l,g="合计";Y?(g=T,T="合计",p=0,v=l,y=M):(v=M,y=l);var N=u.month_on_month||0,k=u.year_on_year||0,w=N?N+"%":"--",H=!0,_="增长",U=k?k+"%":"--",x="-"!==U.substr(0,1),A="增长";"-"===w.substr(0,1)&&(w=w.substr(1),H=!1,_="下降"),"-"===U.substr(0,1)&&(U=U.substr(1),x=!1,A="下降"),_="对比"+O.MOMDate+_+w,A="对比"+O.YOYDate+A+U,"-"===w&&(_=""),"-"===U&&(A=""),a({dashboradNumberData:{rollupDate:Y,unitName:T,mainNumber:v,secondName:g,secondNumber:y,measuresUnit:h,averageNumber:p,MOM:w,MOMIcon:H,MOMTip:_,YOY:U,YOYIcon:x,YOYTip:A}})}};e.exports={process:m.formatNumberData}});
;/*!components/chartDataFactory/segmentation/segmentation.js*/
define("components/chartDataFactory/segmentation/segmentation",function(t,a){var o=t("components/chartDataFactory/segmentation/preprocessor"),e={pie:t("components/chartDataFactory/segmentation/pie"),column:t("components/chartDataFactory/segmentation/column"),line:t("components/chartDataFactory/segmentation/line"),stack:t("components/chartDataFactory/segmentation/stack"),table:t("components/chartDataFactory/segmentation/table"),number:t("components/chartDataFactory/segmentation/number")};a.reportToCharts=function(t,a){if(t.chartsType||(t.chartsType="line"),!e[t.chartsType])throw new Error("components/chartDataFactory/segmentation: 不支持从事件分析数据到 "+t.chartsType+" 图表类型的数据转换");var r=!1;return $.isArray(t.data)&&t.data.map(function(t){t.rollup_result&&t.rollup_result.rows&&t.rollup_result.rows.length&&(r=!0)}),r||t.data&&t.data.rollup_result&&t.data.rollup_result.rows&&t.data.rollup_result.rows.length?void o.process(t,function(o){e[t.chartsType].process(o,a)}):void a()}});
;/*!components/chartDataFactory/funnel/preprocessor.js*/
define("components/chartDataFactory/funnel/preprocessor",function(e,s,n){n.exports={process:function(e,s){sensorsdata.ajax({url:sensorsdata.api.get("funnelProperties",{id:e.queryParams.funnel_id}),success:function(n){e.properties=n,s(e)}})}}});
;/*!components/chartDataFactory/funnel/steps.js*/
define("components/chartDataFactory/funnel/steps",function(e,t,n){n.exports={process:function(e,t){var n=e.data&&e.data.funnel_detail&&e.data.funnel_detail[0],o=e.properties.step_name;t({overview:{completionRate:-1===n.completion_rate?0:n.completion_rate,steps:n.overview[0].map(function(e,t){var r={eventName:o[t],convertedUser:-1===e.converted_user?0:e.converted_user};if(t>0){var a=n.steps[t-1].rows[0].median_converted_time;r.conversionRate=-1===e.conversion_rate?0:e.conversion_rate,r.completionRate=-1===e.completion_rate?0:e.completion_rate,r.medianTime=-1===a?0:a}return r})}})}}});
;/*!components/chartDataFactory/funnel/funnel.js*/
define("components/chartDataFactory/funnel/funnel",function(n,t){var e=n("components/chartDataFactory/funnel/preprocessor"),a={steps:n("components/chartDataFactory/funnel/steps")};t.reportToCharts=function(n,t){return n.data&&n.data.funnel_detail&&n.data.funnel_detail.length?void e.process(n,function(n){a.steps.process(n,t)}):void t()}});
;/*!components/chartDataFactory/retention/line.js*/
define("components/chartDataFactory/retention/line",function(e,n,a){var t=[{name:"1",value:1,cname:sensorsdata.languages.get("次天留存<!--{en}Retention the next day-->"),unit:"day",unitCname:sensorsdata.languages.get("天<!--{en}days-->"),isDay:!0},{name:"2",value:7,cname:sensorsdata.languages.get("7天留存<!--{en}Retention in 7 days -->"),unit:"day",unitCname:sensorsdata.languages.get("天<!--{en}days-->"),isDay:!0},{name:"3",value:14,cname:sensorsdata.languages.get("14天留存<!--{en}Retention in 14 days -->"),unit:"day",unitCname:sensorsdata.languages.get("天<!--{en}days-->"),isDay:!0},{name:"4",value:30,cname:sensorsdata.languages.get("30天留存<!--{en}Retention in 30 days -->"),unit:"day",unitCname:sensorsdata.languages.get("天<!--{en}days-->"),isDay:!0},{name:"5",value:1,cname:sensorsdata.languages.get("次周留存<!--{en}Retention the next week-->"),unit:"week",unitCname:sensorsdata.languages.get("周<!--{en}weeks-->"),isWeek:!0},{name:"6",value:8,cname:sensorsdata.languages.get("8周留存<!--{en}Retention in 8 weeks-->"),unit:"week",unitCname:sensorsdata.languages.get("周<!--{en}weeks-->"),isWeek:!0},{name:"7",value:12,cname:sensorsdata.languages.get("12周留存<!--{en}Retention in 12 weeks-->"),unit:"week",unitCname:sensorsdata.languages.get("周<!--{en}weeks-->"),isWeek:!0},{name:"8",value:24,cname:sensorsdata.languages.get("24周留存<!--{en}Retention in 24 weeks-->"),unit:"week",unitCname:sensorsdata.languages.get("周<!--{en}weeks-->"),isWeek:!0},{name:"9",value:1,cname:sensorsdata.languages.get("次月留存<!--{en}Retention the next month-->"),unit:"month",unitCname:sensorsdata.languages.get("月<!--{en}months-->"),isMonth:!0},{name:"10",value:6,cname:sensorsdata.languages.get("6个月留存<!--{en}Retention in 6 month-->"),unit:"month",unitCname:sensorsdata.languages.get("月<!--{en}months-->"),isMonth:!0},{name:"11",value:12,cname:sensorsdata.languages.get("12个月留存<!--{en}Retention in 12 month-->"),unit:"month",unitCname:sensorsdata.languages.get("月<!--{en}months-->"),isMonth:!0},{name:"12",value:24,cname:sensorsdata.languages.get("24个月留存<!--{en}Retention in 24 month-->"),unit:"month",unitCname:sensorsdata.languages.get("月<!--{en}months-->"),isMonth:!0}],s=function(e,n){var a=moment(e,sensorsdata.CONSTSET.timeFormat),t=sensorsdata.getBeginDate(n);return a.isValid()?t.diff(a,n)+1:0},o=function(e,n){if(!e||!n)return t[0];var a=t.filter(function(a){return a.value.toString()===e.toString()&&a.unit===n});return 1===a.length?a[0]:null};a.exports={process:function(e,n){var a=e.data.rows,t=e.queryParams,r=o(t.duration,t.unit),i=0;a=a.map(function(e){if(!t.by_field){var n=s(e.by_value,r.unit);i=r.value<n?r.value+1:n,e.cells.splice(i)}return e});var u=e.queryParams.is_wastage?1:0,l=a.map(function(e){return e.cells.length}).sort(function(e,n){return n-e})[0],g={day:"天",week:"周",month:"月"}[e.queryParams.unit];n($.extend(!0,{},sensorsdata.echarts.option,{dataZoom:{show:l>sensorsdata.echarts.sets.dataZoomNum,start:0,end:100},tooltip:{show:!0,trigger:"axis",axisPointer:{lineStyle:{color:"#C0CCDA"}},formatter:function(e){var n=[],a="",t=function(e){return e.seriesName+":"+e.data+"%"};if($.isArray(e))for(var s=0,o=e.length;o>s;s++)e[s]&&e[s].data&&(a||(a=e[s].axisValueLabel),n.push(t(e[s])));else a=e&&e.axisValueLabel?e.axisValueLabel:"",n=[t(e)];return n.unshift(a),sensorsdata.echarts.wrapTriangleTooltip(n.join("<br/>"))}},legend:{type:"scroll",pageTextStyle:{color:"#8492A6"},pageIconColor:"#C0CCDA",pageIconInactiveColor:"#EFF2F7",textStyle:{color:"#8492A6",fontWeight:300},selectedMode:!0,data:function(){var n=a.map(function(n){if(/^\d{4}-(\d{1,2}-\d{1,2})$/.test(n.by_value)){var a=moment(n.by_value);n.by_value=sensorsdata.formatTime(a,e.queryParams.unit)}else n.by_value=n.by_value?n.by_value+"":"[未知]";return n.by_value});return n}()},grid:{bottom:25,left:10},xAxis:{type:"category",data:function(){for(var e=[],n=u;l>n;n++)e.push("第"+n+g);return e}(),axisLabel:{textStyle:{color:"#8492A6"}}},yAxis:{axisLabel:{formatter:function(e){return e+"%"},textStyle:{color:"#8492A6"}}},series:function(){var e=[];return a.forEach(function(n){var a=n.cells;e.push({name:n.by_value,type:"line",smooth:!0,symbol:"circle",symbolSize:4.8,lineStyle:{normal:{width:1.4}},data:function(){for(var e=[],n=u;l>n;n++)a[n]&&(a[n].percent||0===a[n].percent)&&e.push(a[n].percent);return e}()})}),e}()}))}}});
;/*!components/chartDataFactory/retention/retention.js*/
define("components/chartDataFactory/retention/retention",function(t,n){var o={line:t("components/chartDataFactory/retention/line")};n.reportToCharts=function(t,n){return t.data&&t.data.rows&&t.data.rows.length?void o.line.process(t,n):void n()}});
;/*!components/chartDataFactory/userAnalytics/preprocessor.js*/
define("components/chartDataFactory/userAnalytics/preprocessor",function(e,s,r){var a=e("components/util/util");r.exports={process:function(e,s){sensorsdata.ajax({useCache:!0,url:sensorsdata.api.get("profile_prop"),success:function(r){e.userProperties=r;var t=$.extend(!0,{type:"userAnalytics"},e.queryParams);a.measuresToText(t,function(r){e.queryParams.measures=r,s(e)})}})}}});
;/*!components/chartDataFactory/userAnalytics/number.js*/
define("components/chartDataFactory/userAnalytics/number",function(a,e,r){r.exports={process:function(a,e){var r=a.data.rows[0].values[0][0],s=a.queryParams.measures[0].unit;e({result:r,unit:s})}}});
;/*!components/chartDataFactory/userAnalytics/pie.js*/
define("components/chartDataFactory/userAnalytics/pie",function(e,a,t){var r=e("components/config/chart"),n=e("components/util/echartsTooltipFormatter");t.exports={process:function(e,a){var t=e.queryParams,s=e.data,o=e.config||{},i="pie"===o.chartsType&&o.byFields?o.byFields:[],u={},l=r.get("tooltip");l.formatter=function(e){return e.seriesName+"</br>"+n.truncateLabel(e.data.name,50)+"："+e.value+sensorsdata.languages.get("占<!--{en}take-->")+e.percent+"%"},u.tooltip=l;var c=e.queryParams.measures[0].text.join("的"),f=this.converPieData(s,[{user:e.userProperties}],t.bucket_params,c);u.series=this.buildSeriesData(f,i),a({result:[u]})},addItemConfigToData:function(e){var a=sensorsdata.CONSTSET.chartsColors;e.forEach(function(e,t){e.itemStyle={normal:{color:a[t]}}})},converPieData:function(e,a,t,r){var n=this;if(!$.isEmptyObject(e)&&$.isArray(e.series)&&0!==e.series.length&&$.isArray(e.rows)&&0!==e.rows.length){var s={series:[],rows:[],num:e.num_rows,name:r},o=(e.by_fields||[]).length;return e.rows.map(sensorsdata.bind(function(i){o>0&&(r=n.buildPieByValueText(e.by_fields,i.by_values,a,t)),s.rows.push({name:r,data:i.values})},this)),s}},buildPieByValueText:function(e,a,t,r){r=r||{};for(var n=[],s=0,o=a.length;o>s;s++){var i=a[s],u=sensorsdata.findProperty(e[s],t)||{};i=sensorsdata.formatByValue(i,u.data_type,sensorsdata.CONSTSET.unknownByValueText,r[e[s]]),n.push(i)}return n.join("，")},buildSeriesData:function(e,a){var t=e.rows,r=e.name,s={radius:["35%","60%"],type:"pie",name:r,label:{normal:{color:"#000000",formatter:function(e){return n.truncateLabel(e.name,10)+"\n"+e.percent+"%"}}}},o=[],i=[];if($.isArray(a)&&a.length>0?(t=[],e.rows.forEach(function(e){-1!==a.indexOf(e.name)?t.push(e):i.push(e)})):$.isArray(a)&&(t=[],e.rows.forEach(function(e,a){10>a?t.push(e):i.push(e)})),t.map(function(e){o.push({name:e.name,value:e.data[0][0]})}),i.length){var u=0;i.map(function(e){u+=e.data[0][0]}),o.push({name:sensorsdata.languages.get("其它...<!--{en}Others...-->"),value:Math.round(100*u)/100})}return o.sort(function(e,a){return a.value-e.value}),this.addItemConfigToData(o),s.data=o,[s]}}});
;/*!components/chartDataFactory/userAnalytics/userAnalytics.js*/
define("components/chartDataFactory/userAnalytics/userAnalytics",function(t,r){var a=t("components/chartDataFactory/userAnalytics/preprocessor"),e={number:t("components/chartDataFactory/userAnalytics/number"),pie:t("components/chartDataFactory/userAnalytics/pie")};r.reportToCharts=function(t,r){return $.isEmptyObject(t.data.rows)||$.isEmptyObject(t.data.rows[0].values)?void r():void a.process(t,function(a){var s=$.isEmptyObject(t.queryParams.by_fields||[])?"number":"pie";e[s].process(a,r)})}});
;/*!components/chartDataFactory/utm/table.js*/
define("components/chartDataFactory/utm/table",function(e,a,t){var n={byValues:[]},r=function(e){var a=null===e?sensorsdata.CONSTSET.unknownByValueText:""===e?sensorsdata.languages.get("直接流量<!--{todo}-->"):e;return a},s=function(e,a){var t=e.filter;e.data=v(e);var r=u(e.data),s=o(e.data);t?(t.byValues=r.filter(function(e){return(t.byValues||[]).indexOf(e)>-1}),t.byValues=t.byValues.length>0?t.byValues:n.byValues):t=n;var c=i(t,e.data),d=l(c,e),f=p(c);$.isFunction(a)&&a({header:d,body:f,utmCatogery:s,utmSources:r})},o=function(e){var a=[];return $.isArray(e)&&(a=e.map(function(e){return e.category})),a},u=function(e){var a=[];return n.byValues=[],e[0]&&$.isArray(e[0].rows)&&e[0].rows.forEach(function(e){if($.isArray(e.by_values)&&e.by_values.length){var t=e.by_values[0];if("$ALL"===t)return;t=r(t),e.platform&&(t=t+"-"+e.platform),a.push(t),n.byValues.push(t)}}),a},l=function(e,a){var t=[sensorsdata.languages.get("名称<!--{todo}-->")],n=a.queryParams,r=[];return r.push({category:sensorsdata.languages.get("app"===n.utm_source?"APP 渠道<!--{todo}-->":"Web 渠道<!--{todo}-->"),colSpan:1}),e.forEach(function(e){var a=$.isArray(e.measure)?e.measure:[];r.push({category:e.category,colSpan:a.length}),t=t.concat(a)}),{category:r,header:c(t,n.utm_source)}},c=function(e,a){switch(e=e.map(function(e){return{text:e}}),a){case"app":var t=sensorsdata.cache.eventsMap.AppInstall.cname,n=sensorsdata.cache.eventsMap.$AppStart.cname,r=sensorsdata.cache.eventsMap.$AppEnd.cname,s=sensorsdata.cache.eventsMap.$AppViewScreen.cname,o=sensorsdata.cache.eventPropertiesMap.$is_first_day.cname,u=sensorsdata.cache.eventPropertiesMap.$event_duration.cname;e[1].tooltip=sensorsdata.util.format(sensorsdata.languages.get("#{event}事件的触发用户数<!--{todo}-->"),{event:t}),e[2].tooltip=sensorsdata.util.format(sensorsdata.languages.get("#{event}的人均触发次数，且属性#{prop}为真<!--{todo}-->"),{event:n,prop:o}),e[3].tooltip=sensorsdata.util.format(sensorsdata.languages.get("#{event}事件的#{prop}属性人均值<!--{todo}-->"),{event:r,prop:u}),e[4].tooltip=sensorsdata.util.format(sensorsdata.languages.get("第一天进行了#{event}，第二天也进行了#{event}的用户，且属性#{prop}为真的次日留存的平均值<!--{todo}-->"),{event:s,prop:o});break;case"web":var l=sensorsdata.cache.eventsMap.$pageview.cname,c=sensorsdata.cache.eventPropertiesMap.$is_first_day.cname;e[1].tooltip=sensorsdata.util.format(sensorsdata.languages.get("#{event}事件的触发用户数<!--{todo}-->"),{event:l}),e[2].tooltip=sensorsdata.util.format(sensorsdata.languages.get("#{event}事件的发生次数<!--{todo}-->"),{event:l}),e[3].tooltip=sensorsdata.util.format(sensorsdata.languages.get("#{event}事件的触发用户数，且属性#{prop}为真（该渠道新用户占比）<!--{todo}-->"),{event:l,prop:c}),e[4].tooltip=sensorsdata.util.format(sensorsdata.languages.get("#{event}事件的发生次数，且属性#{prop}为真（该渠道新用户占比）<!--{todo}-->"),{event:l,prop:c}),e[5].tooltip=sensorsdata.util.format(sensorsdata.languages.get("第一天进行了#{event}，第二天也进行了#{event}的用户，且属性#{prop}为真的次日留存的平均值<!--{todo}-->"),{event:l,prop:c})}return e},p=function(e){var a=[];return e.forEach(function(e){var t=e.rows||[];t.forEach(function(e,t){var n=[];if(a[t])a[t]=a[t].concat(e.values.map(function(e){return null===e?"-":e}));else{var s=r(e.by_values[0]);"$ALL"===s&&(s=sensorsdata.languages.get("总体<!--{en}$ALL-->")),e.platform&&(s=s+"-"+e.platform),n.push(s),n=n.concat((e.values||[]).map(function(e){return null===e?"-":e})),a.push(n)}})}),a},i=function(e,a){var t=e.byValues||[],n=e.category||[];a=a||[];var s=null;return s=n.length>0?a.filter(function(e){return n.indexOf(e.category)>-1}):a,s=s.map(function(e){return e.rows=e.rows.filter(function(e){var a=e.by_values[0];return a=r(a),e.platform&&(a=a+"-"+e.platform),0===t.length?"$ALL"===e.by_values[0]:t.indexOf(a||"")>-1||"$ALL"===e.by_values[0]}),e})},v=function(e){var a=$.extend(!0,{},e.queryParams),t=$.extend(!0,[],e.data);switch(a.utm_source){case"app":t=t.map(function(e,a){return e.rows=(e.rows||[]).map(function(e){return e.values=(e.values||[]).map(function(e,t){var n=null;return 1===a&&0===t&&(e+="%"),{value:e,percent:n}}),e}),e});break;case"web":t=t.map(function(e,a){return e.rows=(e.rows||[]).map(function(e){var t=$.extend(!0,[],e.values);return e.values=(e.values||[]).map(function(e,n){var r=null;return n>1&&0===a&&(r=0===t[n-2]?"-":(e/t[n-2]*100).toFixed(2)+"%"),0===n&&1===a&&(e+="%"),{value:e,percent:r}}),e}),e})}return t};t.exports={process:s}});
;/*!components/chartDataFactory/utm/utm.js*/
define("components/chartDataFactory/utm/utm",function(t,a){var o={table:t("components/chartDataFactory/utm/table")};a.reportToCharts=function(t,a){o.table.process(t,a)}});
;/*!components/chartDataFactory/chartDataFactory.js*/
define("components/chartDataFactory/chartDataFactory",function(t,c){var n={segmentation:t("components/chartDataFactory/segmentation/segmentation"),funnel:t("components/chartDataFactory/funnel/funnel"),retention:t("components/chartDataFactory/retention/retention"),addiction:t("components/chartDataFactory/addiction/addiction"),user_analytics:t("components/chartDataFactory/userAnalytics/userAnalytics"),utm:t("components/chartDataFactory/utm/utm")},r={checkOptions:function(t){var c=[{check:function(){return"object"===$.type(t)},msg:"必须是 Object 类型"},{check:function(){return t.reportType},msg:"内必须包含 reportType 字段指定数据的分析模型类型"},{check:function(){return n[t.reportType]},msg:"内 reportType 字段指定的分析模型类型不支持"},{check:function(){return"object"===$.type(t.queryParams)},msg:"内必须包含 queryParams 字段给到查询条件，且必须为 Object 类型"},{check:function(){return"object"===$.type(t.data)||$.isArray(t.data)},msg:"内必须包含 data 字段，且必须为 Object 类型或 Array 类型"}];c.forEach(function(t){if(!t.check())throw new Error("components/chartDataFactory: reportToCharts 方法的 options 参数"+t.msg)})},checkCallback:function(t){if(!$.isFunction(t))throw new Error("components/chartDataFactory: reportToCharts 方法的 callback 参数不能为空，且必须为 function 类型")}};c.reportToCharts=function(t,c){r.checkOptions(t),r.checkCallback(c),n[t.reportType].reportToCharts($.extend(!0,{},t),c)}});
;/*!components/charts/charts.js*/
define("components/charts/charts",function(t,e){function a(t,e,a){this.$container=t,this.options=e,this.chart=null,this.init(a)}var n=t("echarts3"),s=t("components/util/echartsTooltipFormatter");a.prototype=$.extend({},sensorsdata.EventsModule,{init:function(t){var e=n.init(this.$container[0]),a=this.options.data,i=null;$.isEmptyObject(a)||("line"===t&&(i=function(t){return t.data.xLabel?t.data.xLabel+"</br>"+Mustache.escape(s.truncateLabel(t.seriesName,50))+"："+sensorsdata.formatNumber(t.data.rawValue)+" "+t.data.measureUnit:t.seriesName+"："+t.data+"%"},this.options.tab_name&&"trend"===this.options.tab_name&&this.retentionTrendChart(a)),e.setOption(a),this.chart=e)},retentionTrendChart:function(t){for(var e=t.xAxis.data,a=t.legend.data,n=[],s=0,i=t.series.length;i>s;s++)for(var r=t.series[s],o=r.data,h=0,c=o.length;c>h;h++)if(n[h])n[h].data.push(o[h]);else{var d=$.extend(!0,{},r),u=$.extend(!0,d,{name:e[h]});u.data=[o[h]],n.push(u)}t.legend.data=e,t.xAxis.data=a,t.series=n},resize:function(){this.chart&&$.isFunction(this.chart.resize)&&this.chart.resize()},destroy:function(){n.dispose(this.$container[0])}}),e.chartManager=a});
;/*!components/charts/column/column.js*/
define("components/charts/column/column",function(n,c){var t=n("components/charts/charts").chartManager;c.create=function(n,c){return new t(n,c,"column")}});
;/*!components/charts/line/line.js*/
define("components/charts/line/line",function(n,e){var t=n("components/charts/charts").chartManager;e.create=function(n,e){return new t(n,e,"line")}});
;/*!components/keyLog/keyLog.js*/
define("components/keyLog/keyLog",function(e,n){var t=[],o=[],r=[16,17,18,91,93];$(window).on("keydown",function(e){var n=e.keyCode;if(r.indexOf(n)>-1)return o=o.filter(function(e){return e.keyCode!==n}),void o.push({keyCode:n,time:Date.now()});var i={keyCode:e.keyCode,key:e.key,time:Date.now()};o.length&&(i.functionKeys=$.extend(!0,[],o)),t.push(i),t.length>20&&t.shift()}),$(window).on("keyup",function(e){var n=e.keyCode;r.indexOf(n)>-1&&(o=o.filter(function(e){return e.keyCode!==n}))}),n.checkFunctionKey=function(e,n){if(e=e instanceof Array?e:[e],!o.length)return!1;var t,r,i=o.map(function(e){return e.keyCode});if("and"===n){for(t=0,r=e.length;r>t;t++)if(-1===i.indexOf(e[t]))return!1;return!0}for(t=0,r=e.length;r>t;t++)if(i.indexOf(e[t])>-1)return!0;return!1}});
;/*!components/dashboardTableMenuBar/dashboardTableMenuBar.js*/
define("components/dashboardTableMenuBar/dashboardTableMenuBar",function(a,t){function n(a,t){this.$container=a,this.options=t,this.series=this.options.data.series,this.meta=this.options.meta,this.init()}var e={dashboardTableMenuBarTpl:Handlebars.template({1:function(){return'style="display: none;"'},3:function(a,t,n,e){var i,s=t.helperMissing,l="function",o=this.escapeExpression;return'      <li><a data-value="'+o((i=null!=(i=t.date||(null!=a?a.date:a))?i:s,typeof i===l?i.call(a,{name:"date",hash:{},data:e}):i))+'">'+o((i=null!=(i=t.value||(null!=a?a.value:a))?i:s,typeof i===l?i.call(a,{name:"value",hash:{},data:e}):i))+"</a></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,t,n,e){var i,s,l,o=t.helperMissing,d="function",u='<div class="customer-table-menu">\n  <div class="dropdown type-menu" '+(null!=(i=t["if"].call(a,null!=a?a.hideType:a,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?i:"")+'>\n    <button type="button" class="dropdown-toggle" data-toggle="dropdown" data-value="">\n      <span class="selected" data-value="'+this.escapeExpression((s=null!=(s=t.displayType||(null!=a?a.displayType:a))?s:o,typeof s===d?s.call(a,{name:"displayType",hash:{},data:e}):s))+'"></span>\n      <span class="caret"></span>\n    </button>\n    <ul class="dropdown-menu" role="menu">\n      <li><a data-value="0">类型一</a></li>\n      <li><a data-value="1">类型二</a></li>\n    </ul>\n  </div>\n  <div class="dropdown date-menu" '+(null!=(i=t["if"].call(a,null!=a?a.hideDate:a,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?i:"")+'>\n    <button type="button" class="dropdown-toggle" data-toggle="dropdown" data-value="">\n      <span class="selected" data-value=\'\'></span>\n      <span class="caret"></span>\n    </button>\n    <ul class="dropdown-menu" role="menu">\n';return s=null!=(s=t.data||(null!=a?a.data:a))?s:o,l={name:"data",hash:{},fn:this.program(3,e,0),inverse:this.noop,data:e},i=typeof s===d?s.call(a,l):s,t.data||(i=t.blockHelperMissing.call(a,i,l)),null!=i&&(u+=i),u+'    </ul>\n  </div>\n\n  <div class="dropdown unit-menu">\n    <button type="button" class="dropdown-toggle" data-toggle="dropdown" data-value="">\n      <span class="selected" data-value=""></span>\n      <span class="caret"></span>\n    </button>\n    <ul class="dropdown-menu pull-right" role="menu">\n      <li><a data-value="rollup">合计<!--{en}Total--></a></li>\n      <li><a data-value="minute">分钟<!--{en}Minute--></a></li>\n      <li><a data-value="hour">小时<!--{en}Hour--></a></li>\n      <li><a data-value="day">天<!--{en}Day--></a></li>\n      <li><a data-value="week">周<!--{en}Week--></a></li>\n      <li><a data-value="month">月<!--{en}Month--></a></li>\n    </ul>\n  </div>\n</div>\n'},useData:!0})};n.prototype=$.extend({},sensorsdata.EventsModule,{init:function(){var a=this.series,t=this.options.meta.filter||{},n=this.options.bookmarkConfig,i=this.meta.queryParams,s=i.measures,l=i.by_fields||[],o=t.unit||n.unit||i.unit,d=a.indexOf(t.date)<0?a[a.length-1]:t.date,u=this.options.data.hideDate||!1,p=this.options.data.displayType||"0",r=this.options.data.hideType;this.date=d,this.unit=o,this.hideType=r,this.displayType=p;var h=a.map(function(a,t){return{index:t,date:a,value:sensorsdata.formatTime(a,o,!0,!0,"</br>")}});(1===s.length&&0===l.length||"rollup"===o)&&(u=!0),this.$container.html(e.dashboardTableMenuBarTpl({hideDate:u,displayType:this.displayType,hideType:this.hideType,data:h})),this.initEvent()},initEvent:function(){var a=this,t=this.$container;t.find(".date-menu button").saDropdown({value:a.date,onSelected:function(t){a.date=t,a.options.onSetFilter({id:a.meta.id,date:a.date})}}),t.find(".unit-menu button").saDropdown({value:a.unit,onSelected:function(n){this.unit=n,"rollup"===n&&t.find(".date-menu").hide(),a.options.onSetFilter({id:a.meta.id,unit:n})}}),t.find(".type-menu button").saDropdown({value:a.displayType,onSelected:function(t){a.displayType=t,a.options.onSetFilter({id:a.meta.id,displayType:t})}})},update:function(a){this.options=$.extend(!1,{},this.options,a),this.series=this.options.data.series,this.meta=this.options.meta,this.init()},destroy:function(){this.$container.empty()}}),t.create=function(a,t){return new n(a,t)}});
;/*!components/utmCustomMenu/utmCustomMenu.js*/
define("components/utmCustomMenu/utmCustomMenu",function(t,e){function n(t,e){this.$container=t,this.options=e,this.utmSources=this.options.data.utmSources||[],this.utmCatogery=this.options.data.utmCatogery||[],this.meta=this.options.meta,this.filter=this.options.meta.filter||{},this.init()}var i=t("lodash"),s={content:Handlebars.template({1:function(t){var e=this.lambda,n=this.escapeExpression;return'        <option value="'+n(e(t,t))+'">'+n(e(t,t))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var s;return'<div class="customer-utm-menu">\n  <div class="dropdown source-menu">\n    <select name="utm_source" multiple="multiple">\n'+(null!=(s=e.each.call(t,null!=t?t.utmSources:t,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?s:"")+"    </select>\n  </div>\n</div>\n"},useData:!0}),option:Handlebars.template({1:function(t){var e=this.lambda,n=this.escapeExpression;return'  <option value="'+n(e(t,t))+'">'+n(e(t,t))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var s;return null!=(s=e.each.call(t,t,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?s:""},useData:!0})};n.prototype=$.extend({},sensorsdata.EventsModule,{init:function(){this.$container.html(s.content({utmSources:this.utmSources,utmCatogery:this.utmCatogery})),this.$sourceSelect=this.$container.find('select[name="utm_source"]'),this.$catogerySelect=this.$container.find('select[name="utm_catogery"]'),this.initEvent()},initEvent:function(){var t=this,e=this.$container,n=this.filter.byValues||[],i=e.find('select[name="utm_source"]');i.html(s.option(this.utmSources)),i.multiselect("destroy").multiselect({includeSelectAllOption:!0,maxHeight:400,toggleClose:!1,buttonText:function(t){var e=i.find("option").length===t.length;return e?sensorsdata.languages.get("渠道名称（全部）<!--{en}Channel name (all)-->"):sensorsdata.util.format(sensorsdata.languages.get("渠道名称（#{length} 个）"),{length:t.length})},onChange:function(){t.filter.byValues=i.val()||[],t.filter.id=t.meta.id,$.isFunction(t.options.onSetFilter)&&t.options.onSetFilter(t.filter)}}),0===n.length?i.multiselect("selectAll",!1):i.multiselect("select",n),i.multiselect("updateButtonText")},update:function(t){this.options=i.extend(!0,{},this.options,t),this.meta=this.options.meta;var e=this.options.meta.filter||{};for(var n in e)e.hasOwnProperty(n)&&(this.filter[n]=e[n]);JSON.stringify(this.utmSources)!==JSON.stringify(this.options.data.utmSources||[])?(this.utmSources=this.options.data.utmSources||[],this.filter={},this.initEvent()):(this.$catogerySelect.multiselect("select",this.filter.category||[]),this.$catogerySelect.multiselect("updateButtonText"))}}),e.create=function(t,e){return new n(t,e)}});
;/*!components/widgetCustomMenuBar/widgetCustomMenuBar.js*/
define("components/widgetCustomMenuBar/widgetCustomMenuBar",function(t,n){function e(t){if(!t.container)throw new Error("无效的容器");if(!t.meta)throw new Error("无效的元信息");this.container=t.container,this.options=t,this.meta=t.meta,this.data=t.data,this.$instance=null,this.init(t)}var i=t("components/dashboardTableMenuBar/dashboardTableMenuBar"),a={utm:t("components/utmCustomMenu/utmCustomMenu")},s=t("lodash");e.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.initMenu()},initMenu:function(){var t=this,n=this.meta.bookmarkConfig,e=a[this.meta.type]||i;$.isEmptyObject(this.data)||(this.$instance=e.create(this.container,{data:$.extend(!0,{},this.data),meta:$.extend(!0,{},this.meta),bookmarkConfig:n,onSetFilter:function(n){$.isFunction(t.options.onMessage)&&t.options.onMessage({action:"filter",data:n})}}))},update:function(t){this.data=s.extend(!0,{},this.data,t.data),this.meta=s.extend(!0,{},this.meta,t.meta);var n=this.meta.bookmarkConfig;this.$instance&&$.isFunction(this.$instance.update)?this.$instance.update({data:$.extend(!0,{},this.data),meta:$.extend(!0,{},this.meta),bookmarkConfig:n}):this.initMenu()},destroy:function(){this.$instance&&$.isFunction(this.$instance.destroy)&&this.$instance.destroy()}}),n.create=function(t){return new e(t)}});
;/*!components/widgetSettingMenu/widgetSettingMenu.js*/
define("components/widgetSettingMenu/widgetSettingMenu",function(e,t){function n(e){if(!e.container)throw new Error("无效的容器");this.options=e,this.container=e.container,this.meta=e.meta,this.init()}var a={content:Handlebars.template({1:function(e,t,n,a){var s,i,o=t.helperMissing,r="function",l=this.escapeExpression;return'    <li data-value="'+l((i=null!=(i=t.name||(null!=e?e.name:e))?i:o,typeof i===r?i.call(e,{name:"name",hash:{},data:a}):i))+'" data-method="set-size"  class="'+(null!=(s=t["if"].call(e,null!=e?e.disabled:e,{name:"if",hash:{},fn:this.program(2,a,0),inverse:this.noop,data:a}))?s:"")+" "+(null!=(s=t["if"].call(e,null!=e?e.selected:e,{name:"if",hash:{},fn:this.program(4,a,0),inverse:this.noop,data:a}))?s:"")+'">\n      <a><span>'+l((i=null!=(i=t.cname||(null!=e?e.cname:e))?i:o,typeof i===r?i.call(e,{name:"cname",hash:{},data:a}):i))+'</span><span class="icon-finish"></span></a>\n    </li>\n'},2:function(){return"disabled"},4:function(){return"selected"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,a){var s;return'<span class="dropdown-toggle more-method icon-more" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"></span>\n<ul class="dropdown-menu">\n'+(null!=(s=t.each.call(e,null!=e?e.sizes:e,{name:"each",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?s:"")+'  <li role="separator" class="divider"></li>\n  <li data-method="set" class=""><a>设置<!--{en}Setting--></a></li>\n  <li data-method="del" class=""><a>删除<!--{en}Delete--></a></li>\n</ul>'},useData:!0}),del:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover">\n    <div class="arrow"></div>\n    <h2 class="popover-title"></h2>\n    <div class="popover-content">\n      <span>确认启用此埋点吗？<!--{en}Are you sure to activate this tracking?--></span>\n      <div class="remark">本操作将在 1 分钟后生效<!--{en}This operation will take effect in 1 minutes--></div>\n    </div>\n    <div class="popover-content-footer clearfix">\n      <div class="popover-footer-right">\n        <button type="button" class="pop-is-cancel btn-link">取消<!--{en}Cancel--></button>\n        <button type="button" class="pop-is-success btn btn-primary">确定<!--{en}Ok--></button>\n      </div>\n    </div>\n  </div>'},useData:!0})},s=e("lodash");n.prototype=$.extend(!0,{},sensorsdata.EventModule,{init:function(){this.render(),this.bindEvents()},render:function(){var e={sizes:$.extend(!0,[],this.meta.sizes)};this.container.html(a.content(e))},bindEvents:function(){var e=this;this.container.delegate("[data-method]","click.method",function(){var t=$(this);t.attr("data-method")||(t=t.parents("[data-method]:first"));var n=t.attr("data-method");switch(n){case"set-size":if(t.hasClass("disabled")||t.hasClass("selected"))return;t.siblings('[data-method="set-size"]').removeClass("selected"),t.addClass("selected"),$.isFunction(e.options.onMessage)&&e.options.onMessage({action:n,data:{size:t.attr("data-value")}});break;case"del":if(t.hasClass("disabled"))return;sensorsdata.popover({ele:e.container.find('.more-method[data-toggle="dropdown"]'),container:e.container.parent(),placement:"left",showNow:!0,trigger:"click",template:a.del(),content:sensorsdata.languages.get("确定删除吗?<!--{en}Are you sure to delete it?-->"),successAfter:function(){$.isFunction(e.options.onMessage)&&e.options.onMessage({action:n})}});break;case"set":if(t.hasClass("disabled"))return;$.isFunction(e.options.onMessage)&&e.options.onMessage({action:n})}})},update:function(e){var t=this;this.meta=$.extend(!0,{},this.meta,e);var n=this.meta.sizes.map(function(e){return e.selected=e.name===t.meta.currentSize,e});this.options=s.extend(this.options,{sizes:n}),this.render()}}),t.create=function(e){return new n(e)}});
;/*!components/widgetHeader/widgetHeader.js*/
define("components/widgetHeader/widgetHeader",function(t,e){function n(t){if(!t.container)throw new Error("无效的widget容器");if(!t.meta)throw new Error("无效的widget元数据信息");this.options=$.extend(!0,{},t),this.meta=t.meta,this.container=t.container,this.settingMenu=null,this.customMenuBar=null,this.isShareDash=!!t.isShareDash,this.chartsData=t.chartsData,this.init(t)}var a={content:Handlebars.template({1:function(t,e,n,a){var s,i=e.helperMissing,r="function",o=this.escapeExpression;return'  <div class="title nav">\n    <a href="'+o((s=null!=(s=e.url||(null!=t?t.url:t))?s:i,typeof s===r?s.call(t,{name:"url",hash:{},data:a}):s))+'" data-method="nav">'+o((s=null!=(s=e.name||(null!=t?t.name:t))?s:i,typeof s===r?s.call(t,{name:"name",hash:{},data:a}):s))+"</a>\n  </div>\n"},3:function(t,e,n,a){var s;return'  <div class="title">\n    <span>'+this.escapeExpression((s=null!=(s=e.name||(null!=t?t.name:t))?s:e.helperMissing,"function"==typeof s?s.call(t,{name:"name",hash:{},data:a}):s))+"</span>\n  </div>\n"},5:function(t,e,n,a){var s;return"<span>~</span>"+this.escapeExpression((s=null!=(s=e.to_date||(null!=t?t.to_date:t))?s:e.helperMissing,"function"==typeof s?s.call(t,{name:"to_date",hash:{},data:a}):s))},7:function(t,e,n,a){var s;return" | "+this.escapeExpression((s=null!=(s=e.rangeText||(null!=t?t.rangeText:t))?s:e.helperMissing,"function"==typeof s?s.call(t,{name:"rangeText",hash:{},data:a}):s))},9:function(t,e,n,a){var s;return"    <div "+(null!=(s=e["if"].call(t,null!=t?t.isShareDash:t,{name:"if",hash:{},fn:this.program(10,a,0),inverse:this.noop,data:a}))?s:"")+' class="retention-tab"></div>\n'},10:function(){return'isShareDash="true"'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i;return'<div class="widget-title">\n'+(null!=(s=e["if"].call(t,null!=t?t.supportNav:t,{name:"if",hash:{},fn:this.program(1,a,0),inverse:this.program(3,a,0),data:a}))?s:"")+'  <div class="range">'+this.escapeExpression((i=null!=(i=e.from_date||(null!=t?t.from_date:t))?i:e.helperMissing,"function"==typeof i?i.call(t,{name:"from_date",hash:{},data:a}):i))+(null!=(s=e["if"].call(t,null!=t?t.to_date:t,{name:"if",hash:{},fn:this.program(5,a,0),inverse:this.noop,data:a}))?s:"")+(null!=(s=e["if"].call(t,null!=t?t.rangeText:t,{name:"if",hash:{},fn:this.program(7,a,0),inverse:this.noop,data:a}))?s:"")+'</div>\n</div>\n<div class="pull-right widget-setting">\n  <div class="customer-menu"></div>\n  <div class="dropdown widget-set-menu"></div>\n</div>\n'+(null!=(s=e["if"].call(t,null!=t?t.isRetention:t,{name:"if",hash:{},fn:this.program(9,a,0),inverse:this.noop,data:a}))?s:"")},useData:!0}),title:Handlebars.template({1:function(t,e,n,a){var s,i=e.helperMissing,r="function",o=this.escapeExpression;return'<div class="title nav">\n  <a href="'+o((s=null!=(s=e.url||(null!=t?t.url:t))?s:i,typeof s===r?s.call(t,{name:"url",hash:{},data:a}):s))+'" data-method="nav">'+o((s=null!=(s=e.name||(null!=t?t.name:t))?s:i,typeof s===r?s.call(t,{name:"name",hash:{},data:a}):s))+'</a>\n  <span class="icon-failed"></span>\n</div>\n'},3:function(t,e,n,a){var s;return'<div class="title">\n  <span>'+this.escapeExpression((s=null!=(s=e.name||(null!=t?t.name:t))?s:e.helperMissing,"function"==typeof s?s.call(t,{name:"name",hash:{},data:a}):s))+'</span>\n  <span class="icon-failed"></span>\n</div>\n'},5:function(t,e,n,a){var s;return"<span>~</span>"+this.escapeExpression((s=null!=(s=e.to_date||(null!=t?t.to_date:t))?s:e.helperMissing,"function"==typeof s?s.call(t,{name:"to_date",hash:{},data:a}):s))},7:function(t,e,n,a){var s;return" | "+this.escapeExpression((s=null!=(s=e.rangeText||(null!=t?t.rangeText:t))?s:e.helperMissing,"function"==typeof s?s.call(t,{name:"rangeText",hash:{},data:a}):s))},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i;return(null!=(s=e["if"].call(t,null!=t?t.supportNav:t,{name:"if",hash:{},fn:this.program(1,a,0),inverse:this.program(3,a,0),data:a}))?s:"")+'<div class="range">'+this.escapeExpression((i=null!=(i=e.from_date||(null!=t?t.from_date:t))?i:e.helperMissing,"function"==typeof i?i.call(t,{name:"from_date",hash:{},data:a}):i))+(null!=(s=e["if"].call(t,null!=t?t.to_date:t,{name:"if",hash:{},fn:this.program(5,a,0),inverse:this.noop,data:a}))?s:"")+(null!=(s=e["if"].call(t,null!=t?t.rangeText:t,{name:"if",hash:{},fn:this.program(7,a,0),inverse:this.noop,data:a}))?s:"")+"</div>\n"},useData:!0})},s=t("lodash"),i=t("components/keyLog/keyLog"),r=t("components/widgetCustomMenuBar/widgetCustomMenuBar"),o=t("components/widgetSettingMenu/widgetSettingMenu"),l=t("components/util/util"),h={utm:!0};n.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(t){this.render(),this.bindEvents(),this.isShareDash||(this.initCustomMenuBar(),this.initSettingMenu(t))},render:function(){this.container.html(a.content($.extend(!0,{isShareDash:this.isShareDash},this.meta,{supportNav:!h[this.meta.type]})))},initSettingMenu:function(t){this.settingMenu=o.create({container:this.container.find(".widget-set-menu"),meta:t.meta,onMessage:l.bind(function(t){this.trigger("change",t)},this)})},initCustomMenuBar:function(){var t=this;"table"===this.meta.chartsType&&this.chartsData?this.customMenuBar=r.create({container:this.container.find(".customer-menu"),data:$.extend(!0,{},this.chartsData),meta:this.meta,onMessage:function(e){t.trigger("change",e)}}):this.container.find(".customer-menu").html("")},bindEvents:function(){var t=this;this.container.delegate('[data-method="nav"]',"click.nav",function(e){i.checkFunctionKey(navigator.userAgent.match(/mac os/i)?[91,93]:17)||(e.preventDefault(),h[t.meta.type]||t.trigger("change",{action:"view"}))})},update:function(t){if(t.chartsData&&(this.chartsData=t.chartsData),t.meta){this.meta=$.extend(!0,{},this.meta,t.meta),this.meta=s.extend(this.meta,t.meta);var e=this.meta.rangeText,n=sensorsdata.getRangeText(e);if(!n){var i=/(^过去\s*(\d+)\s*天\s*-\s*过去\s*(\d+)\s*天$)|(^In the past\s*(\d+)\s*Day\s*-\s*in the past\s*(\d+)\s*day$)/,r=/(^过去\s*(\d+)\s*天$)|(^In the past\s*(\d+)\s*day$)/,o=/(^最近\s*(\d+)\s*天$)|(^Lately\s*(\d+)\s*day$)/,l=0;if(i.test(e)){var u=e.match(i),d=Number(u[3]||u[6]),c=Number(u[2]||u[5]);n=sensorsdata.languages.get("过去 <!--{en}In the past -->")+c+sensorsdata.languages.get(" 天-过去 <!--{en} Day - in the past -->")+d+sensorsdata.languages.get(" 天<!--{en} day-->")}else r.test(e)?(l=Number(e.match(r)[2]||e.match(r)[4]),n=sensorsdata.languages.get("过去 <!--{en}In the past -->")+l+sensorsdata.languages.get(" 天<!--{en} day-->")):o.test(e)&&(l=Number(e.match(o)[2]||e.match(o)[4]),n=sensorsdata.languages.get("最近 <!--{en}Lately -->")+l+sensorsdata.languages.get(" 天<!--{en} day-->"))}this.meta.rangeText=n||e,this.container.find(".widget-title").html(a.title($.extend(!0,{},this.meta,{supportNav:!h[this.meta.type]}))),this.trigger("done"),-1!==window.search.indexOf("f=email")&&this.container.find(".widget-title a").removeAttr("href")}if(t.size&&(this.meta.currentSize=t.size),this.settingMenu&&$.isFunction(this.settingMenu.update)&&this.settingMenu.update($.extend(!0,{},this.meta)),"table"===this.meta.chartsType?this.customMenuBar&&$.isFunction(this.customMenuBar.update)?this.customMenuBar.update({meta:$.extend(!0,{},this.meta),data:this.chartsData}):this.initCustomMenuBar():this.customMenuBar&&this.customMenuBar&&$.isFunction(this.customMenuBar.destroy)&&this.customMenuBar.destroy(),t.updateTime&&new Date(t.updateTime.report_update_time).valueOf()<new Date(t.updateTime.data_sufficient_update_time).valueOf()){var m="上次更新时间为："+moment(t.updateTime.report_update_time).format(sensorsdata.CONSTSET.timeFormat)+"，查询涉及的原始数据已经发生较大变化 ";this.container.find(".icon-failed").attr("data-tip",m).show()}else this.container.find(".icon-failed").hide()},destroy:function(){this.settingMenu&&$.isFunction(this.settingMenu.destroy)&&this.settingMenu.destroy(),this.customMenuBar&&$.isFunction(this.customMenuBar.destroy)&&this.customMenuBar.destroy()}}),e.create=function(t){return new n(t)}});
;/*!components/charts/pie/pie.js*/
define("components/charts/pie/pie",function(n,e){function i(n,e){this.charts=[],this.$container=n,this.options=e,this.init()}var t=n("echarts3"),a={pieTpl:Handlebars.template({1:function(n,e,i,t){var a,s,l=e.helperMissing,o="function",r=this.escapeExpression;return'<div class="pie-charts-container '+(null!=(a=e["if"].call(n,null!=n?n.hasCompareData:n,{name:"if",hash:{},fn:this.program(2,t,0),inverse:this.noop,data:t}))?a:"")+'">\n  <div class="pie-content pie-content-'+r((s=null!=(s=e.index||(null!=n?n.index:n))?s:l,typeof s===o?s.call(n,{name:"index",hash:{},data:t}):s))+'">\n    result: '+r((s=null!=(s=e.index||(null!=n?n.index:n))?s:l,typeof s===o?s.call(n,{name:"index",hash:{},data:t}):s))+"\n  </div>\n"+(null!=(a=e["if"].call(n,null!=n?n.hasCompareData:n,{name:"if",hash:{},fn:this.program(4,t,0),inverse:this.noop,data:t}))?a:"")+"</div>\n"},2:function(){return"compare"},4:function(n,e,i,t){var a,s,l,o=e.helperMissing,r="function",c='  <div class="compare-pie-content compare-pie-content-'+this.escapeExpression((s=null!=(s=e.index||(null!=n?n.index:n))?s:o,typeof s===r?s.call(n,{name:"index",hash:{},data:t}):s))+'">\n    compareResult\n  </div>\n  <div class="pie-label">\n';return s=null!=(s=e.label||(null!=n?n.label:n))?s:o,l={name:"label",hash:{},fn:this.program(5,t,0),inverse:this.noop,data:t},a=typeof s===r?s.call(n,l):s,e.label||(a=e.blockHelperMissing.call(n,a,l)),null!=a&&(c+=a),c+"  </div>\n"},5:function(n){return"    <div>"+this.escapeExpression(this.lambda(n,n))+"</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,e,i,t){var a;return null!=(a=e.blockHelperMissing.call(n,this.lambda(n,n),{name:".",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t}))?a:""},useData:!0})};i.prototype=$.extend({},sensorsdata.EventsModule,{init:function(){var n=this,e=this.$container,i=this.options.data,t=i.result,s=i.compareResult,l=!$.isEmptyObject(s);e.empty();var o=[];t.map(function(n,e){o.push({label:i.label,index:e,hasCompareData:l})}),e.html(a.pieTpl(o)),t.map(function(i,t){n.createPie(e.find(".pie-content-"+t),i),l&&n.createPie(e.find(".compare-pie-content-"+t),s[t])})},createPie:function(n,e){var i=t.init(n[0]);i.setOption(e),this.charts.push(i)},destroy:function(){this.$container.empty()},resize:function(){this.charts.map(function(n){n&&$.isFunction(n.resize)&&n.resize()})}}),e.create=function(n,e){return new i(n,e)}});
;/*!components/charts/stack/stack.js*/
define("components/charts/stack/stack",function(t,c){var n=t("components/charts/charts").chartManager;c.create=function(t,c){return new n(t,c,"stack")}});
;/*!components/dashboardNumber/dashboardNumber.js*/
define("components/dashboardNumber/dashboardNumber",function(n,a){function l(n,a){this.$container=n,this.options=a,this.type=a.type,this.createNumber()}var t=n("components/util/sensorsdataUtil"),e=n("components/util/util").getRound,s={dashboardNumberTpl:Handlebars.template({1:function(n,a,l,t){var e;return'          <div class="mom-yoy-content">\n'+(null!=(e=a["if"].call(n,null!=n?n.MOM:n,{name:"if",hash:{},fn:this.program(2,t,0),inverse:this.noop,data:t}))?e:"")+(null!=(e=a["if"].call(n,null!=n?n.YOY:n,{name:"if",hash:{},fn:this.program(11,t,0),inverse:this.noop,data:t}))?e:"")+"          </div>\n"},2:function(n,a,l,t){var e,s,i=a.helperMissing,r="function",u=this.escapeExpression;return'            <div class="MOM-content">\n              <div data-toggle="tooltip" data-placement="top" data-original-title="'+u((s=null!=(s=a.MOMTip||(null!=n?n.MOMTip:n))?s:i,typeof s===r?s.call(n,{name:"MOMTip",hash:{},data:t}):s))+'">\n                <span class="measuresUnit">环比</span>\n                <span data-yoy-mom="'+u((s=null!=(s=a.MOM||(null!=n?n.MOM:n))?s:i,typeof s===r?s.call(n,{name:"MOM",hash:{},data:t}):s))+'" class="'+(null!=(e=a["if"].call(n,null!=n?n.MOMIcon:n,{name:"if",hash:{},fn:this.program(3,t,0),inverse:this.program(5,t,0),data:t}))?e:"")+'">\n                  <span class="'+(null!=(e=a["if"].call(n,null!=n?n.MOMIcon:n,{name:"if",hash:{},fn:this.program(7,t,0),inverse:this.program(9,t,0),data:t}))?e:"")+'"></span>\n                  <span>'+u((s=null!=(s=a.MOM||(null!=n?n.MOM:n))?s:i,typeof s===r?s.call(n,{name:"MOM",hash:{},data:t}):s))+"</span>\n                </span>\n              </div>\n            </div>\n"},3:function(){return"kpi-rise"},5:function(){return"kpi-drop"},7:function(){return"icon-rising"},9:function(){return"icon-falling"},11:function(n,a,l,t){var e,s,i=a.helperMissing,r="function",u=this.escapeExpression;return'            <div>\n              <div data-toggle="tooltip" data-placement="top" data-original-title="'+u((s=null!=(s=a.YOYTip||(null!=n?n.YOYTip:n))?s:i,typeof s===r?s.call(n,{name:"YOYTip",hash:{},data:t}):s))+'">\n                <span class="measuresUnit">同比</span>\n                <span data-yoy-mom="'+u((s=null!=(s=a.YOY||(null!=n?n.YOY:n))?s:i,typeof s===r?s.call(n,{name:"YOY",hash:{},data:t}):s))+'" class="'+(null!=(e=a["if"].call(n,null!=n?n.YOYIcon:n,{name:"if",hash:{},fn:this.program(3,t,0),inverse:this.program(5,t,0),data:t}))?e:"")+'">\n                  <span class="'+(null!=(e=a["if"].call(n,null!=n?n.YOYIcon:n,{name:"if",hash:{},fn:this.program(7,t,0),inverse:this.program(9,t,0),data:t}))?e:"")+'"></span>\n                  <span>'+u((s=null!=(s=a.YOY||(null!=n?n.YOY:n))?s:i,typeof s===r?s.call(n,{name:"YOY",hash:{},data:t}):s))+"</span>\n                </span>\n              </div>\n            </div>\n"},13:function(n,a,l,t){var e;return'    <div class="mobile-mom-yoy-content">\n'+(null!=(e=a["if"].call(n,null!=n?n.MOM:n,{name:"if",hash:{},fn:this.program(14,t,0),inverse:this.noop,data:t}))?e:"")+(null!=(e=a["if"].call(n,null!=n?n.YOY:n,{name:"if",hash:{},fn:this.program(16,t,0),inverse:this.noop,data:t}))?e:"")+"    </div>\n"},14:function(n,a,l,t){var e,s,i=a.helperMissing,r="function",u=this.escapeExpression;return'      <div class="MOM-content">\n        <div data-toggle="tooltip" data-placement="top" data-original-title="'+u((s=null!=(s=a.MOMTip||(null!=n?n.MOMTip:n))?s:i,typeof s===r?s.call(n,{name:"MOMTip",hash:{},data:t}):s))+'">\n          <span class="measuresUnit">环比</span>\n          <span data-yoy-mom="'+u((s=null!=(s=a.MOM||(null!=n?n.MOM:n))?s:i,typeof s===r?s.call(n,{name:"MOM",hash:{},data:t}):s))+'" class="'+(null!=(e=a["if"].call(n,null!=n?n.MOMIcon:n,{name:"if",hash:{},fn:this.program(3,t,0),inverse:this.program(5,t,0),data:t}))?e:"")+'">\n            <span class="'+(null!=(e=a["if"].call(n,null!=n?n.MOMIcon:n,{name:"if",hash:{},fn:this.program(7,t,0),inverse:this.program(9,t,0),data:t}))?e:"")+'"></span>\n            <span>'+u((s=null!=(s=a.MOM||(null!=n?n.MOM:n))?s:i,typeof s===r?s.call(n,{name:"MOM",hash:{},data:t}):s))+"</span>\n          </span>\n        </div>\n      </div>\n"},16:function(n,a,l,t){var e,s,i=a.helperMissing,r="function",u=this.escapeExpression;return'      <div>\n        <div data-toggle="tooltip" data-placement="top" data-original-title="'+u((s=null!=(s=a.YOYTip||(null!=n?n.YOYTip:n))?s:i,typeof s===r?s.call(n,{name:"YOYTip",hash:{},data:t}):s))+'">\n          <span class="measuresUnit">同比</span>\n          <span data-yoy-mom="'+u((s=null!=(s=a.YOY||(null!=n?n.YOY:n))?s:i,typeof s===r?s.call(n,{name:"YOY",hash:{},data:t}):s))+'" class="'+(null!=(e=a["if"].call(n,null!=n?n.YOYIcon:n,{name:"if",hash:{},fn:this.program(3,t,0),inverse:this.program(5,t,0),data:t}))?e:"")+'">\n            <span class="'+(null!=(e=a["if"].call(n,null!=n?n.YOYIcon:n,{name:"if",hash:{},fn:this.program(7,t,0),inverse:this.program(9,t,0),data:t}))?e:"")+'"></span>\n            <span>'+u((s=null!=(s=a.YOY||(null!=n?n.YOY:n))?s:i,typeof s===r?s.call(n,{name:"YOY",hash:{},data:t}):s))+"</span>\n          </span>\n        </div>\n      </div>\n"},18:function(n,a,l,t){var e,s,i=this.lambda,r=this.escapeExpression;return'      <div>\n        <span>均值</span>\n        <span class="number" title="'+r(i(null!=(e=null!=n?n.average:n)?e.originNumber:e,n))+'" data-originData="'+r(i(null!=(e=null!=n?n.average:n)?e.originNumber:e,n))+'">'+r(i(null!=(e=null!=n?n.average:n)?e.formatNumber:e,n))+'</span>\n        <span class="measuresUnit">'+r(i(null!=(e=null!=n?n.average:n)?e.unit:e,n))+r((s=null!=(s=a.measuresUnit||(null!=n?n.measuresUnit:n))?s:a.helperMissing,"function"==typeof s?s.call(n,{name:"measuresUnit",hash:{},data:t}):s))+"</span>\n      </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,l,t){var e,s,i=a.helperMissing,r="function",u=this.escapeExpression,o=this.lambda;return'<div class="dashboard-number-container '+u((s=null!=(s=a.containerType||(null!=n?n.containerType:n))?s:i,typeof s===r?s.call(n,{name:"containerType",hash:{},data:t}):s))+'">\n  <div class="inner">\n    <div class="main-number-content">\n      <div class="">\n        <div>'+u((s=null!=(s=a.unitName||(null!=n?n.unitName:n))?s:i,typeof s===r?s.call(n,{name:"unitName",hash:{},data:t}):s))+'</div>\n        <div class="number-content clearfix">\n          <span class="number" data-originData="'+u(o(null!=(e=null!=n?n.main:n)?e.originNumber:e,n))+'" title="'+u(o(null!=(e=null!=n?n.main:n)?e.originNumber:e,n))+'">'+u(o(null!=(e=null!=n?n.main:n)?e.formatNumber:e,n))+'</span>\n          <span class="measuresUnit">'+u(o(null!=(e=null!=n?n.main:n)?e.unit:e,n))+u((s=null!=(s=a.measuresUnit||(null!=n?n.measuresUnit:n))?s:i,typeof s===r?s.call(n,{name:"measuresUnit",hash:{},data:t}):s))+"</span>\n"+(null!=(e=a.unless.call(n,null!=n?n.rollupDate:n,{name:"unless",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t}))?e:"")+"        </div>\n      </div>\n    </div>\n"+(null!=(e=a.unless.call(n,null!=n?n.rollupDate:n,{name:"unless",hash:{},fn:this.program(13,t,0),inverse:this.noop,data:t}))?e:"")+'    <div class="second-number-content">\n      <div>\n        <span>'+u((s=null!=(s=a.secondName||(null!=n?n.secondName:n))?s:i,typeof s===r?s.call(n,{name:"secondName",hash:{},data:t}):s))+'</span>\n        <span class="number" title="'+u(o(null!=(e=null!=n?n.second:n)?e.originNumber:e,n))+'" data-originData="'+u(o(null!=(e=null!=n?n.second:n)?e.originNumber:e,n))+'">'+u(o(null!=(e=null!=n?n.second:n)?e.formatNumber:e,n))+'</span>\n        <span class="measuresUnit">'+u(o(null!=(e=null!=n?n.second:n)?e.unit:e,n))+u((s=null!=(s=a.measuresUnit||(null!=n?n.measuresUnit:n))?s:i,typeof s===r?s.call(n,{name:"measuresUnit",hash:{},data:t}):s))+"</span>\n      </div>\n"+(null!=(e=a.unless.call(n,null!=n?n.rollupDate:n,{name:"unless",hash:{},fn:this.program(18,t,0),inverse:this.noop,data:t}))?e:"")+"    </div>\n  </div>\n</div>"},useData:!0}),usDashboardNumberTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,l,t){var e,s=a.helperMissing,i="function",r=this.escapeExpression;return'<div class="dashboard-number-container '+r((e=null!=(e=a.containerType||(null!=n?n.containerType:n))?e:s,typeof e===i?e.call(n,{name:"containerType",hash:{},data:t}):e))+'">\n  <div class="inner">\n    <div class="user-analytics-content">\n      <span>'+r((e=null!=(e=a.data||(null!=n?n.data:n))?e:s,typeof e===i?e.call(n,{name:"data",hash:{},data:t}):e))+"</span><span>"+r((e=null!=(e=a.unit||(null!=n?n.unit:n))?e:s,typeof e===i?e.call(n,{name:"unit",hash:{},data:t}):e))+"</span>\n    </div>\n  </div>\n</div>"},useData:!0})};l.prototype=$.extend({},sensorsdata.EventsModule,{createNumber:function(){if($.isNumeric(this.options.data.result)){var n={data:t.formatNumber(this.options.data.result,!1,!1),unit:this.options.data.unit};return void this.$container.html(s.usDashboardNumberTpl(n))}var a=this.convertNumberData();this.$container.html(s.dashboardNumberTpl(a)),this.initEvents()},initEvents:function(){this.$container.find('[data-toggle="tooltip"]').tooltip()},formatDashNumber:function(n){if(!$.isNumeric(n))return{originNumber:n,formatNumber:"-"};var a=[{num:5,unit:"万"},{num:7,unit:"千万"},{num:8,unit:"亿"},{num:11,unit:"千亿"},{num:12,unit:"万亿"},{num:16,unit:""}],l=n+"",s=l.split("."),i=s[0],r="0";switch(s.length>1&&(r=s[1]),r.length){case 1:break;case 2:i.length>3&&(l=i);break;case 3:i.length>2&&(l=i)}for(var u="",o=i.length-1,m=a.length,p=!1,c=0;m>c&&!p;c++){var h=a[c];o>=h.num&&a[c+1]&&o<a[c+1].num&&(p=!0),p&&(i=i.slice(0,i.length-(h.num-3)),(7===h.num||8===h.num||11===h.num||12===h.num)&&(i=Number(i)/10),u=h.unit)}var d=t.formatNumber(e(i/100,2),!1,!1);p||(i=100*Number(l),u="",d=t.formatNumber(e(i/100,r.length),!1,!1));var f={unit:u,originNumber:n,formatNumber:d};return f},convertNumberData:function(){var n=this.options.data.dashboradNumberData;if($.isEmptyObject(n))return{};var a=[1,2,3,4,5,6],l=a[this.type-1]||"1";return n.containerType="number-type"+l,n.main=this.formatDashNumber(n.mainNumber),n.second=this.formatDashNumber(n.secondNumber),n.average=this.formatDashNumber(n.averageNumber),n},destroy:function(){this.$container.empty()}}),a.create=function(n,a){return new l(n,a)}});
;/*!components/dashboardTable/dashboardTable.js*/
define("components/dashboardTable/dashboardTable",function(a,t){function e(a,t){var e=t.data.body,n=t.data.head,s=t.data.timeSort||!1;this.$container=a,this.options=t,this.head=n,this.body=e,this.sortType="descend",this.timeSort=s,this.sortData(),this.createTable()}var n=a("components/util/sensorsdataUtil"),s={dashboardTableTpl:Handlebars.template({1:function(){return"view-dashboard"},3:function(){return'  <div class="mask"></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,t,e,n){var s;return'<div class="dashboard-table-container '+(null!=(s=t.unless.call(a,null!=a?a.isEmail:a,{name:"unless",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?s:"")+'">\n  <div class="dashboard-table-head">\n    <table class="table-lite table-head">\n    </table>\n  </div>\n'+(null!=(s=t.unless.call(a,null!=a?a.isEmail:a,{name:"unless",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?s:"")+'  <div class="dashboard-table-body">\n    <table class="table-lite table-body">\n    </table>\n  </div>\n  <div class="dashboard-table-pagination" class="sa-pagination"></div>\n</div>\n'},useData:!0}),dashboardTableHeadTpl:Handlebars.template({1:function(a,t,e,n){var s,i,l,o=t.helperMissing,r="function",h=t.blockHelperMissing,d="      <th ";return i=null!=(i=t.sortDisplay||(null!=a?a.sortDisplay:a))?i:o,l={name:"sortDisplay",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n},s=typeof i===r?i.call(a,l):i,t.sortDisplay||(s=h.call(a,s,l)),null!=s&&(d+=s),d+=' class="',i=null!=(i=t.textAlignRight||(null!=a?a.textAlignRight:a))?i:o,l={name:"textAlignRight",hash:{},fn:this.program(4,n,0),inverse:this.noop,data:n},s=typeof i===r?i.call(a,l):i,t.textAlignRight||(s=h.call(a,s,l)),null!=s&&(d+=s),d+='" ',i=null!=(i=t.showTitle||(null!=a?a.showTitle:a))?i:o,l={name:"showTitle",hash:{},fn:this.program(6,n,0),inverse:this.noop,data:n},s=typeof i===r?i.call(a,l):i,t.showTitle||(s=h.call(a,s,l)),null!=s&&(d+=s),d+=">\n        <span>"+this.escapeExpression((i=null!=(i=t.value||(null!=a?a.value:a))?i:o,typeof i===r?i.call(a,{name:"value",hash:{},data:n}):i))+"</span>\n        ",i=null!=(i=t.sortDisplay||(null!=a?a.sortDisplay:a))?i:o,l={name:"sortDisplay",hash:{},fn:this.program(8,n,0),inverse:this.noop,data:n},s=typeof i===r?i.call(a,l):i,t.sortDisplay||(s=h.call(a,s,l)),null!=s&&(d+=s),d+"\n      </th>\n"},2:function(a,t,e,n){var s,i=t.helperMissing,l="function",o=this.escapeExpression;return'data-index="'+o((s=null!=(s=t.index||(null!=a?a.index:a))?s:i,typeof s===l?s.call(a,{name:"index",hash:{},data:n}):s))+'" data-type="'+o((s=null!=(s=t.dataType||(null!=a?a.dataType:a))?s:i,typeof s===l?s.call(a,{name:"dataType",hash:{},data:n}):s))+'" data-method="sort" data-sort="'+o((s=null!=(s=t.sortType||(null!=a?a.sortType:a))?s:i,typeof s===l?s.call(a,{name:"sortType",hash:{},data:n}):s))+'"'},4:function(){return"right"},6:function(a,t,e,n){var s;return'title="'+this.escapeExpression((s=null!=(s=t.value||(null!=a?a.value:a))?s:t.helperMissing,"function"==typeof s?s.call(a,{name:"value",hash:{},data:n}):s))+'"'},8:function(){return'<span class="icon_selector"></span>'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,t,e,n){var s,i,l,o="<thead>\n  <tr>\n";return i=null!=(i=t.head||(null!=a?a.head:a))?i:t.helperMissing,l={name:"head",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n},s="function"==typeof i?i.call(a,l):i,t.head||(s=t.blockHelperMissing.call(a,s,l)),null!=s&&(o+=s),o+"  </tr>\n</thead>\n"},useData:!0}),dashboardTableBodyTpl:Handlebars.template({1:function(a,t,e,n){var s;return"  <tr>\n"+(null!=(s=t.blockHelperMissing.call(a,this.lambda(a,a),{name:".",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n}))?s:"")+"  </tr>\n"},2:function(a,t,e,n){var s,i,l,o=t.helperMissing,r="function",h='    <td class="';return i=null!=(i=t.textAlignRight||(null!=a?a.textAlignRight:a))?i:o,l={name:"textAlignRight",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n},s=typeof i===r?i.call(a,l):i,t.textAlignRight||(s=t.blockHelperMissing.call(a,s,l)),null!=s&&(h+=s),h+'"><span>'+this.escapeExpression((i=null!=(i=t.value||(null!=a?a.value:a))?i:o,typeof i===r?i.call(a,{name:"value",hash:{},data:n}):i))+"</span></td>\n"},3:function(){return"right"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,t,e,n){var s,i,l,o="<tbody>\n";return i=null!=(i=t.body||(null!=a?a.body:a))?i:t.helperMissing,l={name:"body",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n},s="function"==typeof i?i.call(a,l):i,t.body||(s=t.blockHelperMissing.call(a,s,l)),null!=s&&(o+=s),o+"</tbody>"},useData:!0})};e.prototype=$.extend({},sensorsdata.EventsModule,{initEvents:function(){var a=this;this.$container.find('[data-method="sort"]').off("click").on("click",function(){a.sortFunction($(this))});var t=this.$container.find(".dashboard-table-head"),e=this.$container.find(".dashboard-table-body"),n=e[0].clientHeight,s=e.find(".table-body")[0].clientHeight;t.on("mousewheel",function(){e.scrollLeft(t.scrollLeft())}),e.on("mousewheel scroll",function(){t.scrollLeft(e.scrollLeft()),n+e.scrollTop()-s>-5?a.$container.find(".mask").hide():a.$container.find(".mask").show()})},showTable:function(){var a=this,t=JSON.parse(JSON.stringify(this.body)),e=this.head,n=this.$container;this.timeSort&&t.forEach(function(a){a[0].value=sensorsdata.formatTime(a[0].value,a[0].unit,!0,!0,"</br>")});var i=function(a,i){a-=1;var l=t.slice(a,i),o={head:e,body:l};n.find(".table-head").html(s.dashboardTableHeadTpl(o)),n.find(".table-body").html(s.dashboardTableHeadTpl(o)+s.dashboardTableBodyTpl(o)),t.length<50&&n.find(".dashboard-table-body").css("height","100%"),t.length<2?n.find(".dashboard-table-head").hide():n.find(".dashboard-table-head").show()};sensorsdata.pagination({tableElement:n.find(".dashboard-table-pagination").show(),totalItems:t.length,pageItems:50,clickHandle:sensorsdata.bind(function(t){i(t.range[0],t.range[1]),a.$container.find(".dashboard-table-body").scrollTop(0),a.initEvents()},this)}),this.initEvents()},createTable:function(){var a=-1!==window.search.indexOf("f=email");this.$container.html(s.dashboardTableTpl({isEmail:a})),this.showTable(),this.fixStyle()},fixStyle:function(){var a=this.$container.find(".dashboard-table-body")[0].clientWidth,t=this.$container.find(".dashboard-table-body")[0].clientHeight,e=this.$container.find(".dashboard-table-body table"),n=this.$container.find(".dashboard-table-head table"),s=this.$container.find(".mask");e.width()<=a?(n.width(a),e.width(a),s.css("width","")):(this.$container.find(".dashboard-table-head").css("width",a+"px"),n.css("width",""),e.css("width",""),s.width(a)),e.height()<t?s.hide():s.css("top",t-30+"px").show()},compare:function(a,t){var e=this.sortType,s=this.getCompareInfo(a,t);a=s.leftValue,t=s.rightValue;var i=s.localeCompareType;return"descend"===e?sensorsdata.isNumeric(a)&&sensorsdata.isNumeric(t)?n.toNumber(t)>n.toNumber(a)?1:-1:"string"==typeof a&&"string"==typeof t?t.localeCompare(a,i,{sensitivity:"accent"}):sensorsdata.isNumeric(a)?sensorsdata.isNumeric(t)?0:-1:1:sensorsdata.isNumeric(a)&&sensorsdata.isNumeric(t)?n.toNumber(a)>n.toNumber(t)?1:-1:"string"==typeof a&&"string"==typeof t?a.localeCompare(t,i,{sensitivity:"accent"}):sensorsdata.isNumeric(a)?sensorsdata.isNumeric(t)?0:1:-1},getCompareInfo:function(a,t){var e=0,n=["en","zh-Hans-CN"];if("string"==typeof a&&"string"==typeof t&&!sensorsdata.isNumeric(a)&&!sensorsdata.isNumeric(t)){for(;e<Math.min(a.length,t.length)&&a.charAt(e)===t.charAt(e);)e++;t=t.substring(e),a=a.substring(e);var s=new RegExp("[一-龥]+");s.test(a)&&s.test(t)&&(n=["zh-Hans-CN","en"])}return{leftValue:a,rightValue:t,localeCompareType:n}},sortFunction:function(a){var t=n.toNumber(a.attr("data-index")),e=a.attr("data-sort"),s=a.attr("data-type"),i=this.$container.find("th");e=e&&""!==e&&"ascend"!==e?"ascend":"descend",this.sortType=e,this.dataType=s,this.head.map(function(a,n){a.sortType=n===t?e:""}),i.removeAttr("data-sort"),a.attr("data-sort",e),this.sortData(t),this.showTable()},sortData:function(a){a||this.head.map(function(t,e){t.sortType&&(a=e)});var t=this,e=this.body,n=function(e){if(e.length<=1)return e;for(var s=Math.floor(e.length/2),i=e.splice(s,1)[0],l=[],o=[],r=0;r<e.length;r++)t.compare(e[r][a].value,i[a].value)<0?l.push(e[r]):o.push(e[r]);return n(l).concat([i],n(o))},s=n(e);this.body=s},destroy:function(){this.$container.empty()},resize:function(){this.createTable()}}),t.create=function(a,t){return new e(a,t)}});
;/*!components/dashboardFunnel/dashboardFunnel.js*/
define("components/dashboardFunnel/dashboardFunnel",function(n,e){function t(n,e){if("object"!=typeof e||"object"!=typeof e.data)throw new Error("无效的配置");if(e.config&&$.isEmptyObject(e.config)&&!e.config.index)throw new Error("无效的配置");this.$container=n,this.options=e,this.createFunnel()}var a={dashboardFunnelTpl:Handlebars.template({1:function(n,e,t,a){var s,i=e.helperMissing,o="function",l=this.escapeExpression;return'    <div>\n      <div class="rate rate-index'+l((s=null!=(s=e.index||(null!=n?n.index:n))?s:i,typeof s===o?s.call(n,{name:"index",hash:{},data:a}):s))+'">\n        <span>\n        <svg width="72px" height="25px" viewBox="0 0 72 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" opacity="0.359658062">\n            <g id="widget" transform="translate(-1546.000000, -8147.000000)" fill="#BEB8EB">\n              <path d="M1549,8147 L1615,8147 L1615,8147 C1616.65685,8147 1618,8148.34315 1618,8150 L1618,8163.79271 L1618,8163.79271 C1618,8165.26834 1616.92688,8166.52485 1615.46943,8166.75575 L1582.83247,8171.92638 L1582.83247,8171.92638 C1582.52456,8171.97516 1582.21094,8171.97565 1581.90288,8171.92783 L1548.53984,8166.74908 L1548.53984,8166.74908 C1547.07816,8166.5222 1546,8165.26377 1546,8163.78458 L1546,8150 L1546,8150 C1546,8148.34315 1547.34315,8147 1549,8147 Z" id="Rectangle-15"></path>\n            </g>\n          </g>\n        </svg>\n        <span>'+l((s=null!=(s=e.conversionRate||(null!=n?n.conversionRate:n))?s:i,typeof s===o?s.call(n,{name:"conversionRate",hash:{},data:a}):s))+'</span>\n        </span>\n      </div>\n      <div class="info">\n        <i>'+l((s=null!=(s=e.index||(null!=n?n.index:n))?s:i,typeof s===o?s.call(n,{name:"index",hash:{},data:a}):s))+"</i>\n        <span>"+l((s=null!=(s=e.eventName||(null!=n?n.eventName:n))?s:i,typeof s===o?s.call(n,{name:"eventName",hash:{},data:a}):s))+'</span>\n        <span class="value">'+l((s=null!=(s=e.convertedUser||(null!=n?n.convertedUser:n))?s:i,typeof s===o?s.call(n,{name:"convertedUser",hash:{},data:a}):s))+'人<!--{en}People--></span>\n      </div>\n      <div class="rate-rectangle">\n        <div style="width: '+l((s=null!=(s=e.width||(null!=n?n.width:n))?s:i,typeof s===o?s.call(n,{name:"width",hash:{},data:a}):s))+'%"></div>\n      </div>\n    </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(n,e,t,a){var s,i,o,l=e.helperMissing,r="function",d='<div class="dashboard-funnel">\n  <div class="completion-rate">\n    总体转化率<!--{en}Total-->\n    <span class="value">'+this.escapeExpression((i=null!=(i=e.completionRate||(null!=n?n.completionRate:n))?i:l,typeof i===r?i.call(n,{name:"completionRate",hash:{},data:a}):i))+'</span>\n  </div>\n  <div class="step-rate">\n';return i=null!=(i=e.steps||(null!=n?n.steps:n))?i:l,o={name:"steps",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a},s=typeof i===r?i.call(n,o):i,e.steps||(s=e.blockHelperMissing.call(n,s,o)),null!=s&&(d+=s),d+"  </div>\n</div>"},useData:!0})};t.prototype=$.extend({},sensorsdata.EventsModule,{createFunnel:function(){var n=this.options.data.overview;n.completionRate=n.completionRate>0?n.completionRate+"%":"-",n.steps.map(function(n,e){var t=n.completionRate;n.index=e+1,n.width=0===e?n.convertedUser>0?0:100:100-t,n.conversionRate=n.conversionRate>0?n.conversionRate+"%":"-",n.convertedUser=sensorsdata.formatNumber(n.convertedUser)}),this.$container.html(a.dashboardFunnelTpl(n))},destroy:function(){this.$container.empty()}}),e.create=function(n,e){return new t(n,e)}});
;/*!components/widgetTable/widgetTable.js*/
define("components/widgetTable/widgetTable",function(t,n){var a=t("components/util/util"),e={table:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<table class="display nowrap" width="100%">\n  <thead>\n    <tr>\n      <th>Name</th>\n      <th>Position</th>\n      <th>Office</th>\n      <th>Age</th>\n      <th>Start date</th>\n      <th>Salary</th>\n    </tr>\n  </thead>\n  <tbody>\n\n  </tbody>\n</table>\n'},useData:!0}),header:Handlebars.template({1:function(t,n,a,e){var i,s=n.helperMissing,o="function",l=this.escapeExpression;return'    <th class="no-sort" colspan="'+l((i=null!=(i=n.colSpan||(null!=t?t.colSpan:t))?i:s,typeof i===o?i.call(t,{name:"colSpan",hash:{},data:e}):i))+'"><span>'+l((i=null!=(i=n.category||(null!=t?t.category:t))?i:s,typeof i===o?i.call(t,{name:"category",hash:{},data:e}):i))+"</span></th>\n"},3:function(t,n,a,e){var i,s;return'    <th class="sortable"><span>'+this.escapeExpression((s=null!=(s=n.text||(null!=t?t.text:t))?s:n.helperMissing,"function"==typeof s?s.call(t,{name:"text",hash:{},data:e}):s))+"</span>\n"+(null!=(i=n["if"].call(t,null!=t?t.tooltip:t,{name:"if",hash:{},fn:this.program(4,e,0),inverse:this.noop,data:e}))?i:"")+'      <span class="icon_selector"></span>\n    </th>\n'},4:function(t,n,a,e){var i;return'        <span class="icon-help" data-toggle="tooltip" title="'+this.escapeExpression((i=null!=(i=n.tooltip||(null!=t?t.tooltip:t))?i:n.helperMissing,"function"==typeof i?i.call(t,{name:"tooltip",hash:{},data:e}):i))+'" style="font-size: 16px; vertical-align: text-bottom;"></span>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,n,a,e){var i;return"<tr>\n"+(null!=(i=n.each.call(t,null!=t?t.category:t,{name:"each",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?i:"")+"</tr>\n<tr>\n"+(null!=(i=n.each.call(t,null!=t?t.header:t,{name:"each",hash:{},fn:this.program(3,e,0),inverse:this.noop,data:e}))?i:"")+"</tr>\n"},useData:!0}),body:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return""},useData:!0}),mask:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="table-mask"></div>'},useData:!0})},a=t("components/util/util"),i=t("components/basicTable/basicTable"),s=function(t,n){if(!t)throw new Error("无效的表格容器");this.options=n,this.$container=t,this.init()};s.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){var t=this.options.data.body.length>50,n=a.bind(function(){return t?this.$container.height()-121:this.$container.height()-101},this)();-1!==window.search.indexOf("f=email")&&(t=!1,n=!1),this.tableInstance=i.create({container:this.$container,data:this.options.data,tpl:e,dataTableOption:{scrollY:n,info:!1,fixedColumns:!0,paging:t,scrollX:!0,columnDefs:[{targets:"_all",render:function(t,n){if("display"===n){if("object"!=typeof t)return t;var a=t.value;return t.percent&&(a+=' <span class="percent">('+t.percent+")<span>"),a}return"object"!=typeof t?t:t.value}}]},customDrawCallback:a.bind(function(){this.initMask();var t=this.$container.find(".dataTables_scrollBody");this.$container.find(".DTFC_LeftWrapper div").toggleClass("decorate-shadow",t.find("table").width()>t.width()),this.$container.find('[data-toggle="tooltip"]').tooltip({container:this.$container})},this)})},initMask:function(){var t=this;if(-1===window.search.indexOf("f=email")){var n=function(){var n=a.innerHeight()-a[0].clientHeight;t.$container.find(".table-mask").css("margin-bottom",n)};this.$container.find(".dataTables_scroll").append(e.mask());var a=this.$container.find(".dataTables_scrollBody");n(),this.$container.find(".dataTables_scrollBody").on("scroll",function(){var a=$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight;t.$container.find(".table-mask").toggle(!a),n()})}},destroy:function(){$.isFunction(this.tableInstance)&&this.tableInstance.destroy&&this.tableInstance.destroy(),this.$container.find(".dataTables_scrollBody").off("scroll"),this.$container.html("")}}),n.create=function(t,n){return new s(t,n)}});
;/*!components/util/getNumberUiType.js*/
define("components/util/getNumberUiType",function(r,n,a){var e={number:{mini:"2",small:"3",normal:"3",large:"3"},chart:{mini:"",small:"2",normal:"3",large:"4"}},l={number:{mini:"1",small:"5",normal:"6",large:"5"},chart:{mini:"",small:"1",normal:"5",large:"6"}},m=function(r){var n="number"===r.chartsType?"number":"chart",a=r.size,m=1,i=r.bookmarkConfig||{};"string"==typeof i&&(i=JSON.parse(i));var o="rollup"===i.unit;return m=o?l[n][a]||1:e[n][a]||1};a.exports=m});
;/*!components/widgetBody/widgetBody.js*/
define("components/widgetBody/widgetBody",function(t,a){function e(t){if(!t.container)throw new Error("无效的widget容器");if(!t.meta)throw new Error("无效的widget元数据信息");this.options=$.extend(!0,{},t),this.container=t.container,this.chartsData=$.extend(!0,{},t.chartsData),this.numberData=$.extend(!0,{},t.numberData),this.chartsInstance=[],this.init(t)}var n={content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="" data-container="side"></div>\n<div class="" data-container="main"></div>'},useData:!0}),error:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,a,e,n){var i;return'<div class="no-data">'+this.escapeExpression((i=null!=(i=a.error||(null!=t?t.error:t))?i:a.helperMissing,"function"==typeof i?i.call(t,{name:"error",hash:{},data:n}):i))+"</div>"},useData:!0}),nodata:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="no-data">无数据<!--{en}No Data--></div>'},useData:!0}),nosupport:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="no-support">\n  不支持<!--{en}No Support-->\n</div>'},useData:!0})},i={line:t("components/charts/line/line"),column:t("components/charts/column/column"),pie:t("components/charts/pie/pie"),stack:t("components/charts/stack/stack"),number:t("components/dashboardNumber/dashboardNumber"),table:t("components/dashboardTable/dashboardTable"),funnel:t("components/dashboardFunnel/dashboardFunnel")},s={utm:t("components/widgetTable/widgetTable")},r=t("components/config/dashboard.widget"),o=t("components/util/getNumberUiType"),c={mini:{side:"no-display",main:"col-md-12"},small:{side:"col-md-4",main:"col-md-8"},normal:{side:"col-md-12",main:"col-md-12"},large:{side:"customer-md-2",main:"customer-md-10"}};e.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(t){this.container.html($("#tpl-widget-loader").html()),$.isEmptyObject(t.chartsData)&&$.isEmptyObject(t.numberData)||this.update(t),this.bindEvents()},bindEvents:function(){},update:function(t){if($.isEmptyObject(this.chartsData)&&$.isEmptyObject(this.numberData)||(this.chartsInstance.forEach(function(t){$.isFunction(t.destroy)&&t.destroy()}),this.chartsInstance=[]),this.chartsData=t.hasOwnProperty("chartsData")?$.extend(!0,{},t.chartsData):this.chartsData,this.numberData=t.hasOwnProperty("numberData")?$.extend(!0,{},t.numberData):this.numberData,this.container.html(n.content()),t.error)return this.container.find('[data-container="main"]').addClass("only").html(n.error(t)),this.container.find('[data-container="side"]').toggle(!1),void this.trigger("done");if(this.meta=$.isEmptyObject(t.meta)?this.meta||{}:$.extend(!0,{},t.meta),t.size&&(this.meta.currentSize=t.size),"number"!==this.meta.chartsType&&$.isEmptyObject(this.chartsData)||"number"===this.meta.chartsType&&$.isEmptyObject(this.numberData))return this.container.find('[data-container="main"]').addClass("only").html(n.nodata()),this.container.find('[data-container="side"]').toggle(!1),void this.trigger("done");var a=document.documentElement.clientWidth<751&&"large"===this.meta.currentSize?"normal":this.meta.currentSize,e=r({type:this.meta.type,chartsType:this.meta.chartsType,widgetUnit:this.meta.queryParams.unit,queryParams:this.meta.queryParams,size:a}).support;if(!e)return this.container.find('[data-container="main"]').addClass("only").html(n.nosupport()),this.container.find('[data-container="side"]').toggle(!1),void this.trigger("done");this.container.find('[data-container="main"]').attr("class","").addClass(c[a].main),this.container.find('[data-container="side"]').attr("class","").addClass(c[a].side);var d=this.meta.chartsType||"number",m=this.meta.bookmarkConfig,h=!1,u={queryParams:this.meta.queryParams,chartsType:this.meta.chartsType,size:a,bookmarkConfig:m};"number"!==d&&"table"!==d?(h=r({type:this.meta.type,chartsType:"number",widgetUnit:this.meta.queryParams.unit,queryParams:this.meta.queryParams,size:a}).support,h&&"segmentation"===this.meta.type?this.chartsInstance.push(i.number.create(this.container.find('[data-container="side"]'),{data:$.extend(!0,{},this.numberData),type:o(u)})):this.container.find('[data-container="main"]').addClass("only")):this.container.find('[data-container="main"]').addClass("only");var l=(s[this.meta.type]||i[d]).create(this.container.find('[data-container="main"]'),{container:this.container.find('[data-container="main"]'),data:$.isEmptyObject(this.chartsData)?$.extend(!0,{},this.numberData):$.extend(!0,{},this.chartsData),type:o(u),tab_name:this.getTabName(t)});this.chartsInstance.push(l),this.trigger("done")},getTabName:function(t){return"retention"===this.meta.type?$.isEmptyObject(t)?$(".retention-tab").find(".active").attr("data-type"):t.tab_name||t.meta&&t.meta.tabName:void 0},destroy:function(){this.chartsInstance.length&&this.chartsInstance.forEach(function(t){$.isFunction(t.destroy)&&t.destroy()}),this.chartsInstance=[]},resize:function(){this.chartsInstance.forEach(function(t){$.isFunction(t.resize)&&t.resize()})},clean:function(){this.container.html($("#tpl-widget-loader").html())}}),a.create=function(t){return new e(t)}});
;/*!components/widgetTopMeasure/widgetTopMeasure.js*/
define("components/widgetTopMeasure/widgetTopMeasure",function(a,e){var t=a("components/util/util").formatDashNumber,n=Handlebars.template({1:function(){return"col-xs-4"},3:function(){return"col-xs-6"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,e,t,n){var i,r,s=e.helperMissing,o="function",u=this.escapeExpression;return'<div class="measure-item '+(null!=(i=e["if"].call(a,null!=a?a.three:a,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+" "+(null!=(i=e["if"].call(a,null!=a?a.three:a,{name:"if",hash:{},fn:this.noop,inverse:this.program(3,n,0),data:n}))?i:"")+'">\n  <div class="info-date">'+u((r=null!=(r=e.date||(null!=a?a.date:a))?r:s,typeof r===o?r.call(a,{name:"date",hash:{},data:n}):r))+'</div>\n  <div class="info-measure">\n    <span style="background:'+u((r=null!=(r=e.color||(null!=a?a.color:a))?r:s,typeof r===o?r.call(a,{name:"color",hash:{},data:n}):r))+'"></span>\n    <span title="'+u((r=null!=(r=e.groupName||(null!=a?a.groupName:a))?r:s,typeof r===o?r.call(a,{name:"groupName",hash:{},data:n}):r))+'">'+u((r=null!=(r=e.groupName||(null!=a?a.groupName:a))?r:s,typeof r===o?r.call(a,{name:"groupName",hash:{},data:n}):r))+'</span>\n  </div>\n  <div class="info-val">\n    <span class="measure-num">'+u((r=null!=(r=e.number||(null!=a?a.number:a))?r:s,typeof r===o?r.call(a,{name:"number",hash:{},data:n}):r))+"</span>\n    <span>"+u((r=null!=(r=e.measureUnit||(null!=a?a.measureUnit:a))?r:s,typeof r===o?r.call(a,{name:"measureUnit",hash:{},data:n}):r))+"</span>\n  </div>\n</div>"},useData:!0}),i=function(a){this.container=a.container,this.meta=a.meta,this.unitName=a.unitName,this.container.addClass("has-content"),this.weekdays=["日","一","二","三","四","五","六"],this.bindEvent()};i.prototype=$.extend(!0,{},sensorsdata.EventsModule,{bindEvent:function(){this.on("done",function(){return this.meta.singleMeasure?(this.firstRender(!0),this.chart.on("showTip",function(a){var e=a.dataIndex;this.handleHover(e)}.bind(this)),void this.chart.on("hideTip",function(){this.firstRender(!1)}.bind(this))):void this.off("update")})},update:function(){this.container.addClass("has-content")},firstRender:function(a){if(!a&&this.firstDataStr)return void this.container.html(this.firstDataStr);var e={},i=this.chartsData,r="",s=[],o=i.legend.data.slice(0,3),u=i.color.slice(0,3),l=[];i.series.forEach(function(a){a.name in e||(l.push(a),e[a.name]=!0)}),l=this.series=l.slice(0,3);for(var h=0,m=o.length;m>h;h++){var d=l[h].data[l[h].data.length-1],c="number"==typeof d.value?t(d.value):"--",f={three:m>2,date:d.xLabel,number:c.formatNumber&&c.formatNumber||c,measureUnit:c.unit&&c.unit+d.measureUnit||d.measureUnit,groupName:o[h].name,color:u[h]};s.push(f),r+=n(f)}this.firstData=s,this.firstDataStr=r,this.container.html(r)},handleHover:function(a){for(var e=this.firstData,i=this.series,r="",s=0,o=e.length;o>s;s++){var u=moment(this.meta.from_date).add(a,"days"),l={};for(var h in i[s].data[0])l[h]=i[s].data[0][h];l.value="--",l.xLabel=u.format("M-DD")+"("+this.weekdays[u.format("d")]+")",l.rawValue="--";var m=i[s].data[a]||l,d="number"==typeof m.value?t(m.value):"--",c={three:o>2,date:m.xLabel,number:d.formatNumber&&d.formatNumber||d,measureUnit:d.unit&&d.unit+m.measureUnit||m.measureUnit,groupName:e[s].groupName,color:e[s].color};r+=n(c)}this.container.html(r)},getFirstDate:function(){var a;switch(this.meta.queryParams.unit){case"day":a="最近一天";break;default:a="本周"}return a},clear:function(){this.container.html(""),this.container.removeClass("has-content")}}),e.create=function(a){return new i(a)}});
;/*!components/widgetRetentionTab/widgetRetentionTab.js*/
define("components/widgetRetentionTab/widgetRetentionTab",function(t,a){var e=Handlebars.template({1:function(){return" active"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,a,e,n){var i;return'<span data-type="change" class="'+(null!=(i=a["if"].call(t,null!=t?t.isDefault:t,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+'">变化</span>\n<span data-type="trend" class="'+(null!=(i=a["if"].call(t,null!=t?t.isDefault:t,{name:"if",hash:{},fn:this.noop,inverse:this.program(1,n,0),data:n}))?i:"")+'">趋势</span>'},useData:!0}),n=function(t){this.container=t.container,this.meta=t.meta,this.widgetHeader=t.widgetHeader,this.init()};n.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.container.html(e({isDefault:"default"===this.meta.tabName||"change"===this.meta.tabName})),this.btns=this.container.find("span"),this.container.prev().prev().addClass("retention-title"),this.bindEvent()},bindEvent:function(){var t=this;this.btns.on("click",function(){var a=$(this);a.hasClass("active")||(a.addClass("active").siblings().removeClass("active"),t.widgetHeader.trigger("change",{action:"changeTab",tabName:a.attr("data-type"),isShareDash:a.parent().attr("isShareDash")}))})}}),a.create=function(t){return new n(t)}});
;/*!components/miniPanel/miniPanel.js*/
define("components/miniPanel/miniPanel",function(e,n,t){var i={miniPanelTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,t,i){var l,o,a=n.helperMissing,f="function",r=this.escapeExpression;return'<div class="mini-panel" style="top: '+r((o=null!=(o=n.top||(null!=e?e.top:e))?o:a,typeof o===f?o.call(e,{name:"top",hash:{},data:i}):o))+"px;left: "+r((o=null!=(o=n.left||(null!=e?e.left:e))?o:a,typeof o===f?o.call(e,{name:"left",hash:{},data:i}):o))+'px;">\n  '+(null!=(o=null!=(o=n.html||(null!=e?e.html:e))?o:a,l=typeof o===f?o.call(e,{name:"html",hash:{},data:i}):o)?l:"")+"\n</div>"},useData:!0})},l=$.extend(!0,{},sensorsdata.EventsModule,{getElementRight:function(e){for(var n=e.offsetLeft,t=e.offsetParent;null!==t;)n+=t.offsetLeft,t=t.offsetParent;return n+$(e).width()},getElementTop:function(e){for(var n=e.offsetTop,t=e.offsetParent;null!==t;)n+=t.offsetTop,t=t.offsetParent;return n},show:function(e,n){var t=this,l=e.ele;this.$ele=l,$(".mini-panel").remove(),$("body").append(i.miniPanelTpl({html:e.template,top:t.getElementTop(l[0]),left:t.getElementRight(l[0])+5})),"function"==typeof n&&n(),this.initEvents()},hide:function(){$(".mini-panel").hide(),$("body").off("click.miniPanel")},initEvents:function(){var e=this,n=function(e,n){for(var t=e.relatedTarget?e.relatedTarget:"mouseout"===e.type?e.toElement:e.fromElement;t&&t!==n;)t=t.parentNode;return t!==n};$(".mini-panel").on("mouseout",function(e){return e=e||window.event,n(e,this)?void $(".mini-panel").hide():!1}),$("body").off("click.miniPanel").on("click.miniPanel",function(n){var t=$(n.target);return t.is(e.$ele)?!1:void e.hide()})},destroy:function(){$(".mini-panel").remove()}});t.exports=l});
;/*!components/charts/normal/normal.js*/
define("components/charts/normal/normal",function(e,a){function t(e){if(!e.container)throw new Error("无效的widget容器");if(!e.meta)throw new Error("无效的widget元数据信息");this.options=$.extend(!0,{},e),this.$dashboardContainer=e.container,this.meta=e.meta||{},this.chartsData=$.extend(!0,{},e.chartsData),this.numberData=$.extend(!0,{},e.numberData),this.isShareDash=!!this.options.isShareDash,this.widgetHeader=null,this.widgetBody=null,this.init(e)}var n={content:Handlebars.template({1:function(){return'style="cursor: auto;"'},3:function(e,a,t,n){var i;return"<span>~</span>"+this.escapeExpression((i=null!=(i=a.to_date||(null!=e?e.to_date:e))?i:a.helperMissing,"function"==typeof i?i.call(e,{name:"to_date",hash:{},data:n}):i))},5:function(e,a,t,n){var i;return" | "+this.escapeExpression((i=null!=(i=a.rangeText||(null!=e?e.rangeText:e))?i:a.helperMissing,"function"==typeof i?i.call(e,{name:"rangeText",hash:{},data:n}):i))},7:function(e,a,t,n){var i;return'        <div class="dropdown widget-set-menu">\n          <span class="dropdown-toggle more-method icon-more" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"></span>\n          <ul class="dropdown-menu">\n'+(null!=(i=a.each.call(e,null!=e?e.sizes:e,{name:"each",hash:{},fn:this.program(8,n,0),inverse:this.noop,data:n}))?i:"")+'            <li role="separator" class="divider"></li>\n            <li data-method="set" class=""><a>设置<!--{en}Setting--></a></li>\n            <li data-method="del" class=""><a>删除<!--{en}Delete--></a></li>\n          </ul>\n        </div>\n'},8:function(e,a,t,n){var i,s,r=a.helperMissing,o="function",l=this.escapeExpression;return'              <li data-value="'+l((s=null!=(s=a.name||(null!=e?e.name:e))?s:r,typeof s===o?s.call(e,{name:"name",hash:{},data:n}):s))+'" data-method="set-size"  class="'+(null!=(i=a["if"].call(e,null!=e?e.disabled:e,{name:"if",hash:{},fn:this.program(9,n,0),inverse:this.noop,data:n}))?i:"")+" "+(null!=(i=a["if"].call(e,null!=e?e.selected:e,{name:"if",hash:{},fn:this.program(11,n,0),inverse:this.noop,data:n}))?i:"")+'">\n                <a><span>'+l((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:r,typeof s===o?s.call(e,{name:"cname",hash:{},data:n}):s))+'</span><span class="icon-finish"></span></a>\n              </li>\n'},9:function(){return"disabled"},11:function(){return"selected"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var i,s,r=a.helperMissing,o="function",l=this.escapeExpression;return'<div class="widget-container" data-chart-type="'+l((s=null!=(s=a.chartsType||(null!=e?e.chartsType:e))?s:r,typeof s===o?s.call(e,{name:"chartsType",hash:{},data:n}):s))+'" data-widgetid="'+l((s=null!=(s=a.id||(null!=e?e.id:e))?s:r,typeof s===o?s.call(e,{name:"id",hash:{},data:n}):s))+'" data-size="'+l((s=null!=(s=a.currentSize||(null!=e?e.currentSize:e))?s:r,typeof s===o?s.call(e,{name:"currentSize",hash:{},data:n}):s))+'" data-module="'+l((s=null!=(s=a.type||(null!=e?e.type:e))?s:r,typeof s===o?s.call(e,{name:"type",hash:{},data:n}):s))+'">\n  <div class="widget-content-container">\n    <div class="mark-contend"></div>\n    <div class="widget-topbar" '+(null!=(i=a["if"].call(e,null!=e?e.isShareDash:e,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+'>\n      <div class="widget-title">\n        <div class="title">\n          <a href="'+l((s=null!=(s=a.url||(null!=e?e.url:e))?s:r,typeof s===o?s.call(e,{name:"url",hash:{},data:n}):s))+'" data-method="nav">'+l((s=null!=(s=a.name||(null!=e?e.name:e))?s:r,typeof s===o?s.call(e,{name:"name",hash:{},data:n}):s))+'</a>\n          <span class="icon-failed"></span>\n        </div>\n        <div class="range">'+l((s=null!=(s=a.from_date||(null!=e?e.from_date:e))?s:r,typeof s===o?s.call(e,{name:"from_date",hash:{},data:n}):s))+(null!=(i=a["if"].call(e,null!=e?e.to_date:e,{name:"if",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?i:"")+(null!=(i=a["if"].call(e,null!=e?e.rangeText:e,{name:"if",hash:{},fn:this.program(5,n,0),inverse:this.noop,data:n}))?i:"")+'</div>\n      </div>\n      <div class="pull-right widget-setting">\n        <div class="customer-menu"></div>\n'+(null!=(i=a.unless.call(e,null!=e?e.isShareDash:e,{name:"unless",hash:{},fn:this.program(7,n,0),inverse:this.noop,data:n}))?i:"")+'      </div>\n    </div>\n    <div class="widget-single-measure">\n\n      </div>\n    <div class="widget-chart-container container">\n      <div class="" data-container="side"></div>\n      <div class="" data-container="main"></div>\n    </div>\n  </div>\n</div>\n'},useData:!0}),title:Handlebars.template({1:function(e,a,t,n){var i;return"<span>~</span>"+this.escapeExpression((i=null!=(i=a.to_date||(null!=e?e.to_date:e))?i:a.helperMissing,"function"==typeof i?i.call(e,{name:"to_date",hash:{},data:n}):i))},3:function(e,a,t,n){var i;return" | "+this.escapeExpression((i=null!=(i=a.rangeText||(null!=e?e.rangeText:e))?i:a.helperMissing,"function"==typeof i?i.call(e,{name:"rangeText",hash:{},data:n}):i))},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var i,s,r=a.helperMissing,o="function",l=this.escapeExpression;return'<div class="title">\n  <a href="'+l((s=null!=(s=a.url||(null!=e?e.url:e))?s:r,typeof s===o?s.call(e,{name:"url",hash:{},data:n}):s))+'" data-method="nav">'+l((s=null!=(s=a.name||(null!=e?e.name:e))?s:r,typeof s===o?s.call(e,{name:"name",hash:{},data:n}):s))+'</a>\n  <span class="icon-failed"></span>\n</div>\n<div class="range">'+l((s=null!=(s=a.from_date||(null!=e?e.from_date:e))?s:r,typeof s===o?s.call(e,{name:"from_date",hash:{},data:n}):s))+(null!=(i=a["if"].call(e,null!=e?e.to_date:e,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+(null!=(i=a["if"].call(e,null!=e?e.rangeText:e,{name:"if",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?i:"")+"</div>\n"},useData:!0}),dropdown:Handlebars.template({1:function(e,a,t,n){var i,s,r=a.helperMissing,o="function",l=this.escapeExpression;return'  <li data-value="'+l((s=null!=(s=a.name||(null!=e?e.name:e))?s:r,typeof s===o?s.call(e,{name:"name",hash:{},data:n}):s))+'" data-method="set-size" '+(null!=(i=a["if"].call(e,null!=e?e.disabled:e,{name:"if",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n}))?i:"")+" "+(null!=(i=a["if"].call(e,null!=e?e.selected:e,{name:"if",hash:{},fn:this.program(4,n,0),inverse:this.noop,data:n}))?i:"")+">\n    <a><span>"+l((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:r,typeof s===o?s.call(e,{name:"cname",hash:{},data:n}):s))+'</span><span class="icon-finish"></span></a>\n  </li>\n'},2:function(){return' class="disabled"'},4:function(){return'class="selected"'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var i;return(null!=(i=a.each.call(e,null!=e?e.sizes:e,{name:"each",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+'<li role="separator" class="divider"></li>\n<li data-method="set" class=""><a>设置<!--{en}Setting--></a></li>\n<li data-method="del" class=""><a>删除<!--{en}Delete--></a></li>\n'},useData:!0}),del:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover">\n    <div class="arrow"></div>\n    <h2 class="popover-title"></h2>\n    <div class="popover-content">\n      <span>确认启用此埋点吗？<!--{en}Are you sure to activate this tracking?--></span>\n      <div class="remark">本操作将在 1 分钟后生效<!--{en}This operation will take effect in 1 minutes--></div>\n    </div>\n    <div class="popover-content-footer clearfix">\n      <div class="popover-footer-right">\n        <button type="button" class="pop-is-cancel btn-link">取消<!--{en}Cancel--></button>\n        <button type="button" class="pop-is-success btn btn-primary">确定<!--{en}Ok--></button>\n      </div>\n    </div>\n  </div>'},useData:!0}),delContent:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return""},useData:!0}),noData:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="no-data">无数据<!--{en}No Data--></div>'},useData:!0}),container:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="" data-container="side"></div>\n<div class="" data-container="main"></div>'},useData:!0}),noSupport:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="no-support">\n  不支持<!--{en}No Support-->\n</div>'},useData:!0}),error:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var i;return'<div class="no-data">'+this.escapeExpression((i=null!=(i=a.error||(null!=e?e.error:e))?i:a.helperMissing,"function"==typeof i?i.call(e,{name:"error",hash:{},data:n}):i))+"</div>"},useData:!0})},i={segmentation:!0,utm:!0},s=e("components/widgetHeader/widgetHeader"),r=e("components/widgetBody/widgetBody"),o=e("components/widgetTopMeasure/widgetTopMeasure"),l=e("components/widgetRetentionTab/widgetRetentionTab"),d=e("components/miniPanel/miniPanel"),c=e("components/util/util"),h=e("components/router/router");t.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.render(),this.bindEvents()},bindEvents:function(){var e=this;this.widgetBody.on("done",c.bind(function(){if(this.trigger("done"),this.meta.singleMeasure){if(this.widgetTopMeasure&&this.widgetBody.chartsInstance[0])this.widgetTopMeasure.clear(),this.widgetTopMeasure=null;else if(!this.widgetBody.chartsInstance[0])return;this.widgetTopMeasure=o.create({container:this.$container.find(".widget-single-measure"),meta:this.meta}),this.widgetTopMeasure.chartsData=this.widgetBody.chartsData,this.widgetTopMeasure.chart=this.widgetBody.chartsInstance[0].chart,this.widgetTopMeasure.trigger("done")}else this.widgetTopMeasure&&this.widgetTopMeasure.clear()},this)),this.widgetHeader.on("done",c.bind(function(){this.options.meta.isRetention&&(this.retentionTab=l.create({container:this.$container.find(".retention-tab"),meta:this.meta,widgetHeader:this.widgetHeader}))},this)),this.$container.delegate(".icon-failed","mouseover",function(){var a=$(this).attr("data-tip");d.show({ele:e.$container.find(".icon-failed"),template:a+'<a class="refresh-btn">刷新</a>'},function(){$(".mini-panel .refresh-btn").on("click",function(){e.options.onMessage({action:"useCache",data:{id:e.$container.attr("data-widgetid"),dashboard_cache_policy:"NORMAL"}}),d.hide()})})}),this.widgetHeader.on("change",function(a){var t=a;t.data=t.data||{},t.data.id=e.meta.id;var n=e.options.dashid;switch(t.action){case"view":h.nav(e.meta.url,{from:$("body").attr("data-page"),action:"view",dashid:n});break;case"set":i[e.meta.type]?$.isFunction(e.options.onMessage)&&e.options.onMessage(t):h.nav(e.meta.url,{from:"dashboard",action:"view",dashid:n});break;default:$.isFunction(e.options.onMessage)&&e.options.onMessage(t)}}),this.$container.delegate('.more-method[data-toggle="dropdown"]',"click.toggle",function(){$(this).data("bs.popover")&&$(this).popover("destroy")})},render:function(){this.preRenderNormal(),this.$dashboardContainer.append(n.content(this.meta)),this.$container=this.$dashboardContainer.find("div.widget-container").last(),this.widgetBody=r.create({container:this.$container.find(".widget-chart-container"),meta:this.options.meta,chartsData:this.chartsData,numberData:this.numberData,isShareDash:this.isShareDash}),this.widgetHeader=s.create({container:this.$container.find(".widget-topbar"),meta:this.options.meta,chartsData:this.chartsData,isShareDash:this.isShareDash}),this.meta.singleMeasure&&(this.widgetTopMeasure=o.create({container:this.$container.find(".widget-single-measure"),meta:this.meta}))},update:function(e){this.$container.toggleClass("widget-error",e.error),this.meta=$.isEmptyObject(e.meta)?this.meta||{}:$.extend(!0,{},e.meta),e.size&&(this.meta.currentSize=e.size),this.widgetHeader.update(e),this.widgetBody.update(e),this.$container.attr("data-size",this.meta.currentSize),e.meta&&e.meta.singleMeasure&&this.widgetTopMeasure.update(e)},resize:function(){-1===window.search.indexOf("f=email")&&this.update({})},destroy:function(){this.widgetHeader&&$.isFunction(this.widgetHeader.destroy)&&this.widgetHeader.destroy(),this.widgetBody&&$.isFunction(this.widgetBody.destroy)&&this.widgetBody.destroy(),this.$container.remove()},clean:function(){this.$container.find(".widget-chart-container").html($("#tpl-widget-loader").html())},preRenderNormal:function(){var e=this.options.meta;"retention"===e.type&&(e.isRetention=!0)}}),a.create=function(e){return new t(e)}});
;/*!components/filterDropdown/filterDropdown.js*/
define("components/filterDropdown/filterDropdown",function(t,n){var e=Handlebars.template({1:function(t,n,e,i){var o,l=n.helperMissing,s="function",c=this.escapeExpression;return'    <li class="filter-item">\n      <label class="common-checkbox">\n        <input type="checkbox" value="'+c((o=null!=(o=n.value||(null!=t?t.value:t))?o:l,typeof o===s?o.call(t,{name:"value",hash:{},data:i}):o))+'">\n        <span class="checkbox-icon"></span>\n      </label>\n      <span class="detail">'+c((o=null!=(o=n.text||(null!=t?t.text:t))?o:l,typeof o===s?o.call(t,{name:"text",hash:{},data:i}):o))+"</span>\n    </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,n,e,i){var o;return'<div class="max-height: 400px; overscroll-y: scroll;">\n'+(null!=(o=n.each.call(t,t,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?o:"")+'</div>\n<li class="footer">\n  <button data-method="confirm" class="btn btn-link btn-small pull-right">确定<!--{en}Ok--></button>\n  <button data-method="reset" class="cancel btn btn-link btn-small pull-left">重置<!--{en}Reset--></button>\n</li>\n'},useData:!0}),i=t("components/util/util"),o=function(t){if(!t.ele)throw new Error("无效的初始化元素");this.$ele=t.ele,0===this.$ele.next("ul:first").length?(this.$ul=$('<ul class="filter-dropdown dropdown-menu"></ul>'),t.container?t.container.append(this.$ul):this.$ele.parent().append(this.$ul)):this.$ul=this.$ele.next("ul:first"),this.$ele.parent().addClass("dropdown");var n={value:null,onConfirm:null,type:"filter",autoshow:!0,list:null,position:"left"};this.selected=[],this.list=t.list||[],this.id="filterDropdown_"+i.guid(),this.$ul.attr("data-id",this.id),this.options=$.extend(!0,n,t),this.init()};o.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.$ul.html(e(this.list)),this.bindEvents(),this.$ul.dropdown(),this.options.autoshow&&this.$ul.dropdown("toggle"),this.$ele.data("filterDropdown",!0)},bindEvents:function(){var t=this,n=this.$ul;this.$ele.unbind("click").bind("click",function(){t.$ul.toggle()}),n.find("li").off("click").on("click."+this.id,function(t){t.stopPropagation();var n=$(this).find('input[type="checkbox"]');n.prop("checked",!n.prop("checked"))}),n.find("li label").off("click").on("click",function(){var t=$(this).find('input[type="checkbox"]');t.prop("checked",!t.prop("checked"))}),n.find('[data-method="reset"]').on("click.reset",function(){n.find("li input").prop("checked",!1),n.toggle(!1),t.confirm()});var e;n.parent().on("show.bs.dropdown",function(){e=$(this).find('.dropdown-menu[data-id="'+t.id+'"]'),$("body").append(e.detach());var n=t.$ele.offset(),i=n.left,o=n.top+t.$ele.outerHeight();e.css({display:"block",top:o,left:i}),t.$ele.length>0&&t.$ele.off("click."+t.id).on("click."+t.id,function(){if("none"!==e.css("display")){var n=$(this).offset();e.css({top:n.top+t.$ele.outerHeight(),left:n.left})}})}),n.parent().on("hide.bs.dropdown",function(){$(this).append(e.detach()),e.hide()}),n.find('[data-method="confirm"]').on("click.confirm",function(){t.confirm()}),$(document).off("click."+this.id).on("click."+this.id,function(n){var e=$(n.target||n.srcElement);0!==e.closest(".filterDropdown").size()||e.closest('[data-method="filter"]').is(t.$ele)||1!==e.parents("body").size()||t.confirm()})},confirm:function(){var t=this,n=[],e=this.$ul;e.find("li input:checked").each(function(){n.push($(this).val())}),this.$ele.toggleClass("active",n.length>0),this.$ul.toggle(!1),$.isFunction(t.options.onConfirm)&&t.options.onConfirm(n)},destroy:function(){this.$ele.off("click."+this.id),this.$ul.off("show.bs.dropdown"),this.$ul.off("hide.bs.dropdown"),$(document).off("click."+this.id),this.$ul.remove()}}),n.create=function(t){return new o(t)}});
;/*!components/clustering/table/table.js*/
define("components/clustering/table/table",function(t,e){var n=t("components/basicTable/basicTable"),a=t("components/util/util"),s={table:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="clustering-table-container">\n  <table class="display nowrap clustering-table" width="100%">\n    <thead>\n\n    </thead>\n    <tbody>\n\n    </tbody>\n  </table>\n</div>\n'},useData:!0}),header:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<tr>\n  <th class="filter"><span>状态<!--{en}Status--></span><span class="icon-filter-set" data-method="filter" data-value="status"></span></th>\n  <th class="sortable"><span>分群名称<!--{en}Cluster name--></span><span class="icon_selector"></span></th>\n  <th class="sortable"><span>分群人数<!--{en}Number of clustering people--></span><span class="icon_selector"></span></th>\n  <th class="filter dropdown"><span>计算周期<!--{todo}--></span><span class="icon-filter-set" data-method="filter" data-value="mode" data-position="right"></span></th>\n  <th class="filter dropdown"><span>类型<!--{en}Type--></span><span class="icon-filter-set" data-method="filter" data-value="type" data-position="right"></span></th>\n  <th class="filter dropdown ghost"><span></span><span class="icon-filter-set" data-method="filter" data-value="computype" data-position="right"></span></th>\n  <th class="sortable"><span>最后计算时间<!--{en}Final calculation time--></span><span class="icon_selector"></span></th>\n  <th class="filter dropdown"><span>创建者<!--{en}Creator--></span></th>\n  <th class="filter"><span>操作<!--{en}Operate--></span></th>\n  <th></th>\n</tr>\n'},useData:!0}),body:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return""},useData:!0}),action:Handlebars.template({1:function(){return'<span class="glyphicon glyphicon-trash" data-method="del"></span>'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i,r,l='<span class="icon-edit" data-method="edit"></span>\n';return i=null!=(i=e.enableDel||(null!=t?t.enableDel:t))?i:e.helperMissing,r={name:"enableDel",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a},s="function"==typeof i?i.call(t,r):i,e.enableDel||(s=e.blockHelperMissing.call(t,s,r)),null!=s&&(l+=s),l+"\n"},useData:!0}),del:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover">\n  <div class="arrow"></div>\n  <h2 class="popover-title"></h2>\n  <div class="popover-content">\n  </div>\n  <div class="popover-content-footer clearfix">\n    <div class="popover-footer-right">\n      <button type="button" class="pop-is-cancel btn-link">取消<!--{en}Cancel--></button>\n      <button type="button" class="pop-is-success btn btn-primary">确定<!--{en}Ok--></button>\n    </div>\n  </div>\n</div>\n'},useData:!0}),success_time:Handlebars.template({1:function(){return'<div class="success"></div>\n<span>成功<!--{todo}-->&nbsp;&nbsp;</span>\n'},3:function(){return'<div class="failed"></div>\n<span>失败<!--{todo}-->&nbsp;&nbsp;</span>\n'},5:function(){return'<span class="icon-computing"></span>\n<span>计算中&nbsp;&nbsp;</span>\n'},7:function(){return'<div class="new"></div>\n<span>待计算&nbsp;&nbsp;</span>\n'},9:function(){return"其他&nbsp;&nbsp;\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i;return(null!=(s=e["if"].call(t,null!=t?t.success:t,{name:"if",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?s:"")+(null!=(s=e["if"].call(t,null!=t?t.failed:t,{name:"if",hash:{},fn:this.program(3,a,0),inverse:this.noop,data:a}))?s:"")+(null!=(s=e["if"].call(t,null!=t?t.computing:t,{name:"if",hash:{},fn:this.program(5,a,0),inverse:this.noop,data:a}))?s:"")+(null!=(s=e["if"].call(t,null!=t?t["new"]:t,{name:"if",hash:{},fn:this.program(7,a,0),inverse:this.noop,data:a}))?s:"")+(null!=(s=e["if"].call(t,null!=t?t.other:t,{name:"if",hash:{},fn:this.program(9,a,0),inverse:this.noop,data:a}))?s:"")+this.escapeExpression((i=null!=(i=e.success_time||(null!=t?t.success_time:t))?i:e.helperMissing,"function"==typeof i?i.call(t,{name:"success_time",hash:{},data:a}):i))+"\n"},useData:!0}),no:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="noResult-clustering" class="noResult-container">\n  <p class="noResult-mark">\n    <svg width="79px" height="79px" viewBox="0 0 79 79" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <desc>noResult</desc>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Group-17" transform="translate(-94.000000, 0.000000)">\n          <g id="Group-13" transform="translate(94.000000, 0.000000)">\n            <circle id="Oval-8" fill="#F4F8FD" cx="39.5" cy="39.5" r="39.5"></circle>\n            <g id="repair" transform="translate(20.000000, 19.000000)" fill-rule="nonzero">\n              <path d="M37.5139181,26.0078125 C35.6191813,24.109375 32.905809,23.2657031 30.2859259,23.7344531 L25.8324366,19.15625 C25.3646004,18.6875 24.6159844,18.7109375 24.17154,19.1796875 L21.785653,21.5702344 L19.3059649,24.0546094 C18.8382066,24.5233594 18.8382066,25.2499219 19.3059649,25.71875 L23.6659649,30.3671094 C23.2215205,32.96875 24.0401559,35.7109375 25.9582846,37.609375 C29.1396491,40.796875 34.3326316,40.796875 37.5138402,37.609375 C40.7185965,34.3984375 40.7185965,29.1953125 37.5139181,26.0078125 Z M29.2566862,34.2813281 C28.5782456,33.6015625 28.2274464,32.7109375 28.2274464,31.7969531 C28.2274464,30.9063281 28.5782456,30.0157031 29.2566862,29.3125781 C30.6134893,27.953125 32.8589474,27.953125 34.2157505,29.3125781 C35.5957895,30.6953125 35.5957895,32.921875 34.2157505,34.2813281 C32.8590253,35.6640625 30.6134893,35.6640625 29.2566862,34.2813281 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M37.5139181,37.609375 C34.3326316,40.796875 29.1397271,40.796875 25.9583626,37.609375 C24.0402339,35.7109375 23.2215984,32.9688281 23.6660429,30.3671094 L19.3060429,25.71875 C18.8382846,25.25 18.8382846,24.5234375 19.3060429,24.0546094 L21.785731,21.5702344 L29.2566862,29.3125781 C28.5782456,30.0157031 28.2274464,30.9063281 28.2274464,31.7969531 C28.2274464,32.7109375 28.5782456,33.6015625 29.2566862,34.2813281 C30.6134893,35.6640625 32.8589474,35.6640625 34.2157505,34.2813281 L37.5139181,37.609375 Z"\n                id="Shape" fill="#2DCA93"></path>\n              <path d="M20.7797271,14.2578125 L16.1813645,10.0078125 C16.7895517,7.26570313 15.994152,4.40625 13.9825341,2.390625 C10.7778558,-0.796875 5.58479532,-0.796875 2.40358674,2.390625 C-0.801091618,5.6015625 -0.801091618,10.7813281 2.40358674,13.9921875 C4.29832359,15.890625 7.03524366,16.7342969 9.63173489,16.2655469 L14.3470565,20.75 C14.5576608,20.9608594 14.8617544,21.078125 15.165848,21.078125 C15.4699415,21.078125 15.7506433,20.9608594 15.9844834,20.75 L18.4640156,18.2421875 L20.8031969,15.8984375 C21.2710331,15.453125 21.2476413,14.703125 20.7797271,14.2578125 Z M5.70191033,10.6874219 C5.02346979,9.98429687 4.67267057,9.09367187 4.67267057,8.20304687 C4.67267057,7.2890625 5.02346979,6.3984375 5.70191033,5.71867187 C7.03524366,4.38273437 9.35103314,4.38273437 10.6843665,5.71867187 C12.0410136,7.078125 12.0410136,9.3046875 10.6609747,10.6874219 C9.30417154,12.046875 7.08194932,12.046875 5.70191033,10.6874219 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M18.4640156,18.2421875 L15.9844834,20.75 C15.7506433,20.9608594 15.4699415,21.078125 15.165848,21.078125 C14.8617544,21.078125 14.5576608,20.9608594 14.3470565,20.75 L9.63173489,16.2655469 C7.03524366,16.7342969 4.29832359,15.890625 2.40358674,13.9921875 C-0.801091618,10.78125 -0.801091618,5.60148438 2.40358674,2.390625 L5.70191033,5.71867187 C5.02346979,6.3984375 4.67267057,7.2890625 4.67267057,8.20304687 C4.67267057,9.09367187 5.02346979,9.98429687 5.70191033,10.6874219 C7.08194932,12.046875 9.30417154,12.046875 10.6609747,10.6874219 L18.4640156,18.2421875 Z"\n                id="Shape" fill="#2DCA93"></path>\n              <path d="M39.1359844,4.65773437 C38.7850292,3.95460937 37.8260429,3.76726562 37.2412476,4.35320312 L33.7793372,7.821875 C33.3582846,7.72820312 33.0073294,7.5171875 32.7032359,7.2359375 C32.4225341,6.93125 32.2119298,6.57960937 32.1184405,6.15773437 L35.5803509,2.6890625 C36.1651462,2.1265625 36.0015595,1.14210937 35.2762573,0.790625 C32.1418324,-0.6859375 28.3992203,-0.053125 25.942924,2.4078125 C23.9780897,4.37648437 23.1826901,7.16554687 23.7207797,9.83742187 C18.691462,14.8530469 14.6661209,18.70375 9.63680312,23.7192187 C7.01692008,23.2271094 4.25668616,24.0708594 2.29185185,26.0864062 C-0.912826511,29.4146094 -0.655516569,34.5707812 2.43220273,37.6177344 C5.6602729,40.8286719 10.8766472,40.8052344 14.0812476,37.4769531 C15.9759844,35.5082812 16.7011306,32.8832812 16.2566862,30.3520312 L30.4809357,16.30625 C33.0073294,16.7046094 35.6271345,15.9078906 37.5218713,14.0094531 C39.9780117,11.5483594 40.6096686,7.79835937 39.1359844,4.65773437 Z M10.6660429,34.2660937 C9.30939571,35.6489844 7.1105653,35.6489844 5.73037037,34.2895312 L5.70697856,34.2660937 C4.35033138,32.9067969 4.35033138,30.6802344 5.70697856,29.2973437 C7.08717349,27.9380469 9.30939571,27.9380469 10.6660429,29.2973437 C12.0462378,30.6802344 12.0462378,32.906875 10.6660429,34.2660937 Z"\n                id="Shape" fill="#D7ECF6"></path>\n              <path d="M37.5218713,14.009375 C35.6271345,15.9078125 33.0072515,16.7046094 30.4809357,16.3061719 L16.2567641,30.3521094 C16.7012086,32.8834375 15.9760624,35.5083594 14.0813255,37.4770313 C10.8766472,40.8052344 5.66035088,40.82875 2.4322807,37.6178125 L5.73044834,34.2896094 C7.11064327,35.6490625 9.30947368,35.6490625 10.6661209,34.2661719 C12.0463158,32.906875 12.0463158,30.6803125 10.6661209,29.2974219 L32.7032359,7.2359375 C33.0073294,7.5171875 33.3582846,7.72820313 33.7793372,7.821875 L37.2412476,4.35320313 C37.8260429,3.76726563 38.7850292,3.9546875 39.1359844,4.65773438 C40.6096686,7.79835938 39.9780117,11.5483594 37.5218713,14.009375 Z"\n                id="Shape" fill="#C1DBE8"></path>\n            </g>\n          </g>\n        </g>\n      </g>\n    </svg>\n  </p>\n  <p class="noResult-desc">还未创建用户分群<!--{en}User clustering has not yet been created.--></p>\n</div>'},useData:!0}),filter:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t){return'<div class="filter">\n  '+this.escapeExpression(this.lambda(t,t))+"\n</div>"},useData:!0}),empty:Handlebars.template({1:function(t){return"    <div>"+this.escapeExpression(this.lambda(t,t))+"</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var s,i,r,l=e.helperMissing,o="function",c='<div class="empty-table">\n  <img src="/res/img/'+this.escapeExpression((i=null!=(i=e.img||(null!=t?t.img:t))?i:l,typeof i===o?i.call(t,{name:"img",hash:{},data:a}):i))+'.png">\n  <div>\n';return i=null!=(i=e.tip||(null!=t?t.tip:t))?i:l,r={name:"tip",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a},s=typeof i===o?i.call(t,r):i,e.tip||(s=e.blockHelperMissing.call(t,s,r)),null!=s&&(c+=s),c+"  </div>\n</div>\n"},useData:!0})},i=t("components/filterDropdown/filterDropdown"),r=[{value:[0,1],text:sensorsdata.languages.get("规则创建<!--{todo}-->"),"class":"tr_type_rule"},{value:[2],text:sensorsdata.languages.get("结果创建<!--{todo}-->"),"class":"tr_type_result"},{value:[5,6],text:sensorsdata.languages.get("上传创建<!--{todo}-->"),"class":"tr_type_upload"}],l=[{value:"true",text:sensorsdata.languages.get("已启用<!--{todo}-->")},{value:"false",text:sensorsdata.languages.get("暂停<!--{todo}-->")}],o=[{value:[0,2,3,4,5],text:sensorsdata.languages.get("单次<!--{todo}-->")},{value:[1,6,7],text:sensorsdata.languages.get("例行<!--{todo}-->")}],c=[{value:"succeed",text:sensorsdata.languages.get("成功<!--{todo}-->")},{value:"failed",text:sensorsdata.languages.get("失败<!--{todo}-->")},{value:"computing",text:sensorsdata.languages.get("计算中<!--{todo}-->")}],d={type:r,status:l,mode:o,computype:c},u=function(t){if(!t.container)throw new Error("无效的表格容器");if(!t.data||!$.isArray(t.data.result))throw new Error("无效的数据");this.options=t,this.originData=[],this.$container=t.container,this.$tableInstance=null,this.$filterInstance=[],this.filterObj={},this.data=t.data.result||[],this.newIdStack=[],this.highLightTimeOutIdList=[],this.init()};u.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.render(),this.bindEvents()},dataTableGenerator:function(t){var e={paging:(t||[]).length>20,searching:!0,info:!1,dom:"tip",iDisplayLength:20,columnDefs:[{targets:"filter",orderable:!1}],fixedColumns:{leftColumns:2},scrollY:!1,language:{emptyTable:s.no(),thousands:",",zeroRecords:s.empty({img:"empty",tip:[sensorsdata.languages.get("没有找到符合条件的分群<!--{todo}-->")]})},scrollX:!0,columns:[{data:"scheduler.running",render:function(t){return sensorsdata.languages.get(t?"已启用<!--{todo}-->":"暂停<!--{todo}-->")}},{data:null,render:function(t){var e="";if((5===t.type||6===t.type)&&t.last_partition){var n=t.last_partition.status;("computing"===n||"new"===n)&&(e="disabled")}return'<span data-method="cluster-detail" class="'+e+'">'+t.cname+"</span>"}},{data:null,render:function(t){return"succeed"!==t.last_partition.status?"-":sensorsdata.formatNumber(t.last_partition.count)}},{data:null,render:function(t){var e=(o.filter(function(e){return-1!==e.value.indexOf(t.type)})[0]||{}).text;return"例行"===e?"例行 按天":"单次"}},{data:"type",render:function(t){var e=(r.filter(function(e){return-1!==e.value.indexOf(t)})[0]||{}).text||"未知",n=(r.filter(function(e){return-1!==e.value.indexOf(t)})[0]||{}).class||"";return'<span class="'+n+'">'+e+"</span>"}},{data:"last_partition.status",render:function(t){return t}},{data:null,render:function(t,e){if("display"===e){var n=t.last_partition?t.last_partition.status:t.status,a=t.last_partition?t.last_partition.finished_time:"-",i={success:"succeed"===n,failed:"failed"===n,"new":"new"===n,other:"succeed"!==n&&"failed"!==n&&"computing"!==n&&"new"!==n,computing:"computing"===n,success_time:"computing"===n?"-":a};return s.success_time(i)}return"sort"===e?t.last_partition&&t.last_partition.finished_time?moment(t.last_partition.finished_time):"-":t}},{data:"user_name",render:function(t){return t?t:"-"}},{data:null,render:function(t){var e=!(sensorsdata.authority.isAnalyst&&sensorsdata.authority.userName!==t.user_name);return s.action({enableDel:e})}},{data:"create_time",visible:!1,sortable:!0}],order:[9,"desc"]};return e},bindEvents:function(){var t=this;this.$container.delegate("[data-method]","click.method",function(e){var n=$(e.target||e.srcElement);if(n.attr("data-method")||(n=n.parents("[data-method]:first")),!n.hasClass("disabled")){var a=n.attr("data-method"),r=n.parents("tr:first");switch(a){case"edit":case"cluster-detail":var l=t.$tableInstance.instance.row(r).data();t.trigger(a,l);break;case"del":sensorsdata.popover({ele:n,container:t.$container,placement:"left",showNow:!0,template:s.del(),content:sensorsdata.languages.get("确定删除吗?<!--{todo}-->"),successAfter:function(){t.del(r)}});break;case"filter":n.data("filterDropdown")||t.$filterInstance.push(i.create({ele:n,list:d[n.attr("data-value")],position:n.attr("data-position"),onConfirm:function(e){t.filterObj[n.attr("data-value")]=e,t.filter()}}))}}}),this.$container.delegate("tbody tr","mouseover",function(){var e=$(this).index();$(this).hasClass("DTFC_NoData")||(t.$container.find("table tbody tr").removeClass("highlight"),0===t.$container.find("table tbody tr .empty-table").length&&t.$container.find("table").each(function(){var t=$(this);t.find("tbody tr:eq("+e+")").addClass("highlight")}))}),this.$container.delegate("tbody tr","mouseout",function(){var e=$(this).index();t.$container.find("table").each(function(){var t=$(this);t.find("tbody tr:eq("+e+")").removeClass("highlight")})}),this.on("clean",function(){t.clean()}),this.on("search",function(e){t.search(e)}),$(document).off("click.table-dropdown").on("click.table-dropdown",function(e){var n=$(e.target||e.srcElement);0===n.closest(".filter-dropdown").size()&&1===n.parents("body").size()&&t.options.container.find('[data-method="filter"]').each(function(){n.closest('[data-method="filter"]').is($(this))||$(this).next("ul").hide()})}),$(window).off("resize.cluster-table").on("resize.cluster-table",a.bind(function(){this.adjustShadow()},this))},filter:function(){var t=this;if(0!==(this.filterObj.status||[]).length){var e=this.filterObj.status.map(function(t){return l.filter(function(e){return e.value===t})[0].text}).join("|");t.$tableInstance.instance.columns(0).search(e,!0).draw()}else t.$tableInstance.instance.columns(0).search("").draw();if(0!==(this.filterObj.type||[]).length){var n=this.filterObj.type.map(function(t){return r.filter(function(e){return String(e.value)===String(t)})[0].text}).join("|");t.$tableInstance.instance.columns(4).search(n,!0).draw()}else t.$tableInstance.instance.columns(4).search("").draw();if(0!==(this.filterObj.mode||[]).length){var a=this.filterObj.mode.map(function(t){return o.filter(function(e){return String(e.value)===String(t)})[0].text});t.$tableInstance.instance.columns(3).search(a.join("|"),!0).draw()}else t.$tableInstance.instance.columns(3).search("").draw();if(0!==(this.filterObj.computype||[]).length){var s=this.filterObj.computype.map(function(t){return c.filter(function(e){return e.value===t})[0].value}).join("|");t.$tableInstance.instance.columns(5).search(s,!0).draw()}else t.$tableInstance.instance.columns(5).search("").draw();this.trigger("filter")},render:function(){this.$tableInstance=n.create({container:this.$container,data:{body:this.data},tpl:s,dataTableOption:this.dataTableGenerator($.extend(!0,[],this.data)),customDrawCallback:a.bind(function(){this.adjustShadow()},this)})},adjustShadow:function(){var t=this.$container.find(".dataTables_scrollBody");this.$container.find(".DTFC_LeftWrapper div").toggleClass("decorate-shadow",t.find("table").width()>t.width())},highlightRow:function(t){if(t){var e=this,n=this.$tableInstance.instance,a=n.rows().eq(0).filter(function(e){return n.row(e).data().id===t})[0];n.rows(a).nodes().to$().addClass("cluster-new-row"),this.$container.find("table").each(function(){var t=$(this);t.find('tbody tr[data-dt-row="'+a+'"]').addClass("cluster-new-row")});var s=setTimeout(function(){e.newIdStack=e.newIdStack.filter(function(e){return e!==t}),n.rows(a).nodes().to$().removeClass("cluster-new-row"),e.$container.find("table").each(function(){var t=$(this);t.find('tbody tr[data-dt-row="'+a+'"]').removeClass("cluster-new-row")})},2e3);this.highLightTimeOutIdList.push(s)}},getCurrentData:function(){return this.$tableInstance&&this.$tableInstance.instance?this.$tableInstance.instance.rows({filter:"applied"}).data():[]},del:function(t){var e=this.$tableInstance.instance.row(t).data();this.trigger("del",{id:e.id}),this.$tableInstance.instance.row(t).remove().draw("page")},search:function(t){this.$tableInstance.instance&&$.isFunction(this.$tableInstance.instance.search)&&this.$tableInstance.instance.columns(1).search(t).draw()},update:function(t){var e=t.result||{};this.data=e,t.hasOwnProperty("newId")&&t.newId&&this.newIdStack.push(t.newId);var n=this.$tableInstance.instance;this.$tableInstance.instance.clear(),n.rows.add(this.data),n.draw(!1),this.newIdStack.length>0&&this.highlightRow(this.newIdStack[this.newIdStack.length-1])},destroy:function(){this.$tableInstance&&$.isFunction(this.$tableInstance.destroy)&&this.$tableInstance.destroy(),this.$filterInstance.length&&this.$filterInstance.forEach(function(t){$.isFunction(t.destroy)&&t.destroy()}),$.isArray(this.newIdStack)&&this.newIdStack.length>0&&(this.newIdStack=[]),this.highLightTimeOutIdList.length>0&&this.highLightTimeOutIdList.forEach(function(t){clearTimeout(t)}),this.off("clean"),this.off("search"),this.off("filter"),$(window).off("resize.cluster-table")}}),e.create=function(t){return new u(t)}});
;/*!components/clustering/control/control.js*/
define("components/clustering/control/control",function(t,n){function a(t){this.init(t),this.bindEvents()}var e={content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,n,a,e){var s,i=n.helperMissing,o="function",c=this.escapeExpression;return'<div id="clusteringControl" class="clusteringControl">\n  <div class="report-result-container">\n    <span>当前条件</span>\n    <span>分群数\n      <!--{todo}-->\n    </span>\n    <span class="report-result" data-input="total">'+c((s=null!=(s=n.total||(null!=t?t.total:t))?s:i,typeof s===o?s.call(t,{name:"total",hash:{},data:e}):s))+'</span>\n    <span>成功\n      <!--{todo}-->\n    </span>\n    <span class="report-result" data-input="succeed">'+c((s=null!=(s=n.succeed||(null!=t?t.succeed:t))?s:i,typeof s===o?s.call(t,{name:"succeed",hash:{},data:e}):s))+'</span>\n    <span>失败\n      <!--{todo}-->\n    </span>\n    <span class="report-result" data-input="fail">'+c((s=null!=(s=n.fail||(null!=t?t.fail:t))?s:i,typeof s===o?s.call(t,{name:"fail",hash:{},data:e}):s))+'</span>\n    <span>计算中\n      <!--{todo}-->\n    </span>\n    <span class="report-result" data-input="computing">'+c((s=null!=(s=n.computing||(null!=t?t.computing:t))?s:i,typeof s===o?s.call(t,{name:"computing",hash:{},data:e}):s))+'</span>\n  </div>\n\n  <div class="report-method-container">\n    <div id="clustering-query-container" class="clustering-query-container">\n      <input id="clustering-query" data-method="search" type="text" name="name" placeholder="搜索分群名称" data-lang-placeholder="<!--{en}Search-->"\n        autocomplete="off" data-input="search">\n      <span class="icon-search"></span>\n    </div>\n    <button class="btn btn-primary" type="button" data-method="upload">\n      <span id="clustering-upload">上传创建<!--{en}Upload creation--></span>\n    </button>\n    <button class="btn btn-primary" type="button" data-method="create">\n      <span class="icon-add"></span>\n      <span id="clustering-create">规则创建<!--{en}Rule creation--></span>\n    </button>\n  </div>\n</div>'},useData:!0})};a.prototype=$.extend({},sensorsdata.EventsModule,{init:function(t){this.data=t.data,this.$container=$(e.content(this.data||{})),t.placeholder.replaceWith(this.$container),this.data.hasOwnProperty("keyword")&&this.$container.find('input[data-method="search"]').val(this.data.keyword)},bindEvents:function(){var t=this;this.$container.off("click").on("click","[data-method]",function(){var n=$(this).attr("data-method");switch(n){case"create":t.trigger("create");break;case"upload":t.trigger("upload")}}),this.$container.off("input",":text").on("input",":text","data-method",function(){var n=this,a=$(this).attr("data-method");"search"===a&&t.trigger("search",$(n).val())})},reset:function(){var t=this,n=this.$container.find('input[data-method="search"]');n.length&&n.val(""),t.trigger("search","")},update:function(t){var n=t;if(n){var a=this.$container.find("[data-input]");$.each(a,function(t,a){var e=$(a).attr("data-input");if(n.hasOwnProperty(e))switch(e){case"total":case"succeed":case"fail":case"computing":$(a).text(n[e]);break;case"search":$(a).val(n[e])}})}},refresh:function(t){var n=t;n&&this.$container.html(e.content(n))},destroy:function(){this.$container.off("click").off("input",":text").empty()}}),n.create=function(t){return new a(t)}});
;/*!components/model/apppush.js*/
define("components/model/apppush",function(n,o,s){var e={get:function(n){sensorsdata.ajax({method:"GET",url:"app_push_config",showLoader:!1,success:function(o){var s=[];$.isArray(o)&&o.length>0&&(s=o),$.isFunction(n)&&n(s)}})}};s.exports=e});
;/*!components/clustering/upload/upload.js*/
define("components/clustering/upload/upload",function(n,t){function a(n){this.$container=n.placeholder,this.tasks_=n.listData.result||[],this.total=n.listData.total||0,this.apppush=e,this.uploadFile=i,this.onConfirm=n.onConfirm,this.isValid=!0,this.authority=sensorsdata.authority||{},this.isNotAllowed=sensorsdata.authority.isAnalyst&&sensorsdata.cache.config.allow_analyst_higher_privilege!==!0||sensorsdata.authority.isNormal,this.init(),this.bindEvents(),this.show()}var e=n("components/model/apppush"),i=n("components/model/uploadFile"),s={pannel:Handlebars.template({1:function(){return"disabled"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,t,a,e){var i,s;return'<div id="clustering-upload-modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <span>上传 ID 列表创建分群<!--{en}Upload ID list to create clustering--></span>\n        <a href="'+this.escapeExpression((s=null!=(s=t.link||(null!=n?n.link:n))?s:t.helperMissing,"function"==typeof s?s.call(n,{name:"link",hash:{},data:e}):s))+'" target="_blank">\n          <span class="icon-help" data-placement="bottom" data-toggle="tooltip" title="" data-lang-title="" data-original-title="点击查看上传文本的内容和格式">\n          </span>\n        </a>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <div class="input-group-default">\n          <div>\n            <p class="modal-text">上传<!--{en}Upload--></p>\n          </div>\n          <div>\n            <input type="file" name="upload-input" id="upload-input" class="modal-input-file" accept=".txt">\n            <label for="upload-input" id="upload-btn" class="btn btn-primary" data-method="upload-pick"><span class="icon-upload"></span>上传文件<!--{en}<span class="icon-upload"></span>Upload files--></label>\n            <div class="upload-info" id="upload-info">\n              <span class="icon-link"></span>\n              <a id="upload-filename" class="upload-filename" title=""></a>\n              <span class="icon-remove" data-method="upload-stop"></span>\n              <div class="upload-progress-whole"></div>\n              <div class="upload-progress"></div>\n            </div>\n\n            <p class="modal-text-sub">上传 txt 格式的 ID 列表创建分群<!--{en}Upload TXT format ID list to create clustering--></p>\n            <p class="modal-text">\n            <a title="下载模版" href="../../../static/files/cluster-template.txt" data-method="download-template" download="分群格式模板_SensorsAnalytics.txt">下载模版<!--{en}Download template--></a>\n            </p>\n          </div>\n        </div>\n\n        <div id="input-group-hidden" class="input-group-hidden">\n          <div class="input-line" id="clustering-cname">\n            <p class="modal-text">分群名称\n            </p>\n            <input type="text" data-input="cname" data-error-reg-exp="\\S+" data-error-text="必填">\n            <!--{todo}-->\n            </input>\n          </div>\n\n          <div class="input-line" id="clustering-name">\n            <p class="modal-text">分群 ID\n            </p>\n            <input type="text" data-input="name" placeholder="字母开头，可包含数字" data-error-reg-exp="^((?!^distinct_id$|^original_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$)[a-zA-Z][a-zA-Z\\d_$]{0,99})$"\n              data-error-text="以字母开头, 可包含数字和下划线" data-error-check="keyup">\n            <!--{todo}-->\n            </input>\n          </div>\n          <div class="input-line" id="upload-apppush">\n            <p class="modal-text">推送设置\n            </p>\n            <div class="selector" data-toggle="tooltip" data-placement="right">\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="pop-is-cancel btn btn-link" data-dismiss="modal">取 消\n          <!--{en}Cancel-->\n        </button>\n        <button disabled type="button" class="pop-is-success btn btn-primary '+(null!=(i=t["if"].call(n,null!=n?n.isNotAllowed:n,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?i:"")+'" data-method="upload-confirm">创 建\n          <!--{en}Confirm-->\n        </button>\n      </div>\n    </div>\n  </div>\n</div>'},useData:!0}),config:Handlebars.template({1:function(n,t,a,e){var i,s,l,o='<div class="panel-push-config form-group">\n  <label>\n    <div class="panel-push">\n      <select multiple="multiple" style="display:none;">\n';return s=null!=(s=t.apppush||(null!=n?n.apppush:n))?s:t.helperMissing,l={name:"apppush",hash:{},fn:this.program(2,e,0),inverse:this.noop,data:e},i="function"==typeof s?s.call(n,l):s,t.apppush||(i=t.blockHelperMissing.call(n,i,l)),null!=i&&(o+=i),o+"      </select>\n    </div>\n  </label>\n</div>\n"},2:function(n,t,a,e){var i,s=t.helperMissing,l="function",o=this.escapeExpression;return'        <option value="'+o((i=null!=(i=t.id||(null!=n?n.id:n))?i:s,typeof i===l?i.call(n,{name:"id",hash:{},data:e}):i))+'">'+o((i=null!=(i=t.cname||(null!=n?n.cname:n))?i:s,typeof i===l?i.call(n,{name:"cname",hash:{},data:e}):i))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,t,a,e){var i;return null!=(i=t["if"].call(n,null!=n?n.isShow:n,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?i:""},useData:!0})};a.prototype=$.extend({},sensorsdata.EventsModule,{init:function(){this.$container&&!this.$container.find("#clustering-upload-modal").length&&this.$container.append(s.pannel({link:"https://www.sensorsdata.cn/manual/user_segmentation_113.html#53-上传文本的内容和格式",isNotAllowed:this.isNotAllowed})),this.$modal=this.$container.find("#clustering-upload-modal"),this.$modal.find(".icon-help").tooltip(),this.uploadData={}},bindEvents:function(){var n=this;this.$modal.off("click.uploadpanel").on("click.uploadpanel","[data-method]",function(){var t=$(this).attr("data-method");switch(t){case"upload-pick":n.$modal.find("#upload-input").off("change").on("change",function(){var t=$(this)[0].files[0];"text/plain"!==t.type?sensorsdata.error.show(sensorsdata.languages.get("上传文件格式错误<!--{todo}-->")):($("#upload-info").fadeIn().css("display","inline-block"),n.$modal.find(".icon-remove").css("display","inline-block"),t&&(n.$modal.find("#upload-filename").text(t.name).attr("title",t.name),n.$modal.find(".upload-progress-whole").css({width:"100%"}),n.uploadFile.on("update",function(t){n.$modal.find(".upload-progress").css({width:t})}).on("complete",function(t){setTimeout(function(){n.$modal.find(".upload-progress").css({width:0}),n.$modal.find(".upload-progress-whole").css({width:0}),n.$modal.find(".icon-remove").hide()},1e3),t&&(n.uploadData.file_name=t,n.$container.find('[data-method="upload-confirm"]').attr("disabled",!1)),n.showConfig()}),n.uploadFile.init(),n.uploadFile.upload(t)))});break;case"upload-stop":n.hideConfig(n.$modal),n.uploadFile.stopUpload();break;case"download-template":break;case"upload-confirm":n.confirmCreate()&&n.isValid&&n.hide(n.$modal)}}),this.$modal.on("hidden.bs.modal",function(){n.hideConfig(n.$modal),n.destroy()})},show:function(){this.$modal.modal("show")},hide:function(){this.$modal.length&&this.$modal.modal("hide")},showConfig:function(){var n=this;n.$inputCname_=this.$modal.find("#clustering-cname input"),n.$inputName_=this.$modal.find("#clustering-name input");var t=$("#upload-apppush>.selector");this.apppush.get(function(a){n.app_push_list_all=a,t.html(s.config({apppush:a,isShow:!0})),t.find("select").multiselect("destroy").multiselect({nonSelectedText:sensorsdata.languages.get("可选择<!--{en}Select the Push Configuration-->"),allSelectedText:sensorsdata.languages.get("全选<!--Select all-->"),numberDisplayed:1,enableFiltering:!1,enableCaseInsensitiveFiltering:!1,buttonText:function(n){return 0===n.length?sensorsdata.languages.get("可选择<!--{en}Select the Push Configuration-->"):sensorsdata.util.format(sensorsdata.languages.get("推送配置(#{length})<!--{en}Push Configuration(#{length})-->"),n)}}),n.setTooltip(t,n.$inputName_.val(),a)}),this.$modal.find("#input-group-hidden").fadeIn().show(),this.$modal.find('#input-group-hidden input[type="text"]').unbind("input.check").bind("input.check",function(){"cname"===$(this).attr("data-input")?n.isValid=n.checkInput($(this).parent(".input-line"))&&n.checkRepeatedCname($(this)):"name"===$(this).attr("data-input")&&(n.$inputCname_.unbind("input.pinyin"),n.isValid=n.checkInput($(this).parent(".input-line"))&&n.checkRepeatedName($(this)),n.setTooltip(t,$(this).val(),n.app_push_list_all))}),n.$inputCname_.val("分群"+(parseInt(this.total,10)+1)).unbind("input.pinyin").bind("input.pinyin",function(){var a={items:[n.$inputCname_.val().trim()]};sensorsdata.ajax({queueEnable:!0,method:"POST",url:"common/pinyin",showLoader:!1,data:JSON.stringify(a),success:function(a){var e=a[0].replace(/^\d+/,"").replace(/\W/g,"_");n.$inputName_.val(e),n.setTooltip(t,e,n.app_push_list_all)}})}),n.$inputName_.val("fenqun"+(parseInt(this.total,10)+1))},hideConfig:function(n){var t=n.find("#upload-info"),a=n.find("#input-group-hidden");n.find("#upload-input").length&&$("#upload-input").val(""),t.length&&t.hide(),a.length&&(a.hide(),a.find("input").val(""),a.find(".multiselect").multiselect("deselectAll",!1),sensorsdata.form.removeError(a.find("input")))},setTooltip:function(n,t,a){n&&(n.tooltip({container:n,placement:"right",title:a?'执行成功后在推送平台使用标签"'+t+'"进行推送':"请先在“推送管理”中添加推送配置"}),$.isEmptyObject(a)?(n.find(".btn-selector").addClass("disabled"),n.attr("data-original-title","请先在“推送管理”中添加推送配置")):(n.find(".btn-selector").removeClass("disabled"),n.attr("data-original-title",'执行成功后在推送平台使用标签"'+t+'"进行推送')))},destroy:function(){this.$modal.off("click"),this.$modal.find("#input-group-hidden input").unbind("input"),this.$modal.find("#upload-input").off("change"),this.$modal.length&&this.$container.find(".modal").remove()},checkInput:function(n){return sensorsdata.form.checkChildren(n,!0,1,{container:this.$modal})},checkRepeatedName:function(n){for(var t=!0,a=$.trim(n.val()),e=0,i=this.tasks_.length;i>e;e++){var s=this.tasks_[e];if(s.name===a){t=!1;break}}return t===!0?sensorsdata.form.removeError(n):sensorsdata.form.addError(n,sensorsdata.languages.get("分群 ID 重复<!--{en}Repetition of cluster name-->"),!0,{container:this.$modal}),t},checkRepeatedCname:function(n){for(var t=!0,a=$.trim(n.val()),e=0,i=this.tasks_.length;i>e;e++){var s=this.tasks_[e];if(s.cname===a){t=!1;break}}return t===!0?sensorsdata.form.removeError(n):sensorsdata.form.addError(n,sensorsdata.languages.get("分群名称重复<!--{en}Repetition of cluster name-->"),!0,{container:this.$modal}),t},confirmCreate:function(){var n=this,t=!1;if(this.isNotAllowed)return!1;if(!this.$modal.find("#upload-input").val())return sensorsdata.error.show(sensorsdata.languages.get("未上传模版文件<!--{todo}-->")),!1;var a=[];return this.$modal.find("#upload-apppush>.selector option:selected").map(function(){a.push(parseInt($(this).val(),10))}),this.isValid&&(t=this.checkInput(this.$modal.find("#input-group-hidden .input-line"))&&this.checkRepeatedName(this.$inputName_)&&this.checkRepeatedCname(this.$inputCname_)),t?(n.uploadData.app_push_list=a,n.uploadData.name=n.$inputName_.val(),n.uploadData.cname=n.$inputCname_.val(),$.isFunction(n.onConfirm)&&n.onConfirm(n.uploadData),n.trigger("uploadcreate",n.uploadData),!0):!1}}),t.show=function(n){return new a(n)}});
;/*!components/model/validation/clustering.js*/
define("components/model/validation/clustering",function(e,t,n){var a={getList:function(e){return"function"!==$.type(e)?"getList(callback) 参数 callback 不能为空，且必须为 function 类型":void 0},getDetail:function(e,t){var n="getDetail(id, callback) ";return"number"!==$.type(e)?n+"参数 id 不能为空，且必须为 number 类型":"function"!==$.type(t)?n+"参数 callback 不能为空，且必须为 function 类型":void 0},getPartitions:function(e,t){var n="getPartitions(options, callback) ";return"object"!==$.type(e)?n+"参数 options 不能为空，且必须为 Object 类型":"number"!==$.type(e.id)?n+"参数 options 内的必填字段 id 不能为空，且必须为 number 类型":"function"!==$.type(t)?n+"参数 callback 不能为空，且必须为 function 类型":void 0},add:function(e){var t="add(data, callback) ";return"object"!==$.type(e)?t+"参数 data 不能为空，且必须为 Object 类型":e.name&&e.cname&&"undefined"!==$.type(e.type)&&e.content?void 0:t+"参数 data 内的必填字段 name、cname、type、content 不能为空"},del:function(e){var t="del(id, callback) ";return"number"!==$.type(e)?t+"参数 id 不能为空，且必须为 number 类型":void 0},set:function(e){var t="set(data, callback) ";return"object"!==$.type(e)?t+"参数 data 不能为空，且必须为 Object 类型":"undefined"!==$.type(e.id)&&e.name&&e.cname&&"undefined"!==$.type(e.type)&&e.content?void 0:t+"参数 data 内的必填字段 id、name、cname、type、content 不能为空"},run:function(e,t){var n="run(id, base_time, callback) ";return"number"!==$.type(e)?n+"参数 id 不能为空，且必须为 number 类型":"string"!==$.type(t)?n+"参数 base_time 不能为空，且必须为 string 类型":void 0},startScheduler:function(e){var t="startScheduler(id, callback) ";return"number"!==$.type(e)?t+"参数 id 不能为空，且必须为 number 类型":void 0},pauseScheduler:function(e){var t="pauseScheduler(id, callback) ";return"number"!==$.type(e)?t+"参数 id 不能为空，且必须为 number 类型":void 0},upload:function(e){var t="upload(data) ";return"object"!==$.type(e)?t+"参数 data 不能为空，且必须为 Object 类型":e.name&&e.cname&&e.file_name?void 0:t+"参数 data 内的必填字段 name、cname、filename 不能为空"},download:function(e,t){var n="download(cluster, filename) ";return"object"===$.type(e)&&e?"number"!==$.type(e.id)?n+"参数 id 不能为空，且必须为 number 类型":"string"===$.type(e.name)&&e.name?"string"!==$.type(e.base_time)?n+"参数 base_time 不能为空，且必须为 string 类型":"string"===$.type(t)&&t?void 0:n+"参数 filename 不能为空，且必须为 string 类型":n+"参数 name 不能为空，且必须为 string 类型":n+"参数 cluster 不能为空，且必须为 object 类型"},getUsersURL:function(e,t){var n="getUsersURL(name, partitionId, filename) ";return"string"===$.type(e)&&e?"number"!==$.type(t)?n+"参数 partitionKey 不能为空，且必须为 number 类型":void 0:n+"参数 name 不能为空，且必须为 string 类型"}};n.exports=a});
;/*!components/model/simpleClustering.js*/
define("components/model/simpleClustering",function(s,e,t){var n=s("components/router/router"),a={segmentation:"segmentationUserList",funnel:"funnelUserList",retention:"retentionUserList",addiction:"addictionUserList","behavior-path":"behaviorPathUserList","web-click":"webClickUserList","app-click":"appClickUserList"},i=$.extend(!0,{},sensorsdata.EventsModule,{runningTaskList:[],isRefresh:!1,tasks:null,pushConfig:null,getPushConfig:function(s){var e=this;e.pushConfig?s&&s(e.pushConfig):sensorsdata.ajax({url:"app_push_config",showLoader:!1,success:function(t){e.pushConfig=$.isArray(t)&&t.length>0?t:[],s&&s(e.pushConfig)}})},getClusteringTasksName:function(s){var e=this,t={};return this.tasks?(t=this.renderClusteringTasksName(),s&&s(t)):this.getClusteringTasks(function(){t=e.renderClusteringTasksName(),s&&s(t)}),t},renderClusteringTasksName:function(){var s=this.tasks,e=s.length+1,t="分析结果"+e,n="fenxijieguo"+e,a=!1,i=[],r=(e+"").length;s.map(function(s){var e=s.name.substr(-r),u=s.cname.substr(-r);isNaN(e)||(i[e]=!0),isNaN(u)||(i[u]=!0),(s.cname===t||s.name===n)&&(a=!0)}),a&&(e=i.length,t="分析结果"+e,n="fenxijieguo"+e);var u={cname:t,name:n};return u},getClusteringTasks:function(s){var e=this,t=[];sensorsdata.ajax({queueEnable:!0,url:"segmenter/rule/all",success:function(n){$.isArray(n.result)?(t=n.result.filter(function(s){return 2===s.type}),e.tasks=t,s&&s()):sensorsdata.error.show(sensorsdata.languages.get("数据格式错误，请联系技术人员<!--{en}Data in wrong format, please contact with technicians-->"))}})},saveCluster:function(s){var e=this,t=window.location.pathname+window.location.hash,n=s.cname;s.query_url=t;var i,r=window.location.pathname.split("/").filter(function(s){return""!==s});i=sensorsdata.api.get(a.hasOwnProperty(r[0])?a[r[0]]:"defaultUserList"),sensorsdata.ajax({data:JSON.stringify(s),url:i,type:"post",success:function(s){e.getClusteringTasks();var t='"'+n+'"'+sensorsdata.languages.get("已保存，待执行成功后方可使用<!--{Save successfully, the execution has been initiated and can be used until the execution is successful}-->")+'<span class="iconc-running white-iconc-running" style="font-size: 24px; vertical-align: sub;"></span>',a=sensorsdata.info.show({content:t,autohide:!1,isclose:!0});if(s.id){var i={taskId:s.id,base_time:s.base_time,clusterSaveInfoId:a};e.getClusterStatus(i)}}})},getClusterListStatus:function(s){var e=this;s.map(function(s){var t=s.taskId,n=!0;e.runningTaskList.map(function(s){s.taskId===t&&(n=!1)}),n&&e.runningTaskList.push(s)}),this.isRefresh||(this.isRefresh=!0,this.refresh())},getClusterStatus:function(s,e){if(e&&(this.callback=e),$.isArray(s)){var t=[];s.map(function(s){t.push({taskId:s})}),this.getClusterListStatus(t)}else this.getClusterListStatus([s])},getComputingStatus:function(){return this.runningTaskList?this.runningTaskList.length>0?!0:!1:void 0},refresh:function(){var s=this,e="",t=sensorsdata.api.get("segmenterStatus"),n=[];s.runningTaskList.map(function(s){n.push({id:s.taskId,base_time_list:[s.base_time]})}),sensorsdata.ajax({method:"POST",url:t,data:JSON.stringify(n),showCommonError:!1,showLoader:!1,success:function(e){for(var t=0,n=e.length;n>t;t++){var a=e[t],i=a.id;if("failed"===a.result[0].status||"succeed"===a.result[0].status){var r="",u=s.runningTaskList.filter(function(s){return s.taskId===i?(r=s.clusterSaveInfoId||"",!1):!0});s.runningTaskList=u,r&&sensorsdata.info.hide(r),"/clustering/"===window.location.pathname?s.callback&&$.isFunction(s.callback)&&s.callback(a):(s.tasks?s.prevShowTip(i,a.result[0].status):s.getClusteringTasks(function(){s.prevShowTip(i,a.result[0].status)}),sensorsdata.cache.ajax={})}}},complete:function(){var t=s.runningTaskList.length;t?(s.isRefresh=!0,e=window.setTimeout(function(){s.refresh()},1e4)):s.isRefresh=!1}})},prevShowTip:function(s,e){var t="",n="",a="",i=[];if(this.tasks.map(function(r){r.id===s&&(a=r.cname,n=r.name,i=r.last_partition.app_push_list,t=sensorsdata.languages.get("用户分群 “<!--{en}User clustering-->")+a+sensorsdata.languages.get("” 执行<!--{en}” Execute-->")+sensorsdata.languages.get("succeed"===e?"成功<!--{en}Success-->":"失败<!--{en}Fail-->"))}),"succeed"===e&&i.length>0){var r=this.pushConfig;r?this.showTip(s,e,t,i):this.getPushConfig(function(){this.showTip(s,e,t,i)})}else this.showTip(s,e,t,i)},showTip:function(s,e,t,a){if("succeed"===e&&a.length>0){var i=this.pushConfig,r=a.map(function(s){return"“"+i.filter(function(e){return e.id===s})[0].cname+"”"});t+=sensorsdata.languages.get("，请在推送平台<!--{en}，please in the push platform-->")+r.join("、")+sensorsdata.languages.get("中使用标签<!--{en}use the tag in-->")+name+sensorsdata.languages.get("进行推送<!--{en}Push-->")}t+=' <a data-action="SaveSuccess" data-id="{{id}}">'+sensorsdata.languages.get("点击查看<!--{Click to view}-->")+"</a>","succeed"===e?sensorsdata.success.show({content:t,isclose:!0,onSaveSuccess:function(e){sensorsdata.success.hide(e),n.nav("/clustering/#type=2&id="+s)}}):sensorsdata.error.show({content:t,isclose:!0,onSaveSuccess:function(e){sensorsdata.success.hide(e),n.nav("/clustering/#type=2&id="+s)}})}});t.exports=i});
;/*!components/model/clustering.js*/
define("components/model/clustering",function(t,e,n){var r=t("components/util/util"),s=t("components/model/validation/clustering"),i=t("components/model/api"),a=t("components/dataCache/dataCache").create(),o=t("components/model/simpleClustering"),u={setThunk:function(t,e){return function(n){a.del("list"),"function"===$.type(e)&&e(n);var r={action:t.action,id:t.id||n&&n.id};d.trigger("rule.change",r),d.trigger("rule."+r.action,r)}},errorThunk:function(t){return function(e){"function"===$.type(t)&&t({error:{mag:e&&e.responseJSON&&e.responseJSON.error}})}}},c=function(){var t=[],e=[],n={},s=!1;return{add:function(r,s){r=$.isArray(r)?r:[r],r.forEach(function(r){var i=r.id+"::"+r.base_time;-1===t.indexOf(i)&&(t.push(i),n[i]=r.status),"function"===$.type(r.callback)&&e.push({key:i,callback:s})}),this.run()},run:function(){!s&&t.length&&(s=!0,sensorsdata.ajax({url:i.get("SEGMENTER_EXECUTE_STATUS"),method:"post",data:JSON.stringify(this.buildCheckData()),success:r.bind(this.checkHandle,this)}))},buildCheckData:function(){var e=[],n={};return t.forEach(function(t){var r=t.split("::"),s=r[0],i=r[1];n[s]?n[s].push(i):(n[s]=[i],e.push({id:s,base_time_list:n[s]}))}),e},checkHandle:function(t){var e=this;t.forEach(function(t){if(t.result&&t.result.length){var r=t.id;t.result.forEach(function(t){t.status!==n[r+"::"+t.base_time]&&(a.del("list"),e.computeComplet(r,t))})}}),s=!1,setTimeout(function(){e.run()},1e4)},computeComplet:function(r,s){var i=r+"::"+s.base_time,a={action:"execute",id:r,pid:s.base_time,status:s.status,count:s.count,finished_time:s.finished_time};"succeed"===s.status||"failed"===s.status?(t=t.filter(function(t){return t!==i}),e=e.filter(function(t){return t.key===i?(t.callback(a),!1):!0}),delete n[i]):(e.forEach(function(t){t.key===i&&t.callback(a)}),n[i]=s.status),d.trigger("partition.change",a),d.trigger("partition.execute",a)}}}(),d=$.extend(!0,{},sensorsdata.EventsModule,{getList:function(t){var e=a.get("list"),n=o.getComputingStatus();return e&&!n?void t(e):void sensorsdata.ajax({url:i.get("SEGMENTER_RULE_LIST"),success:function(e){a.set("list",e),t(a.get("list"));var n=e.result.filter(function(t){return t.last_partition&&"computing"===t.last_partition.status});n.length&&c.add(n.map(function(t){return{id:t.id,base_time:t.last_partition.base_time,status:t.last_partition.status}}))},error:u.errorThunk(t)})},getDetail:function(t,e){sensorsdata.ajax({url:i.get("SEGMENTER_RULE",{id:t}),success:function(t){e(t)},error:u.errorThunk(e)})},getPartitions:function(t,e){var n=[];t.from_date&&t.to_date&&n.push("from_date="+encodeURIComponent(t.from_date),"to_date="+encodeURIComponent(t.to_date)),"number"===$.type(t.start)&&"number"===$.type(t.count)&&n.push("start="+t.start,"count="+t.count),t.order&&n.push("order="+t.order),sensorsdata.ajax({url:i.get("SEGMENTER_PARTITION",{id:t.id,query:n.length>0?n.join("&"):""}),success:function(t){e(t)},error:u.errorThunk(e)})},getUsersURL:function(t,e){return"/clustering/users/"+location.search+"#"+$.param({filter:{conditions:[{field:"user."+t,"function":"isTrue"}],relation:"and",partition_key:e},page:0,type:1})},add:function(t,e){this.set(t,e,!0)},del:function(t,e){sensorsdata.ajax({url:i.get("SEGMENTER_RULE",{id:t}),method:"delete",success:u.setThunk({action:"del",id:t},e),error:u.errorThunk(e)})},set:function(t,e,n){sensorsdata.ajax({url:i.get("SEGMENTER_RULE",{id:t.id}),method:"post",data:JSON.stringify(t),success:u.setThunk({action:n?"add":"set",id:t.id},e),error:u.errorThunk(e)})},run:function(t,e,n){sensorsdata.ajax({url:i.get("SEGMENTER_EXECUTE",{id:t}),method:"post",data:JSON.stringify([{id:t,base_time_list:[e]}]),success:function(){c.add({id:t,base_time:e},n)}})},startScheduler:function(t,e){sensorsdata.ajax({url:i.get("SEGMENTER_RULE_SCHEDULER_STATUS",{id:t}),method:"put",success:u.setThunk({action:"startScheduler",id:t},e),error:u.errorThunk(e)})},pauseScheduler:function(t,e){sensorsdata.ajax({url:i.get("SEGMENTER_RULE_SCHEDULER_STATUS",{id:t}),method:"delete",success:u.setThunk({action:"pauseScheduler",id:t},e),error:u.errorThunk(e)})},upload:function(t,e){sensorsdata.ajax({url:i.get("SEGMENTER_RULE"),method:"PUT",data:JSON.stringify(t),success:u.setThunk({action:"upload"},e),error:u.errorThunk(e)})},download:function(t,e,n){sensorsdata.download("users/list/csv",this.buildDownQueryData(t.id,t.name,t.base_time,n),e)},buildDownQueryData:function(t,e,n,r){var s={id:t,segmenter_base_time:n,filter:{conditions:[{field:"user."+e,"function":"isTrue"}],relation:"and"},type:1,all_page:!0,page:0,detail:!1,profiles:sensorsdata.cache.userProperties.map(function(t){return t.is_segmenter?void 0:"user."+t.name}).filter(function(t){return t})};return"number"==typeof r&&(s.limit=r),s}});n.exports=function(){var t={};for(var e in d)d.hasOwnProperty(e)&&!function(e){t[e]=function(){if(s[e]){var t=s[e].apply(s,arguments);if(t)throw window.console&&console.log(arguments),new Error("model/clustering: "+t)}return d[e].apply(d,arguments)}}(e);return t}()});
;/*!components/clustering/editor/metaPanel/metaPanel.js*/
define("components/clustering/editor/metaPanel/metaPanel",function(t,a){var e=t("components/model/apppush"),n=t("components/util/cron"),i={NOTALLOWED:"notallowed",ALY_NOTSELF:"analyst_notself",NORMAL:"normal",README:"https://sensorsdata.cn/2.1/manual/user_segmentation.html#2-基准时间"},l={content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="meta-panel-container">\n  <div class="meta-panel-container-input">\n    <div class="input-group" data-input="cname">\n      <label>分群名称<!--{en}Cluster name--></label>\n      <input id="meta_panel_cname" class="meta-panel-input" type="text" placeholder="" data-error-reg-exp="\\S+" data-error-text="必填">\n    </div>\n    <div class="input-group" data-input="name">\n      <label>分群 ID<!--{en}Cluster identification--></label>\n      <input id="meta_panel_name" class="meta-panel-input" type="text" placeholder="字母开头，可包含数字" data-error-reg-exp="^((?!^distinct_id$|^original_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$)[a-zA-Z][a-zA-Z\\d_$]{0,99})$"\n        data-error-text="以字母开头, 可包含数字和下划线" data-error-check="keyup">\n    </div>\n    <div class="input-group" id="meta_panel_calculation">\n      <label>计算周期<!--{todo}--></label>\n      <div class="selector" data-input="calculation_cycle">\n        <button class="btn-option" data-value="byscheduler">\n          <span class="icon-repeat"></span><span>例行</span><div class="corner-selected"><span class="icon-selected"></span></div>\n        </button>\n        <button class="btn-option" data-value="bymanual">\n          <span class="icon-single"></span><span>单次</span><div class="corner-selected"><span class="icon-selected"></span></div>\n        </button>\n      </div>\n    </div>\n    <div class="input-group" id="meta_panel_scheduler">\n      <label></label>\n      <div class="selector dropdown meta_panel_scheduler calculation_cycle_unit" data-input="calculation_cycle_unit">\n        <span>按</span>\n        <button class="btn-selector dropdown-toggle" type="button" data-value="byday" data-toggle="dropdown" aria-expanded="false">\n        </button>\n        <ul class="dropdown-menu dropdown-menu-customize" role="menu">\n          <li>\n            <a data-value="byday">天<!--{todo}--></a>\n          </li>\n        </ul>\n        <span>计算</span>\n        <span class="meta_panel_tip_scheduler">将在当天结束后 1 小时（即次日01:00）开始计算</span>\n      </div>\n      <span class="meta_panel_tip_manual">分群将在手动更新时刻开始计算</span>\n      <div id="meta_panel_unit" class="selector dropdown meta_panel_unit" data-input="update_unit">\n      </div>\n      <div id="meta_panel_time" class="selector dropdown meta_panel_time disabled" data-input="hour">\n      </div>\n    </div>\n    <div class="input-group" data-input="app_push_list">\n      <label>推送设置<!--{en}Push setting--></label>\n      <div id="meta_panel_apppush" class="selector meta_panel_apppush" data-toggle="tooltip" data-placement="right">\n      </div>\n    </div>\n\n  </div>\n</div>\n'},useData:!0}),apppush:Handlebars.template({1:function(t,a,e,n){var i,l=a.helperMissing,s="function",o=this.escapeExpression;return'  <option value="'+o((i=null!=(i=a.id||(null!=t?t.id:t))?i:l,typeof i===s?i.call(t,{name:"id",hash:{},data:n}):i))+'">'+o((i=null!=(i=a.cname||(null!=t?t.cname:t))?i:l,typeof i===s?i.call(t,{name:"cname",hash:{},data:n}):i))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,a,e,n){var i,l,s,o='<select  multiple="multiple" style="display:none;">\n';return l=null!=(l=a.configs||(null!=t?t.configs:t))?l:a.helperMissing,s={name:"configs",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n},i="function"==typeof l?l.call(t,s):l,a.configs||(i=a.blockHelperMissing.call(t,i,s)),null!=i&&(o+=i),o+"</select>"},useData:!0}),unit:Handlebars.template({1:function(t,a,e,n){var i,l=a.helperMissing,s="function",o=this.escapeExpression;return'  <option value="'+o((i=null!=(i=a.value||(null!=t?t.value:t))?i:l,typeof i===s?i.call(t,{name:"value",hash:{},data:n}):i))+'">'+o((i=null!=(i=a.name||(null!=t?t.name:t))?i:l,typeof i===s?i.call(t,{name:"name",hash:{},data:n}):i))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,a,e,n){var i,l,s,o='<select id="meta_panel_unit_month" class="btn-selector" multiple="multiple" style="display:none;" data-unit="bymonth" data-error-reg-exp="\\S+"\n  data-error-text="必填">\n';return l=null!=(l=a.time||(null!=t?t.time:t))?l:a.helperMissing,s={name:"time",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n},i="function"==typeof l?l.call(t,s):l,a.time||(i=a.blockHelperMissing.call(t,i,s)),null!=i&&(o+=i),o+'</select>\n<select id="meta_panel_unit_week" class="btn-selector" multiple="multiple" style="display:none;" data-unit="byweek" data-error-reg-exp="\\S+"\n  data-error-text="必填">\n  <option value="2">星期一<!--{en}Monday--></option>\n  <option value="3">星期二<!--{en}Tuesday--></option>\n  <option value="4">星期三<!--{en}Wednesday--></option>\n  <option value="5">星期四<!--{en}Thursday--></option>\n  <option value="6">星期五<!--{en}Friday--></option>\n  <option value="7">星期六<!--{en}Saturday--></option>\n  <option value="1">星期日<!--{en}Sunday--></option>\n</select>\n'},useData:!0}),time:Handlebars.template({1:function(t,a,e,n){var i,l=a.helperMissing,s="function",o=this.escapeExpression;return'  <li>\n    <a data-value="'+o((i=null!=(i=a.value||(null!=t?t.value:t))?i:l,typeof i===s?i.call(t,{name:"value",hash:{},data:n}):i))+'">'+o((i=null!=(i=a.name||(null!=t?t.name:t))?i:l,typeof i===s?i.call(t,{name:"name",hash:{},data:n}):i))+"\n    </a>\n  </li>"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,a,e,n){var i;return'<button class="btn-selector dropdown-toggle" type="button" data-value="" data-toggle="dropdown" aria-expanded="false">\n</button>\n<ul class="dropdown-menu" role="menu">\n'+(null!=(i=a.each.call(t,null!=t?t.time:t,{name:"each",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+"\n</ul>"},useData:!0})},s=function(t){if(!t.container)throw new Error("clustering/editor/matePanel/matePanel.js: create(options) 参数 options 不能为空，且必须为 Object 类型");this.$container=$(l.content()),t.container.append(this.$container),this.options=t,this.apppush=e,this.metadata={},this.tasks_=t.listData.result,this.isValid=!0,this.isCopy=this.options.data.isCopy?!0:!1,this.init(this.options.data||"")};s.prototype.init=function(t){this.metadata=t?this.formatData(t):{name:"",cname:"",type:0,scheduler:{},app_push_list:[],authority:[],running:t.running},this.initPanel(),this.bindEvents()},s.prototype.formatData=function(t){var a={},e={},i={};return 0===t.type?i.bywhat="bymanual":(1===t.type||7===t.type)&&(e=n.format(t.scheduler.cron||""),i.bywhat="by".concat(e.unit||"")),i.weekday=e.week||"",i.monthday=e.day||"",i.time=e.hour||"",a={name:t.name||"",cname:t.cname||"",type:t.type,scheduler:i||{},app_push_list:t.last_partition?t.last_partition.app_push_list:[],id:t.id,authority:t.authority||[],running:t.running}},s.prototype.initPanel=function(){var t=this;this.metadata.authority.length>0&&(this.metadata.authority.indexOf(i.ALY_NOTSELF)>-1||this.metadata.authority.indexOf(i.NORMAL)>-1)&&(this.authority=i.NOTALLOWED),this.isCopy===!0&&(this.authority=null),this.$selectorField=this.$container.find(".selector"),$(this.$selectorField).each(function(){var a=this,e=$(a).find("button"),n=$(a).attr("data-input")||$(a).parent(".input-group").attr("data-input");switch(n){case"app_push_list":t.apppush.get(function(e){t.app_push_list_all=e,t._multi=$(a).html(l.apppush({configs:e})).find("select").multiselect("destroy").multiselect({nonSelectedText:sensorsdata.languages.get("可选择<!--{en}Select the Push Configuration-->"),allSelectedText:sensorsdata.languages.get("全选<!--Select all-->"),numberDisplayed:1,enableFiltering:!1,enableCaseInsensitiveFiltering:!1,buttonText:function(t){return 0===t.length?sensorsdata.languages.get("可选择<!--{en}Select the Push Configuration-->"):sensorsdata.util.format(sensorsdata.languages.get("推送配置(#{length})<!--{en}Push Configuration(#{length})-->"),t)}}),$.isArray(t.metadata.app_push_list)&&t.metadata.app_push_list.length&&t._multi.multiselect("select",t.metadata.app_push_list),t.authority===i.NOTALLOWED&&t.$container.find("#meta_panel_apppush .btn-selector").prop("disabled",!0);var n=t._multi.parent("#meta_panel_apppush");if(t.metadata.name)t.setTooltip(n,t.metadata.name,e);else{var s=n.attr("data-name");t.setTooltip(n,s,e)}});break;case"hour":var s=[{value:"0",name:"00:00"}];$(a).html(l.time({time:s})),e=$(a).find("button"),e.attr("data-value",t.metadata.scheduler.time||0),e.saDropdown({value:e.attr("data-value")}),e.data("saDropdown").select("0");break;case"calculation_cycle":$(e.get(0)).addClass("selected"),!t.metadata.type&&0!==t.metadata.type||t.isCopy===!0||t.$container.find("#meta_panel_calculation .btn-option").prop("disabled",!0).addClass("disabled");break;case"calculation_cycle_unit":e.attr("data-value","byday"),t._schedulerSelect=e.saDropdown({value:e.attr("data-value")}),t.metadata.scheduler.bywhat&&t.isCopy!==!0&&t.$container.find('[data-input="calculation_cycle_unit"]').prop("disabled",!0).addClass("disabled")}}),this.authority===i.NOTALLOWED&&this.$container.find("#meta_panel_cname").prop("disabled",!0),this.metadata.name&&!this.isCopy&&(this.$container.find("#meta_panel_name").prop("disabled",!0),this.$container.find("#meta_panel_scheduler").find("button").attr("disabled",!0)),(2===this.metadata.type||5===this.metadata.type||6===this.metadata.type||7===this.metadata.type)&&this.$container.find("#meta_panel_scheduler").hide(),this.metadata&&this.set(this.metadata)},s.prototype.setTooltip=function(t,a,e){t&&(t.tooltip({container:t,placement:"top",title:e?'执行成功后在推送平台使用标签"'+a+'"进行推送':"请先在“推送管理”中添加推送配置"}),$.isEmptyObject(e)?(t.find(".btn-selector").addClass("disabled"),t.attr("data-original-title","请先在“推送管理”中添加推送配置")):(t.find(".btn-selector").removeClass("disabled"),t.attr("data-original-title",'执行成功后在推送平台使用标签"'+a+'"进行推送')))},s.prototype.bindEvents=function(){var t=this,a=this.$container.find('[data-input="cname"]'),e=this.$container.find('[data-input="name"]'),n=this.$container.find("#meta_panel_apppush"),i=this.$container.find("#meta_panel_scheduler .meta_panel_tip_scheduler"),l=this.$container.find("#meta_panel_scheduler .meta_panel_tip_manual"),s=this.$container.find('[data-input="calculation_cycle_unit"]');this.$container.find("#meta_panel_cname").unbind("input.check").bind("input.check",function(){t.isValid=t.checkInput(a)&&t.checkRepeatedCname($(this))}).unbind("input.pinyin").bind("input.pinyin",function(){if("disabled"!==t.$container.find("#meta_panel_name").attr("disabled")){var e={items:[a.find('input[type="text"]').val().trim()]};sensorsdata.ajax({queueEnable:!0,method:"POST",url:"common/pinyin",showLoader:!1,data:JSON.stringify(e),success:function(a){var e=a[0].replace(/^\d+/,"").replace(/\W/g,"_");t.$container.find("#meta_panel_name").val(e),t.setTooltip(n,e,t.app_push_list_all)}})}}),this.$container.find("#meta_panel_name").unbind("input.check").bind("input.check",function(){t.isValid=t.checkInput(e)&&t.checkRepeatedName($(this)),t.$container.find("#meta_panel_cname").unbind("input.pinyin"),n.attr("data-name",$(this).val()),t.setTooltip(n,$(this).val(),t.app_push_list_all)}),this.$container.unbind("mouseover.tooltip",'[data-toggle="tooltip"]').bind("mouseover.tooltip",'[data-toggle="tooltip"]',function(t){var a=$(t.target||t.srcElement);a.data("bs.tooltip")||a.tooltip().tooltip("show")}),this.$container.find("#meta_panel_calculation").off("click.option").on("click.option","[data-value]",function(){"bymanual"===$(this).attr("data-value")?(i.hide(),l.show(),s.hide()):(t.$container.find("#meta_panel_scheduler button").removeClass("disabled").prop("disabled",!1),i.show(),l.hide(),s.show()),$(this).parent().find("button").removeClass("selected"),$(this).addClass("selected")})},s.prototype.set=function(t){var a=this,e=this.options,n=parseInt(e.listData.total,10)+1,i=this.$container,l=i.find('[data-input="calculation_cycle"]'),s=t?t.scheduler.bywhat||"bymanual":"",o=i.find("#meta_panel_scheduler .meta_panel_tip_scheduler"),d=i.find("#meta_panel_scheduler .meta_panel_tip_manual"),r=i.find('[data-input="calculation_cycle_unit"]'),p=i.find('#meta_panel_calculation [data-value="bymanual"]'),c=i.find('#meta_panel_calculation [data-value="byscheduler"]');i.find(".input-group").each(function(){var e=$(this).attr("data-input"),l=$(this).find('input[type="text"]');if(l.length&&t)if("name"===e){var s=t[e]||"fenqun"+n;l.val(s),i.find("#meta_panel_apppush").attr("data-name",s),a.setTooltip(i.find("#meta_panel_apppush"),s,a.app_push_list_all)}else"cname"===e&&l.val(t[e]||sensorsdata.languages.get("分群<!--{en}Cluster-->")+n)}),l.length>0&&("bymanual"===s?(p.addClass("selected"),c.removeClass("selected"),o.hide(),d.show(),r.hide()):(p.removeClass("selected"),c.addClass("selected"),o.show(),d.hide(),r.show().find("button")))},s.prototype.get=function(){var t={},a=this.$container.find('[data-input="name"]'),e=this.$container.find('[data-input="cname"]'),i=this.$container.find("#meta_panel_unit"),l={};return l.unit="",l.day=[],l.hour=[],l.week=[],l.type=null,this.$container.find("[data-input]").each(function(){var t=$(this).attr("data-input");$(this).children("input").length?l[t]=$(this).children("input").val():$(this).children("button").length&&(l[t]=$(this).children("button").hasClass("btn-option")?$(this).children("button.selected").attr("data-value"):$(this).children("button").attr("data-value"))}),this.$container.find("#meta_panel_scheduler").is(":visible")?"byscheduler"===l.calculation_cycle&&"byday"===l.calculation_cycle_unit?(l.type=1,l.unit="day"):"bymanual"===l.calculation_cycle&&(l.type=0):l.type=this.metadata.type,this.isValid&&(this.metadata.id||(this.isValid=this.checkInput(a)&&this.checkInput(e)&&this.checkRepeatedCname(this.$container.find("#meta_panel_cname"))&&this.checkRepeatedName(this.$container.find("#meta_panel_name"))&&this.checkInput(i))),l.scheduler={},0===l.type?l.scheduler={running:!0}:(l.hour=[l.hour],l.scheduler={running:this.metadata.running||!0,cron:$.trim(n.toCron(l))}),l.app_push_list=(this._multi.val()||[]).map(function(t){return parseInt(t,10)}),t={data:l,isValid:this.isValid}},s.prototype.checkInput=function(t){var a=this,e=!0;return t.is(":visible")&&t.hasClass("dropdown")?(t.children().each(function(t,n){return $(n).is(":visible")&&!$(n).find('input[type="checkbox"]:checked').length?(sensorsdata.form.addError($(n).children("button"),sensorsdata.languages.get("必填<!--{todo}-->"),!0,{container:a.$container}),e=!1,!1):void 0}),e):sensorsdata.form.checkChildren(t,!0,1,{container:this.$container})},s.prototype.checkRepeatedCname=function(t){for(var a=!0,e=$.trim(t.val()),n=0,i=this.tasks_.length;i>n;n++){var l=this.tasks_[n];if(l.cname===e){a=!1;break}}return a===!0?sensorsdata.form.removeError(t):sensorsdata.form.addError(t,sensorsdata.languages.get("分群名称重复<!--{en}Repetition of cluster name-->"),!0,{container:this.$container}),a},s.prototype.checkRepeatedName=function(t){for(var a=!0,e=$.trim(t.val()),n=0,i=this.tasks_.length;i>n;n++){var l=this.tasks_[n];if(l.name===e){a=!1;break}}return a===!0?sensorsdata.form.removeError(t):sensorsdata.form.addError(t,sensorsdata.languages.get("分群 ID 重复<!--{en}Repetition of cluster name-->"),!0,{container:this.$container}),a},s.prototype.destroy=function(){this.$container.find("#meta_panel_name").unbind("input"),this.$container.find("#meta_panel_cname").unbind("input"),this.$container.unbind("mouseover"),this.$container.find("#meta_panel_calculation").off("click.option"),this.$container.remove()},a.create=function(t){return new s(t)}});
;/*!components/model/eventProps.js*/
define("components/model/eventProps",function(e,n,s){var t={get:function(e,n){var s=[];if($.isArray(e))s=e;else{if("string"!=typeof e)throw new Error("查询参数类型错误");s=[e]}s=s.filter(function(e,n,s){return s.indexOf(e)===n});var t=s.filter(function(e){return e!==sensorsdata.CONSTSET.sessionGeneral.name});0===t.length&&t.push(sensorsdata.CONSTSET.eventEmptyValue),sensorsdata.ajax({useCache:!0,url:"event/properties?events="+t.join(",")+"&method=mixed",success:sensorsdata.bind(function(e){return $.isEmptyObject(e)?void sensorsdata.error.show(sensorsdata.languages.get("数据格式错误，请联系技术人员<!--{en}Data in wrong format, please contact with technicians-->")):void($.isFunction(n)&&n(e))},this)})}};s.exports=t});
;/*!components/config/condition.js*/
define("components/config/condition",function(e,a){var n={dict:[{name:"equal",cname:sensorsdata.languages.get("等于<!--{en}equals to-->")},{name:"notEqual",cname:sensorsdata.languages.get("不等于<!--{en}does not equal to-->")},{name:"isSet",cname:sensorsdata.languages.get("有值<!--{en}has value -->")},{name:"notSet",cname:sensorsdata.languages.get("没值<!--{en}has no value-->")}],number:[{name:"equal",cname:sensorsdata.languages.get("等于<!--{en}equals to-->")},{name:"notEqual",cname:sensorsdata.languages.get("不等于<!--{en}does not equal to-->")},{name:"less",cname:sensorsdata.languages.get("小于<!--{en}less than-->")},{name:"greater",cname:sensorsdata.languages.get("大于<!--{en}greater than-->")},{name:"between",cname:sensorsdata.languages.get("区间<!--{en}range-->")},{name:"isSet",cname:sensorsdata.languages.get("有值<!--{en}has value -->")},{name:"notSet",cname:sensorsdata.languages.get("没值<!--{en}has no value-->")}],string:[{name:"equal",cname:sensorsdata.languages.get("等于<!--{en}equals to-->")},{name:"notEqual",cname:sensorsdata.languages.get("不等于<!--{en}does not equal to-->")},{name:"contain",cname:sensorsdata.languages.get("包含<!--{en}includes-->")},{name:"notContain",cname:sensorsdata.languages.get("不包含<!--{en}excludes-->")},{name:"isSet",cname:sensorsdata.languages.get("有值<!--{en}has value -->")},{name:"notSet",cname:sensorsdata.languages.get("没值<!--{en}has no value-->")},{name:"isEmpty",cname:sensorsdata.languages.get("为空<!--{en}null -->")},{name:"isNotEmpty",cname:sensorsdata.languages.get("不为空<!--{en}not null-->")},{name:"rlike",cname:sensorsdata.languages.get("正则匹配<!--{en}Regular matches-->")},{name:"notrlike",cname:sensorsdata.languages.get("正则不匹配<!--{en}Regular mismatches-->")}],list:[{name:"in",cname:sensorsdata.languages.get("包含<!--{en}includes-->")},{name:"notInclude",cname:sensorsdata.languages.get("不包含<!--{en}excludes-->")},{name:"isEmpty",cname:sensorsdata.languages.get("为空<!--{en}null -->")},{name:"isNotEmpty",cname:sensorsdata.languages.get("不为空<!--{en}not null-->")},{name:"isSet",cname:sensorsdata.languages.get("有值<!--{en}has value -->")},{name:"notSet",cname:sensorsdata.languages.get("没值<!--{en}has no value-->")}],date:[{name:"absolute_between",cname:sensorsdata.languages.get("绝对时间<!--{en}Absolute time-->")},{name:"relative",cname:sensorsdata.languages.get("相对当前时间点<!--{en}Be relative to current time -->")},{name:"relative_between",cname:sensorsdata.languages.get("相对当前时间区间<!--{en}Be relative to current time range-->")},{name:"relative_event_time",cname:sensorsdata.languages.get("相对事件发生时间<!--{en}Be relative to event occurrence time -->")},{name:"isSet",cname:sensorsdata.languages.get("有值<!--{en}has value -->")},{name:"notSet",cname:sensorsdata.languages.get("没值<!--{en}has no value-->")}],datetime:[{name:"absolute_between",cname:sensorsdata.languages.get("绝对时间<!--{en}Absolute time-->")},{name:"relative",cname:sensorsdata.languages.get("相对当前时间点<!--{en}Be relative to current time -->")},{name:"relative_between",cname:sensorsdata.languages.get("相对当前时间区间<!--{en}Be relative to current time range-->")},{name:"relative_event_time",cname:sensorsdata.languages.get("相对事件发生时间<!--{en}Be relative to event occurrence time -->")},{name:"isSet",cname:sensorsdata.languages.get("有值<!--{en}has value -->")},{name:"notSet",cname:sensorsdata.languages.get("没值<!--{en}has no value-->")}],bool:[{name:"isTrue",cname:sensorsdata.languages.get("为真<!--{en}True-->")},{name:"isFalse",cname:sensorsdata.languages.get("为假<!--{en}False-->")},{name:"isSet",cname:sensorsdata.languages.get("有值<!--{en}has value -->")},{name:"notSet",cname:sensorsdata.languages.get("没值<!--{en}has no value-->")}]},s={fns:n};a.get=function(e){return s[e]?$.extend(!0,{},s[e]):void 0}});
;/*!components/conditionInput/conditionInput.js*/
define("components/conditionInput/conditionInput",function(t,e){function a(t){this.options=t=$.extend(!0,{},t),this.$outer=t.container,this.tpl=t.tpl,this.prop=t.prop,this.defValue=t.value,this.valueProcess=t.valueProcess,this.render()}var n=t("components/util/util"),i={container:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="condition-input"></div>'},useData:!0}),number:{equal:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,a,n){var i;return'<div class="field-equal">\n<input type="text" data-type="number" value="'+this.escapeExpression((i=null!=(i=e.value||(null!=t?t.value:t))?i:e.helperMissing,"function"==typeof i?i.call(t,{name:"value",hash:{},data:n}):i))+'" data-tags="true" data-input-field="true" />\n<span class="action-edit" data-method="condition-edit" data-placement="top" data-toggle="tooltip" data-container="body" data-original-title="点击可批量复制粘贴。" data-lang-title="<!--{en}Click to bulk copy and paste.-->"><span class="icon-edit"></span></span>\n<span class="icon-help" data-toggle="tooltip" data-placement="top" data-container="body" title="支持输入多个数字，按回车键完成一个数字的输入。" data-lang-title="<!--{en}Support to enter multiple numbers, please press the ENTER key to complete the input of one number.-->"></span>\n</div>'},useData:!0}),lessGreater:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t){var e;return'<input type="number" step="0.0001" value="'+this.escapeExpression(this.lambda(null!=(e=null!=t?t.value:t)?e[0]:e,t))+'" data-input-field="true" />'},useData:!0}),between:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t){var e,a=this.lambda,n=this.escapeExpression;return'<div class="field-between"><input type="number" name="start" step="0.0001" value="'+n(a(null!=(e=null!=t?t.value:t)?e[0]:e,t))+'" data-input-field="true" /> 与<!--{en}between--> <input type="number" name="end" step="0.0001" value="'+n(a(null!=(e=null!=t?t.value:t)?e[1]:e,t))+'" data-input-field="true" /> 之间<!--{en}and--></div>'},useData:!0})},string:{equal:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,a,n){var i;return'<div class="field-equal">\n<input type="text" value="'+this.escapeExpression((i=null!=(i=e.value||(null!=t?t.value:t))?i:e.helperMissing,"function"==typeof i?i.call(t,{name:"value",hash:{},data:n}):i))+'" data-tags="true" data-input-field="true" />\n<span class="action-edit" data-toggle="tooltip" data-method="condition-edit" data-placement="top" data-container="body" data-original-title="点击可批量复制粘贴。" data-lang-title="<!--{en}Click to bulk copy and paste.-->"><span class="icon-edit"></span></span>\n<span class="icon-help" data-toggle="tooltip" data-placement="top" data-container="body" title="提示选项为最近7天的属性关键词（最多展示 10 条），非所有关键词。可直接输入关键词，回车完成。" data-lang-title="<!--{en}Tooltip is the property key words of  latest 7 days (display up to 10 items),  not all the key words.Please enter the key words directly and press ENTER to complete.-->"></span>\n</div>'},useData:!0}),contain:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t){var e;return'<div class="field-contain">\n<input type="text" value="'+this.escapeExpression(this.lambda(null!=(e=null!=t?t.value:t)?e[0]:e,t))+'" data-input-field="true" />\n<span class="icon-help" data-toggle="tooltip" data-placement="top" data-container="body" title="提示选项为最近7天的属性关键词（最多展示 10 条），非所有关键词。可直接输入关键词，回车完成。" data-lang-title="<!--{en}Tooltip is the property key words of  latest 7 days (display up to 10 items),  not all the key words.Please enter the key words directly and press ENTER to complete.-->"></span>\n</div>'},useData:!0}),reg:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t){var e;return'<div class="field-reg">\n<input type="text" value="'+this.escapeExpression(this.lambda(null!=(e=null!=t?t.value:t)?e[0]:e,t))+'" data-input-field="true" />\n<a href="https://sensorsdata.cn/manual/regex.html" target="_blank">\n  <span class="icon-help" data-toggle="tooltip" data-placement="top" data-container="body" data-original-title="点击查看帮助" title="<!--{en}Click to view help-->"></span>\n</a>\n</div>'},useData:!0})},date:{absoluteBetween:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t){var e,a=this.lambda,n=this.escapeExpression;return'<div class="field-date-absolute">在<!--{en}During--> <input type="text" name="start" value="'+n(a(null!=(e=null!=t?t.value:t)?e[0]:e,t))+'" data-input-field="true" data-date="true" /> 至<!--{en}To--> <input type="text" name="end" value="'+n(a(null!=(e=null!=t?t.value:t)?e[1]:e,t))+'" data-input-field="true" data-date="true" /> 之间<!--{en}and--> <span class="icon-help" data-toggle="tooltip" data-placement="top" data-container="body" title="区间包含起始和结束时间。输入时间格式为 yyyy-mm-dd hh:ii。" data-lang-title="<!--{en}The interval contains the beginning and the end time. The input time format is yyyy-mm-dd hh:ii.-->"></span></div>'},useData:!0}),relative:Handlebars.template({1:function(t,e,a,n){var i,l,s,r=e.helperMissing,o="function",u=this.escapeExpression,p='      <option value="'+u((l=null!=(l=e.name||(null!=t?t.name:t))?l:r,typeof l===o?l.call(t,{name:"name",hash:{},data:n}):l))+'"';return l=null!=(l=e.isActive||(null!=t?t.isActive:t))?l:r,s={name:"isActive",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n},i=typeof l===o?l.call(t,s):l,e.isActive||(i=e.blockHelperMissing.call(t,i,s)),null!=i&&(p+=i),p+">"+u((l=null!=(l=e.cname||(null!=t?t.cname:t))?l:r,typeof l===o?l.call(t,{name:"cname",hash:{},data:n}):l))+"</option>\n"},2:function(){return' selected="selected"'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,a,n){var i,l=this.lambda;return'<div class="field-date-relative">在<!--{en}During--> <input type="number" min="1" value="'+this.escapeExpression(l(null!=(i=null!=t?t.value:t)?i[0]:i,t))+'" data-input-field="true" /> 天<!--{en}day-->\n  <div class="selector">\n    <select name="relative" data-input-field="true">\n'+(null!=(i=e.blockHelperMissing.call(t,l(null!=(i=null!=t?t.value:t)?i[1]:i,t),{name:"value.1",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+"    </select>\n  </div>\n</div>"},useData:!0}),relativeBetween:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t){var e,a=this.lambda,n=this.escapeExpression;return'<div class="field-date-between">在 过去<!--{en}In the past--> <input type="number" min="1" value="'+n(a(null!=(e=null!=t?t.value:t)?e[0]:e,t))+'" data-input-field="true" /> 天&nbsp;到&nbsp;过去<!--{en}Day&nbsp;to&nbsp;in the past--> <input type="number" min="1" value="'+n(a(null!=(e=null!=t?t.value:t)?e[1]:e,t))+'" data-input-field="true" /> 天<!--{en}day--> 之内<!--{en}in--> <input type="hidden" value="day" data-input-field="true" /><span class="icon-help" data-toggle="tooltip" data-placement="top" data-container="body" title="起始数值应大于终止数值。" data-lang-title="<!--{en}The starting number should be greater than the termination number-->"></span></div>'},useData:!0}),relativeEventTime:Handlebars.template({1:function(t,e,a,n){var i,l,s,r=e.helperMissing,o="function",u=this.escapeExpression,p='    <option value="'+u((l=null!=(l=e.name||(null!=t?t.name:t))?l:r,typeof l===o?l.call(t,{name:"name",hash:{},data:n}):l))+'"';return l=null!=(l=e.isActive||(null!=t?t.isActive:t))?l:r,s={name:"isActive",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n},i=typeof l===o?l.call(t,s):l,e.isActive||(i=e.blockHelperMissing.call(t,i,s)),null!=i&&(p+=i),p+">"+u((l=null!=(l=e.cname||(null!=t?t.cname:t))?l:r,typeof l===o?l.call(t,{name:"cname",hash:{},data:n}):l))+"</option>\n"},2:function(){return' selected="selected"'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,a,n){var i,l=this.lambda,s=e.blockHelperMissing;return'<div class="field-date-event-time">在<!--{en}During-->\n<div class="selector event-date">\n  <select name="event-date" data-input-field="true">\n'+(null!=(i=s.call(t,l(null!=(i=null!=t?t.value:t)?i[0]:i,t),{name:"value.0",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+'  </select>\n</div>\n<input type="number" min="1" value="'+this.escapeExpression(l(null!=(i=null!=t?t.value:t)?i[1]:i,t))+'" data-input-field="true" />\n<div class="selector event-time">\n  <select name="event-time" data-input-field="true">\n'+(null!=(i=s.call(t,l(null!=(i=null!=t?t.value:t)?i[2]:i,t),{name:"value.2",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?i:"")+"  </select>\n</div>\n之内<!--{en}in-->\n</div>"},useData:!0})}},l={dict:{equal:{tpl:i.string.equal},notEqual:{tpl:i.string.equal}},number:{equal:{tpl:i.number.equal},notEqual:{tpl:i.number.equal},less:{tpl:i.number.lessGreater},greater:{tpl:i.number.lessGreater},between:{tpl:i.number.between}},string:{equal:{tpl:i.string.equal},notEqual:{tpl:i.string.equal},contain:{tpl:i.string.contain},notContain:{tpl:i.string.contain},rlike:{tpl:i.string.reg},notrlike:{tpl:i.string.reg}},list:{"in":{tpl:i.string.contain},notInclude:{tpl:i.string.contain}},date:{absolute_between:{tpl:i.date.absoluteBetween},relative:{tpl:i.date.relative},relative_between:{tpl:i.date.relativeBetween},relative_event_time:{tpl:i.date.relativeEventTime,valueProcess:function(t){var e=t.values[0];return("day"===e||"week"===e||"month"===e)&&(t.values=[e]),t}}},datetime:{absolute_between:{tpl:i.date.absoluteBetween},relative:{tpl:i.date.relative},relative_between:{tpl:i.date.relativeBetween},relative_event_time:{tpl:i.date.relativeEventTime,valueProcess:function(t){var e=t.values[0];return("day"===e||"week"===e||"month"===e)&&(t.values=[e]),t}}}};a.prototype={render:function(){this.$container=$(i.container()).html(this.tpl({value:this.defValue})).appendTo(this.$outer),this.bindEvents(),this.initTagsInput(),this.initDateInput(),this.initSelect(),this.initTooltip()},bindEvents:function(){this.$container.delegate("input","focus",function(){var t=$(this);t.attr("data-error")&&(t.removeAttr("data-error"),t.parent().hasClass("bootstrap-tagsinput")?t.parent().removeClass("error"):t.removeClass("error"))}).delegate('[data-method="condition-edit"]',"click",n.bind(this.showEditPanel,this))},initTagsInput:function(){var t=this;this.$container.find("input[data-tags]").each(function(e,a){var n=$(a),i=a.value&&a.value.split(",");a.value="",n.tagsinput({items:0,minLength:0,showHintOnFocus:!0,typeahead:{items:10,minLength:0,showHintOnFocus:!0,autoSelect:!1,afterSelect:function(){n.tagsinput("input").val("")},source:function(e){var a=t.prop.id;if("number"===$.type(a)){var i=$.trim(n.val());return t.buildTypeaheadSource(a,i?i.split(","):[],$.trim(e))}}}}),"number"===n.attr("data-type")&&n.on("beforeItemAdd",function(t){t.cancel=!$.isNumeric(t.item)}),i&&i.forEach(function(t){n.tagsinput("add",t)})})},buildTypeaheadSource:function(t,e,a){var n=$.Deferred(),i=function(t){$.isArray(t)&&t.length?(e.length&&(t=t.filter(function(t){return-1===e.indexOf(t)})),a&&(t=t.filter(function(t){return t.indexOf(t)>-1}))):t=[],n.resolve(t)};return sensorsdata.ajax({url:sensorsdata.api.get("propertyValuse",{id:t,limit:20}),isCommonError:!0,success:i,error:function(){n.resolve()}}),n},initDateInput:function(){this.$container.find("input[data-date]").datetimepicker({autoclose:!0,minView:"month",todayBtn:!0,language:"zh-CN",format:"date"===this.options.dataType?"yyyy-mm-dd":"yyyy-mm-dd hh:ii",todayHighlight:!0,forceParse:!1})},initSelect:function(){var t=this.$container;t.find("select").multiselect({enableCaseInsensitiveFiltering:!1,onChange:function(e){var a=e.val(),n=e.parents("select").attr("name");t.attr("data-"+n,a)}}).each(function(e,a){var n=$(a);t.attr("data-"+n.attr("name"),n.val())})},initTooltip:function(){this.$container.find("[data-toggle=tooltip]").tooltip()},showEditPanel:function(){var t=this.$container.find("input[data-tags]").eq(0);if($.isFunction(t.tagsinput)){var e=this.options,a=$(Mustache.render($("#tpl-common-modal").html(),{title:e.prop.cname+e.fnData.cname,content:$("#tpl-tagsinput-edit").html()})),n=a.find("textarea");n.val(t.tagsinput("items").join("\n")),a.find("#btn-ok").click(function(){t.tagsinput("removeAll"),n.val().split("\n").forEach(function(e){var a=$.trim(e);a&&t.tagsinput("add",a)}),a.modal("hide")}),a.modal({backdrop:"static",keyboard:!1}),a.on("hidden.bs.modal",function(){a.remove()})}},get:function(){var t=this,e={isValid:!0},a=e.values=[];return this.$container.find("[data-input-field]").each(function(n,i){if(t.checkIsValid($(i))){var l=$.trim(i.value);if(i.getAttribute("data-tags")?Array.prototype.push.apply(a,"number"===i.getAttribute("data-type")?l.split(",").map(function(t){return Number(t)}):l.split(",")):a.push(l),!l){var s=$(i);e.isValid=!1,s.attr("data-tags")&&s.tagsinput("input")&&s.tagsinput("input").jquery?s.tagsinput("input").attr("data-error",!0).parent().addClass("error"):s.addClass("error").attr("data-error",!0)}}}),"function"==typeof this.valueProcess?this.valueProcess(e):e},checkIsValid:function(t){for(var e=[function(){return t[0]&&"INPUT"===t[0].tagName&&"hidden"===t.attr("type")||t.is(":visible")},function(){if(t.attr("data-tags")){var e=t.tagsinput("input");if(e&&e.is(":visible"))return!0}return!1},function(){return"SELECT"===t[0].tagName&&t.next("div").find(".multiselect").is(":visible")?!0:!1}],a=0,n=e.length;n>a;a++)if(e[a]())return!0;return!1},destroy:function(){var t=this.$container;t.find("input[data-tags]").tagsinput("destroy"),t.find("select").multiselect("destroy"),t.find("input[data-date]").datetimepicker("remove"),t.remove()}},e.create=function(t){if(!(t&&t.container&&"object"==typeof t.prop&&"object"==typeof t.fnData&&l[t.prop.data_type]&&l[t.prop.data_type][t.fnData.name]))throw new Error("ConditionInput: 实例创建失败，options 参数错误。");var e=l[t.prop.data_type][t.fnData.name];return new a({container:t.container,tpl:e.tpl,prop:t.prop,fnData:t.fnData,value:t.value,valueProcess:t.valueProcess})}});
;/*!components/condition/condition.js*/
define("components/condition/condition",function(e,n){function t(e){this.__id__=sensorsdata.guid(),this.config(e),this.render(),this.bindEvent()}var a=e("components/config/condition"),i=a.get("fns"),s=e("components/conditionInput/conditionInput"),o={container:Handlebars.template({1:function(e,n,t,a){var i;return" "+this.escapeExpression((i=null!=(i=n.className||(null!=e?e.className:e))?i:n.helperMissing,"function"==typeof i?i.call(e,{name:"className",hash:{},data:a}):i))},3:function(){return'  <span class="action-del" data-method="condition-del"><span class="icon-remove"></span></span>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,t,a){var i,s,o=n.helperMissing,l="function",r=this.escapeExpression;return'<div class="condition'+(null!=(i=n["if"].call(e,null!=e?e.className:e,{name:"if",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?i:"")+'" data-style="'+r((s=null!=(s=n.style||(null!=e?e.style:e))?s:o,typeof s===l?s.call(e,{name:"style",hash:{},data:a}):s))+'" data-isadd="'+r((s=null!=(s=n.isAdd||(null!=e?e.isAdd:e))?s:o,typeof s===l?s.call(e,{name:"isAdd",hash:{},data:a}):s))+'">\n  <div class="fields">\n    <div class="property"></div>\n    <div class="function"></div>\n    <div class="value"></div>\n  </div>\n  <span class="action-add" data-method="condition-add"><span class="icon-add-fill"></span></span>\n'+(null!=(i=n["if"].call(e,null!=e?e.isDel:e,{name:"if",hash:{},fn:this.program(3,a,0),inverse:this.noop,data:a}))?i:"")+"</div>"},useData:!0}),filterProperties:Handlebars.template({1:function(e,n,t,a,i,s){var o,l,r,c=n.helperMissing,u="function",d=this.escapeExpression,p=n.blockHelperMissing,h='    <optgroup label="'+d((l=null!=(l=n.label||(null!=e?e.label:e))?l:c,typeof l===u?l.call(e,{name:"label",hash:{},data:a}):l))+'" data-icon="'+d((l=null!=(l=n.icon||(null!=e?e.icon:e))?l:c,typeof l===u?l.call(e,{name:"icon",hash:{},data:a}):l))+'"';return l=null!=(l=n.iconValue||(null!=e?e.iconValue:e))?l:c,r={name:"iconValue",hash:{},fn:this.program(2,a,0,i,s),inverse:this.noop,data:a},o=typeof l===u?l.call(e,r):l,n.iconValue||(o=p.call(e,o,r)),null!=o&&(h+=o),h+=">\n",l=null!=(l=n.items||(null!=e?e.items:e))?l:c,r={name:"items",hash:{},fn:this.program(4,a,0,i,s),inverse:this.noop,data:a},o=typeof l===u?l.call(e,r):l,n.items||(o=p.call(e,o,r)),null!=o&&(h+=o),h+"    </optgroup>\n"},2:function(e,n,t,a){var i;return' data-icon-value="'+this.escapeExpression((i=null!=(i=n.iconValue||(null!=e?e.iconValue:e))?i:n.helperMissing,"function"==typeof i?i.call(e,{name:"iconValue",hash:{},data:a}):i))+'"'},4:function(e,n,t,a,i,s){var o,l,r,c=n.helperMissing,u="function",d=this.escapeExpression,p=n.blockHelperMissing,h='      <option value="'+d((l=null!=(l=n.fullName||(null!=e?e.fullName:e))?l:c,typeof l===u?l.call(e,{name:"fullName",hash:{},data:a}):l))+'" data-type="'+d((l=null!=(l=n.data_type||(null!=e?e.data_type:e))?l:c,typeof l===u?l.call(e,{name:"data_type",hash:{},data:a}):l))+'" data-dict="'+d((l=null!=(l=n.has_dict||(null!=e?e.has_dict:e))?l:c,typeof l===u?l.call(e,{name:"has_dict",hash:{},data:a}):l))+'"';return l=null!=(l=n.isActive||(null!=e?e.isActive:e))?l:c,r={name:"isActive",hash:{},fn:this.program(5,a,0,i,s),inverse:this.noop,data:a},o=typeof l===u?l.call(e,r):l,n.isActive||(o=p.call(e,o,r)),null!=o&&(h+=o),h+=">\n        ",l=null!=(l=n.cname||(null!=e?e.cname:e))?l:c,r={name:"cname",hash:{},fn:this.program(7,a,0,i,s),inverse:this.noop,data:a},o=typeof l===u?l.call(e,r):l,n.cname||(o=p.call(e,o,r)),null!=o&&(h+=o),l=null!=(l=n.cname||(null!=e?e.cname:e))?l:c,r={name:"cname",hash:{},fn:this.noop,inverse:this.program(9,a,0,i,s),data:a},o=typeof l===u?l.call(e,r):l,n.cname||(o=p.call(e,o,r)),null!=o&&(h+=o),h+="<!--{en}"+d((l=null!=(l=n.name||(null!=e?e.name:e))?l:c,typeof l===u?l.call(e,{name:"name",hash:{},data:a}):l))+"-->\n        ",l=null!=(l=n.has_dict||(null!=e?e.has_dict:e))?l:c,r={name:"has_dict",hash:{},fn:this.program(11,a,0,i,s),inverse:this.noop,data:a},o=typeof l===u?l.call(e,r):l,n.has_dict||(o=p.call(e,o,r)),null!=o&&(h+=o),h+"\n      </option>\n"},5:function(){return' selected="selected"'},7:function(e,n,t,a,i,s){return this.escapeExpression(this.lambda(null!=s[1]?s[1].cname:s[1],e))},9:function(e,n,t,a,i,s){return this.escapeExpression(this.lambda(null!=s[1]?s[1].name:s[1],e))},11:function(){return'<span class="icon-data-type-dict"></span>'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,t,a,i,s){var o,l,r,c='<div class="selector">\n  <select>\n';return l=null!=(l=n.groups||(null!=e?e.groups:e))?l:n.helperMissing,r={name:"groups",hash:{},fn:this.program(1,a,0,i,s),inverse:this.noop,data:a},o="function"==typeof l?l.call(e,r):l,n.groups||(o=n.blockHelperMissing.call(e,o,r)),null!=o&&(c+=o),c+"  </select>\n</div>"},useData:!0,useDepths:!0}),filterFunctions:Handlebars.template({1:function(e,n,t,a){var i,s,o,l=n.helperMissing,r="function",c=this.escapeExpression,u='    <option value="'+c((s=null!=(s=n.name||(null!=e?e.name:e))?s:l,typeof s===r?s.call(e,{name:"name",hash:{},data:a}):s))+'"';return s=null!=(s=n.isActive||(null!=e?e.isActive:e))?s:l,o={name:"isActive",hash:{},fn:this.program(2,a,0),inverse:this.noop,data:a},i=typeof s===r?s.call(e,o):s,n.isActive||(i=n.blockHelperMissing.call(e,i,o)),null!=i&&(u+=i),u+">"+c((s=null!=(s=n.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:a}):s))+"</option>\n"},2:function(){return' selected="selected"'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,t,a){var i,s,o,l='<div class="selector">\n  <select>\n';return s=null!=(s=n.items||(null!=e?e.items:e))?s:n.helperMissing,o={name:"items",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a},i="function"==typeof s?s.call(e,o):s,n.items||(i=n.blockHelperMissing.call(e,i,o)),null!=i&&(l+=i),l+"  </select>\n</div>"},useData:!0})},l={isSet:!0,notSet:!0,isEmpty:!0,isNotEmpty:!0,isTrue:!0,isFalse:!0},r={relative:[{name:"relative_within",cname:"之内"},{name:"relative_before",cname:"之前"}],relativeEventTime:{date:[{name:"relative_after",cname:sensorsdata.languages.get("之后<!--{en}After-->")},{name:"relative_before",cname:sensorsdata.languages.get("之前<!--{en}Before-->")},{name:"day",cname:sensorsdata.languages.get("当天<!--{en}This day-->")},{name:"week",cname:sensorsdata.languages.get("当周<!--{en}This week-->")},{name:"month",cname:sensorsdata.languages.get("当月<!--{en}This month-->")}],time:[{name:"second",cname:sensorsdata.languages.get("秒<!--{en}second-->")},{name:"minute",cname:sensorsdata.languages.get("分<!--{en}minute-->")},{name:"hour",cname:sensorsdata.languages.get("小时<!--{en}hour-->")},{name:"day",cname:sensorsdata.languages.get("天<!--{en}day-->"),isActive:!0}]}};t.prototype=$.extend(!0,{},sensorsdata.EventsModule,{config:function(e){var n=this.options=$.extend(!0,{style:1,addControl:{enable:!1,onClick:function(){}},delControl:{enable:!0,onClick:function(){}}},e),t=this.properties=sensorsdata.convertProperty(n.properties,!1),a=this.propertiesMap={},i="";if(n.data){var s=this.configPreprocess(n.data);i=s.field,this.defFn=s["function"],this.defValue=s.params instanceof Array&&s.params}t.forEach(function(e){e.items.forEach(function(e){e.fullName===i&&(e.isActive=!0),a[e.fullName]=e})}),this.defProp=a[i]||t[0].items[0]},render:function(){var e=this.options,n=this.$container=$(o.container({style:e.style,className:e.className,isAdd:e.addControl.enable,isDel:e.delControl.enable})).appendTo(e.container);this.$property=n.find(".property"),this.$function=n.find(".function"),this.$value=n.find(".value"),this.createPropertyControl()},bindEvent:function(){var e=this;this.$container.delegate("[data-method]","click",function(n){e.handleClick(this,n)})},handleClick:function(e){var n=e.getAttribute("data-method");switch(n){case"condition-add":this.options.addControl.onClick(this.__id__),this.trigger("add",{id:this.__id__});break;case"condition-del":this.options.delControl.onClick(this.__id__),this.trigger("del",{id:this.__id__})}},createPropertyControl:function(){var e=this;this.$property.find("select").multiselect("destroy"),this.$property.html(o.filterProperties({groups:this.properties})).find("select").multiselect({maxHeight:490,onChange:function(n){var t=n.val(),a=e.propertiesMap[t];a&&e.createFunctionControl(a)}}),this.$property.find(".multiselect-container input[data-dict=true]").each(function(e,n){$(n).parent().before('<span class="icon-data-type-dict"></span>')}),this.createFunctionControl(this.defProp,this.defFn,this.defValue)},createFunctionControl:function(e,n,t){var a=this,s=e.has_dict?"dict":e.data_type,r=i[s]?s:"string",c=$.extend(!0,[],i[r]),u=!1;c.forEach(function(e){e.name===n&&(e.isActive=!0,u=!0)}),this.options.timeType&&"absolute"===this.options.timeType&&(c=c.filter(function(e){return"relative_event_time"!==e.name})),u||(c[0].isActive=!0,n=c[0].name);var d=function(n,t){l[n]?a.conditionInput&&(a.conditionInput.destroy(),a.conditionInput=null):a.createInputControl(e,c.filter(function(e){return e.name===n})[0],t)};this.$function.find("select").multiselect("destroy"),this.$function.html(o.filterFunctions({items:c})).find("select").multiselect({enableCaseInsensitiveFiltering:!1,maxHeight:490,onChange:function(e){d(e.val())}}),d(n,t)},createInputControl:function(e,n,t){this.conditionInput&&this.conditionInput.destroy(),this.conditionInput=s.create(this.buildInputControlTplData(e,n,t))},buildInputControlTplData:function(e,n,t){var a={container:this.$value,prop:$.extend(!0,{},e),fnData:n,value:t},i=n.name;if("absolute_between"===i){if(void 0===t){var s="date"===e.data_type?sensorsdata.CONSTSET.dateFormat:sensorsdata.CONSTSET.normalTimeFormat;a.value=[moment().add(-8,"day").startOf("day").format(s),moment().add(-1,"day").startOf("day").format(s)]}}else if("relative"===i){if(a.value=["",$.extend(!0,[],r.relative)],t){var o=t[1];a.value[0]=t[0],a.value[1].forEach(function(e){e.isActive=e.name===o?!0:!1})}}else if("relative_event_time"===i&&(a.value=[$.extend(!0,[],r.relativeEventTime.date),"",$.extend(!0,[],r.relativeEventTime.time)],t)){var l=t[0],c=t[2];a.value[1]=t[1],a.value[0].forEach(function(e){e.isActive=e.name===l?!0:!1}),a.value[2].forEach(function(e){e.isActive=e.name===c?!0:!1})}return a},get:function(){var e={condition:{field:this.$property.find("select").val(),"function":this.$function.find("select").val()},isValid:!0};if(this.conditionInput){var n=this.conditionInput.get();e.condition.params=n.values,n.isValid||(e.isValid=!1)}return this.dataPostprocess(e)},configPreprocess:function(e){var n=e.params;if(!n)return e;var t=e["function"];return"relative_before"===t||"relative_within"===t?(n[1]=t,e["function"]="relative"):"relative_event_time"===t&&(0===Number(n[0])?n[0]="relative_before":0===Number(n[1])&&(n[1]=Math.abs(Number(n[0])),n[0]="relative_after")),e},dataPostprocess:function(e){var n=e.condition;if(!n.params||!n.params.values)return e;var t=n.params;switch(n["function"]){case"relative":n["function"]=t[1],t[1]="day";break;case"relative_event_time":switch(t[0]){case"relative_after":t[0]="-"+t[1],t[1]="0";break;case"relative_before":t[0]="0"}}return e},getId:function(){return this.__id__},setAddControl:function(e){this.$container.attr("data-isadd",e)},destroy:function(){this.$property.find("select").multiselect("destroy"),this.$function.find("select").multiselect("destroy"),this.conditionInput&&this.conditionInput.destroy(),this.$container.remove()}}),n.create=function(e){var n="components/condition: create(options) ";if("object"!==$.type(e))throw new Error(n+"参数 options 不能为空，且必须为 Object 类型");if("object"!==$.type(e.properties))throw new Error(n+"参数 options.properties 不能为空，且必须为 Object 类型");if(!($.isArray(e.properties.event)&&e.properties.event||$.isArray(e.properties.user)&&e.properties.user))throw new Error(n+"参数 options.properties 数据水能为空，必须包含 event 数据或 user 数据");return new t(e)},n.isInstanceof=function(e){return e instanceof t}});
;/*!components/filterPanel/filterPanel.js*/
define("components/filterPanel/filterPanel",function(t,n){function i(t){this.options=$.extend(!0,{blurHide:!1},t),this.properties=this.options.properties,this.conditions=[],this.isShow=!1,this.handleBodyClick=sensorsdata.bind(this.handleProxyClickBody,this),this.render(),this.bindEvent(),this.update(this.options)}var e=t("components/condition/condition"),o={container:Handlebars.template({1:function(t,n,i,e){var o;return" "+this.escapeExpression((o=null!=(o=n.className||(null!=t?t.className:t))?o:n.helperMissing,"function"==typeof o?o.call(t,{name:"className",hash:{},data:e}):o))},compiler:[6,">= 2.0.0-beta.1"],main:function(t,n,i,e){var o,s=this.lambda,a=this.escapeExpression;return'<div class="filter-panel'+(null!=(o=n["if"].call(t,null!=t?t.className:t,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?o:"")+'">\n  <span class="extra-tag"></span>\n  <div class="panel-bd">\n    <div class="conditions">\n      <div class="action-relation" data-method="setRelation" data-value="'+a(s(null!=(o=null!=t?t.relation:t)?o.name:o,t))+'">\n        <span class="text">'+a(s(null!=(o=null!=t?t.relation:t)?o.cname:o,t))+'</span>\n      </div>\n    </div>\n    <button data-method="add" type="button" class="btn btn-link action-add">\n      <span class="icon-add"></span><span>筛选条件</span>\n    </button>\n  </div>\n  <div class="panel-ft">\n    <button class="btn btn-link btn-cancel" data-method="cancel">取 消</button>\n    <button class="btn btn-primary" data-method="save">确 定</button>\n  </div>\n</div>'},useData:!0})};i.prototype=$.extend(!0,{},sensorsdata.EventsModule,{render:function(){var t=this.options,n=t.filter&&"and"!==t.filter.relation?"or":"and";this.$outer=t.container,this.$container=$(o.container({relation:{name:n,cname:sensorsdata.CONSTSET.filterRelation[n].cname},className:t.className})).appendTo(this.$outer),this.$conditions=this.$container.find(".conditions"),this.$arrow=this.$container.find(".extra-tag"),this.$relation=this.$container.find(".action-relation")},bindEvent:function(){var t=this;this.$container.delegate("[data-method]","click",function(){var n=this.getAttribute("data-method");switch(n){case"setRelation":t.setRelation();break;case"add":t.addCondition();break;case"save":t.save();break;case"cancel":t.hide()}})},setRelation:function(t){var n=t||("and"===this.$relation.attr("data-value")?"or":"and");this.$relation.attr("data-value",n).find(".text").html(sensorsdata.CONSTSET.filterRelation[n].cname)},addCondition:function(t){var n=this;this.conditions.push(e.create({container:this.$conditions,properties:this.properties,data:t,delControl:{enable:!0,onClick:function(t){n.delCondition(t)}}})),this.$conditions.attr("data-total",this.conditions.length)},delCondition:function(t){this.conditions=this.conditions.filter(function(n){return n.getId()===t?(n.destroy(),!1):!0}),this.$conditions.attr("data-total",this.conditions.length)},save:function(){var t=this.get();if(t&&t.isValid){var n=this.filterProcess(t);this.hide(),this.trigger("save",n),"function"==typeof this.onSave&&this.onSave.call(window,n)}},filterProcess:function(t){var n=$.extend(!0,{},t);return delete n.isValid,n.conditions=n.conditions.map(function(t){return t.condition}),n},update:function(t){if(t&&t.properties){var n=this,i="and",e=t.expressionFilter;this.conditions.forEach(function(t){t.destroy()}),this.properties=t.properties,this.conditions=[],e&&(i=e.relation,e.conditions instanceof Array&&e.conditions.forEach(function(t){n.addCondition(t)})),this.setRelation(i)}},handleProxyClickBody:function(t){if("function"!=typeof this.options.blurHidePreCheck||this.options.blurHidePreCheck(t)!==!1){var n=this.$container.offset(),i=$(t.target);!(t.pageX<n.left||t.pageY<n.top||t.pageX>n.left+this.$container.width()||t.pageY>n.top+this.$container.height())||i.hasClass("modal")||$(".modal").has(t.target).length||this.hide()}},get:function(){for(var t={relation:this.$relation.attr("data-value"),isValid:!0},n=t.conditions=[],i=this.conditions,e=0,o=i.length;o>e;e++){var s=i[e].get();n.push(s),s.isValid||(t.isValid=!1)}return t},show:function(t){if(this.properties||t&&t.properties){var n=this;this.showPreprocess(t),this.isShow||(this.isShow=!0,this.$container.show(),this.options.blurHide&&setTimeout(function(){$(document.body).on("click",n.handleBodyClick)},0))}},showPreprocess:function(t){t&&(this.marker=t.marker,this.onSave=t.onSave,this.update(t),this.conditions.length||t.expressionFilter&&t.expressionFilter.conditions&&t.expressionFilter.conditions.length||this.addCondition(),t.arrow&&"number"==typeof t.arrow.left&&this.$arrow.css({left:t.arrow.left}))},hide:function(){if(this.isShow){var t=this.get();this.isShow=!1,this.$container.hide(),this.options.blurHide&&$(document.body).off("click",this.handleBodyClick),this.trigger("hid",t)}},getStatus:function(){return this.isShow},getMarker:function(){return this.marker},clean:function(){this.conditions.forEach(function(t){t.destroy()}),this.marker=null},destroy:function(){this.$container.undelegate("click"),this.conditions.forEach(function(t){t.destroy()}),this.$container.remove()}}),n.create=function(t){if(!t||!t.container)throw new Error("Condition: 实例创建失败，options 参数错误。");return new i(t)},n.isInstanceof=function(t){return t instanceof i}});
;/*!components/clustering/util/getFilterData.js*/
define("components/clustering/util/getFilterData",function(t,e,i){i.exports=function(t){t=t||{};var e=[];if(!$.isEmptyObject(t)){var i=t.conditions||[];if(1===i.length){var n={type:"filter"};n=$.extend(!0,{},n,i[0]),e.push(n)}else if(0!==i.length){var r=[];i.forEach(function(t){r.push($.extend(!0,{},{type:"filter"},t))}),e.push({type:"filters_relation",relation:t.relation,subfilters:r})}}return e}});
;/*!components/clustering/util/buildFilterData.js*/
define("components/clustering/util/buildFilterData",function(n,i,t){t.exports=function(n){n=n||[];var i={relation:"and",conditions:[]};if(1===n.length){var t=n[0].type;"filter"===t?i.conditions.push(n[0]):(i.relation=n[0].relation||"and",(n[0].subfilters||[]).forEach(function(n){delete n.isValid,i.conditions.push(n)}))}return i}});
;/*!components/clustering/editor/eventSimpleItem/eventSimpleItem.js*/
define("components/clustering/editor/eventSimpleItem/eventSimpleItem",function(t,e){var n={content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var s;return'<div class="clustering-series-item-container">\n  <div class="clustering-event-filter-item">\n    <div class="line-prefix"><span>'+this.escapeExpression((s=null!=(s=e.indexText||(null!=t?t.indexText:t))?s:e.helperMissing,"function"==typeof s?s.call(t,{name:"indexText",hash:{},data:i}):s))+'</span></div>\n    <div class="selector" data-method="filter-events">\n      <button class="btn-selector multiselect" data-toggle="dropdown">\n        <span class="icon-event"></span><span class="multiselect-selected-text">$App 浏览页面</span>\n      </button>\n    </div>\n    <span class="icon-remove" data-method="del"></span>\n    <span class="icon-filter-set event-simple-item-filter" data-method="filter"></span>\n  </div>\n</div>\n'},useData:!0})},i=t("components/model/eventProps"),s=t("components/filterPanel/filterPanel"),o=t("components/clustering/util/getFilterData"),a=t("components/clustering/util/buildFilterData"),r=function(t){if(!t.container)throw new Error("无效的事件条目容器");var e={indexText:"A",addControl:{enable:!1,onClick:null},delControl:{enable:!0,onClick:null},data:null};e=$.extend(!0,{},e,t),this.options=e,this.$container=$(n.content(e)),e.container.append(this.$container),this.filterInstance=s.create({container:this.$container,className:"filter-simple-item",blurHide:!0}),this.data=this.options.data||{event:sensorsdata.cache.events[0].name},this.props={},this.init()};r.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.set(this.options),this.bindEvents()},bindEvents:function(){var t=this;this.$container.find('[data-method="del"]').on("click.del",function(){t.options.delControl&&$.isFunction(t.options.delControl.onClick)&&t.options.delControl.onClick(),t.trigger("del")}),this.$container.find('[data-method="add"]').on("click.add",function(){t.options.addControl&&$.isFunction(t.options.addControl.onClick)&&t.options.addControl.onClick(),t.trigger("add")}),this.$container.find('[data-method="filter"]').on("click.filter-item",function(){var e=$(this),n=t.filterInstance;n.getStatus()?n.hide():(e.addClass("active"),n.show({expressionFilter:a(t.data.filters),properties:t.props}))}),this.filterInstance.on("hid",function(e){var n=e;n&&n.conditions&&0!==n.conditions.length&&n.isValid||t.$container.find('[data-method="filter"]').removeClass("active")}),this.filterInstance.off("save").on("save",function(e){t.data.filters=o(e)})},setIndexText:function(t){this.$container.find(".line-prefix span").text(t)},get:function(){var t={event:this.data.event};return 0!==(this.data.filters||[]).length&&(t.filters=this.data.filters),$.extend(!0,{},t)},set:function(t){var e=this,n=this.data||{};this.setIndexText(t.indexText),this.$container.find('[data-method="filter-events"]').eventDropdown("destroy").eventDropdown({events:sensorsdata.cache.events,eventName:n.event,onChange:function(t){e.data.event=t,delete e.data.filters,i.get([t],function(n){e.props=n.original[t];var i=n.original[t].user||[];$.isEmptyObject(i)||(n.original[t].user=i.filter(function(t){return!t.is_segmenter}))})}}),i.get([n.event],function(t){var i=t.original[n.event].user||[];$.isEmptyObject(i)||(t.original[n.event].user=i.filter(function(t){return!t.is_segmenter})),e.props=t.original[n.event]})},destroy:function(){this.filterInstance&&$.isFunction(this.filterInstance.destroy)&&this.filterInstance.destroy(),this.$container.remove()}}),e.create=function(t,e){return $.isFunction(e)?void e(new r(t)):new r(t)}});
;/*!components/clustering/editor/eventSeriesPanel/eventSeriesPanel.js*/
define("components/clustering/editor/eventSeriesPanel/eventSeriesPanel",function(e,n){var t={content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="clustering-series-container">\n  <div class="filter-item-container">\n    <div class="clustering-event-filter-item">\n      <span class="label-text">在</span>\n      <div class="selector">\n        <button data-method="time-range" class="btn-selector" type="button" />\n      </div>\n      <span class="label-text">做过</span>\n      <button\n        data-method="remove-series"\n        type="button"\n        class="btn btn-danger-small pull-right"\n      >\n        <span class="icon-remove" />\n      </button>\n    </div>\n    <div class="clustering-event-container" />\n    <div class="clustering-series-toolbar">\n      <span data-method="add-event">\n        <span class="icon-add-fill"></span>\n        <span>添加事件</span>\n      </span>\n    </div>\n  </div>\n</div>;\n'},useData:!0})},i=e("components/clustering/editor/eventSimpleItem/eventSimpleItem"),a=e("components/util/util"),s=function(e){if(!e.container)throw new Error("clustering/editor/eventSeriesPanel/eventSeriesPanel.js: create(options) options.container 不能为空");this.$container=$(t.content()),e.container.append(this.$container),this.options=e,this.$inputDate=this.$container.find('[data-method="time-range"]'),this.eventSimpleItemInstances=[],this.init()};s.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.set(this.options.data),this.bindEvents()},bindEvents:function(){var e=this;this.$container.find('[data-method="add-event"]').on("click.add-event",function(){var n={};n.index=a.guid(),n.instance=i.create({container:e.$container.find(".clustering-event-container"),indexText:e.eventSimpleItemInstances.length+1,delControl:{enable:!0,onClick:function(){e.del(n)}}}),e.eventSimpleItemInstances.push(n)}),this.$container.find('[data-method="remove-series"]').on("click.remove-series",function(){e.trigger("del")})},set:function(e){var n=this;e=e||{};var t={parentEl:this.$container};"relative_time"===e.time_function?(t.relativeValue=e.time_params?e.time_params[0]:"",t.chosenLabel=sensorsdata.convertRelativeTimeLabel(t.relativeValue)):e.time_params&&(t.startDate=e.time_params[0],t.endDate=e.time_params[1]),sensorsdata.initDateRangeInput(this.$inputDate,$.extend({allowRelative:!0,allowDisplayTip:!0,parentEl:".slide-page"},t));var s=e.steps||[];if(s.length>0)s.forEach(function(e,t){var s={};s.index=a.guid(),s.instance=i.create({container:n.$container.find(".clustering-event-container"),indexText:t+1,delControl:{enable:!0,onClick:function(){n.del(s)}},data:e}),n.eventSimpleItemInstances.push(s)});else{var r={};r.index=a.guid(),r.instance=i.create({container:n.$container.find(".clustering-event-container"),indexText:1,delControl:{enable:!0,onClick:function(){n.del(r)}}}),n.eventSimpleItemInstances.push(r)}},get:function(){var e=this.$inputDate.data("daterangepicker"),n={steps:[],type:"event_sequence_rule"},t=sensorsdata.CONSTSET.timeFormat;return e.relativeValue?(n.time_params=[e.relativeValue],n.time_function="relative_time"):(n.time_params=[e.startDate.format(t),e.endDate.format(t)],n.time_function="absolute_time"),this.eventSimpleItemInstances.forEach(function(e){e&&e.instance&&n.steps.push(e.instance.get())}),0===n.steps.length?{}:n},del:function(e){e&&e.instance&&(e.instance.destroy(),this.eventSimpleItemInstances=this.eventSimpleItemInstances.filter(function(n){return e.index!==n.index}),this.eventSimpleItemInstances.forEach(function(e,n){e.instance.setIndexText(n+1)}))},destroy:function(){var e=this.$inputDate.data("daterangepicker");e&&$.isFunction(e.remove)&&e.remove(),this.$container.remove()}}),n.create=function(e,n){$.isFunction(n)&&n(new s(e))}});
;/*!components/clustering/editor/eventItem/eventItem.js*/
define("components/clustering/editor/eventItem/eventItem",function(e,a){var t={content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var i;return'<div class="filter-item-container">\n  <div class="clustering-event-filter-item">\n    <div class="clustering-event-filter-foldline-wrapper">\n      <div class="line-prefix"><span>'+this.escapeExpression((i=null!=(i=a.indexText||(null!=e?e.indexText:e))?i:a.helperMissing,"function"==typeof i?i.call(e,{name:"indexText",hash:{},data:n}):i))+'</span></div>\n      <span>在</span>\n      <div class="selector">\n        <button data-method="filter-time-range" class="btn-selector" type="button">2018-6-11至2018-6-14</button>\n      </div>\n      <span>做过</span>\n      <div class="selector" data-method="filter-events">\n        <button class="btn-selector multiselect" data-toggle="dropdown">\n          <span class="icon-event"></span><span class="multiselect-selected-text">$App 浏览页面</span>\n        </button>\n      </div>\n      <div class="selector" data-container="measure">\n\n      </div>\n      <div class="selector" data-container="input">\n        <div class="selector dropdown">\n          <button id="filter-repeated-times-type" class="btn-selector dropdown-toggle" type="button" data-toggle="dropdown" data-value="least" aria-expanded="false">\n            大于等于\n          </button>\n          <ul class="dropdown-menu" role="menu">\n            <li><a data-value="least">大于等于</a></li>\n            <li><a data-value="most">小于等于</a></li>\n            <li><a data-value="between">区间</a></li>\n          </ul>\n        </div>\n        <input type="number" class="form-control input-times" data-method="single" data-type="repeated-times" value="1" data-error-reg-exp="^[1-9][0-9]*$" data-error-text="必填，正整数">\n        <span data-type="repeated-times-split" data-method="between" style="display:none;">至</span>\n        <input type="number" class="form-control input-times" data-method="between" data-type="repeated-times" style="display:none;" value="" data-error-reg-exp="^[1-9][0-9]*$" data-error-text="必填，正整数">\n        <span data-method="single">次</span>\n      </div>\n      <span data-method="add-item"><span class="icon-add-fill"></span></span>\n    </div>\n    <div class="clustering-event-filter-icon-wrapper">\n      <span class="icon-remove" data-method="del"></span>\n      <span class="icon-filter-set" data-method="filter"></span>\n    </div>\n  </div>\n</div>\n'},useData:!0}),input:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var i,s,r=a.helperMissing,l="function",o=this.escapeExpression,d=this.lambda;return'<div class="selector dropdown">\n  <button class="btn-selector dropdown-toggle" type="button" data-toggle="dropdown" data-value="'+o((s=null!=(s=a["function"]||(null!=e?e["function"]:e))?s:r,typeof s===l?s.call(e,{name:"function",hash:{},data:n}):s))+'" aria-expanded="false">\n    <!-- 大于等于 -->\n  </button>\n  <ul class="dropdown-menu" role="menu">\n    <li><a data-value="equal">=</a></li>\n    <li><a data-value="notEqual">≠</a></li>\n    <li><a data-value="less"><</a></li>\n    <li><a data-value="most">≤</a></li>\n    <li><a data-value="greater">></a></li>\n    <li><a data-value="least">≥</a></li>\n    <li><a data-value="between">区间</a></li>\n  </ul>\n</div>\n<input type="number" class="form-control input-times" data-method="single" data-type="repeated-times" value="'+o(d(null!=(i=null!=e?e.params:e)?i[0]:i,e))+'" data-error-reg-exp="^[1-9][0-9]*$" min="0" data-error-text="必填，正整数">\n<span data-type="repeated-times-split" data-method="between" style="display:none;">至</span>\n<input type="number" class="form-control input-times" data-method="between" data-type="repeated-times" style="display:none;" value="'+o(d(null!=(i=null!=e?e.params:e)?i[1]:i,e))+'" data-error-reg-exp="^[1-9][0-9]*$" data-error-text="必填，正整数">\n<span data-method="single" data-type="unit" data-unit='+o((s=null!=(s=a.unit||(null!=e?e.unit:e))?s:r,typeof s===l?s.call(e,{name:"unit",hash:{},data:n}):s))+">"+o((s=null!=(s=a.unit||(null!=e?e.unit:e))?s:r,typeof s===l?s.call(e,{name:"unit",hash:{},data:n}):s))+"</span>\n"},useData:!0}),measures:Handlebars.template({1:function(e,a,t,n){var i,s=a.helperMissing,r="function",l=this.escapeExpression;return'        <span class="selected cur-measure" data-event-name="'+l((i=null!=(i=a.event_name||(null!=e?e.event_name:e))?i:s,typeof i===r?i.call(e,{name:"event_name",hash:{},data:n}):i))+'" data-aggregator="'+l((i=null!=(i=a.aggregator||(null!=e?e.aggregator:e))?i:s,typeof i===r?i.call(e,{name:"aggregator",hash:{},data:n}):i))+'" data-field="'+l((i=null!=(i=a.field||(null!=e?e.field:e))?i:s,typeof i===r?i.call(e,{name:"field",hash:{},data:n}):i))+'" >\n          '+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+"\n        </span>\n"},3:function(e,a,t,n){var i,s=a.helperMissing,r="function",l=this.escapeExpression;return'      <li class="dropdown-submenu">\n        <a tabindex="-1">'+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+"<!--{en}"+l((i=null!=(i=a.name||(null!=e?e.name:e))?i:s,typeof i===r?i.call(e,{name:"name",hash:{},data:n}):i))+'--></a>\n        <ul class="dropdown-menu" data-method="choose-agg-two">\n          <li><a data-cname="'+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+'" data-field="'+l((i=null!=(i=a.measureField||(null!=e?e.measureField:e))?i:s,typeof i===r?i.call(e,{name:"measureField",hash:{},data:n}):i))+'" data-aggregator="SUM" data-unit="'+l((i=null!=(i=a.unit||(null!=e?e.unit:e))?i:s,typeof i===r?i.call(e,{name:"unit",hash:{},data:n}):i))+'">总和<!--{en}Total--></a></li>\n          <li><a data-cname="'+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+'" data-field="'+l((i=null!=(i=a.measureField||(null!=e?e.measureField:e))?i:s,typeof i===r?i.call(e,{name:"measureField",hash:{},data:n}):i))+'" data-aggregator="AVG" data-unit="'+l((i=null!=(i=a.unit||(null!=e?e.unit:e))?i:s,typeof i===r?i.call(e,{name:"unit",hash:{},data:n}):i))+'">均值<!--{en}Mean value--></a></li>\n          <li><a data-cname="'+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+'" data-field="'+l((i=null!=(i=a.measureField||(null!=e?e.measureField:e))?i:s,typeof i===r?i.call(e,{name:"measureField",hash:{},data:n}):i))+'" data-aggregator="MAX" data-unit="'+l((i=null!=(i=a.unit||(null!=e?e.unit:e))?i:s,typeof i===r?i.call(e,{name:"unit",hash:{},data:n}):i))+'">最大值<!--{en}Max value--></a></li>\n          <li><a data-cname="'+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+'" data-field="'+l((i=null!=(i=a.measureField||(null!=e?e.measureField:e))?i:s,typeof i===r?i.call(e,{name:"measureField",hash:{},data:n}):i))+'" data-aggregator="MIN" data-unit="'+l((i=null!=(i=a.unit||(null!=e?e.unit:e))?i:s,typeof i===r?i.call(e,{name:"unit",hash:{},data:n}):i))+'">最小值<!--{en}Min value--></a></li>\n          <!--<li><a data-cname="'+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+'" data-field="'+l((i=null!=(i=a.measureField||(null!=e?e.measureField:e))?i:s,typeof i===r?i.call(e,{name:"measureField",hash:{},data:n}):i))+'" data-aggregator="uniqAvg" data-unit="'+l((i=null!=(i=a.unit||(null!=e?e.unit:e))?i:s,typeof i===r?i.call(e,{name:"unit",hash:{},data:n}):i))+'">人均值&lt;!&ndash;{en}Value per capita&ndash;&gt;</a></li>-->\n          <!--<li><a data-cname="'+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+'" data-field="'+l((i=null!=(i=a.measureField||(null!=e?e.measureField:e))?i:s,typeof i===r?i.call(e,{name:"measureField",hash:{},data:n}):i))+'" data-aggregator="uniqCount" data-unit="'+l((i=null!=(i=a.unit||(null!=e?e.unit:e))?i:s,typeof i===r?i.call(e,{name:"unit",hash:{},data:n}):i))+'">去重数&lt;!&ndash;{en}Deduplication&ndash;&gt;</a></li>-->\n        </ul>\n      </li>\n'},5:function(e,a,t,n){var i,s=a.helperMissing,r="function",l=this.escapeExpression;return'        <li class="dropdown-submenu">\n          <a tabindex="-1">'+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+"<!--{en}"+l((i=null!=(i=a.name||(null!=e?e.name:e))?i:s,typeof i===r?i.call(e,{name:"name",hash:{},data:n}):i))+'--></a>\n          <ul class="dropdown-menu" data-method="choose-agg-two">\n            <li>\n              <a data-cname="'+l((i=null!=(i=a.cname||(null!=e?e.cname:e))?i:s,typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i))+'" data-field="'+l((i=null!=(i=a.measureField||(null!=e?e.measureField:e))?i:s,typeof i===r?i.call(e,{name:"measureField",hash:{},data:n}):i))+'" data-aggregator="uniqCount">去重数<!--{en}Deduplication--></a>\n            </li>\n          </ul>\n        </li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,n){var i,s,r,l='<div class="aggregator-item">\n  <span>的</span>\n  <div class="selector dropdown">\n    <button data-toggle="dropdown" class="btn-selector dropdown-toggle" data-target="#">\n';return s=null!=(s=a.measure||(null!=e?e.measure:e))?s:a.helperMissing,r={name:"measure",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n},i="function"==typeof s?s.call(e,r):s,a.measure||(i=a.blockHelperMissing.call(e,i,r)),null!=i&&(l+=i),l+'    </button>\n    <ul class="dropdown-menu" data-method="choose-agg-one">\n      <li>\n        <a data-cname="总次数" data-aggregator="general" data-field="" data-unit="次">总次数<!--{en}Event Totals--></a>\n      </li>\n      <li class="divider"></li>\n'+(null!=(i=a.each.call(e,null!=e?e.measures:e,{name:"each",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?i:"")+'      <li class="divider"></li>\n'+(null!=(i=a.each.call(e,null!=e?e.notMeasures:e,{name:"each",hash:{},fn:this.program(5,n,0),inverse:this.noop,data:n}))?i:"")+"    </ul>\n  </div>\n</div>\n"},useData:!0}),error:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div style="text-align:left;">\n  <span>选择 0 次 需满足至少一个条件：</span><br>\n  <span>1. 有一个用户属性过滤条件 </span><br>\n  <span>2. 明确做过某个事件</span><br>\n  <span>3. 有个行为序列条件</span>\n</div>'},useData:!0})},n=e("components/model/eventProps"),i=e("components/filterPanel/filterPanel"),s=e("components/clustering/util/getFilterData"),r=e("components/clustering/util/buildFilterData"),l=e("components/util/util"),o=function(e){if(!e.container)throw new Error("clustering/editor/eventItem/eventItem.js: create(options) options.container 不能为空");var a={indexText:"A",addControl:{enable:!1,onClick:null},delControl:{enable:!0,onClick:null},data:{}};a=$.extend(!0,{},a,e),this.options=a,this.antiError=!1,this.$container=$(t.content(a)),a.container.append(this.$container),this.$dateInput=this.$container.find('[data-method="filter-time-range"]'),this.filterInstance=i.create({container:this.$container,className:"filter-item",blurHide:!0,arrow:{left:this.$container.find('[data-method="filter"]').offset().left-this.$container.offset().left}}),this.data=this.options.data||{measure:{event_name:sensorsdata.cache.events[0].name,aggregator:"general",type:"event_measure"}},this.propObj={},this.init()};o.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.setIndexText(this.options.index),this.set(this.data),this.bindEvents()},setAddControl:function(e){e=!!e,this.$container.find('[data-method="add-item"]').toggle(e)},setDelControl:function(e){e=!!e,this.$container.find('[data-method="del"]').toggle(e)},bindEvents:function(){var e=this;this.$container.find('[data-method="del"]').on("click.del",function(){e.options.delControl&&$.isFunction(e.options.delControl.onClick)&&(e.options.delControl.onClick(),e.trigger("del")),e.trigger("del")}),this.$container.find('[data-method="add-item"]').on("click.add-item",function(){e.options.addControl&&$.isFunction(e.options.addControl.onClick)&&e.options.addControl.onClick(),e.trigger("add")}),this.$container.find('[data-method="filter"]').on("click.filter-item",function(){var a=$(this),t=e.filterInstance;t.getStatus()?t.hide():(a.addClass("active"),t.show({expressionFilter:r(e.data.filters),properties:e.propObj.props}))}),this.filterInstance.on("hid",function(a){var t=a;t&&t.conditions&&0!==t.conditions.length&&t.isValid||e.$container.find('[data-method="filter"]').removeClass("active")}),this.filterInstance.off("save").on("save",function(a){e.data.filters=s(a)}),this.$container.off("setAntiError").on("setAntiError",function(a,t){e.antiError=!!t.antiError})},setIndexText:function(e){this.$container.find(".line-prefix span").text(String.fromCharCode(65+e%26))},get:function(){var e=!0,a=this.$container.find('[data-container="measure"]'),t={event_name:this.$container.find('[data-method="filter-events"]').data("selected-event"),aggregator:a.find("span.cur-measure").attr("data-aggregator"),field:a.find("span.cur-measure").attr("data-field"),type:"event_measure"},n=this.$container.find('[data-container="input"]'),i=this.checkInputs();e=i.isValid;var s=i.params,r=this.$container.find('[data-method="filter-time-range"]').data("daterangepicker");r.relativeValue?(this.data.time_function="relative_time",this.data.time_params=[r.relativeValue]):(this.data.time_function="absolute_time",this.data.time_params=[r.startDate.format(sensorsdata.CONSTSET.timeFormat),r.endDate.format(sensorsdata.CONSTSET.timeFormat)]);var l={measure:t,type:"event_rule",time_function:this.data.time_function,time_params:this.data.time_params,"function":n.find("button").attr("data-value"),params:s,filters:this.data.filters||[],isValid:e};return 0===l.filters.length&&delete l.filters,l},checkInputs:function(){var e=this,a=this.$container.find('input[data-method="single"]'),n=this.$container.find('input[data-method="between"]'),i=parseInt(a.val(),10),s=parseInt(n.val(),10),r=this.$container.find('[data-container="input"] button').attr("data-value"),l=[],o=this.$container.find('[data-type="unit"]'),d=o.length?o.attr("data-unit"):"";a.is(":visible")&&l.push(i),n.is(":visible")&&l.push(s);var u=!0;switch(r){case"least":case"most":$.isNumeric(i)&&0!==i||(sensorsdata.form.removeError(a),sensorsdata.form.addError(a,sensorsdata.languages.get("必填，正整数<!--{en}Required, positive integer-->"),!0),u=!1);break;case"equal":$.isNumeric(i)?0>=i&&e.antiError===!1&&"次"===d&&(sensorsdata.form.addError(a,t.error,!0,{html:!0}),u=!1):(sensorsdata.form.addError(a,sensorsdata.languages.get("必填，正整数<!--{en}Required, positive integer-->"),!0),u=!1);break;case"less":$.isNumeric(i)&&0>=i&&e.antiError===!1&&"次"===d&&(sensorsdata.form.addError(a,t.error,!0,{html:!0}),u=!1);break;case"between":$.isNumeric(i)||(sensorsdata.form.addError(a,sensorsdata.languages.get("必填，正整数<!--{en}Required, positive integer-->"),!0),u=!1),$.isNumeric(s)||(sensorsdata.form.addError(n,sensorsdata.languages.get("必填，正整数<!--{en}Required, positive integer-->"),!0),u=!1),i>s&&(sensorsdata.form.addError(n,sensorsdata.languages.get("必须大于左侧数字<!--{en}Must be greater than the number on the left-->"),!0),u=!1)}return u&&(sensorsdata.form.removeError(a),sensorsdata.form.removeError(n)),{isValid:u,params:l}},set:function(e){e=e||{},this.renderEventSelect(e),this.initDate(e),this.filterProps(e.measure?e.measure.event_name:sensorsdata.cache.events[0].name,l.bind(function(a){this.propObj=a,this.renderAggregator(a,e)},this))},renderInputField:function(e,a){var n=this;e=$.isEmptyObject(e)?{params:[1],"function":"least"}:e,e.unit=a||"";var i=this.$container.find('[data-container="input"]');i.html(t.input(e));var s=i.find("button[data-toggle]"),r=s.attr("data-value");n.changeInputStatus(r),s.saDropdown({value:r,onSelected:function(e){n.changeInputStatus(e)}})},changeInputStatus:function(e){switch(e){case"between":this.$container.find('[data-method="single"]').toggle(!0),this.$container.find('[data-method="between"]').toggle(!0);break;default:this.$container.find('[data-method="single"]').toggle(!0),this.$container.find('[data-method="between"]').toggle(!1)}},renderEventSelect:function(e){this.$container.find('[data-method="filter-events"]').eventDropdown("destroy").eventDropdown({events:sensorsdata.cache.events,eventName:e.measure?e.measure.event_name:sensorsdata.cache.events[0].name,virtualDisplay:!1,onChange:l.bind(function(e){delete this.data.filters,this.filterProps(e,l.bind(function(e){this.propObj=e,this.renderAggregator(e)},this))},this)})},filterProps:function(e,a){n.get(e,function(t){for(var n=t.original[e].event||[],i=t.original[e].user||[],s=[],r=[],l=0,o=n.length;o>l;l++){var d=n[l];d.measureField=["event",d.event_name,d.name].join("."),"$user_id"!==d.name&&"number"===d.data_type&&d.is_measure?(d.isMeasure="is_measure",s.push($.extend(!0,{},d))):(d.isMeasure="not_measure",d.aggregator="uniqCount")}$.isFunction(a)&&($.isEmptyObject(i)||(t.original[e].user=i.filter(function(e){return!e.is_segmenter})),a({measures:s,notMeasures:r,props:t.original[e]||{}}))})},renderAggregator:function(e,a){if(!e)throw new Error("clustering/editor/eventItem/eventItem.js: renderAggregator(propObj, data) 参数 propObj 不能为空");var n=(a||{}).measure||{aggregator:"general",event_name:sensorsdata.cache.events[0].name},i="";l.measuresToText({measures:[n]},function(e){i=e[0].hasOwnProperty("unit")?e[0].unit:"",n.cname=e[0].text.slice(1).join("的")});var s=this.$container.find('[data-container="measure"]'),r=this.$container.find('[data-container="input"]');if(s.html(t.measures($.extend(!0,{measure:n},e))),n.field){var o=s.find('[data-field="'+n.field+'"]').filter(function(e,a){return $(a).attr("data-aggregator")===n.aggregator?!0:void 0});o.parent().addClass("active").closest(".dropdown-submenu").addClass("active")}else s.find('[data-aggregator="'+n.aggregator+'"]').parent().addClass("active");s.off("click.method").on("click.method",function(e){var a=$(e.target||e.srcElement),t=a.attr("data-method")||a.closest("[data-method]").attr("data-method"),n=null,i=null,l="";switch(t){case"choose-agg-one":if(i=a.closest(".aggregator-item").find(".cur-measure"),n=a.closest("li"),n.hasClass("disabled"))return;if(n.hasClass("dropdown-submenu"))return!1;o=n.find("a"),n.addClass("active").siblings().removeClass("active"),i.attr("data-aggregator",o.attr("data-aggregator")).attr("data-field",o.attr("data-field")).text(o.attr("data-cname")),i.attr("data-unit",o.attr("data-unit")),l=s.find("span.cur-measure").attr("data-unit"),r.find('[data-type="unit"]').attr("data-unit",l).text(l||"");break;case"choose-agg-two":if(i=a.closest(".aggregator-item").find(".cur-measure"),n=a.closest("li"),n.hasClass("disabled"))return;n.addClass("active").siblings().removeClass("active");var o=n.find("a");n.parents("ul:first").parent().addClass("active").siblings().removeClass("active").find("ul li").removeClass("active"),i.attr("data-aggregator",o.attr("data-aggregator")).attr("data-field",o.attr("data-field")).attr("data-unit",o.attr("data-unit")).text(o.attr("data-cname")+"的"+o.text()),l=s.find("span.cur-measure").attr("data-unit"),r.find('[data-type="unit"]').attr("data-unit",l).text(l||""),"次"!==l&&r.find(".error").length&&sensorsdata.form.removeError(r.find(".error"))}}),this.renderInputField(a,i)},initDate:function(e){var a=this;e=e||{};var t={allowRelative:!0,allowDisplayTip:!0,parentEl:this.$container};if("relative_time"===e.time_function)t.relativeValue=e.time_params?e.time_params[0]:"",t.chosenLabel=sensorsdata.convertRelativeTimeLabel(t.relativeValue);else if("absolute_time"===e.time_function)e.time_params&&(t.startDate=e.time_params[0],t.endDate=e.time_params[1]);else{var n=sensorsdata.buildDefaultTimeRange();t.startDate=n[0].format(sensorsdata.CONSTSET.dateFormat),t.endDate=n[1].format(sensorsdata.CONSTSET.dateFormat),t.relativeValue=""}sensorsdata.initDateRangeInput(this.$dateInput,t),this.$dateInput.unbind("apply.daterangepicker").bind("apply.daterangepicker",function(e,t){t.relativeValue?(a.data.time_function="relative_time",a.data.time_params=[t.relativeValue]):(a.data.time_function="absolute_time",a.data.time_params=[t.startDate.format(sensorsdata.CONSTSET.timeFormat),t.endDate.format(sensorsdata.CONSTSET.timeFormat)])})},destroy:function(){var e=this.$dateInput.data("daterangepicker");e&&$.isFunction(e.remove)&&e.remove(),this.$container.find("input").each(function(){sensorsdata.form.removeError($(this))}),this.filterInstance&&$.isFunction(this.filterInstance.destroy)&&this.filterInstance.destroy(),this.$container.off("setAntiError"),this.$container.html("")}}),a.create=function(e,a){$.isFunction(a)&&a(new o(e))}});
;/*!components/clustering/editor/propItem/propItem.js*/
define("components/clustering/editor/propItem/propItem",function(e,t){var n=e("components/model/api"),o=e("components/util/util"),i=e("components/condition/condition"),r=e("components/dataCache/dataCache").create(),a={queue:[],loading:!1,create:function(e,t){var n=$.extend(!0,{style:2,className:"clustering-editor-propitem",timeType:"absolute"},e);n.data&&(n.data=n.data.condition);var o=r.get("properties");return o?(n.properties=o,t(i.create(n)),!0):(this.queue.push({options:n,callback:t}),this.loadData(),!1)},loadData:function(){this.loading||(this.loading=!0,sensorsdata.ajax({url:n.get("USER_PROPERTIES"),success:o.bind(this.receive,this)}))},receive:function(e){r.set("properties",{user:e.filter(function(e){return!e.is_segmenter&&"$id"!==e.name})}),this.loading=!1,this.processQueue()},processQueue:function(){var e=r.get("properties");this.queue.forEach(function(t){t.options.properties=e,t.callback(i.create(t.options))}),this.queue.length=0}},c={create:function(e,t){var n="components/editor/propItem: create(options, callback) ";if("object"!==$.type(e))throw new Error(n+"参数 options 不能为空，且必须为 Object 类型");if(!e.container||!$.isFunction(e.container.append))throw new Error(n+"参数 options.container 不能为空，且必须为 jQuery 对象，存在 append 方法");if(!$.isFunction(t))throw new Error(n+"参数 callback 不能为空，且必须为 Function 类型")}};t.create=function(e,t){return c.create(e,t),a.create(e,t)},t.isInstanceof=i.isInstanceof});
;/*!components/clustering/editor/panelBlock/panelBlock.js*/
define("components/clustering/editor/panelBlock/panelBlock",function(n,i){function t(n){this.options=n,this.isCollapse="boolean"===$.type(n.isCollapse)?n.isCollapse:!1,this.$container=$(Handlebars.template({1:function(n,i,t,e){var o;return'    <span class="quicklink" data-method="panel.quicklink"><span class="icon-add-fill"></span>'+this.escapeExpression((o=null!=(o=i.quickLink||(null!=n?n.quickLink:n))?o:i.helperMissing,"function"==typeof o?o.call(n,{name:"quickLink",hash:{},data:e}):o))+"</span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,i,t,e){var o,s,l=i.helperMissing,a="function",c=this.escapeExpression;return'<div class="clustering-editor-panelblock" data-collapse="'+c((s=null!=(s=i.isCollapse||(null!=n?n.isCollapse:n))?s:l,typeof s===a?s.call(n,{name:"isCollapse",hash:{},data:e}):s))+'">\n  <div class="block-hd">\n'+(null!=(o=i["if"].call(n,null!=n?n.quickLink:n,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?o:"")+'    <h4><span class="icon-chart-collapse" data-method="panel.collapse"></span><span class="icon-chart-expand" data-method="panel.collapse"></span>'+c((s=null!=(s=i.title||(null!=n?n.title:n))?s:l,typeof s===a?s.call(n,{name:"title",hash:{},data:e}):s))+'</h4>\n  </div>\n  <div class="block-bd"></div>\n</div>'},useData:!0})({title:n.title,isCollapse:this.isCollapse,quickLink:n.quickLink&&n.quickLink.text})).appendTo(n.container),this.$body=this.$container.find(".block-bd"),this.bindEvents()}var e=n("components/util/util");t.prototype={bindEvents:function(){this.$container.find('.block-hd [data-method="panel.collapse"]').click(e.bind(this.toggleCollapse,this)),"object"===$.type(this.options.quickLink)&&this.$container.find('.block-hd [data-method="panel.quicklink"]').click(e.bind(function(){this.isCollapse&&this.toggleCollapse(),this.options.quickLink.onClick()},this))},toggleCollapse:function(){this.isCollapse=!this.isCollapse,this.$container.attr("data-collapse",this.isCollapse)},update:function(n){this.$body.html(n)},append:function(n){this.$body.append(n)},destroy:function(){this.$container.remove()}};var o={create:function(n){var i="components/editor/panelBlock: create(options) ";if("object"!==$.type(n))throw new Error(i+"参数 options 不能为空，且必须为 Object 类型");if(!n.container||!$.isFunction(n.container.append))throw new Error(i+"参数 options.container 不能为空，且必须为 jQuery 对象，存在 append 方法");if("string"!==$.type(n.title)||!n.title)throw new Error(i+"参数 options.title 不能为空，且必须为 string 类型");if("object"===$.type(n.quickLink)){if("string"!==$.type(n.quickLink.text)||!n.quickLink.text)throw new Error(i+"参数 options.quickLink.text 不能为空，且必须为 string 类型");if(!$.isFunction(n.quickLink.onClick))throw new Error(i+"参数 options.quickLink.onClick 不能为空，且必须为 Function 类型")}}};i.create=function(n){return o.create(n),new t(n)},i.isInstanceof=function(n){return n instanceof t}});
;/*!components/clustering/editor/configPanel/configPanel.js*/
define("components/clustering/editor/configPanel/configPanel",function(t,e){function n(t){this.options=$.extend(!0,{},t),this.items=[],this.groups={},this.rootGroup={relation:"and",childNum:0},this.initPanel(),this.initData(t.data)}var i=t("components/util/util"),o=t("components/clustering/editor/panelBlock/panelBlock"),a={container:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="clustering-editor-configpanel" data-group-num="0">\n  <div class="action-relation">\n    <span class="text" data-method="panel.groups.setRelation" data-id="-1"></span>\n  </div>\n  <div class="groups"></div>\n</div>'},useData:!0}),group:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o,a=e.helperMissing,r="function",s=this.escapeExpression;return'<div class="group" data-id="'+s((o=null!=(o=e.id||(null!=t?t.id:t))?o:a,typeof o===r?o.call(t,{name:"id",hash:{},data:i}):o))+'" data-item-num="0">\n  <div class="action-relation">\n    <span class="text" data-method="panel.items.setRelation" data-id="'+s((o=null!=(o=e.id||(null!=t?t.id:t))?o:a,typeof o===r?o.call(t,{name:"id",hash:{},data:i}):o))+'">'+s((o=null!=(o=e.relation||(null!=t?t.relation:t))?o:a,typeof o===r?o.call(t,{name:"relation",hash:{},data:i}):o))+'</span>\n  </div>\n  <div class="items"></div>\n</div>'},useData:!0}),item:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var o;return'<div class="item" data-id="'+this.escapeExpression((o=null!=(o=e.id||(null!=t?t.id:t))?o:e.helperMissing,"function"==typeof o?o.call(t,{name:"id",hash:{},data:i}):o))+'"></div>'},useData:!0})},r={and:"且",or:"或"};n.prototype={initPanel:function(){this.panelBlock=o.create({container:this.options.container,title:this.options.title,quickLink:{text:this.options.addButtonText,onClick:i.bind(function(){this.add()},this)}}),this.$container=$(a.container()).delegate("[data-method]","click",i.bind(this.handleAction,this)),this.$body=this.$container.find(".groups"),this.panelBlock.update(this.$container)},handleAction:function(t){var e=$(t.target);switch(e.attr("data-method")){case"panel.groups.setRelation":e.text(this.setRelation().text);break;case"panel.items.setRelation":e.text(this.setRelation(Number(e.attr("data-id"))).text)}},initData:function(t){if(this.$container.find('[data-method="panel.groups.setRelation"]').text(this.setRelation(t&&t.relation||"and").text),"object"===$.type(t)&&"rules_relation"===t.type){var e=this,n=$.extend(!0,[],t.rules),i=function(t){e["rules_relation"===t.type?"createRulesNode":"add"]({data:t}).then(function(){n.length&&i(n.shift())})};i(n.shift())}},createRulesNode:function(t){var e=this,n=$.Deferred(),i=t.data,o=this.createGroup({relation:i.relation}),a=$.extend(!0,[],i.rules),r=function(t){e.add({groupID:o.id,data:t}).then(function(){a.length?r(a.shift()):n.resolve()})};return a.length||n.resolve(),r(a.shift()),n},add:function(t){return this.creating?void 0:(t="object"===$.type(t)?$.extend(!0,{},t):{},t.defer=$.Deferred(),this.createControl(t)===!1&&(this.creating=!0),t.defer)},createControl:function(t){var e=this.getItem(t.prevID);return t.id=i.guid(),t.container=$(a.item({id:t.id})),t.index=e?e.index+1:this.items.length,this.options.createControl({container:t.container,data:t.data,index:t.index,addControl:{enable:!0},delControl:{enable:!0}},i.bind(function(e){t.control=e,this.createPostprocess(t)},this))},createPostprocess:function(t){t.control.on("add",i.bind(function(){this.add({prevID:t.id})},this)),t.control.on("del",i.bind(function(){this.del(t.id)},this));var e=null,n=this.getItem(t.prevID);n?(e=this.getGroup(t.prevID),n.data.container.after(t.container)):(e=void 0!==t.groupID?this.groups[t.groupID]:this.createGroup(),e.body.append(t.container)),this.updateGroupChildNum(e.id,"add"),this.items.splice(t.index,0,{id:t.id,parentID:e.id,container:t.container,control:t.control}),this.items.forEach(function(t,e){t.control&&$.isFunction(t.control.setIndexText)&&t.control.setIndexText(e)}),this.creating=!1,t.defer.resolve()},getItem:function(t){if("number"===$.type(t))for(var e=this.items,n=0,i=e.length;i>n;n++)if(e[n].id===t)return{data:e[n],index:n}},del:function(t){var e=this.getItem(t);if(e){var n=e.data;n.control.destroy(),n.container.remove(),this.items.splice(e.index,1),this.updateGroupChildNum(n.parentID,"del")}},getGroup:function(t){if("number"===$.type(t))for(var e=this.items,n=0,i=e.length;i>n;n++)if(e[n].id===t)return this.groups[e[n].parentID]},createGroup:function(t){var e=i.guid(),n=t&&"or"===t.relation?"or":"and",o=$(a.group({id:e,relation:r[n]}));return this.groups[e]={id:e,relation:n,container:o,body:o.find(".items"),childNum:0},this.$body.append(o).attr("data-group-num"),this.$container.attr("data-group-num",++this.rootGroup.childNum),this.groups[e]},updateGroupChildNum:function(t,e){var n=this.groups[t];n.childNum="add"===e?n.childNum+1:n.childNum-1,n.childNum?n.container.attr("data-item-num",n.childNum):(n.container.remove(),delete this.groups[n.id],this.$container.attr("data-group-num",--this.rootGroup.childNum))},setRelation:function(t,e){"string"===$.type(t)&&(e=t,t=void 0);var n=t?this.groups[t]:this.rootGroup;return n.relation="string"===$.type(e)?e:i.toggle(n.relation,"and","or"),{value:n.relation,text:r[n.relation]}},get:function(){var t={type:"rules_relation",relation:this.rootGroup.relation||"and"},e=!0,n=t.rules=[],o=-1,a=[];return this.items.forEach(i.bind(function(t){t.parentID!==o&&a.length&&(n.push(this.buildRulesNode(o,a)),a=[]),o=t.parentID;var i=t.control.get();i.isValid===!1&&(e=!1),delete i.isValid,$.isEmptyObject(i)||a.push(i)},this)),0!==a.length?n.push(this.buildRulesNode(o,a)):t=null,{data:t,isValid:e}},buildRulesNode:function(t,e){return e.length?1===e.length?e[0]:{type:"rules_relation",relation:this.groups[t].relation||"and",rules:e}:void 0},destroy:function(){this.items.forEach(function(t){t.control&&$.isFunction(t.control.destroy)&&t.control.destroy()}),this.$container.remove(),this.panelBlock.destroy(),this.rootGroup=this.groups=this.items=null}};var s={create:function(t){var e="components/editor/configPanel: create(options) ";if("object"!==$.type(t))throw new Error(e+"参数 options 不能为空，且必须为 Object 类型");if(!t.container||!$.isFunction(t.container.append))throw new Error(e+"参数 options.container 不能为空，且必须为 jQuery 对象，存在 append 方法");if("string"!==$.type(t.title)||!t.title)throw new Error(e+"参数 options.title 不能为空，且必须为 string 类型");if("string"!==$.type(t.addButtonText)||!t.addButtonText)throw new Error(e+"参数 options.addButtonText 不能为空，且必须为 string 类型");if(!$.isFunction(t.createControl))throw new Error(e+"参数 options.createControl 不能为空，且必须为 Function 类型")}};e.create=function(t){return s.create(t),new n(t)},e.isInstanceof=function(t){return t instanceof n}});
;/*!components/clustering/editor/editor.js*/
define("components/clustering/editor/editor",function(t,e,n){var a={create:{title:"创建分群",content:Handlebars.template({1:function(){return"disabled"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var r;return'<div class="clustering-editor-content">\n  <div class="clustering-meta-container">\n  </div>\n  <div class="clustering-rule-container">\n    <div class="panel-label-block">\n      <span></span>\n      <label>满足如下条件的用户：</label>\n    </div>\n    <div class="action-relation">\n      <span class="text" data-relation="and" data-method="toggle-relation">且</span>\n    </div>\n  </div>\n  <div class="footer">\n    <button class="btn btn-primary pull-right '+(null!=(r=e["if"].call(t,null!=t?t.isNotAllowed:t,{name:"if",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?r:"")+'" data-method="create">创建<!--{en}Create--></button>\n    <button class="pull-right btn btn-link" data-method="close">取消<!--{en}Cancel--></button>\n  </div>\n</div>\n'},useData:!0})},edit:{title:"编辑分群",content:Handlebars.template({1:function(){return"disabled"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var r,i,o=e.helperMissing,s="function",l=this.escapeExpression;return'<div class="clustering-editor-content">\n  <div class="clustering-meta-container">\n  </div>\n  <div class="clustering-rule-container">\n    <div class="panel-label-block">\n      <span></span>\n      <label>满足如下条件的用户：</label>\n    </div>\n    <div class="action-relation">\n      <span class="text" data-relation="'+l((i=null!=(i=e.relation||(null!=t?t.relation:t))?i:o,typeof i===s?i.call(t,{name:"relation",hash:{},data:a}):i))+'" data-method="toggle-relation">'+l((i=null!=(i=e.text||(null!=t?t.text:t))?i:o,typeof i===s?i.call(t,{name:"text",hash:{},data:a}):i))+'</span>\n    </div>\n  </div>\n  <div class="footer">\n    <button class="btn btn-primary pull-right '+(null!=(r=e["if"].call(t,null!=t?t.isNotAllowed:t,{name:"if",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?r:"")+'" data-method="save">保存<!--{en}Save--></button>\n    <button class="btn btn-primary pull-right" data-method="copy">复制<!--{en}Copy--></button>\n    <button class="pull-right btn btn-link" data-method="close">取消<!--{en}Cancel--></button>\n  </div>\n</div>\n'},useData:!0})},confirm:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover clustering-editor-confirm">\n  <div class="arrow"></div>\n  <h2 class="popover-title"></h2>\n  <div class="popover-content">\n  </div>\n  <div class="popover-content-footer clearfix">\n    <div class="popover-footer-right">\n      <button type="button" class="pop-is-cancel btn-link">取消<!--{en}Cancel--></button>\n      <button type="button" class="pop-is-success btn btn-primary">确定<!--{en}Ok--></button>\n    </div>\n  </div>\n</div>'},useData:!0})},r={or:sensorsdata.languages.get("或<!--{en}or-->"),and:sensorsdata.languages.get("且<!--{en}and-->")},i=t("components/clustering/editor/metaPanel/metaPanel"),o=null,s=t("components/clustering/editor/eventSeriesPanel/eventSeriesPanel"),l=t("components/clustering/editor/eventItem/eventItem"),d=t("components/clustering/editor/propItem/propItem"),c=t("components/clustering/editor/configPanel/configPanel"),u=[],p=null,f=["profile_rule","event_rule","event_sequence_rule"],h=$.extend(!0,{},sensorsdata.EventsModule,{show:function(t,e,n){var h=this,v=[],g=sensorsdata.authority.isAdmin,y=sensorsdata.authority.isAnalyst,m=sensorsdata.authority.isNormal,b=sensorsdata.authority.userName,_=t&&t.hasOwnProperty("last_partition")&&"computing"===t.last_partition.status;if(this.isNotAllowed=!1,t&&y&&b!==t.user_name&&v.push("analyst_notself"),m&&v.push("normal"),(m||y&&sensorsdata.cache.config.allow_analyst_higher_privilege!==!0)&&(this.isNotAllowed=!0),$.extend(!0,t,{authority:v}),t&&t.isCopy===!0){var w="_2";t.id=null,t.name+=w,t.cname+=w}e=e||[];var x=t&&t.isCopy!==!0?a.edit:a.create;p=sensorsdata.createSlidePage({title:x.title,width:1e3}),p.setContent(x.content(!t||0!==t.type&&1!==t.type?{isNotAllowed:this.isNotAllowed}:{relation:t.content.relation,text:r[t.content.relation],isNotAllowed:this.isNotAllowed})),p.show(),p.on("hid",function(){h.destroy()});var C=p.$container.find(".clustering-rule-container"),A=p.$container.find(".clustering-meta-container");o=i.create({container:A,data:t?$.extend(!0,{},t,t.scheduler):{},listData:{total:e.length,result:e}});var D=this.buildPanelData(t);t&&0!==t.type&&1!==t.type?p.$container.find(".clustering-rule-container").remove():(u.push(c.create({container:C,title:"用户属性满足",addButtonText:"添加",createControl:function(t,e){d.create(t,e)},data:D.profile_rule})),u.push(c.create({container:C,title:"做过",addButtonText:"添加",createControl:function(t,e){l.create(t,e)},data:D.event_rule})),u.push(c.create({container:C,title:"行为序列",addButtonText:"添加",createControl:function(t,e){s.create(t,e)},data:D.event_sequence_rule})),!t||!t.id&&t.isCopy!==!0?u.length&&u[1].add({}):(t.id&&!g||_)&&p.$container.find(".clustering-rule-container").addClass("disabled")),(!t||t.isCopy===!0||"isNormal"===t.authority||0!==t.type&&1!==t.type)&&p.$container.find('[data-method="copy"]').remove(),p.$container.find('[data-method="toggle-relation"]').off("click.relation").on("click.relation",function(){var t="and"===$(this).attr("data-relation");$(this).attr("data-relation",t?"or":"and"),$(this).text(r[$(this).attr("data-relation")])}),p.$container.find(".footer button[data-method]").off("click.method").on("click.method",function(){var e=$(this).attr("data-method");switch(e){case"close":h.hide();break;case"save":case"create":if(h.isNotAllowed===!0)return;var r=p.$container.find('[data-method="toggle-relation"]').attr("data-relation"),i=!1,s=t&&t.content?t.content.relation!==r:!1,l=!1,d={data:$.extend(!0,t,{content:{type:"rules_relation",relation:r,rules:[]}}),isValid:!0},c=o.get();if(c.isValid?d.data=$.extend(!0,{},d.data,{name:c.data.name,cname:c.data.cname,scheduler:c.data.scheduler,type:"number"==typeof d.data.type&&t.hasOwnProperty("isCopy")&&t.isCopy!==!0?d.data.type:c.data.type,app_push_list:c.data.app_push_list}):d.isValid=c.isValid,0===d.data.type&&(d.data.scheduler={running:!0}),d.data.content.rules=[],!t||t&&(0===t.type||1===t.type)){if(l=!(!u[0].get().data&&!u[2].get().data),!l){var v=u[1].get(),g=$.extend(!0,{},v.data);if(g){var y=g&&g.rules&&$.isArray(g.rules)?g.rules.reduce(function(t,e){return t.concat("rules_relation"!==e.type?e:e.rules)},[]):[];y=y.filter(function(t){return!(1===t.params.length&&t.params[0]<=0&&["equal","less","most"].indexOf(t.function)>-1)}),y.length&&(l=!0)}}}else l=!0;if(!t||t&&(0===t.type||1===t.type)){var m=u[1].$body.find(".filter-item-container");m.length>0&&m.trigger("setAntiError",{antiError:l})}if(u.forEach(function(t,e){var n=t.get();if(n.isValid){var a=n.data;a&&d.data.content.rules.push(h.buildRulesData(a,f[e]))}else d.isValid=n.isValid}),!d.data)return;if((0===d.data.type||1===d.data.type)&&0===d.data.content.rules.length)return void sensorsdata.info.show("请添加规则<!--{todo}-->");if("rules_relation"===d.data.content.type){var b=d.data.content.rules;if(b.length>0)for(var _=0;_<b.length;_++)for(var w=0;w<b[_].rules.length;w++)if("event_sequence_rule"===b[_].rules[w].type&&!$.isEmptyObject(b[_].rules[w].steps)&&1===b[_].rules[w].steps.length)return void sensorsdata.info.show(sensorsdata.languages.get("行为序列中至少要包含两个事件<!--{en}The behavior sequence must contain at least two events-->"))}if(d.data.content.rules&&$.isArray(d.data.content.rules)&&(d.data.id||0===d.data.id)){for(var x=$.extend(!0,[],d.data.content.rules),C={},A=0;A<x.length;A++){var N=x[A],P=h.getType(N);N=h.convertRuleData(N),C[P]=N}i=t&&(0===t.type||1===t.type)&&(!h.diffByType(D,C)||s)}if(d.isValid)if(i){var k=p.$container.find('.footer [data-method="save"]');sensorsdata.popover({ele:k,container:p.$container,placement:"top",showNow:!0,template:a.confirm(),title:sensorsdata.languages.get("确定修改规则?<!--{todo}-->"),content:sensorsdata.languages.get("下次计算将按新规则执行<!--{todo}-->"),successAfter:function(){if(h.hide(),$.isFunction(n)){for(var e in d.data)t&&d.data.hasOwnProperty(e)&&(t[e]=d.data[e]);n($.extend(!0,{},t,d.data))}}})}else if(h.hide(),$.isFunction(n)){for(var T in d.data)t&&d.data.hasOwnProperty(T)&&(t[T]=d.data[T]);n($.extend(!0,{},t,d.data))}break;case"copy":h.on("editor.destroy",function(){h.trigger("editor.copy",{isCopy:!0})}),h.hide()}})},buildPanelData:function(t){var e=this;t=t||{};var n=t.content||{},a=n.rules||[],r={};if(0===a.length)return r;for(var i=0;i<a.length;i++){var o=a[i],s=e.getType(o);o=e.convertRuleData(o),r[s]=o}return r},buildRulesData:function(t,e){var n=this,a=$.extend(!0,{},t),r=a.rules||[];if(r.length)a.type="rules_relation",a.rules=a.rules.map(function(t){return n.buildRulesData(t,e)});else switch(a.type=e,e){case"profile_rule":var i=a.condition;delete a.condition,$.extend(a,i)}return a},convertRuleData:function(t){var e=this,n=$.extend(!0,{},t||{}),a=n.rules||[];if(a.length)n.rules=a.map(function(t){return e.convertRuleData(t)});else{var r=n.type;switch(r){case"profile_rule":var i=n;n={condition:i}}}return n},getType:function(t){if(!t)throw new Error("clustering/editor/editor.js getType(node): 参数 node 不能为空，且必须为 Object 类型");t=t||{};var e=null;if(t.type&&"rules_relation"!==t.type)return t.type;var n=t.rules||[];if(0===n.length)throw new Error("clustering/editor/editor.js getType(node): 规则节点列表不能为空 list ");for(var a=0;a<n.length&&!(e=this.getType(n[a]));a++);return e},diffByType:function(t,e){if(!t||!e||$.isEmptyObject(t)||$.isEmptyObject(e))return!1;var n=!1,a=sensorsdata.util.diff;return n=a(t.profile_rule,e.profile_rule)&&a(t.event_rule,e.event_rule)&&a(t.event_sequence_rule,e.event_sequence_rule)},hide:function(){p&&$.isFunction(p.hide)&&p.hide()},destroy:function(){u.length>0&&u.forEach(function(t){t.destroy&&t.destroy()}),u=[],o&&$.isFunction(o.destroy)&&(o.destroy(),o=null),p&&$.isFunction(p.hide)&&p.destroy(),p=null,this.trigger("editor.destroy").off("editor.destroy")}});n.exports=h});
;/*!components/clustering/body/body.js*/
define("components/clustering/body/body",function(t,n){var e=t("components/clustering/table/table"),s=t("components/clustering/control/control"),o=t("components/clustering/upload/upload"),a=t("components/model/clustering"),r=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="clusteringBody">\n  <div data-placeholder="control"></div>\n  <div data-placeholder="table"></div>\n</div>'},useData:!0}),i=t("components/util/util"),c=t("components/clustering/editor/editor"),l=t("components/router/router"),u=function(t){if(!t.placeholder)throw new Error("clustering/body/body.js: create(options) 参数 options 不能为空，且必须为 Object 类型");this.container=$(r()),t.placeholder.replaceWith(this.container),this.tableInstance=null,this.controlInstance=null,this.clusters=[],this.options=t,this.copy_cluster={},this.init()};u.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){a.getList(i.bind(function(t){t.error||(this.clusters=t.result||[],this.controlInstance=s.create({placeholder:this.container.find('[data-placeholder="control"]'),data:this.buildListInfo(this.clusters)}),this.tableInstance=e.create({container:this.container.find('[data-placeholder="table"]'),data:t}),this.bindEvents(),sensorsdata.track("view_clustering_list",{clustering_total:t.total}))},this))},bindEvents:function(){var t=this;this.controlInstance.on("search",function(n){t.tableInstance.trigger("search",n),t.controlInstance.update(t.buildListInfo())}),this.tableInstance.on("filter",function(){t.controlInstance.update(t.buildListInfo())}),this.controlInstance.on("create",function(){c.show(null,t.clusters,function(t){var n={};a.add(t,function(t){t.error?(n.success=!1,n.fail_reason=t.error):(sensorsdata.success.show(sensorsdata.languages.get("创建成功<!--{todo}-->")),a.run(t.id,t.base_time),n.success=!0),sensorsdata.track("create_clustering",n)})})}),this.controlInstance.on("upload",function(){o.show({placeholder:t.container,listData:{total:t.clusters.length,result:t.clusters},onConfirm:function(t){a.upload(t,function(t){var n={};t.error?(n.success=!1,n.fail_reason=t.error):(sensorsdata.success.show(sensorsdata.languages.get("创建成功<!--{todo}-->")),a.trigger("update"),n.success=!0),sensorsdata.track("create_clustering",n)})}})}),this.tableInstance.on("edit",function(n){n&&(t.copy_cluster={name:n.name,cname:n.cname,type:n.type,last_partition:{app_push_list:n.last_partition.app_push_list||[]},scheduler:0===n.type?{running:!0}:$.extend(!0,{},n.scheduler),content:$.extend(!0,{},n.content),user_name:n.user_name}),c.show(n,t.clusters,function(t){a.set(t,function(t){t.error||sensorsdata.success.show(sensorsdata.languages.get("修改成功<!--{todo}-->"))})})}),this.tableInstance.on("cluster-detail",function(t){if(-1!==[2,5,6].indexOf(t.type)){var n={id:t.id,filter:{conditions:[{"function":"isTrue",field:"user."+t.name}],relation:"and"},type:t.type};l.nav("/clustering/users/#"+$.param(n))}else l.nav("/clustering/cluster-detail/#id="+t.id)}),this.tableInstance.on("del",function(t){a.del(t.id,function(t){t.error||sensorsdata.success.show(sensorsdata.languages.get("删除成功<!--{todo}-->"))})}),c.off("editor.copy").on("editor.copy",function(n){$.extend(!0,t.copy_cluster,n),c.show(t.copy_cluster,t.clusters,function(n){a.add(n,function(t){t.error||(sensorsdata.success.show(sensorsdata.languages.get("创建成功<!--{todo}-->")),a.run(t.id,t.base_time))}),t.copy_cluster=null})});var n=function(n){a.getList(function(e){e.error||(["add","upload"].indexOf(n.action)>-1&&(e.newId=n.id),t.tableInstance.update(e),t.clusters=e.result||[],t.controlInstance.update(t.buildListInfo()))})};a.on("rule.change",n),a.on("partition.change",n)},buildListInfo:function(t){var n=[];t?n=$.extend(!0,[],t):this.tableInstance&&(n=this.tableInstance.getCurrentData());var e=[],s=[],o=[];(n||[]).map(function(t){t.last_partition&&("failed"===t.last_partition.status?e.push(t):"succeed"===t.last_partition.status?s.push(t):"computing"===t.last_partition.status&&o.push(t))});var a=n.length;return{total:a,fail:e.length,succeed:s.length,computing:o.length}},destroy:function(){this.controlInstance&&$.isFunction(this.tableInstance.destroy)&&this.tableInstance.destroy(),this.controlInstance&&$.isFunction(this.controlInstance.destroy)&&this.controlInstance.destroy(),a&&$.isFunction(a.destroy)&&a.destroy()}}),n.create=function(t){return new u(t)}});
;/*!components/clustering/head/head.js*/
define("components/clustering/head/head",function(n,e){var t=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="clusteringHead" class="clusteringHead">\n\n  <div class="clustering-title-container">\n    <span class="clustering-title-logo icon-clustering">\n      <img src=\'../../../res/img/icon/clustering.svg\'>\n    </span>\n    <span class="clustering-title" contenteditable="false">用户分群<!--{en}User Clustering--></span>\n  </div>\n\n</div>'},useData:!0}),i=function(n){this.$container=$(t()),n.placeholder.replaceWith(this.$container)};i.prototype.destroy=function(){this.$container.empty()},e.create=function(n){return new i(n)}});
;/*!components/clustering/noResult/noResult.js*/
define("components/clustering/noResult/noResult",function(n,C){C.create=function(n){var C=n.placeholder;C.html(Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="noResult-clustering" class="noResult-container">\n  <p class="noResult-mark">\n    <svg width="79px" height="79px" viewBox="0 0 79 79" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <desc>noResult</desc>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Group-17" transform="translate(-94.000000, 0.000000)">\n          <g id="Group-13" transform="translate(94.000000, 0.000000)">\n            <circle id="Oval-8" fill="#F4F8FD" cx="39.5" cy="39.5" r="39.5"></circle>\n            <g id="repair" transform="translate(20.000000, 19.000000)" fill-rule="nonzero">\n              <path d="M37.5139181,26.0078125 C35.6191813,24.109375 32.905809,23.2657031 30.2859259,23.7344531 L25.8324366,19.15625 C25.3646004,18.6875 24.6159844,18.7109375 24.17154,19.1796875 L21.785653,21.5702344 L19.3059649,24.0546094 C18.8382066,24.5233594 18.8382066,25.2499219 19.3059649,25.71875 L23.6659649,30.3671094 C23.2215205,32.96875 24.0401559,35.7109375 25.9582846,37.609375 C29.1396491,40.796875 34.3326316,40.796875 37.5138402,37.609375 C40.7185965,34.3984375 40.7185965,29.1953125 37.5139181,26.0078125 Z M29.2566862,34.2813281 C28.5782456,33.6015625 28.2274464,32.7109375 28.2274464,31.7969531 C28.2274464,30.9063281 28.5782456,30.0157031 29.2566862,29.3125781 C30.6134893,27.953125 32.8589474,27.953125 34.2157505,29.3125781 C35.5957895,30.6953125 35.5957895,32.921875 34.2157505,34.2813281 C32.8590253,35.6640625 30.6134893,35.6640625 29.2566862,34.2813281 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M37.5139181,37.609375 C34.3326316,40.796875 29.1397271,40.796875 25.9583626,37.609375 C24.0402339,35.7109375 23.2215984,32.9688281 23.6660429,30.3671094 L19.3060429,25.71875 C18.8382846,25.25 18.8382846,24.5234375 19.3060429,24.0546094 L21.785731,21.5702344 L29.2566862,29.3125781 C28.5782456,30.0157031 28.2274464,30.9063281 28.2274464,31.7969531 C28.2274464,32.7109375 28.5782456,33.6015625 29.2566862,34.2813281 C30.6134893,35.6640625 32.8589474,35.6640625 34.2157505,34.2813281 L37.5139181,37.609375 Z"\n                id="Shape" fill="#2DCA93"></path>\n              <path d="M20.7797271,14.2578125 L16.1813645,10.0078125 C16.7895517,7.26570313 15.994152,4.40625 13.9825341,2.390625 C10.7778558,-0.796875 5.58479532,-0.796875 2.40358674,2.390625 C-0.801091618,5.6015625 -0.801091618,10.7813281 2.40358674,13.9921875 C4.29832359,15.890625 7.03524366,16.7342969 9.63173489,16.2655469 L14.3470565,20.75 C14.5576608,20.9608594 14.8617544,21.078125 15.165848,21.078125 C15.4699415,21.078125 15.7506433,20.9608594 15.9844834,20.75 L18.4640156,18.2421875 L20.8031969,15.8984375 C21.2710331,15.453125 21.2476413,14.703125 20.7797271,14.2578125 Z M5.70191033,10.6874219 C5.02346979,9.98429687 4.67267057,9.09367187 4.67267057,8.20304687 C4.67267057,7.2890625 5.02346979,6.3984375 5.70191033,5.71867187 C7.03524366,4.38273437 9.35103314,4.38273437 10.6843665,5.71867187 C12.0410136,7.078125 12.0410136,9.3046875 10.6609747,10.6874219 C9.30417154,12.046875 7.08194932,12.046875 5.70191033,10.6874219 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M18.4640156,18.2421875 L15.9844834,20.75 C15.7506433,20.9608594 15.4699415,21.078125 15.165848,21.078125 C14.8617544,21.078125 14.5576608,20.9608594 14.3470565,20.75 L9.63173489,16.2655469 C7.03524366,16.7342969 4.29832359,15.890625 2.40358674,13.9921875 C-0.801091618,10.78125 -0.801091618,5.60148438 2.40358674,2.390625 L5.70191033,5.71867187 C5.02346979,6.3984375 4.67267057,7.2890625 4.67267057,8.20304687 C4.67267057,9.09367187 5.02346979,9.98429687 5.70191033,10.6874219 C7.08194932,12.046875 9.30417154,12.046875 10.6609747,10.6874219 L18.4640156,18.2421875 Z"\n                id="Shape" fill="#2DCA93"></path>\n              <path d="M39.1359844,4.65773437 C38.7850292,3.95460937 37.8260429,3.76726562 37.2412476,4.35320312 L33.7793372,7.821875 C33.3582846,7.72820312 33.0073294,7.5171875 32.7032359,7.2359375 C32.4225341,6.93125 32.2119298,6.57960937 32.1184405,6.15773437 L35.5803509,2.6890625 C36.1651462,2.1265625 36.0015595,1.14210937 35.2762573,0.790625 C32.1418324,-0.6859375 28.3992203,-0.053125 25.942924,2.4078125 C23.9780897,4.37648437 23.1826901,7.16554687 23.7207797,9.83742187 C18.691462,14.8530469 14.6661209,18.70375 9.63680312,23.7192187 C7.01692008,23.2271094 4.25668616,24.0708594 2.29185185,26.0864062 C-0.912826511,29.4146094 -0.655516569,34.5707812 2.43220273,37.6177344 C5.6602729,40.8286719 10.8766472,40.8052344 14.0812476,37.4769531 C15.9759844,35.5082812 16.7011306,32.8832812 16.2566862,30.3520312 L30.4809357,16.30625 C33.0073294,16.7046094 35.6271345,15.9078906 37.5218713,14.0094531 C39.9780117,11.5483594 40.6096686,7.79835937 39.1359844,4.65773437 Z M10.6660429,34.2660937 C9.30939571,35.6489844 7.1105653,35.6489844 5.73037037,34.2895312 L5.70697856,34.2660937 C4.35033138,32.9067969 4.35033138,30.6802344 5.70697856,29.2973437 C7.08717349,27.9380469 9.30939571,27.9380469 10.6660429,29.2973437 C12.0462378,30.6802344 12.0462378,32.906875 10.6660429,34.2660937 Z"\n                id="Shape" fill="#D7ECF6"></path>\n              <path d="M37.5218713,14.009375 C35.6271345,15.9078125 33.0072515,16.7046094 30.4809357,16.3061719 L16.2567641,30.3521094 C16.7012086,32.8834375 15.9760624,35.5083594 14.0813255,37.4770313 C10.8766472,40.8052344 5.66035088,40.82875 2.4322807,37.6178125 L5.73044834,34.2896094 C7.11064327,35.6490625 9.30947368,35.6490625 10.6661209,34.2661719 C12.0463158,32.906875 12.0463158,30.6803125 10.6661209,29.2974219 L32.7032359,7.2359375 C33.0073294,7.5171875 33.3582846,7.72820313 33.7793372,7.821875 L37.2412476,4.35320313 C37.8260429,3.76726563 38.7850292,3.9546875 39.1359844,4.65773438 C40.6096686,7.79835938 39.9780117,11.5483594 37.5218713,14.009375 Z"\n                id="Shape" fill="#C1DBE8"></path>\n            </g>\n          </g>\n        </g>\n      </g>\n    </svg>\n  </p>\n  <p class="noResult-desc">还未创建用户分群<!--{en}User clustering has not yet been created.--></p>\n</div>'},useData:!0}))}});
;/*!components/clusteringDetail/breadcrumbsNav/breadcrumbsNav.js*/
define("components/clusteringDetail/breadcrumbsNav/breadcrumbsNav",function(a,n){var e=a("components/router/router"),e=a("components/router/router");n.create=function(a){var n=a.container,r={breadcrumbsNav:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,n,e,r){var s,c=n.helperMissing,t="function",l=this.escapeExpression;return'<div id="clustering-breadcrumbs-nav" class="breadcrumbsNav breadcrumbsnav-container">\n  <a class="breadcrumbsNav-back" data-nav="/'+l((s=null!=(s=n.url_back||(null!=a?a.url_back:a))?s:c,typeof s===t?s.call(a,{name:"url_back",hash:{},data:r}):s))+'/"><span class="icon-arrow-left"></span>返回<!--{en}Back--></a>\n  <span class="sa-h-split"></span>\n  <a data-nav="/'+l((s=null!=(s=n.url_home||(null!=a?a.url_home:a))?s:c,typeof s===t?s.call(a,{name:"url_home",hash:{},data:r}):s))+'/" class="breadcrumbsNav-home " contenteditable="false">用户分群<!--{en}User Clustering--></a>\n  <span class="icon-arrow-right "></span>\n  <span class="breadcrumbsNav-sub " contenteditable="false ">分群结果<!--{en}Clustering results--></span>\n</div>\n'},useData:!0})};n.find('[data-placeholder="breadcrumbsNav"]').replaceWith(r.breadcrumbsNav({url_back:"clustering",url_home:"clustering"})),n.off("click.jumpto").on("click.jumpto","[data-nav]",function(){var a=$(this).attr("data-nav");e.nav(a)})}});
;/*!components/clusteringDetail/chart/chart.js*/
define("components/clusteringDetail/chart/chart",function(t,a){var n={column:t("components/charts/column/column")},s={content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="chart-container">\n  <div class="nodata-container">\n    <p class="nodata">\n      <svg width="79px" height="79px" viewBox="0 0 79 79" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <desc>nodata</desc>\n        <defs></defs>\n        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n          <g id="Group-17" transform="translate(-94.000000, 0.000000)">\n            <g id="Group-13" transform="translate(94.000000, 0.000000)">\n              <circle id="Oval-8" fill="#F4F8FD" cx="39.5" cy="39.5" r="39.5"></circle>\n              <g id="repair" transform="translate(20.000000, 19.000000)" fill-rule="nonzero">\n                <path d="M37.5139181,26.0078125 C35.6191813,24.109375 32.905809,23.2657031 30.2859259,23.7344531 L25.8324366,19.15625 C25.3646004,18.6875 24.6159844,18.7109375 24.17154,19.1796875 L21.785653,21.5702344 L19.3059649,24.0546094 C18.8382066,24.5233594 18.8382066,25.2499219 19.3059649,25.71875 L23.6659649,30.3671094 C23.2215205,32.96875 24.0401559,35.7109375 25.9582846,37.609375 C29.1396491,40.796875 34.3326316,40.796875 37.5138402,37.609375 C40.7185965,34.3984375 40.7185965,29.1953125 37.5139181,26.0078125 Z M29.2566862,34.2813281 C28.5782456,33.6015625 28.2274464,32.7109375 28.2274464,31.7969531 C28.2274464,30.9063281 28.5782456,30.0157031 29.2566862,29.3125781 C30.6134893,27.953125 32.8589474,27.953125 34.2157505,29.3125781 C35.5957895,30.6953125 35.5957895,32.921875 34.2157505,34.2813281 C32.8590253,35.6640625 30.6134893,35.6640625 29.2566862,34.2813281 Z"\n                  id="Shape" fill="#68D9B1"></path>\n                <path d="M37.5139181,37.609375 C34.3326316,40.796875 29.1397271,40.796875 25.9583626,37.609375 C24.0402339,35.7109375 23.2215984,32.9688281 23.6660429,30.3671094 L19.3060429,25.71875 C18.8382846,25.25 18.8382846,24.5234375 19.3060429,24.0546094 L21.785731,21.5702344 L29.2566862,29.3125781 C28.5782456,30.0157031 28.2274464,30.9063281 28.2274464,31.7969531 C28.2274464,32.7109375 28.5782456,33.6015625 29.2566862,34.2813281 C30.6134893,35.6640625 32.8589474,35.6640625 34.2157505,34.2813281 L37.5139181,37.609375 Z"\n                  id="Shape" fill="#2DCA93"></path>\n                <path d="M20.7797271,14.2578125 L16.1813645,10.0078125 C16.7895517,7.26570313 15.994152,4.40625 13.9825341,2.390625 C10.7778558,-0.796875 5.58479532,-0.796875 2.40358674,2.390625 C-0.801091618,5.6015625 -0.801091618,10.7813281 2.40358674,13.9921875 C4.29832359,15.890625 7.03524366,16.7342969 9.63173489,16.2655469 L14.3470565,20.75 C14.5576608,20.9608594 14.8617544,21.078125 15.165848,21.078125 C15.4699415,21.078125 15.7506433,20.9608594 15.9844834,20.75 L18.4640156,18.2421875 L20.8031969,15.8984375 C21.2710331,15.453125 21.2476413,14.703125 20.7797271,14.2578125 Z M5.70191033,10.6874219 C5.02346979,9.98429687 4.67267057,9.09367187 4.67267057,8.20304687 C4.67267057,7.2890625 5.02346979,6.3984375 5.70191033,5.71867187 C7.03524366,4.38273437 9.35103314,4.38273437 10.6843665,5.71867187 C12.0410136,7.078125 12.0410136,9.3046875 10.6609747,10.6874219 C9.30417154,12.046875 7.08194932,12.046875 5.70191033,10.6874219 Z"\n                  id="Shape" fill="#68D9B1"></path>\n                <path d="M18.4640156,18.2421875 L15.9844834,20.75 C15.7506433,20.9608594 15.4699415,21.078125 15.165848,21.078125 C14.8617544,21.078125 14.5576608,20.9608594 14.3470565,20.75 L9.63173489,16.2655469 C7.03524366,16.7342969 4.29832359,15.890625 2.40358674,13.9921875 C-0.801091618,10.78125 -0.801091618,5.60148438 2.40358674,2.390625 L5.70191033,5.71867187 C5.02346979,6.3984375 4.67267057,7.2890625 4.67267057,8.20304687 C4.67267057,9.09367187 5.02346979,9.98429687 5.70191033,10.6874219 C7.08194932,12.046875 9.30417154,12.046875 10.6609747,10.6874219 L18.4640156,18.2421875 Z"\n                  id="Shape" fill="#2DCA93"></path>\n                <path d="M39.1359844,4.65773437 C38.7850292,3.95460937 37.8260429,3.76726562 37.2412476,4.35320312 L33.7793372,7.821875 C33.3582846,7.72820312 33.0073294,7.5171875 32.7032359,7.2359375 C32.4225341,6.93125 32.2119298,6.57960937 32.1184405,6.15773437 L35.5803509,2.6890625 C36.1651462,2.1265625 36.0015595,1.14210937 35.2762573,0.790625 C32.1418324,-0.6859375 28.3992203,-0.053125 25.942924,2.4078125 C23.9780897,4.37648437 23.1826901,7.16554687 23.7207797,9.83742187 C18.691462,14.8530469 14.6661209,18.70375 9.63680312,23.7192187 C7.01692008,23.2271094 4.25668616,24.0708594 2.29185185,26.0864062 C-0.912826511,29.4146094 -0.655516569,34.5707812 2.43220273,37.6177344 C5.6602729,40.8286719 10.8766472,40.8052344 14.0812476,37.4769531 C15.9759844,35.5082812 16.7011306,32.8832812 16.2566862,30.3520312 L30.4809357,16.30625 C33.0073294,16.7046094 35.6271345,15.9078906 37.5218713,14.0094531 C39.9780117,11.5483594 40.6096686,7.79835937 39.1359844,4.65773437 Z M10.6660429,34.2660937 C9.30939571,35.6489844 7.1105653,35.6489844 5.73037037,34.2895312 L5.70697856,34.2660937 C4.35033138,32.9067969 4.35033138,30.6802344 5.70697856,29.2973437 C7.08717349,27.9380469 9.30939571,27.9380469 10.6660429,29.2973437 C12.0462378,30.6802344 12.0462378,32.906875 10.6660429,34.2660937 Z"\n                  id="Shape" fill="#D7ECF6"></path>\n                <path d="M37.5218713,14.009375 C35.6271345,15.9078125 33.0072515,16.7046094 30.4809357,16.3061719 L16.2567641,30.3521094 C16.7012086,32.8834375 15.9760624,35.5083594 14.0813255,37.4770313 C10.8766472,40.8052344 5.66035088,40.82875 2.4322807,37.6178125 L5.73044834,34.2896094 C7.11064327,35.6490625 9.30947368,35.6490625 10.6661209,34.2661719 C12.0463158,32.906875 12.0463158,30.6803125 10.6661209,29.2974219 L32.7032359,7.2359375 C33.0073294,7.5171875 33.3582846,7.72820313 33.7793372,7.821875 L37.2412476,4.35320313 C37.8260429,3.76726563 38.7850292,3.9546875 39.1359844,4.65773438 C40.6096686,7.79835938 39.9780117,11.5483594 37.5218713,14.009375 Z"\n                  id="Shape" fill="#C1DBE8"></path>\n              </g>\n            </g>\n          </g>\n        </g>\n      </svg>\n      <br/> 未查到相关分群数据\n      <!--{todo}-->\n      <br/>\n    </p>\n  </div>\n</div>'},useData:!0}),nodata:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="nodata-container">\n  <p class="nodata">\n    <svg width="79px" height="79px" viewBox="0 0 79 79" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <!-- Generator: Sketch 51.1 (57501) - http://www.bohemiancoding.com/sketch -->\n      <desc>Created with Sketch.</desc>\n      <defs></defs>\n      <g id="其他" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="空页面" transform="translate(-797.000000, -283.000000)">\n          <g id="Group-20" transform="translate(797.000000, 283.000000)">\n            <g id="Group-13" fill="#F4F8FD">\n              <circle id="Oval-8" cx="39.5" cy="39.5" r="39.5"></circle>\n            </g>\n            <g id="job-search" transform="translate(23.000000, 18.000000)" fill-rule="nonzero">\n              <path d="M29.5714286,38.7578125 L1.28571429,38.7578125 C0.575657143,38.7578125 0,38.1806562 0,37.46875 L0,1.2890625 C0,0.57715625 0.575657143,0 1.28571429,0 L29.5714286,0 C30.2814857,0 30.8571429,0.57715625 30.8571429,1.2890625 L30.8571429,37.46875 C30.8571429,38.1806562 30.2814857,38.7578125 29.5714286,38.7578125 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M29.5714286,0 L15.4285714,0 L15.4285714,38.7578125 L29.5714286,38.7578125 C30.2814857,38.7578125 30.8571429,38.1806562 30.8571429,37.46875 L30.8571429,1.2890625 C30.8571429,0.57715625 30.2814857,0 29.5714286,0 Z"\n                id="Shape" fill="#2DCA93"></path>\n              <path d="M36,15.46875 L36,42.7109375 C36,43.4328984 35.4343714,44 34.7142857,44 L6.42857143,44 C5.70848571,44 5.14285714,43.4328984 5.14285714,42.7109375 L5.14285714,6.4453125 C5.14285714,5.72335156 5.70848571,5.15625 6.42857143,5.15625 L25.7142857,5.15625 L36,15.46875 Z"\n                id="Shape" fill="#D7ECF6"></path>\n              <path d="M36,15.46875 L36,42.7109375 C36,43.4328984 35.4343714,44 34.7142857,44 L20.5714286,44 L20.5714286,5.15625 L25.7142857,5.15625 L36,15.46875 Z"\n                id="Shape" fill="#C1DBE8"></path>\n              <path d="M36,12.6585078 L36,15.46875 L27,15.46875 C26.2799143,15.46875 25.7142857,14.9016484 25.7142857,14.1796875 L25.7142857,5.15625 L28.5172286,5.15625 C29.5457143,5.15625 30.4971429,5.56866406 31.2429429,6.290625 L34.8685714,9.92569531 C35.5886571,10.6734375 36,11.6273438 36,12.6585078 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M30.4713429,35.7069453 C29.9827714,36.2225703 29.1600857,36.2225703 28.6714286,35.7069453 L21.6256286,28.66875 C21.1370571,28.1789063 21.1370571,27.3539062 21.6256286,26.8381953 C22.1399143,26.3483516 22.9628571,26.3483516 23.4514286,26.8381953 L30.4713429,33.9024297 C30.9857143,34.3922734 30.9857143,35.2171016 30.4713429,35.7069453 Z"\n                id="Shape" fill="#84B6ED"></path>\n              <path d="M30.4713429,35.7069453 C29.9827714,36.2225703 29.1600857,36.2225703 28.6714286,35.7069453 L21.6256286,28.66875 C21.1370571,28.1789062 21.1370571,27.3539062 21.6256286,26.8381953 L30.4713429,35.7069453 Z"\n                id="Shape" fill="#559FF0"></path>\n              <path d="M23.4514286,17.7375 C20.4429429,14.7211797 15.5571429,14.7211797 12.5485714,17.7375 C9.54,20.7538203 9.54008571,25.6523437 12.5485714,28.66875 C15.5570571,31.6851562 20.4428571,31.6850703 23.4514286,28.66875 C26.46,25.6524297 26.4599143,20.7539062 23.4514286,17.7375 Z"\n                id="Shape" fill="#84B6ED"></path>\n              <path d="M23.4514286,28.66875 C20.4429429,31.6850703 15.5571429,31.6850703 12.5485714,28.66875 C9.54,25.6524297 9.54008571,20.7539062 12.5485714,17.7375 L23.4514286,28.66875 Z"\n                id="Shape" fill="#559FF0"></path>\n              <path d="M21.6256286,19.5680547 C19.62,17.53125 16.38,17.53125 14.3743714,19.5680547 C12.3428571,21.5789062 12.3428571,24.8273438 14.3743714,26.8381953 C16.38,28.875 19.62,28.875 21.6256286,26.8381953 C23.6571429,24.8273438 23.6571429,21.5789062 21.6256286,19.5680547 Z"\n                id="Shape" fill="#D7ECF6"></path>\n              <path d="M21.6256286,26.8381953 C19.62,28.875 16.38,28.875 14.3743714,26.8381953 C12.3428571,24.8273438 12.3428571,21.5789062 14.3743714,19.5680547 L21.6256286,26.8381953 Z"\n                id="Shape" fill="#C1DBE8"></path>\n            </g>\n          </g>\n        </g>\n      </g>\n    </svg>\n  </p>\n  <p class="nodata-desc">\n    未找到数据\n    <!--{en}No data was found-->\n  </p>\n  <p class="nodata-desc-sub">请尝试调整时间段<!--{en}Please try to adjust the time period or filter condition--></p>\n</div>'},useData:!0}),toolbar:Handlebars.template({1:function(){return"disabled"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,a,n,s){var e,i,l=a.helperMissing,o="function",r=this.escapeExpression;return'<div class="clustering-chart-toolbar" data-id="'+r((i=null!=(i=a.id||(null!=t?t.id:t))?i:l,typeof i===o?i.call(t,{name:"id",hash:{},data:s}):i))+'" data-key='+r((i=null!=(i=a.base_timestamp||(null!=t?t.base_timestamp:t))?i:l,typeof i===o?i.call(t,{name:"base_timestamp",hash:{},data:s}):i))+'>\n  <span class="icon-remove" data-method="close"></span>\n  <div class="tooltip-text">\n    <div>\n      <span>用户数</span>\n      <span class="cluster-usercount '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+'">'+r((i=null!=(i=a.count||(null!=t?t.count:t))?i:l,typeof i===o?i.call(t,{name:"count",hash:{},data:s}):i))+'</span>\n      <span class="cluster-nodata '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+'">-</span>\n    </div>\n    <div>\n      <span>计算基准时间</span>\n      <span class="cluster-basetime '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+'">'+r((i=null!=(i=a.base_time||(null!=t?t.base_time:t))?i:l,typeof i===o?i.call(t,{name:"base_time",hash:{},data:s}):i))+'</span>\n      <span class="cluster-nodata '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+'">-</span>\n    </div>\n    <div>\n      <span>最后计算时间</span>\n      <span class="cluster-completetime '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+'">'+r((i=null!=(i=a.finished_time||(null!=t?t.finished_time:t))?i:l,typeof i===o?i.call(t,{name:"finished_time",hash:{},data:s}):i))+'</span>\n      <span class="cluster-nodata '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+'">-</span>\n    </div>\n  </div>\n  <button class="button tooltip-button '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+'" '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+' type="button" data-method="query" data-id='+r((i=null!=(i=a.id||(null!=t?t.id:t))?i:l,typeof i===o?i.call(t,{name:"id",hash:{},data:s}):i))+" data-key="+r((i=null!=(i=a.base_timestamp||(null!=t?t.base_timestamp:t))?i:l,typeof i===o?i.call(t,{name:"base_timestamp",hash:{},data:s}):i))+'>\n    <span class="icon-user-analysis"></span>查看用户列表<!--{en}View Users--></button>\n  <button class="button tooltip-button '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+'" '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+' type="button" data-method="download" data-id='+r((i=null!=(i=a.id||(null!=t?t.id:t))?i:l,typeof i===o?i.call(t,{name:"id",hash:{},data:s}):i))+" data-key="+r((i=null!=(i=a.base_timestamp||(null!=t?t.base_timestamp:t))?i:l,typeof i===o?i.call(t,{name:"base_timestamp",hash:{},data:s}):i))+'>\n    <span class="icon-download"></span>下载用户列表</button>\n  <button class="button tooltip-button '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+'" '+r((i=null!=(i=a.status||(null!=t?t.status:t))?i:l,typeof i===o?i.call(t,{name:"status",hash:{},data:s}):i))+"  "+(null!=(e=a["if"].call(t,null!=t?t.notallowed:t,{name:"if",hash:{},fn:this.program(1,s,0),inverse:this.noop,data:s}))?e:"")+' type="button" data-method="update" data-id='+r((i=null!=(i=a.id||(null!=t?t.id:t))?i:l,typeof i===o?i.call(t,{name:"id",hash:{},data:s}):i))+" data-key="+r((i=null!=(i=a.base_timestamp||(null!=t?t.base_timestamp:t))?i:l,typeof i===o?i.call(t,{name:"base_timestamp",hash:{},data:s}):i))+'>\n    <span class="icon-refresh"></span>更新分群</button>\n  <div class="arrow"></div>\n</div>'},useData:!0})},e={NOTALLOWED:"notallowed",DISABLED:"disabled",ALY_NOTSELF:"analyst-notself",TIME_FORMAT:"YYYY-MM-DD HH:mm:ss"},i=function(t){this.init(t)};i.prototype=$.extend(!0,{},sensorsdata.EventsModule),i.prototype.init=function(t){var a=this;this.chartOptions=t,this.authority=t.authority;var i=t.partitionData,l=t.clusterData;if(this.chartOptions.container.find('[data-placeholder="chart"]').replaceWith(s.content()),"column"!==this.chartOptions.type)throw new Error("暂不支持"+this.chartOptions.type+"图表类型");this.$container=this.chartOptions.container.find(".chart-container"),this.chartInstance=n.column.create(this.$container,this.chartOptions),this.chart=this.chartInstance.chart,i.result.reverse(),this.chartOptions.data&&(this.chartOptions.data.tooltip.formatter=function(t){var n=i.result,o=t.dataIndex,r="normal",h=!1;"computing"===n[o].status&&(r=e.DISABLED),a.authority===e.ALY_NOTSELF&&(r=e.NOTALLOWED,h=!0);var d=s.toolbar({id:l.id,count:sensorsdata.formatNumber(n[o].count),base_time:n[o].base_time,base_timestamp:moment(n[o].base_time).format(),finished_time:n[o].finished_time,status:r,notallowed:h});return d},this.chart.setOption(this.chartOptions.data,!0)),this.chart.on("click",function(t){t.event.event.stopPropagation()}),this.chart.on("showTip",function(){a.trigger("showTip")}),this.bindEvent()},i.prototype.refresh=function(t){this.chartOptions=t;var a=this.chartOptions.partitionData,n=this.chartOptions.clusterData;if(a.result.reverse(),"column"!==this.chartOptions.type)throw new Error("暂不支持"+this.chartOptions.type+"图表类型");this.chartOptions.data?(this.$container.removeClass("render-blank"),this.chart.setOption(this.chartOptions.data,!0)):this.renderBlank();var i=this;this.chartOptions.data&&(this.chartOptions.data.tooltip.formatter=function(t){var l=a.result,o=t.dataIndex,r=!1,h="";"computing"===l[o].status&&(h="disabled"),i.authority===e.ALY_NOTSELF&&(h=e.NOTALLOWED,r=!0);var d=s.toolbar({id:n.id,base_time:l[o].base_time.replace(/23:59:59/i,"24:00"),base_timestamp:moment(l[o].base_time).format(),count:sensorsdata.formatNumber(l[o].count),finished_time:l[o].finished_time,status:h,notallowed:r});return d},this.chart.setOption(this.chartOptions.data,!0))},i.prototype.renderBlank=function(){this.$container.addClass("render-blank"),this.$container.find(".nodata-container").length||this.$container.append(s.nodata())},i.prototype.bindEvent=function(){var t=this;this.$container.off("click.toolbar").on("click.toolbar","[data-method]",function(){var a={base_time:moment($(this).attr("data-key")).format(e.TIME_FORMAT)},n=$(this).attr("data-method");switch(n){case"close":t.$container.find(".clustering-chart-toolbar").hide();break;case"query":case"download":case"update":t.trigger(n,a)}t.$container.find(".clustering-chart-toolbar").hide()})},i.prototype.setToolbar_=function(t){if(t&&!$.isEmptyObject(t)){var a=this.$container.find(".clustering-chart-toolbar");for(var n in t)"running"===n&&(t.running?a.find('[data-method="'+n+'"]').addClass("tooltip-cluster-running").prop("disabled","disabled"):a.find('[data-method="'+n+'"]').removeClass("tooltip-cluster-running"))}},i.prototype.hideTip=function(){this.$container.find(".clustering-chart-toolbar").length>0&&(this.$container.find(".clustering-chart-toolbar").hide(),this.trigger("hideTip"))},i.prototype.resize=function(){this.chart.resize()},i.prototype.destroy=function(){this.chart&&$.isFunction(this.chartInstance.destroy)&&(this.chart.off("click"),this.chart.clear()),this.$container.off("click"),this.$container.empty()},a.create=function(t){return new i(t)}});
;/*!components/clusteringDetail/head/head.js*/
define("components/clusteringDetail/head/head",function(t,e){var n=function(t){this.options=t,this.options.container.find('[data-placeholder="header"]').replaceWith(a.head({cname:this.options.data.cname,create_time:this.options.data.create_time})),this.container=this.options.container.find(".head-container"),this.init()},a={head:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="clusteringDetailHead" class="clusteringDetailHead head-container">\n  <div class="tool-container">\n    <div class="report-date-picker-wrap pull-left">\n      <span class="icon-date-picker"></span>\n      <input id="inputDate" type="text" style="width: 100%;" class="form-control" readonly="readonly" data-placement="top" data-container="body"\n        title="" data-original-title="分群计算的基准时间范围" data-lang-title="<!--{en}The time range in which the event occurred-->">\n    </div>\n  </div>\n</div>'},useData:!0}),popover:{toolbar:Handlebars.template({1:function(){return'<div class="popover-group-delete">\n  <p style="width:160px;margin:0;">确认更新当前分群？\n    <!--{todo}-->\n  </p>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">将按最新条件立即重新计算分群\n    <!--{todo}-->\n  </p>\n</div>\n'},3:function(){return'\n<div class="popover-group-delete">\n  <p style="width:160px;margin:0;">确认暂停当前分群？\n    <!--{todo}-->\n  </p>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">分群将不再例行计算，可再次开启\n    <!--{todo}-->\n  </p>\n</div>\n'},5:function(){return'\n<div class="popover-group-delete">\n  <p style="width:160px;margin:0;">确认开启当前分群？\n    <!--{todo}-->\n  </p>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">分群将例行计算\n    <!--{todo}-->\n  </p>\n</div>\n'},7:function(){return'\n<div class="popover-group-delete">\n  <p style="width:160px;margin:0;">确认删除分群？\n    <!--{todo}-->\n  </p>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">本操作无法撤销\n    <!--{todo}-->\n  </p>\n</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var i;return(null!=(i=e["if"].call(t,null!=t?t.compute:t,{name:"if",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?i:"")+" "+(null!=(i=e["if"].call(t,null!=t?t.pause:t,{name:"if",hash:{},fn:this.program(3,a,0),inverse:this.noop,data:a}))?i:"")+(null!=(i=e["if"].call(t,null!=t?t.start:t,{name:"if",hash:{},fn:this.program(5,a,0),inverse:this.noop,data:a}))?i:"")+" "+(null!=(i=e["if"].call(t,null!=t?t["delete"]:t,{name:"if",hash:{},fn:this.program(7,a,0),inverse:this.noop,data:a}))?i:"")},useData:!0}),toolbarTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover popover-clustering-detail" role="tooltip">\n  <div class="arrow"></div>\n  <h3 class="popover-title"></h3>\n  <div class="popover-content"></div>\n  <div class="popover-content-footer clearfix">\n  </div>\n</div>'},useData:!0}),footer:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover-footer-right">\n  <button type="button" class="pop-is-cancel btn btn-link btn-small">取消<!--{en}Cancel--></button>\n  <button type="button" class="pop-is-success btn btn-primary btn-small">确定<!--{en}Confirm--></button>\n</div>'},useData:!0})}};n.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.initToolbar_(),this.initDate_(this.options)},initToolbar_:function(){var t=this;this.$inputDate=this.container.find("#inputDate"),this.$download=this.container.find("#head-download"),this.$refresh=this.container.find("#head-refresh"),this.$pause=this.container.find("#head-pause"),this.$inputSetting=this.container.find("#head-setting");var e=moment().format("YYYY-MM-DD"),n=moment(sensorsdata.cache.partitions[1]).format("YYYY-MM-DD"),a=n>e?e:n,i=n>e?e:n;this.paramObj_={rangeText:"",unit:"day",from_date:a,to_date:i},this.container.off("click.dropdown").on("click.dropdown",".dropdown-toggle",function(){t.removePopover()}).off("click.popover").on("click.popover","[data-action]",function(){var e=$(this).attr("data-action");switch(e){case"edit":t.initPopover(e),t.removePopover();break;case"delete":t.initPopover(e,t.container.find("#head-setting"));break;case"compute":case"pause":case"start":case"download":t.initPopover(e)}}),this.$download.tooltip(),this.$refresh.tooltip(),this.$pause.tooltip(),this.$inputSetting.saDropdown({changeText:!1}),0===this.options.data.type?this.setToolbar_({pause:"hide"}):(1===this.options.data.type||6===this.options.data.type)&&this.setToolbar_({pause:"show",running:this.options.data.scheduler.running})},setToolbar_:function(t){if(t&&!$.isEmptyObject(t))for(var e in t)if("pause"===e||"refresh"===e||"download"===e||"delete"===e){var n=this.container.find("#head-"+e),a=n.attr("data-source-title");if(n.length>0)switch(t[e]){case"hide":n.remove();break;case"disabled":n.addClass("disabled"),n.unbind("click.disabled").bind("click.disabled",function(t){return t.preventDefault(),!1}),n.attr("data-original-title","计算中无法"+a);break;case"notallowed":n.addClass("disabled"),n.unbind("click.disabled").bind("click.disabled",function(t){return t.preventDefault(),!1}),n.attr("data-original-title","无"+a+"权限");break;case"show":n.prop("disabled",!1).removeClass("disabled").unbind("click.disabled").show().blur()}}else"running"===e&&(t.running&&this.$pause.length>0?(this.$pause.children("span").attr("class","icon-pause"),this.$pause.attr({"data-action":"pause","data-original-title":"暂停分群","data-source-title":"暂停分群"})):(this.$pause.children("span").attr("class","icon-play"),this.$pause.attr({"data-action":"start","data-original-title":"开启分群","data-source-title":"开启分群"})))},initDate_:function(t){var e=this,n="YYYY-MM-DD HH:mm:ss",a=this.paramObj_,i=t||{};i.startDate=moment(a.from_date,n),i.endDate=moment(a.to_date,n),i.chosenLabel=a.rangeText||"",i.rangeLimit=sensorsdata.CONSTSET.dateRangeLimit[a.unit],i.allowRelative=!0,sensorsdata.initDateRangeInput(this.$inputDate,i),this.$inputDate.tooltip().unbind("apply.daterangepicker").bind("apply.daterangepicker",function(){e.trigger("change.dateinput",e.getParams())})},initPopover:function(t,e){if(this.type=t,this.$ele_popover=e||this.container.find("[data-action="+this.type+"]"),!(this.$ele_popover&&this.$ele_popover.length>0&&(this.$ele_popover.prop("disabled")||this.$ele_popover.hasClass("disabled")))){if("edit"===this.type||"download"===this.type)return this.trigger(this.type),void this.container.find('[data-action="download"]').blur();var n={};n[this.type]=!0;var i=this;sensorsdata.popover({ele:i.$ele_popover,showNow:!0,placement:"bottom",template:a.popover.toolbarTpl(),content:a.popover.toolbar(n),footer:a.popover.footer(),container:this.container,successAfter:function(){i.trigger(i.type)}}),this.$ele_popover.data("bs.popover")&&this.$ele_popover.on("hidden.bs.popover",function(){$(this).popover("destroy")})}},setPopover:function(t){if(this.options.data.scheduler){var e=this,n=t.running?"pause":"start",i={};i[n]=!0,this.container.find("#head-pause").popover("destroy"),sensorsdata.popover({ele:this.container.find("#head-pause"),showNow:!0,placement:"bottom",template:a.popover.toolbarTpl(),content:a.popover.toolbar(i),footer:a.popover.footer(),container:this.container,successAfter:function(){e.trigger(n)}})}},removePopover:function(){this.container.find(".popover-clustering-detail").remove()},refresh:function(t){t&&($.extend(!0,this.options.data,t),0===this.options.data.type?this.setToolbar_({pause:"hide"}):(1===this.options.data.type||6===this.options.data.type||7===this.options.data.type)&&this.setToolbar_({pause:"show",running:this.options.data.scheduler.running}),this.setToolbar_("computing"===t.last_partition.status?{download:"disabled",refresh:"disabled",pause:"disabled"}:{refresh:"show",pause:"show"}),this.options.data.cname&&this.container.find(".clustering-title").text(this.options.data.cname),this.options.data.create_time&&this.container.find(".clustering-title-sub").text("创建时间："+this.options.data.create_time))},setParams:function(t){if(!$.isEmptyObject(t)&&(t.hasOwnProperty("from_date")||t.hasOwnProperty("to_date")||t.hasOwnProperty("rangeText"))){for(var e in t)if(!t[e])try{delete t[e]}catch(n){t[e]=void 0}$.extend(!0,this.paramObj_,t),this.initDate_(this.paramObj_)}},getParams:function(t){if(!this.$inputDate.data("startDate"))return{};var e=this.$inputDate.data("daterangepicker").chosenLabel||"",n={from_date:this.$inputDate.data("startDate").format(t||"YYYY-MM-DD HH:mm:ss"),to_date:this.$inputDate.data("endDate").format(t||"YYYY-MM-DD HH:mm:ss"),rangeText:e},a=moment(n.to_date).format("YYYY-MM-DD")===moment().format("YYYY-MM-DD");return("今日"===e||a)&&(n.to_date=moment().format("YYYY-MM-DD HH:mm:ss")),n},destroy:function(){this.$ele_popover&&this.$ele_popover.data("bs.popover")&&this.$ele_popover.on("hidden.bs.popover",function(){$(this).popover("destroy")}),this.container.off("click"),this.container.find("button").unbind("click"),this.$inputDate.tooltip().unbind("apply.daterangepicker"),this.$inputDate.tooltip("destroy");var t=this.$inputDate.data("daterangepicker");t&&$.isFunction(t.remove)&&t.remove(),this.container.empty()}}),e.create=function(t){return new n(t)}});
;/*!components/clusteringDetail/headline/headline.js*/
define("components/clusteringDetail/headline/headline",function(t,e){var n=function(t){this.options=t,this.options.container.find('[data-placeholder="headline"]').replaceWith(a.head({cname:this.options.data.cname,create_time:this.options.data.create_time})),this.container=this.options.container.find("#clustering-headline"),this.init()},a={head:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var o,i=e.helperMissing,s="function",r=this.escapeExpression;return'<div id="clustering-headline" class="headline head-container">\n\n  <div class="clustering-title-container">\n    <span class="clustering-title-logo icon-clustering">\n      <img src=\'../../../res/img/icon/clustering.svg\'>\n    </span>\n    <span class="clustering-title" contenteditable="false">\n      '+r((o=null!=(o=e.cname||(null!=t?t.cname:t))?o:i,typeof o===s?o.call(t,{name:"cname",hash:{},data:a}):o))+'\n      <!--{todo}-->\n    </span>\n    <span class="clustering-title-sub">\n      创建时间：\n      <!--{todo}-->\n      '+r((o=null!=(o=e.create_time||(null!=t?t.create_time:t))?o:i,typeof o===s?o.call(t,{name:"create_time",hash:{},data:a}):o))+'\n    </span>\n  </div>\n  <div class="tool-container">\n    <div class="report-config btn-group selector">\n      <button class="btn-config" id="head-edit" data-action="edit" data-container="body" data-toggle="tooltip"\n        data-original-title="编辑分群" data-source-title="编辑分群" data-placement="top">\n        <span class="icon-edit2"></span>\n        <span class="btn-text">编辑</span>\n      </button>\n      <button class="btn-config" id="head-refresh" data-action="compute" data-container="body" data-toggle="tooltip"\n        data-original-title="更新分群" data-source-title="更新最近一次分群" data-placement="top">\n        <span class="icon-refresh"></span>\n        <span class="btn-text">更新</span>\n      </button>\n      <span class="sub-split"></span>\n      <button class="btn-right dropdown-toggle" id="head-setting" type="button" data-toggle="dropdown" aria-expanded="false">\n        <span class="icon-more"></span>\n      </button>\n      <ul class="dropdown-menu" role="menu">\n        <li>\n          <a data-action="pause" id="head-pause" data-container="body" data-toggle="tooltip" data-original-title="开启分群"\n            data-source-title="开启分群" data-placement="top">\n            <span class="icon-play"></span><span class="dropdown-menu-text">开启</span>\n            <!--{en}Start--></a>\n        </li>\n        <li>\n          <a data-action="download" id="head-download" data-container="body" data-toggle="tooltip" data-original-title="下载分群人数"\n            data-source-title="下载分群人数" data-placement="top">\n            <span class="icon-download"></span><span class="dropdown-menu-text">下载</span>\n            <!--{en}Download--></a>\n        </li>\n        <li>\n          <a data-action="delete" id="head-delete" data-container="body" data-toggle="tooltip" data-original-title="删除分群"\n            data-source-title="删除分群" data-placement="top">\n            <span class="icon-delete"></span><span class="dropdown-menu-text">删除</span>\n            <!--{en}Delete--></a>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>'},useData:!0}),popover:{toolbar:Handlebars.template({1:function(){return'<div class="popover-group-delete">\n  <p style="width:160px;margin:0;">确认更新分群？\n    <!--{todo}-->\n  </p>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">将按最新条件立即重新计算分群\n    <!--{todo}-->\n  </p>\n</div>\n'},3:function(){return'\n<div class="popover-group-delete">\n  <p style="width:160px;margin:0;">确认暂停当前分群？\n    <!--{todo}-->\n  </p>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">分群将不再例行计算，可再次开启\n    <!--{todo}-->\n  </p>\n</div>\n'},5:function(){return'\n<div class="popover-group-delete">\n  <p style="width:160px;margin:0;">确认开启当前分群？\n    <!--{todo}-->\n  </p>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">分群将例行计算\n    <!--{todo}-->\n  </p>\n</div>\n'},7:function(){return'\n<div class="popover-group-delete">\n  <p style="width:160px;margin:0;">确认删除分群？\n    <!--{todo}-->\n  </p>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">本操作无法撤销\n    <!--{todo}-->\n  </p>\n</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,a){var o;return(null!=(o=e["if"].call(t,null!=t?t.compute:t,{name:"if",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a}))?o:"")+" "+(null!=(o=e["if"].call(t,null!=t?t.pause:t,{name:"if",hash:{},fn:this.program(3,a,0),inverse:this.noop,data:a}))?o:"")+(null!=(o=e["if"].call(t,null!=t?t.start:t,{name:"if",hash:{},fn:this.program(5,a,0),inverse:this.noop,data:a}))?o:"")+" "+(null!=(o=e["if"].call(t,null!=t?t["delete"]:t,{name:"if",hash:{},fn:this.program(7,a,0),inverse:this.noop,data:a}))?o:"")},useData:!0}),toolbarTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover popover-clustering-detail" role="tooltip">\n  <div class="arrow"></div>\n  <h3 class="popover-title"></h3>\n  <div class="popover-content"></div>\n  <div class="popover-content-footer clearfix">\n  </div>\n</div>'},useData:!0}),footer:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover-footer-right">\n  <button type="button" class="pop-is-cancel btn btn-link btn-small">取消<!--{en}Cancel--></button>\n  <button type="button" class="pop-is-success btn btn-primary btn-small">确定<!--{en}Confirm--></button>\n</div>'},useData:!0})}};n.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.initToolbar_()},initToolbar_:function(){var t=this;this.$edit=this.container.find("#head-edit"),this.$refresh=this.container.find("#head-refresh"),this.$pause=this.container.find("#head-pause"),this.$download=this.container.find("#head-download"),this.$delete=this.container.find("#head-delete"),this.$inputSetting=this.container.find("#head-setting"),this.container.off("click.dropdown").on("click.dropdown",".dropdown-toggle",function(){t.removePopover()}).off("click.popover").on("click.popover","[data-action]",function(){var e=$(this).attr("data-action");switch(e){case"edit":t.initPopover(e),t.removePopover();break;case"delete":t.initPopover(e,t.container.find("#head-setting"));break;case"compute":case"pause":case"start":case"download":t.initPopover(e)}}),this.$edit.tooltip(),this.$refresh.tooltip(),this.$pause.tooltip(),this.$download.tooltip(),this.$delete.tooltip(),this.$inputSetting.saDropdown({changeText:!1}),0===this.options.data.type?this.setToolbar_({pause:"hide"}):(1===this.options.data.type||6===this.options.data.type)&&this.setToolbar_({pause:"show",running:this.options.data.scheduler.running})},setToolbar_:function(t){if(t&&!$.isEmptyObject(t))for(var e in t)if("pause"===e||"refresh"===e||"download"===e||"delete"===e){var n=this.container.find("#head-"+e),a=n.attr("data-source-title");if(n.length>0)switch(t[e]){case"hide":"LI"===n.parent().prop("tagName")?n.parent().remove():n.remove();break;case"disabled":n.addClass("disabled"),n.unbind("click.disabled").bind("click.disabled",function(t){return t.preventDefault(),!1}),n.attr("data-original-title","计算中无法"+a);break;case"notallowed":n.addClass("disabled"),n.unbind("click.disabled").bind("click.disabled",function(t){return t.preventDefault(),!1}),n.attr("data-original-title","无"+a+"权限");break;case"show":n.prop("disabled",!1).removeClass("disabled").unbind("click.disabled").show().blur(),n.attr("data-original-title",a)}}else"running"===e&&(t.running&&this.$pause.length>0?(this.$pause.children('[class^="icon-"]').attr("class","icon-pause"),this.$pause.attr({"data-action":"pause","data-original-title":"暂停分群","data-source-title":"暂停分群"}),this.$pause.children(".dropdown-menu-text").text(sensorsdata.languages.get("暂停<!--{en}Pause-->"))):(this.$pause.children('[class^="icon-"]').attr("class","icon-play"),this.$pause.attr({"data-action":"start","data-original-title":"开启分群","data-source-title":"开启分群"}),this.$pause.children(".dropdown-menu-text").text(sensorsdata.languages.get("开启<!--{en}Start-->"))))},initPopover:function(t,e){if(this.type=t,this.$ele_popover=e||this.container.find("[data-action="+this.type+"]"),!(this.$ele_popover&&this.$ele_popover.length>0&&(this.$ele_popover.prop("disabled")||this.$ele_popover.hasClass("disabled")))){if("edit"===this.type||"download"===this.type)return this.trigger(this.type),void this.container.find('[data-action="download"]').blur();var n={};n[this.type]=!0;var o=this;sensorsdata.popover({ele:o.$ele_popover,showNow:!0,placement:"bottom",template:a.popover.toolbarTpl(),content:a.popover.toolbar(n),footer:a.popover.footer(),container:this.container,successAfter:function(){o.trigger(o.type)}}),this.$ele_popover.data("bs.popover")&&this.$ele_popover.on("hidden.bs.popover",function(){$(this).popover("destroy")})}},setPopover:function(t){if(this.options.data.scheduler){var e=this,n=t.running?"pause":"start",o={};o[n]=!0,this.container.find("#head-pause").popover("destroy"),sensorsdata.popover({ele:this.container.find("#head-pause"),showNow:!0,placement:"bottom",template:a.popover.toolbarTpl(),content:a.popover.toolbar(o),footer:a.popover.footer(),container:this.container,successAfter:function(){e.trigger(n)}})}},removePopover:function(){this.container.find(".popover-clustering-detail").remove()},refresh:function(t){t&&($.extend(!0,this.options.data,t),0===this.options.data.type?this.setToolbar_({pause:"hide"}):(1===this.options.data.type||6===this.options.data.type||7===this.options.data.type)&&this.setToolbar_({pause:"show",running:this.options.data.scheduler.running}),this.setToolbar_("computing"===t.last_partition.status?{download:"disabled",refresh:"disabled",pause:"disabled"}:{refresh:"show",pause:"show"}),this.options.data.cname&&this.container.find(".clustering-title").text(this.options.data.cname),this.options.data.create_time&&this.container.find(".clustering-title-sub").text("创建时间："+this.options.data.create_time))},destroy:function(){this.$ele_popover&&this.$ele_popover.data("bs.popover")&&this.$ele_popover.on("hidden.bs.popover",function(){$(this).popover("destroy")}),this.$edit.tooltip("destroy"),this.$refresh.tooltip("destroy"),this.$pause.tooltip("destroy"),this.$download.tooltip("destroy"),this.container.off("click"),this.container.find("button").unbind("click"),this.container.empty()}}),e.create=function(t){return new n(t)}});
;/*!components/clusteringDetail/number/number.js*/
define("components/clusteringDetail/number/number",function(t,n){var a=t("components/model/apppush"),s={content:Handlebars.template({1:function(t,n,a,s){var e,i,l=n.helperMissing,u="function",o=this.escapeExpression;return'    <div class="sub-split"></div>\n    <div class="sub-number-content">\n      <span class="sub-number-content-title">'+o((i=null!=(i=n.key||(null!=t?t.key:t))?i:l,typeof i===u?i.call(t,{name:"key",hash:{},data:s}):i))+"</span>\n"+(null!=(e=n["if"].call(t,null!=t?t.isTooltip:t,{name:"if",hash:{},fn:this.program(2,s,0),inverse:this.noop,data:s}))?e:"")+'      <span class="sub-number-content-info" data-value="'+o((i=null!=(i=n.name||(null!=t?t.name:t))?i:l,typeof i===u?i.call(t,{name:"name",hash:{},data:s}):i))+'">'+o((i=null!=(i=n.value||(null!=t?t.value:t))?i:l,typeof i===u?i.call(t,{name:"value",hash:{},data:s}):i))+"</span>\n    </div>\n"},2:function(){return""},compiler:[6,">= 2.0.0-beta.1"],main:function(t,n,a,s){var e,i,l=n.helperMissing,u="function",o=this.escapeExpression;return'<div class="number-container">\n  <div class="inner clearfix">\n    <div class="main-number-content">\n      <div class="number-content clearfix">\n        <span class="status-marker running"></span>\n        <span class="status">'+o((i=null!=(i=n.running||(null!=t?t.running:t))?i:l,typeof i===u?i.call(t,{name:"running",hash:{},data:s}):i))+'</span>\n        <span class="ftime finished-time '+o((i=null!=(i=n.status||(null!=t?t.status:t))?i:l,typeof i===u?i.call(t,{name:"status",hash:{},data:s}):i))+'" data-container="body" data-toggle="tooltip" data-original-title="最后计算时间" data-placement="top">'+o((i=null!=(i=n.finished_time||(null!=t?t.finished_time:t))?i:l,typeof i===u?i.call(t,{name:"finished_time",hash:{},data:s}):i))+'</span>\n        <span class="ftime cluster-nodata '+o((i=null!=(i=n.status||(null!=t?t.status:t))?i:l,typeof i===u?i.call(t,{name:"status",hash:{},data:s}):i))+'">-</span>\n        <span class="update-time">'+o((i=null!=(i=n.update_time||(null!=t?t.update_time:t))?i:l,typeof i===u?i.call(t,{name:"update_time",hash:{},data:s}):i))+'</span>\n        <span class="number count '+o((i=null!=(i=n.status||(null!=t?t.status:t))?i:l,typeof i===u?i.call(t,{name:"status",hash:{},data:s}):i))+'" data-originData="" title="">'+o((i=null!=(i=n.count||(null!=t?t.count:t))?i:l,typeof i===u?i.call(t,{name:"count",hash:{},data:s}):i))+'</span>\n        <span class="number cluster-nodata '+o((i=null!=(i=n.status||(null!=t?t.status:t))?i:l,typeof i===u?i.call(t,{name:"status",hash:{},data:s}):i))+'">-&nbsp;</span>\n        <span class="measuresUnit">人</span>\n      </div>\n    </div>\n'+(null!=(e=n.each.call(t,null!=t?t.clusterInfo:t,{name:"each",hash:{},fn:this.program(1,s,0),inverse:this.noop,data:s}))?e:"")+"  </div>\n</div>"},useData:!0})},e=function(t){this.init(t)};e.prototype.init=function(t){this.options=t,this.numberData=t.data,this.options.container.find('[data-placeholder="number"]').replaceWith(s.content({running:sensorsdata.languages.get(this.numberData.running?"已启用<!--{todo}-->":"暂停<!--{todo}-->"),count:sensorsdata.formatNumber(this.numberData.count),finished_time:this.numberData.finished_time,clusterInfo:this.numberData.info})),this.container=this.options.container.find(".number-container");var n=this.container.find(".number-content"),a=n.find(".finished-time"),e=this.container.find('[data-faq="update-type"]');this.numberData.running?n.find(".status-marker").removeClass("pause").addClass("running"):n.find(".status-marker").removeClass("running").addClass("pause"),a.tooltip(),e.tooltip({html:!0,container:e}),"computing"===this.numberData.status&&this.setContent({status:"disabled"})},e.prototype.refresh=function(t){this.numberData=t;var n=this.container.find(".number-content"),s=this.container.find(".sub-number-content");t&&t.last_partition&&(n.find(".status").text(sensorsdata.languages.get(t.scheduler.running?"已启用<!--{todo}-->":"暂停<!--{todo}-->")),t.scheduler.running?n.find(".status-marker").removeClass("pause").addClass("running"):n.find(".status-marker").removeClass("running").addClass("pause"),n.find(".finished-time").text(t.last_partition.finished_time),n.find(".count").text(sensorsdata.formatNumber(t.last_partition.count)),s.find('[data-value="next-execute-time"]').text(t.scheduler.running?t.next_execute_time||"-":"-"),s.find('[data-value="user-name"]').text(t.user_name),a.get(function(n){this.app_push_list_cname=[],n.map(function(n){-1!==t.last_partition.app_push_list.indexOf(n.id)&&this.app_push_list_cname.push(n.cname)}),t.last_partition.app_push_list=this.app_push_list_cname,s.find('[data-value="app-push-list"]').text($.isEmptyObject(t.last_partition.app_push_list)?"-":t.last_partition.app_push_list)}),this.setContent("computing"===t.last_partition.status?{status:"disabled"}:{status:"succeed"}))},e.prototype.setContent=function(t){t&&t.status&&("succeed"===t.status?(this.container.find(".count").removeClass("disabled"),this.container.find(".finished-time").removeClass("disabled"),this.container.find(".cluster-nodata").removeClass("disabled")):(this.container.find(".count").addClass("disabled"),this.container.find(".finished-time").addClass("disabled"),this.container.find(".cluster-nodata").addClass("disabled")))},e.prototype.destroy=function(){this.container.empty()},n.create=function(t){return new e(t)}});
;/*!components/clusteringDetail/preprocessor/preprocessor.js*/
define("components/clusteringDetail/preprocessor/preprocessor",function(t,e,i){i.exports={process:function(t,e){var i=t.type;if(this.partitionData=t.partitionData,"function"==typeof e)if("column"===i){var n=this.partitionData.result,r=$.extend(!0,[],n);r.reverse();var a=r?r.map(function(t){return sensorsdata.formatTime(t.base_time,"day")}):[],o=r?r.map(function(t){return t.count}):[],s=$.extend(!0,{},sensorsdata.echarts.option,{tooltip:{trigger:"item",axisPointer:{type:""},transitionDuration:0,triggerOn:"click",position:function(t,e,i,n,r){var a={top:20-n.height,left:n.x+(n.width-r.contentSize[0])/2},o=r.contentSize[0]>n.width?(r.contentSize[0]-n.width)/2:0;return o>=n.x?(a.left=5,delete a.right):o+n.x+n.width>r.viewSize[0]&&(a.right=5,delete a.left),a},enterable:!0,confine:!1,alwaysShowContent:!0,padding:0,borderWidth:0},xAxis:{type:"category",data:a,show:!0,triggerEvent:!0,axisLabel:{clickable:!0}},yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dot",width:"0.8"}},splitNumber:3},series:[{type:"bar",barGap:"10%",barMaxWidth:"40%",data:o}]});e(s)}else if("table"===i){var p=this.partitionData;e(p)}}}});
;/*!components/clusteringDetail/table/table.js*/
define("components/clusteringDetail/table/table",function(t,n){var a=t("components/basicTable/basicTable"),e={table:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<table class="display nowrap clustering-table" width="100%">\n  <thead>\n    <tr>\n      <th class="filer">\n        <span>基准时间<!--{todo}--></span>\n        <span class="icon_selector"></span>\n      </th>\n      <th class="filter">\n        <span>最后计算时间<!--{todo}--></span>\n        <span class="icon_selector"></span>\n      </th>\n      <th class="filter">\n        <span>分群人数<!--{todo}--></span>\n        <span class="icon_selector"></span>\n      </th>\n      <th>操作<!--{todo}--></th>\n    </tr>\n  </thead>\n  <tbody>\n  </tbody>\n</table>\n'},useData:!0}),action:Handlebars.template({1:function(){return'<span class="icon-refresh" data-method="refresh" data-container="body" data-toggle="tooltip" data-original-title="更新分群" data-placement="top"></span>\n<span class="icon-download" data-method="download" data-container="body" data-toggle="tooltip" data-original-title="下载用户列表" data-placement="top"></span>\n'},3:function(){return'\n<span class="icon-refresh disabled" data-method="refresh" data-container="body" data-toggle="tooltip" data-original-title="计算中无法更新分群" data-placement="top"></span>\n<span class="icon-download disabled" data-method="download" data-container="body" data-toggle="tooltip" data-original-title="计算中无法下载用户列表" data-placement="top"></span>\n'},5:function(){return'\n<span class="icon-refresh disabled" data-method="refresh" data-container="body" data-toggle="tooltip" data-original-title="无更新分群权限" data-placement="top"></span>\n<span class="icon-download" data-method="download" data-container="body" data-toggle="tooltip" data-original-title="下载用户列表" data-placement="top"></span>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,n,a,e){var o;return(null!=(o=n["if"].call(t,null!=t?t.normal:t,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?o:"")+(null!=(o=n["if"].call(t,null!=t?t.computing:t,{name:"if",hash:{},fn:this.program(3,e,0),inverse:this.noop,data:e}))?o:"")+(null!=(o=n["if"].call(t,null!=t?t.notallowed:t,{name:"if",hash:{},fn:this.program(5,e,0),inverse:this.noop,data:e}))?o:"")},useData:!0}),header:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<tr>\n  <th class="filer">\n    <span>计算基准时间<!--{todo}--></span>\n    <span class="icon_selector"></span>\n  </th>\n  <th class="filter">\n    <span>最后计算时间<!--{todo}--></span>\n    <span class="icon_selector"></span>\n  </th>\n  <th class="filter">\n    <span>分群人数<!--{todo}--></span>\n    <span class="icon_selector"></span>\n  </th>\n  <th>操作<!--{todo}--></th>\n</tr>'},useData:!0}),success_time:Handlebars.template({1:function(){return'<div class="success"></div>\n<span>成功<!--{en}Successed-->&nbsp;&nbsp;</span>\n'},3:function(){return'<div class="failed"></div>\n<span>失败<!--{todo}Failed-->&nbsp;&nbsp;</span>\n'},5:function(){return'<span class="icon-computing"></span>\n<span>计算中<!--{en}Computing-->&nbsp;&nbsp;</span>\n'},7:function(){return'<div class="new"></div>\n<span>待计算<!--{todo}-->&nbsp;&nbsp;</span>\n'},9:function(){return"其他<!--{en}Other-->&nbsp;&nbsp;\n"},11:function(){return"-&nbsp;&nbsp;\n"},13:function(t,n,a,e){var o;return this.escapeExpression((o=null!=(o=n.success_time||(null!=t?t.success_time:t))?o:n.helperMissing,"function"==typeof o?o.call(t,{name:"success_time",hash:{},data:e}):o))+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,n,a,e){var o;return(null!=(o=n["if"].call(t,null!=t?t.success:t,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?o:"")+(null!=(o=n["if"].call(t,null!=t?t.failed:t,{name:"if",hash:{},fn:this.program(3,e,0),inverse:this.noop,data:e}))?o:"")+(null!=(o=n["if"].call(t,null!=t?t.computing:t,{name:"if",hash:{},fn:this.program(5,e,0),inverse:this.noop,data:e}))?o:"")+(null!=(o=n["if"].call(t,null!=t?t["new"]:t,{name:"if",hash:{},fn:this.program(7,e,0),inverse:this.noop,data:e}))?o:"")+(null!=(o=n["if"].call(t,null!=t?t.other:t,{name:"if",hash:{},fn:this.program(9,e,0),inverse:this.noop,data:e}))?o:"")+(null!=(o=n["if"].call(t,null!=t?t.computing:t,{name:"if",hash:{},fn:this.program(11,e,0),inverse:this.program(13,e,0),data:e}))?o:"")},useData:!0}),no:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="nodata-container">\n  <p class="nodata">\n    <svg width="79px" height="79px" viewBox="0 0 79 79" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <!-- Generator: Sketch 51.1 (57501) - http://www.bohemiancoding.com/sketch -->\n      <desc>Created with Sketch.</desc>\n      <defs></defs>\n      <g id="其他" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="空页面" transform="translate(-797.000000, -283.000000)">\n          <g id="Group-20" transform="translate(797.000000, 283.000000)">\n            <g id="Group-13" fill="#F4F8FD">\n              <circle id="Oval-8" cx="39.5" cy="39.5" r="39.5"></circle>\n            </g>\n            <g id="job-search" transform="translate(23.000000, 18.000000)" fill-rule="nonzero">\n              <path d="M29.5714286,38.7578125 L1.28571429,38.7578125 C0.575657143,38.7578125 0,38.1806562 0,37.46875 L0,1.2890625 C0,0.57715625 0.575657143,0 1.28571429,0 L29.5714286,0 C30.2814857,0 30.8571429,0.57715625 30.8571429,1.2890625 L30.8571429,37.46875 C30.8571429,38.1806562 30.2814857,38.7578125 29.5714286,38.7578125 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M29.5714286,0 L15.4285714,0 L15.4285714,38.7578125 L29.5714286,38.7578125 C30.2814857,38.7578125 30.8571429,38.1806562 30.8571429,37.46875 L30.8571429,1.2890625 C30.8571429,0.57715625 30.2814857,0 29.5714286,0 Z"\n                id="Shape" fill="#2DCA93"></path>\n              <path d="M36,15.46875 L36,42.7109375 C36,43.4328984 35.4343714,44 34.7142857,44 L6.42857143,44 C5.70848571,44 5.14285714,43.4328984 5.14285714,42.7109375 L5.14285714,6.4453125 C5.14285714,5.72335156 5.70848571,5.15625 6.42857143,5.15625 L25.7142857,5.15625 L36,15.46875 Z"\n                id="Shape" fill="#D7ECF6"></path>\n              <path d="M36,15.46875 L36,42.7109375 C36,43.4328984 35.4343714,44 34.7142857,44 L20.5714286,44 L20.5714286,5.15625 L25.7142857,5.15625 L36,15.46875 Z"\n                id="Shape" fill="#C1DBE8"></path>\n              <path d="M36,12.6585078 L36,15.46875 L27,15.46875 C26.2799143,15.46875 25.7142857,14.9016484 25.7142857,14.1796875 L25.7142857,5.15625 L28.5172286,5.15625 C29.5457143,5.15625 30.4971429,5.56866406 31.2429429,6.290625 L34.8685714,9.92569531 C35.5886571,10.6734375 36,11.6273438 36,12.6585078 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M30.4713429,35.7069453 C29.9827714,36.2225703 29.1600857,36.2225703 28.6714286,35.7069453 L21.6256286,28.66875 C21.1370571,28.1789063 21.1370571,27.3539062 21.6256286,26.8381953 C22.1399143,26.3483516 22.9628571,26.3483516 23.4514286,26.8381953 L30.4713429,33.9024297 C30.9857143,34.3922734 30.9857143,35.2171016 30.4713429,35.7069453 Z"\n                id="Shape" fill="#84B6ED"></path>\n              <path d="M30.4713429,35.7069453 C29.9827714,36.2225703 29.1600857,36.2225703 28.6714286,35.7069453 L21.6256286,28.66875 C21.1370571,28.1789062 21.1370571,27.3539062 21.6256286,26.8381953 L30.4713429,35.7069453 Z"\n                id="Shape" fill="#559FF0"></path>\n              <path d="M23.4514286,17.7375 C20.4429429,14.7211797 15.5571429,14.7211797 12.5485714,17.7375 C9.54,20.7538203 9.54008571,25.6523437 12.5485714,28.66875 C15.5570571,31.6851562 20.4428571,31.6850703 23.4514286,28.66875 C26.46,25.6524297 26.4599143,20.7539062 23.4514286,17.7375 Z"\n                id="Shape" fill="#84B6ED"></path>\n              <path d="M23.4514286,28.66875 C20.4429429,31.6850703 15.5571429,31.6850703 12.5485714,28.66875 C9.54,25.6524297 9.54008571,20.7539062 12.5485714,17.7375 L23.4514286,28.66875 Z"\n                id="Shape" fill="#559FF0"></path>\n              <path d="M21.6256286,19.5680547 C19.62,17.53125 16.38,17.53125 14.3743714,19.5680547 C12.3428571,21.5789062 12.3428571,24.8273438 14.3743714,26.8381953 C16.38,28.875 19.62,28.875 21.6256286,26.8381953 C23.6571429,24.8273438 23.6571429,21.5789062 21.6256286,19.5680547 Z"\n                id="Shape" fill="#D7ECF6"></path>\n              <path d="M21.6256286,26.8381953 C19.62,28.875 16.38,28.875 14.3743714,26.8381953 C12.3428571,24.8273438 12.3428571,21.5789062 14.3743714,19.5680547 L21.6256286,26.8381953 Z"\n                id="Shape" fill="#C1DBE8"></path>\n            </g>\n          </g>\n        </g>\n      </g>\n    </svg>\n  </p>\n  <p class="nodata-desc">\n    未找到数据\n    <!--{en}No data was found-->\n  </p>\n  <p class="nodata-desc-sub">请尝试调整时间段<!--{en}Please try to adjust the time period or filter condition--></p>\n</div>'},useData:!0}),popover:{toolbar:Handlebars.template({1:function(){return'<div class="popover-group-delete">\n  <p style="width:160px;margin:0;">确认更新当前分群？\n    <!--{todo}-->\n  </p>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">将按最新条件立即重新计算分群\n    <!--{todo}-->\n  </p>\n</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,n,a,e){var o;return null!=(o=n["if"].call(t,null!=t?t.compute:t,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?o:""},useData:!0}),toolbarTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover popover-clustering-detail" role="tooltip">\n  <div class="arrow"></div>\n  <h3 class="popover-title"></h3>\n  <div class="popover-content"></div>\n  <div class="popover-content-footer clearfix">\n  </div>\n</div>'},useData:!0}),footer:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover-footer-right">\n  <button type="button" class="pop-is-cancel btn btn-link btn-small">取消<!--{en}Cancel--></button>\n  <button type="button" class="pop-is-success btn btn-primary btn-small">确定<!--{en}Confirm--></button>\n</div>'},useData:!0})}},o={ALY_NOTSELF:"analyst-notself",TABLE_DISPLAY:20},s=function(t){if(!t.container)throw new Error("无效的表格容器");if(!t.data||!$.isArray(t.data.result))throw new Error("无效的数据");this.options=t,this.originalData=[],t.container.find('[data-placeholder="table"]').replaceWith('<div class="table-container dataTables-wrapper"></div>'),this.$container=t.container.find(".table-container"),this.$tableInstance=null,this.data=t.data.result||[],this.authority=t.data.authority||"",this.customDrawCallback=t.customDrawCallback,this.init()};s.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.render(),this.bindEvents()},bindEvents:function(){var t=this;this.$container.delegate("[data-method]","click.method",function(){var n=$(this),a=n.attr("data-method"),o=n.parents("tr:first");switch(a){case"download":if(n.attr("class").split(" ").indexOf("disabled")>0)break;t.trigger(a,t.$tableInstance.instance.row(o).data());break;case"refresh":if(n.attr("class").split(" ").indexOf("disabled")>0)break;var s={compute:!0};sensorsdata.popover({ele:n,showNow:!0,placement:"top",template:e.popover.toolbarTpl(),content:e.popover.toolbar(s),footer:e.popover.footer(),container:this.container,beforeShow:function(){t.$container.find('[data-method="refresh"]').tooltip("hide"),t.$container.find('[data-method="download"]').tooltip("hide")},successAfter:function(){t.trigger(a,t.$tableInstance.instance.row(o).data())}});break;case"count":t.trigger(a,t.$tableInstance.instance.row(o).data())}})},dataTableGenerator:function(t){function n(t){return function(n,a){return n[t]-a[t]}}var a=$.extend([],t);a.sort(n("base_time"));var s=this,i={searching:!1,info:(a||[]).length>0,paging:!0,dom:"tip",iDisplayLength:o.TABLE_DISPLAY,order:[[0,"desc"]],scrollY:!1,language:{emptyTable:e.no(),thousands:",",zeroRecords:e.no()},columns:[{data:null,render:function(t){return t.base_time},sortable:!0},{data:null,render:function(t){var n=t.status,a=t.finished_time?t.finished_time:"-",o={success:"succeed"===n,failed:"failed"===n,"new":"new"===n,other:"succeed"!==n&&"failed"!==n&&"computing"!==n&&"new"!==n,computing:"computing"===n,success_time:a};return e.success_time(o)},sortable:!0},{data:null,render:function(t){return"computing"===t.status?'<span class="disabled" style="text-decoration:none;">-</span>':'<span class="" data-method="count">'+t.count.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+"</span>"},sortable:!0},{data:null,render:function(t){var n=t.status,a={computing:"computing"===n&&s.authority!==o.ALY_NOTSELF,notallowed:s.authority===o.ALY_NOTSELF,normal:!1};return"computing"!==n&&s.authority!==o.ALY_NOTSELF&&(a={computing:!1,notallowed:!1,normal:!0}),e.action(a)},sortable:!1}]};return i},render:function(){this.$tableInstance=a.create({container:this.$container,data:{body:$.extend(!0,[],this.data)},tpl:e,dataTableOption:this.dataTableGenerator($.extend(!0,[],this.data)),customDrawCallback:this.customDrawCallback||""}),this.$container.find('[data-method="refresh"]').tooltip(),this.$container.find('[data-method="download"]').tooltip()},update:function(t){if(!$.isEmptyObject(t)){var n=t.result||{};this.data=n;var a=this.$tableInstance.instance;this.$tableInstance.instance.clear(),a.rows.add(this.data),a.draw(!1),this.$container.find('[data-method="refresh"]').tooltip(),this.$container.find('[data-method="download"]').tooltip()}},getCurrentData:function(t){var n=this.$tableInstance.instance;if(this.$tableInstance&&n){for(var a=n.rows().data().length,e=[],o=0;a>o;o++)if(e[o]=$.extend(!0,{},n.rows().data()[o]),$.isArray(t)&&t.length>0)for(var s in e[o])t.indexOf(s)<0&&delete e[o][s];return e}return[]},destroy:function(){this.$tableInstance&&$.isFunction(this.$tableInstance.destroy)&&(this.$container.find('[data-method="refresh"]').tooltip("destroy"),this.$container.find('[data-method="download"]').tooltip("destroy"),this.$tableInstance.destroy()),this.$container.off("click")}}),n.create=function(t){return new s(t)}});
;/*!components/config/dashboard.size.js*/
define("components/config/dashboard.size",function(e,a){var l=["mini","normal","large"],r={utm:!0},s=function(e){var a=e.type,l=e.chartsType,r=e.queryParams.rollup_date||!0,s=r===!0||"true"===r?"rollup":"detail",n=[];switch(s="pie"===l?"rollup":s,a){case"segmentation":var m=e.queryParams.measures,i=e.queryParams.by_fields,o=1===m.length?"measure":"measures",d=$.isArray(i)&&i.length>0?"hasFields":"noFields",u={number:{rollup:{measure:{hasFields:[],noFields:["mini","small","normal","large"]},measures:{hasFields:[],noFields:[]}},detail:{measure:{hasFields:[],noFields:["mini","small","normal","large"]},measures:{hasFields:[],noFields:[]}}},line:{rollup:{measure:{hasFields:["normal","large"],noFields:["small","normal","large"]},measures:{hasFields:["normal","large"],noFields:["normal","large"]}},detail:{measure:{hasFields:["normal","large"],noFields:["mini","small","normal","large"]},measures:{hasFields:["normal","large"],noFields:["normal","large"]}}},column:{rollup:{measure:{hasFields:["normal","large"],noFields:["small","normal","large"]},measures:{hasFields:["normal","large"],noFields:["normal","large"]}},detail:{measure:{hasFields:["normal","large"],noFields:["small","normal","large"]},measures:{hasFields:["normal","large"],noFields:["normal","large"]}}},pie:{rollup:{measure:{hasFields:e.queryParams.compare_from_date&&e.queryParams.compare_to_date?["large"]:["normal","large"],noFields:[]},measures:{hasFields:[],noFields:[]}},detail:{measure:{hasFields:[],noFields:[]},measures:{hasFields:[],noFields:[]}}},stack:{rollup:{measure:{hasFields:["normal","large"],noFields:["small","normal","large"]},measures:{hasFields:[],noFields:[]}},detail:{measure:{hasFields:["normal","large"],noFields:["small","normal","large"]},measures:{hasFields:[],noFields:[]}}},table:{rollup:{measure:{hasFields:["normal","large"],noFields:["normal","large"]},measures:{hasFields:["normal","large"],noFields:["normal","large"]}},detail:{measure:{hasFields:["normal","large"],noFields:["normal","large"]},measures:{hasFields:["normal","large"],noFields:["normal","large"]}}}};n=u[l]&&u[l][s]&&u[l][s][o]&&u[l][s][o][d]?u[l][s][o][d]:[];break;case"funnel":n=["normal"];break;case"retention":n=["normal"];break;case"addiction":n=["normal"];break;case"user_analytics":n=["normal"];break;case"behaviorPath":break;case"interval":break;case"utm":n=["large"];break;default:throw new Error("暂不支持"+e.type+"模块")}return n};a.get=function(e){var a=s(e),n={mini:{name:"mini",cname:"小"},normal:{name:"normal",cname:"中"},large:{name:"large",cname:"大"}},m=[];return r[e.type]||l.map(function(e){var l=n[e];l.disabled=!0,$.inArray(e,a)>=0&&(l.disabled=!1),m.push(l)}),m},a.checkSize=function(e,a){var l=s(e);return $.inArray(a,l)>=0?!0:!1}});
;/*!components/model/eventsCategory.js*/
define("components/model/eventsCategory",function(e,t,r){var n={categorys:null,category:{},eventsUpdateTime:-1,check:function(){return sensorsdata.cache.eventsUpdateTime!==this.eventsUpdateTime?(this.categorys=null,this.category={},this.eventsUpdateTime=sensorsdata.cache.eventsUpdateTime,!1):!0}},s={get:function(e,t){var r=this.texts[e];return r?"sensorsdata.eventsCategoryModel: "+(t?t+" ":"")+r:""},texts:{1:"参数类型必须为 object",2:"参数中必须包含 current 属性，且必须为 number 类型",3:"参数中必须包含 title 属性",4:"参数中必须包含 groups 属性，值为 Array 类型且不能为空",5:"参数中必须包含 id 属性，且值必须为 number 类型",6:"参数 id 的值必须为 number 类型"}},a={categorys:{update:function(e){var t;return"object"!=typeof e?t=1:void 0===e.current&&(t=2),t?s.get(t,"updateAll"):void 0},setCurrent:function(e){return"number"!=typeof e?s.get(6,"setCurrent"):void 0}},category:{add:function(e,t){var r;return"object"!=typeof e?r=1:e.title?e.groups&&e.groups.length||(r=4):r=3,r?s.get(r,t||"add"):void 0},update:function(e){return e&&"number"==typeof e.id?this.add(e,"update"):s.get(5)},get:function(e){return"number"!=typeof e?s.get(5,"get"):void 0},del:function(e){return"number"!=typeof e?s.get(5,"del"):void 0}}},o={getEvents:function(){var e=$.extend(!0,[],sensorsdata.cache.events),t={};return e.forEach(function(e){t[e.id]=e}),t},fusion:function(e){var t=this.getEvents();return e.groups.forEach(function(e){e.events=e.events.filter(function(e){var r=t[e.id];return r?(e.meta=r,r.cname&&$.trim(r.cname)||(r.cname=r.name),!0):!1})}),e},filter:function(e){return{id:e.id,title:e.title,default_group_id:e.default_group_id,groups:e.groups.map(function(e){return{id:e.id,visible:e.visible,title:e.title,events:e.events.map(function(e){return{id:e.id,visible:e.visible}})}})}}},i=$.extend({},sensorsdata.EventsModule,{getAll:function(e,t){function r(){2===++o&&(s.current=void 0===a?s.default_classification_id:a,n.categorys=s,e($.extend(!0,{},n.categorys)))}if(n.check()&&!t&&n.categorys)return void e($.extend(!0,{},n.categorys));var s,a,o=0;sensorsdata.ajax({url:sensorsdata.api.get("eventsClassifications"),success:function(e){s=e,r()}}),sensorsdata.ajax({url:sensorsdata.api.get("eventsCurrentClassification"),success:function(e){a=e&&e.current,r()}})},get:function(e,t,r){var s=a.category.get(e);if(s)throw new Error(s);if(n.check()&&!r&&n.category[e]){var i=$.extend(!0,{},n.category[e]);return void t(o.fusion(i))}sensorsdata.ajax({url:sensorsdata.api.get("eventsClassification",{id:e}),success:function(r){n.category[e]=r,t(o.fusion($.extend(!0,{},r)))}})},getCurrent:function(e){var t=this;this.getAll(function(r){t.get(r.current,e)})},updateAll:function(e,t){var r=a.categorys.update(e);if(r)throw new Error(r);if(n.categorys&&n.categorys.current===e.current)return void("function"==typeof t&&t({status:-1}));var s=this;sensorsdata.ajax({type:"post",url:sensorsdata.api.get("eventsCurrentClassification"),data:JSON.stringify({current:e.current}),success:function(e){n.categorys=null,s.postProcessingCRUD("updateAll",!0),"function"==typeof t&&t(e)},error:function(e){"function"==typeof t&&t({error:e&&e.responseJSON&&e.responseJSON.error||sensorsdata.languages.get("操作失败<!--{en}Operation failed-->")})}})},add:function(e,t){var r=a.category.add(e);if(r)throw new Error(r);var s=o.filter($.extend(!0,{},e)),i=this;sensorsdata.ajax({type:"put",url:sensorsdata.api.get("eventsClassification"),data:JSON.stringify(s),success:function(e){n.categorys=null,i.postProcessingCRUD("add"),"function"==typeof t&&t(e)},error:function(e){"function"==typeof t&&t({error:e&&e.responseJSON&&e.responseJSON.error||sensorsdata.languages.get("操作失败<!--{en}Operation failed-->")})}})},del:function(e,t){var r=a.category.del(e);if(r)throw new Error(r);var s=this;sensorsdata.ajax({type:"delete",url:sensorsdata.api.get("eventsClassification",{id:e}),success:function(r){var a=n.categorys&&n.categorys.current===e;a&&s.setCurrent(n.categorys.default_classification_id),n.categorys=n.category[e]=null,s.postProcessingCRUD("del",a),"function"==typeof t&&t(r)},error:function(e){"function"==typeof t&&t({error:e&&e.responseJSON&&e.responseJSON.error||sensorsdata.languages.get("操作失败<!--{en}Operation failed-->")})}})},update:function(e,t){var r=a.category.update(e);if(r)throw new Error(r);var s=o.filter($.extend(!0,{},e)),i=this;sensorsdata.ajax({type:"post",url:sensorsdata.api.get("eventsClassification",{id:e.id}),data:JSON.stringify(s),success:function(r){var s=n.categorys&&n.categorys.current===e.id;n.categorys=n.category[e.id]=null,i.postProcessingCRUD("update",s),"function"==typeof t&&t(r)},error:function(e){"function"==typeof t&&t({error:e&&e.responseJSON&&e.responseJSON.error||sensorsdata.languages.get("操作失败<!--{en}Operation failed-->")})}})},setCurrent:function(e,t){var r=a.categorys.setCurrent(e);if(r)throw new Error(r);this.updateAll({current:e},t)},postProcessingCRUD:function(e,t){var r=this;("add"===e||"updateAll"===e||"del"===e||"update"===e)&&this.getAll(function(n){r.trigger("categorys.update",{action:e,data:n}),t&&r.get(n.current,function(t){r.trigger("update",{action:e,data:t})},!0)},!0)}});r.exports=i});
;/*!components/eventsCategoryManager/eventsCategoryManager.js*/
define("components/eventsCategoryManager/eventsCategoryManager",function(e,t,a){var n=e("components/model/eventsCategory"),i={managerPanel:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="eventsCategorysManager">\n  <div class="view-panel"></div>\n  <div class="edit-panel"></div>\n</div>'},useData:!0}),viewPanel:Handlebars.template({1:function(e,t,a,n){var i,s,l,o=t.helperMissing,r="function",d=t.blockHelperMissing,c="";return s=null!=(s=t.isAdmin||(null!=e?e.isAdmin:e))?s:o,l={name:"isAdmin",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.isAdmin||(i=d.call(e,i,l)),null!=i&&(c+=i),s=null!=(s=t.isAdmin||(null!=e?e.isAdmin:e))?s:o,l={name:"isAdmin",hash:{},fn:this.noop,inverse:this.program(4,n,0),data:n},i=typeof s===r?s.call(e,l):s,t.isAdmin||(i=d.call(e,i,l)),null!=i&&(c+=i),c},2:function(){return'  <div class="tips">管理员可编辑“默认”中的信息，保存后将同步所有账号</div>\n'},4:function(){return'  <div class="tips">“默认”中的信息由管理员共享，不可编辑</div>\n'},6:function(e,t,a,n){var i,s,l,o="";return s=null!=(s=t.items||(null!=e?e.items:e))?s:t.helperMissing,l={name:"items",hash:{},fn:this.program(7,n,0),inverse:this.noop,data:n},i="function"==typeof s?s.call(e,l):s,t.items||(i=t.blockHelperMissing.call(e,i,l)),null!=i&&(o+=i),o},7:function(e,t,a,n){var i,s,l,o=t.helperMissing,r="function",d=this.escapeExpression,c="        <li";return s=null!=(s=t.isCurrent||(null!=e?e.isCurrent:e))?s:o,l={name:"isCurrent",hash:{},fn:this.program(8,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.isCurrent||(i=t.blockHelperMissing.call(e,i,l)),null!=i&&(c+=i),c+' data-method="panel-select" data-id="'+d((s=null!=(s=t.id||(null!=e?e.id:e))?s:o,typeof s===r?s.call(e,{name:"id",hash:{},data:n}):s))+'">'+d((s=null!=(s=t.title||(null!=e?e.title:e))?s:o,typeof s===r?s.call(e,{name:"title",hash:{},data:n}):s))+"</li>\n"},8:function(){return' class="current"'},10:function(e){var t;return'<button class="btn btn-edit" data-method="edit" data-id="'+this.escapeExpression(this.lambda(null!=(t=null!=e?e.category:e)?t.id:t,e))+'">编辑</button>'},12:function(e,t,a,n){var i,s,l,o='  <div class="groups">\n';return s=null!=(s=t.groups||(null!=e?e.groups:e))?s:t.helperMissing,l={name:"groups",hash:{},fn:this.program(13,n,0),inverse:this.noop,data:n},i="function"==typeof s?s.call(e,l):s,t.groups||(i=t.blockHelperMissing.call(e,i,l)),null!=i&&(o+=i),o+"  </div>\n"},13:function(e,t,a,n){var i,s,l,o=t.helperMissing,r="function",d=t.blockHelperMissing,c='    <div class="group';return s=null!=(s=t.visible||(null!=e?e.visible:e))?s:o,l={name:"visible",hash:{},fn:this.noop,inverse:this.program(14,n,0),data:n},i=typeof s===r?s.call(e,l):s,t.visible||(i=d.call(e,i,l)),null!=i&&(c+=i),c+='">\n      <div class="group-hd">\n        <span class="action-onoff" data-method="group-onoff"><span class="icon-chart-collapse"></span><span class="icon-chart-expand"></span></span>\n        <h3>'+this.escapeExpression((s=null!=(s=t.title||(null!=e?e.title:e))?s:o,typeof s===r?s.call(e,{name:"title",hash:{},data:n}):s))+'</h3>\n      </div>\n      <div class="events">\n        <ul>\n',s=null!=(s=t.events||(null!=e?e.events:e))?s:o,l={name:"events",hash:{},fn:this.program(16,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.events||(i=d.call(e,i,l)),null!=i&&(c+=i),c+"        </ul>\n      </div>\n    </div>\n"},14:function(){return" visible-false"},16:function(e,t,a,n){var i,s,l,o="          <li";return s=null!=(s=t.visible||(null!=e?e.visible:e))?s:t.helperMissing,l={name:"visible",hash:{},fn:this.noop,inverse:this.program(17,n,0),data:n},i="function"==typeof s?s.call(e,l):s,t.visible||(i=t.blockHelperMissing.call(e,i,l)),null!=i&&(o+=i),o+">"+this.escapeExpression(this.lambda(null!=(i=null!=e?e.meta:e)?i.cname:i,e))+"</li>\n"},17:function(){return' class="visible-false"'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,a,n){var i,s,l,o=t.helperMissing,r="function",d=t.blockHelperMissing,c=this.lambda,u=this.escapeExpression,h="";return s=null!=(s=t.isDefaultCategory||(null!=e?e.isDefaultCategory:e))?s:o,l={name:"isDefaultCategory",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.isDefaultCategory||(i=d.call(e,i,l)),null!=i&&(h+=i),h+='<div class="panel-hd">\n  <div class="hgroup">\n    <h2 data-method="panel-select-onoff"><span class="title">'+u(c(null!=(i=null!=e?e.category:e)?i.title:i,e))+'</span><span class="caret"></span></h2>\n    <ul class="panel-select">\n',s=null!=(s=t.categorys||(null!=e?e.categorys:e))?s:o,l={name:"categorys",hash:{},fn:this.program(6,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.categorys||(i=d.call(e,i,l)),null!=i&&(h+=i),h+='    </ul>\n  </div>\n  <div class="buttons">\n    <button class="btn btn-create" data-method="create" data-id="'+u(c(null!=(i=null!=e?e.category:e)?i.id:i,e))+'">新建</button>',s=null!=(s=t.isEdit||(null!=e?e.isEdit:e))?s:o,l={name:"isEdit",hash:{},fn:this.program(10,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.isEdit||(i=d.call(e,i,l)),null!=i&&(h+=i),h+='\n  </div>\n</div>\n<div class="panel-bd">\n',s=null!=(s=t.category||(null!=e?e.category:e))?s:o,l={name:"category",hash:{},fn:this.program(12,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.category||(i=d.call(e,i,l)),null!=i&&(h+=i),h+'</div>\n<div class="panel-ft">\n  <button class="btn btn-link btn-cancel" data-method="cancel">取 消</button><button class="btn btn-primary" data-method="save" data-id="'+u(c(null!=(i=null!=e?e.category:e)?i.id:i,e))+'" data-title="'+u(c(null!=(i=null!=e?e.category:e)?i.title:i,e))+'">应 用</button>\n</div>'},useData:!0}),editPanel:Handlebars.template({1:function(){return'<div class="tips">保存后将同步所有账号</div>\n'},3:function(e,t,a,n){var i;return'  <h2 class="title">'+this.escapeExpression((i=null!=(i=t.title||(null!=e?e.title:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{name:"title",hash:{},data:n}):i))+"</h2>\n"},5:function(e,t,a,n){var i;return'  <h2><span contenteditable="true" class="title">'+this.escapeExpression((i=null!=(i=t.title||(null!=e?e.title:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{name:"title",hash:{},data:n}):i))+'</span><span class="icon-edit" data-method="edit-focus"></span></h2>\n'},7:function(e,t,a,n){var i,s,l,o=t.helperMissing,r="function",d=t.blockHelperMissing,c=this.escapeExpression,u='    <div class="group';return s=null!=(s=t.visible||(null!=e?e.visible:e))?s:o,l={name:"visible",hash:{},fn:this.noop,inverse:this.program(8,n,0),data:n},i=typeof s===r?s.call(e,l):s,t.visible||(i=d.call(e,i,l)),null!=i&&(u+=i),u+='" data-id="'+c((s=null!=(s=t.id||(null!=e?e.id:e))?s:o,typeof s===r?s.call(e,{name:"id",hash:{},data:n}):s))+'" data-visible="',s=null!=(s=t.visible||(null!=e?e.visible:e))?s:o,l={name:"visible",hash:{},fn:this.program(10,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.visible||(i=d.call(e,i,l)),null!=i&&(u+=i),s=null!=(s=t.visible||(null!=e?e.visible:e))?s:o,l={name:"visible",hash:{},fn:this.noop,inverse:this.program(12,n,0),data:n},i=typeof s===r?s.call(e,l):s,t.visible||(i=d.call(e,i,l)),null!=i&&(u+=i),u+='">\n      <div class="group-hd">\n        <span class="action-handle"><span class="icon-drag-top"></span></span>\n        <span class="action-onoff" data-method="group-onoff"><span class="icon-chart-collapse"></span><span class="icon-chart-expand"></span></span>\n',s=null!=(s=t.isDefaultGroup||(null!=e?e.isDefaultGroup:e))?s:o,l={name:"isDefaultGroup",hash:{},fn:this.program(14,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.isDefaultGroup||(i=d.call(e,i,l)),null!=i&&(u+=i),s=null!=(s=t.isDefaultGroup||(null!=e?e.isDefaultGroup:e))?s:o,l={name:"isDefaultGroup",hash:{},fn:this.noop,inverse:this.program(16,n,0),data:n},i=typeof s===r?s.call(e,l):s,t.isDefaultGroup||(i=d.call(e,i,l)),null!=i&&(u+=i),u+='        <span class="action-visible icon-visible" data-method="group-visible" data-id="'+c((s=null!=(s=t.id||(null!=e?e.id:e))?s:o,typeof s===r?s.call(e,{name:"id",hash:{},data:n}):s))+'"></span>\n        <span class="action-visible icon-hidden" data-method="group-visible" data-id="'+c((s=null!=(s=t.id||(null!=e?e.id:e))?s:o,typeof s===r?s.call(e,{name:"id",hash:{},data:n}):s))+'"></span>\n      </div>\n      <div class="events">\n        <ul>\n',s=null!=(s=t.events||(null!=e?e.events:e))?s:o,l={name:"events",hash:{},fn:this.program(18,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.events||(i=d.call(e,i,l)),null!=i&&(u+=i),u+"        </ul>\n      </div>\n    </div>\n"},8:function(){return" visible-false"},10:function(){return"true"},12:function(){return"false"},14:function(e,t,a,n){var i;return'        <h3 class="action-edit-title">'+this.escapeExpression((i=null!=(i=t.title||(null!=e?e.title:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{name:"title",hash:{},data:n}):i))+"</h3>\n"},16:function(e,t,a,n){var i,s=t.helperMissing,l="function",o=this.escapeExpression;return'        <h3 class="action-edit-title"><span contenteditable="true">'+o((i=null!=(i=t.title||(null!=e?e.title:e))?i:s,typeof i===l?i.call(e,{name:"title",hash:{},data:n}):i))+'</span><span class="icon-edit" data-method="edit-focus"></span></h3>\n        <span class="action-delete icon-remove" data-method="group-delete" data-id="'+o((i=null!=(i=t.id||(null!=e?e.id:e))?i:s,typeof i===l?i.call(e,{name:"id",hash:{},data:n}):i))+'"></span>\n        <span class="s-line"></span>\n'},18:function(e,t,a,n){var i,s,l,o=t.helperMissing,r="function",d=this.escapeExpression,c='          <li class="event ';return s=null!=(s=t.visible||(null!=e?e.visible:e))?s:o,l={name:"visible",hash:{},fn:this.noop,inverse:this.program(19,n,0),data:n},i=typeof s===r?s.call(e,l):s,t.visible||(i=t.blockHelperMissing.call(e,i,l)),null!=i&&(c+=i),c+'" data-id="'+d((s=null!=(s=t.id||(null!=e?e.id:e))?s:o,typeof s===r?s.call(e,{name:"id",hash:{},data:n}):s))+'">\n            <span class="event-handle icon-drag-left"></span>\n            '+d(this.lambda(null!=(i=null!=e?e.meta:e)?i.cname:i,e))+'\n            <span class="event-visible icon-visible" data-method="event-visible" data-id="'+d((s=null!=(s=t.id||(null!=e?e.id:e))?s:o,typeof s===r?s.call(e,{name:"id",hash:{},data:n}):s))+'"></span>\n            <span class="event-visible icon-hidden" data-method="event-visible" data-id="'+d((s=null!=(s=t.id||(null!=e?e.id:e))?s:o,typeof s===r?s.call(e,{name:"id",hash:{},data:n}):s))+'"></span>\n          </li>\n'},19:function(){return"visible-false"},21:function(e,t,a,n){var i,s,l,o="";return s=null!=(s=t.isCreate||(null!=e?e.isCreate:e))?s:t.helperMissing,l={name:"isCreate",hash:{},fn:this.noop,inverse:this.program(22,n,0),data:n},i="function"==typeof s?s.call(e,l):s,t.isCreate||(i=t.blockHelperMissing.call(e,i,l)),null!=i&&(o+=i),o},22:function(){return'  <button type="button" data-method="del" class="btn-delete btn btn-red">\n    <span class="glyphicon glyphicon-trash"></span><span>删除</span>\n  </button>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,a,n){var i,s,l,o=t.helperMissing,r="function",d=t.blockHelperMissing,c="";return s=null!=(s=t.isDefaultCategory||(null!=e?e.isDefaultCategory:e))?s:o,l={name:"isDefaultCategory",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.isDefaultCategory||(i=d.call(e,i,l)),null!=i&&(c+=i),c+='<div class="panel-hd">\n',s=null!=(s=t.isDefaultCategory||(null!=e?e.isDefaultCategory:e))?s:o,l={name:"isDefaultCategory",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.isDefaultCategory||(i=d.call(e,i,l)),null!=i&&(c+=i),s=null!=(s=t.isDefaultCategory||(null!=e?e.isDefaultCategory:e))?s:o,l={name:"isDefaultCategory",hash:{},fn:this.noop,inverse:this.program(5,n,0),data:n},i=typeof s===r?s.call(e,l):s,t.isDefaultCategory||(i=d.call(e,i,l)),null!=i&&(c+=i),c+='  <div class="buttons">\n    <button class="btn btn-add-sub" data-method="add-group">新建分组<span class="icon-new"></span></span></button>\n  </div>\n</div>\n<div class="panel-bd">\n  <div class="groups">\n',s=null!=(s=t.groups||(null!=e?e.groups:e))?s:o,l={name:"groups",hash:{},fn:this.program(7,n,0),inverse:this.noop,data:n},i=typeof s===r?s.call(e,l):s,t.groups||(i=d.call(e,i,l)),null!=i&&(c+=i),c+='  </div>\n</div>\n<div class="panel-ft">\n',s=null!=(s=t.isDefaultCategory||(null!=e?e.isDefaultCategory:e))?s:o,l={name:"isDefaultCategory",hash:{},fn:this.noop,inverse:this.program(21,n,0),data:n},i=typeof s===r?s.call(e,l):s,t.isDefaultCategory||(i=d.call(e,i,l)),null!=i&&(c+=i),c+'  <button class="btn btn-link btn-cancel" data-method="cancel">取 消</button><button class="btn btn-primary btn-sub btn-save" data-method="save">保存</button><button class="btn btn-primary" data-method="save-and-set">保存并应用</button>\n</div>'},useData:!0}),editPanelGroup:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,a,n){var i,s=t.helperMissing,l="function",o=this.escapeExpression;return'<div class="group" data-id="'+o((i=null!=(i=t.id||(null!=e?e.id:e))?i:s,typeof i===l?i.call(e,{name:"id",hash:{},data:n}):i))+'" data-visible="true">\n  <div class="group-hd">\n    <span class="action-handle"><span class="icon-drag-top"></span></span>\n    <span class="action-onoff" data-method="group-onoff"><span class="icon-chart-collapse"></span><span class="icon-chart-expand"></span></span>\n    <h3 class="action-edit-title"><span contenteditable="true">'+o((i=null!=(i=t.title||(null!=e?e.title:e))?i:s,typeof i===l?i.call(e,{name:"title",hash:{},data:n}):i))+'</span><span class="icon-edit" data-method="edit-focus"></span></h3>\n    <span class="action-delete icon-remove" data-method="group-delete" data-id="'+o((i=null!=(i=t.id||(null!=e?e.id:e))?i:s,typeof i===l?i.call(e,{name:"id",hash:{},data:n}):i))+'"></span>\n    <span class="s-line"></span>\n    <span class="action-visible icon-visible" data-method="group-visible" data-id="'+o((i=null!=(i=t.id||(null!=e?e.id:e))?i:s,typeof i===l?i.call(e,{name:"id",hash:{},data:n}):i))+'"></span>\n    <span class="action-visible icon-hidden" data-method="group-visible" data-id="'+o((i=null!=(i=t.id||(null!=e?e.id:e))?i:s,typeof i===l?i.call(e,{name:"id",hash:{},data:n}):i))+'"></span>\n  </div>\n  <div class="events">\n    <ul></ul>\n  </div>\n</div>'},useData:!0}),popoverDelete:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<span>确定删除吗？<!--{en}Are you sure to delete?--></span><br/>\n<span style="color:#B2B0BB;font-size:13px;">本操作无法撤销<!--{en}This operation cannot be revoked--></span>\n'},useData:!0}),popoverDeleteGroup:Handlebars.template({1:function(){return"display:none;"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,a,n){var i,s,l,o='<span style="display:block;width:170px;">确定删除吗？<!--{en}Are you sure to delete?--></span>\n<span class="popover-events-category-delete-tip" style="';return s=null!=(s=t.isChildren||(null!=e?e.isChildren:e))?s:t.helperMissing,l={name:"isChildren",hash:{},fn:this.noop,inverse:this.program(1,n,0),data:n},i="function"==typeof s?s.call(e,l):s,t.isChildren||(i=t.blockHelperMissing.call(e,i,l)),null!=i&&(o+=i),o+'color:#B2B0BB;font-size:13px;">所属事件将转移至默认分组<!--{en}The belonging events will be transferred to the default group--></span>\n'},useData:!0})},s=$.extend({},sensorsdata.EventsModule,{init:function(e){this.isinit||(this.isinit=!0,this.$container=e,this.switchCategory(),this.bindEvent())},switchCategory:function(e){var t=this;this.hidePanelSelect(),this.$container.html(""),this.isHidePanelSelect=!0,n.getAll(function(a){if(a&&a.classifications){var s=a.map={};a.classifications.forEach(function(e){s[e.id]=e}),t.dataCategorys=a,t.selected=s[e]?e:a.current,n.get(t.selected,function(e){t.selected===e.id&&(t.dataCategory=e,t.$container.html(i.viewPanel(t.buildTplData())))})}})},buildTplData:function(){var e=$.extend(!0,{},this.dataCategorys),t=$.extend(!0,{},this.dataCategory);return e.items=e.classifications,e.title=e.map[this.selected].title,e.classifications.forEach(function(e){e.id===t.id&&(e.isCurrent=!0)}),t.groups=t.groups.filter(function(e){return e.visible}),{categorys:e,category:t,isEdit:this.selected!==e.default_classification_id||sensorsdata.authority.isAdmin,isDefaultCategory:e.default_classification_id===t.id,isAdmin:sensorsdata.authority.isAdmin}},bindEvent:function(){var e=this;this.$container.delegate("[data-method]","click",function(t){t.preventDefault();var a=t.$target=$(this);e.handler(a.attr("data-method"),t)})},handler:function(e,t){var a=Number(t.$target.attr("data-id"));switch(e){case"edit":this.trigger("edit",a);break;case"create":this.trigger("create",a);break;case"cancel":this.trigger("cancel");break;case"save":this.handleSave(t);break;case"panel-select-onoff":this.togglePanelSelect();break;case"panel-select":a!==this.selected?this.switchCategory(a):this.togglePanelSelect();break;case"group-onoff":this.handleGroupOnOff(t)}},handleGroupOnOff:function(e){var t=e.$target.parents(".group");t.data("status")===!1?t.removeClass("off").data("status",!0):t.addClass("off").data("status",!1)},togglePanelSelect:function(){if(this.isHidePanelSelect){if(!this.handlePanelSelectHide){var e=this;this.handlePanelSelectHide=function(t){$(".panel-select li, h2[data-method=panel-select-onoff]").is(t.target)||e.hidePanelSelect()}}return this.$container.find(".panel-hd .panel-select").show(),this.$container.on("click",this.handlePanelSelectHide),void(this.isHidePanelSelect=!1)}this.hidePanelSelect()},hidePanelSelect:function(){this.isHidePanelSelect||(this.$container.find(".panel-hd .panel-select").hide(),this.$container.off("click",this.handlePanelSelectHide),this.isHidePanelSelect=!0)},handleSave:function(e){var t=this,a=Number(e.$target.attr("data-id")),i=e.$target.attr("data-title");n.setCurrent(a,function(e){e&&e.error||(sensorsdata.success.show(sensorsdata.languages.get("{{title}} 已应用<!--{en}{{title}} has been applied-->").replace("{{title}}",i)),t.trigger("save"))})}}),l=$.extend({},sensorsdata.EventsModule,{init:function(e){this.isinit||(this.isinit=!0,this.$container=e,this.bindEvent())},show:function(e,t){var a=this;this.clear(),this.current=e,n.getAll(function(i){a.dataCategorys=i,n.get(e,function(n){n.id===a.current&&(a.processData(n,t,e),a.render(n))})})},processData:function(e,t,a){var n=this.dataCategory={source:e,groupsIdMap:{},eventsIdMap:{}};e.groups.forEach(function(e){n.groupsIdMap[e.id]=e,e.events.forEach(function(e){n.eventsIdMap[e.id]=e})}),"add"===t&&(delete e.id,e.title=this.buildPanelTitle(a),e.isCreate=!0)},buildPanelTitle:function(e){var t=null,a=[],n=this.dataCategorys.classifications;if(this.dataCategorys.default_classification_id===e)t=sensorsdata.languages.get("我的<!--{en}My-->");else for(var i=0,s=n.length;s>i;i++)n[i].id===e&&(t=n[i].title.replace(/( \d+)$/,""));return n.forEach(function(e){a.push(e.title)}),this.createTitle(t,a)},render:function(e){var t=i.editPanel(this.buildTplData(e));this.$container.html(t),this.createSortable()},buildTplData:function(e){e.isDefaultCategory=this.dataCategorys.default_classification_id===e.id;for(var t=e.groups,a=0,n=t.length;n>a;a++)t[a].id===e.default_group_id&&(t[a].isDefaultGroup=!0);return e},createSortable:function(){var e=this.sortables={groups:[],groupsMap:{}},t=this.$container.find(".panel-bd .group"),a=[];t.each(function(e,t){a.push(t.getAttribute("data-id"))}),t.each(function(t,n){var i=$.extend(!0,[],a),s=n.getAttribute("data-id"),l=$(n);i.splice(i.indexOf(s),1),e.groups.push(e.groupsMap[s]=Sortable.create(l.find(".events ul")[0],{group:{name:s,put:i},animation:200,onStart:function(){l.addClass("dragging")},onEnd:function(){l.removeClass("dragging")}}))}),e.groupsList=Sortable.create(this.$container.find(".panel-bd .groups")[0],{draggable:".group",handle:".action-handle",animation:200})},destorySortable:function(){this.sortables&&(this.sortables.groups.forEach(function(e){e.destroy()}),this.sortables.groupsList.destroy(),this.sortables=null)},clear:function(){this.sortables&&(this.destorySortable(),this.$container.html(""))},bindEvent:function(){var e=this;this.$container.delegate("[data-method]","click",function(t){t.preventDefault();var a=t.$target=$(this);e.handler(a.attr("data-method"),t)}),this.$container.delegate("[contenteditable]","focus",function(){this.prevText=this.innerText}),this.$container.delegate("[contenteditable]","keydown",function(e){var t=Number(e.keyCode);return 13===t?(this.blur(),!1):27===t?(this.prevText&&(this.innerText=this.prevText),this.blur(),!1):void 0})},handler:function(e,t){var a=Number(t.$target.attr("data-id"));switch(e){case"cancel":this.trigger("cancel");break;case"save":this.save();break;case"save-and-set":this.save(!0);break;case"del":this.del(t);break;case"add-group":this.addGroup();break;case"group-visible":this.handleGroupVisible(t);break;case"group-delete":this.deleteGroup(a,t);break;case"event-visible":this.handleEventVisible(t);break;case"group-onoff":this.handleGroupOnOff(t);break;case"edit-focus":this.handleEditFocus(t)}},save:function(e){if(!this.saving){var t=this.buildUpdateData();if(this.validationSaveData(t)){this.saving=!0,this.$container.addClass("saving");var a=this;n[t.id?"update":"add"](t,function(i){if(a.$container.removeClass("saving"),a.saving=!1,i&&i.error)return void sensorsdata.success.error(i.error);var s=function(){var n=sensorsdata.languages.get(t.id?e?"{{title}} 已保存并应用":"{{title}} 已保存":e?"{{title}} 已新建并应用":"{{title}} 已新建");n=n.replace("{{title}}",t.title),sensorsdata.success.show(n),a.trigger("save",{id:t.id||i.id,close:e})};e?n.setCurrent(t.id||i.id,function(e){e&&e.error||s()}):s()})}}},buildUpdateData:function(){var e=this,t=$.extend(!0,{},this.dataCategory.source);t.title=$.trim(this.$container.find(".panel-hd .title").text());var a={},n={};this.$container.find(".panel-bd .group").each(function(e,t){var i=Number(t.getAttribute("data-id"));n[i]="false"===t.getAttribute("data-visible")?!1:!0,a[i]=$.trim($(t).find(".action-edit-title").text())});var i=this.sortables.groupsList.toArray(),s=t.groups=[],l=this.dataCategory.groupsIdMap;return i.forEach(function(t){var i=l[t]||{};i.title=a[t],i.visible=n[t];var o=e.dataCategory.eventsIdMap,r=e.sortables.groupsMap[t].toArray(),d=i.events=[];r.forEach(function(e){d.push(o[e])}),s.push(i)}),t},validationSaveData:function(e){for(var t=e.groups,a=this.dataCategorys,n=[{check:function(){return e.title},msg:sensorsdata.languages.get("标题不能为空<!--{en}The title can not be empty-->")},{check:function(){for(var t=e.title,n=a.classifications,i=0,s=n.length;s>i;i++)if(n[i].id!==e.id&&n[i].title===t)return!1;return!0},msg:sensorsdata.languages.get("标题已存在<!--{en}The title has already existed-->")},{check:function(){for(var e={},a=0,n=t.length;n>a;a++){if(e[t[a].title])return!1;e[t[a].title]=!0}return!0},msg:sensorsdata.languages.get("分组名称不能重复<!--{en}Group names cannot be repeated-->")},{check:function(){for(var e=0,a=t.length;a>e;e++)if(!t[e].title)return!1;return!0},msg:sensorsdata.languages.get("分组名称不能为空<!--{en}Group names cannot be empty-->")},{check:function(){for(var e=0,a=t.length;a>e;e++)if(t[e].visible)return!0;return!1},msg:sensorsdata.languages.get("不能隐藏所有分组<!--{en}Can not hide all the groups-->")},{check:function(){for(var e=0,a=t.length;a>e;e++)if(t[e].visible)for(var n=t[e].events,i=0,s=n.length;s>i;i++)if(n[i].visible)return!0;return!1},msg:sensorsdata.languages.get("不能隐藏所有事件<!--{en}Can not hide all the events-->")}],i=0,s=n.length;s>i;i++){var l=n[i];if(!l.check())return sensorsdata.error.show(l.msg),!1}return!0},del:function(e){var t=this,a=this.dataCategory.source.title;sensorsdata.popover({ele:e.$target,showNow:!0,footer:$("#tpl_popover_footer_state_3").html(),content:i.popoverDelete(),success:function(){n.del(t.current,function(e){e&&e.error||(sensorsdata.success.show(sensorsdata.languages.get("{{title}} 删除成功<!--{en}{{title}}delete successfully-->").replace("{{title}}",a)),t.trigger("del"))})}})},addGroup:function(){this.$container.find(".panel-bd .groups").append(i.editPanelGroup({id:"666666"+sensorsdata.guid(),title:this.createTitle(sensorsdata.languages.get("新建分组<!--{en}Create new group-->"),this.getGroupTitles())})),this.destorySortable(),this.createSortable(),this.trigger("addGroup")},deleteGroup:function(e,t){var a=this,n=this.$container.find(".panel-bd .group[data-id="+e+"] .events li").length>0;sensorsdata.popover({ele:t.$target,showNow:!0,footer:$("#tpl_popover_footer_state_3").html(),content:i.popoverDeleteGroup({isChildren:n}),onShow:function(){var t=a.$container.find(".panel-bd .group[data-id="+e+"] .events li").length>0?"show":"hide";$(this.container).find(".popover .popover-events-category-delete-tip")[t]()},success:function(){a.deleteGroupRun(e)}})},deleteGroupRun:function(e){var t=this.$container.find(".panel-bd .group[data-id={{id}}]".replace("{{id}}",e)),a=t.find(".events li");a&&a.length&&this.$container.find(".panel-bd .group[data-id={{id}}] .events ul".replace("{{id}}",this.dataCategory.source.default_group_id)).append(a),t.remove(),this.destorySortable(),this.createSortable()},handleGroupVisible:function(e){var t=e.$target.parents(".group");if("true"===t.attr("data-visible"))t.attr("data-visible",!1).addClass("visible-false");else{t.attr("data-visible",!0).removeClass("visible-false");var a=this.dataCategory.eventsIdMap;t.find(".events li").each(function(e,t){var n=$(t);a[Number(n.attr("data-id"))].visible=!0,n.removeClass("visible-false")})}},handleEventVisible:function(e){var t=this.dataCategory.eventsIdMap,a=e.$target.parents(".group"),n=Number(e.$target.attr("data-id"));"false"===a.attr("data-visible")&&(a.attr("data-visible",!0).removeClass("visible-false"),a.find(".events li").each(function(e,a){var n=$(a);t[Number(n.attr("data-id"))].visible=!1,n.addClass("visible-false")}));var i=t[n];i.visible=!i.visible,e.$target.parents("li.event")[i.visible?"removeClass":"addClass"]("visible-false")},handleGroupOnOff:function(e){var t=e.$target.parents(".group"),a=t.attr("data-status");"off"===a?t.removeClass("off").attr("data-status","on"):t.addClass("off").attr("data-status","off")},handleEditFocus:function(e){var t=e.$target.prev("[contenteditable]");if(t.length&&(t[0].focus(),t.scrollLeft(9999),window.getSelection)){var a=window.getSelection();a.selectAllChildren(t[0]),a.collapseToEnd()}},getGroupTitles:function(){var e=[];return this.$container.find(".panel-bd .groups .group h3 span[contenteditable]").each(function(t,a){e.push(a.innerHTML)}),e},createTitle:function(e,t){var a=new RegExp("^"+e+"( \\d+){0,1}$"),n=[];if(t.forEach(function(e){var t=e.match(a);t&&n.push(Number(t[1]||1))}),n.length){n.sort(function(e,t){return e>t});for(var i=null,s=0,l=n.length-1;l>s;s++)if(n[s]+1<n[s+1]){i=n[s]+1;break}return i||(i=n[n.length-1]+1),e+" "+i}return e}}),o=$.extend({},sensorsdata.EventsModule,{init:function(){this.isinit||(this.isinit=!0,this.slidePage=sensorsdata.createSlidePage({title:"设置",content:i.managerPanel(),isListenAction:!1}),this.$viewPanel=this.slidePage.$content.find(".view-panel"),this.$editPanel=this.slidePage.$content.find(".edit-panel"),this.initViewPanel(),this.initEditPanel())},initViewPanel:function(){var e=this;s.init(this.$viewPanel),s.on("save",function(){e.hide()}),s.on("cancel",function(){e.hide()}),s.on("create",function(t){e.showEditPanel(Number(t),"add")}),s.on("edit",function(t){e.showEditPanel(Number(t))})},initEditPanel:function(){var e=this;l.init(this.$editPanel),l.on("save",function(t){t.close?e.hide():e.showViewPanel(t.id)}),l.on("cancel",function(){e.showViewPanel()}),l.on("del",function(){e.showViewPanel(void 0,"del")}),l.on("addGroup",function(){e.slidePage.$content.scrollTop(e.$editPanel.height()).find(".group:last .icon-edit").click()})},showViewPanel:function(e,t){(void 0!==e||"del"===t)&&s.switchCategory(e),this.slidePage.setTitle(sensorsdata.languages.get("设置<!--{en}Set-->")),this.$editPanel.hide(),this.$viewPanel.show()},showEditPanel:function(e,t){l.show(e,t),this.slidePage.setTitle(sensorsdata.languages.get("add"===t?"新建<!--{en}Create-->":"编辑<!--{en}Edit-->")+'<span class="icon-help" style="position:relative;top:-2px;left:4px;" data-original-title="可对事件进行拖拽排序、分类和隐藏，该页面操作只影响事件下拉列表的展现形式，不影响元数据。下拉列表选择任意事件时，依然包含所属权限内的隐藏事件。" data-placement="bottom"></span>'),this.$viewPanel.hide(),this.$editPanel.show()},show:function(){this.isinit?s.switchCategory():this.init(),this.showViewPanel(),this.slidePage.show(),this.trigger("show")},hide:function(){this.slidePage.hide(),this.trigger("hide")}});a.exports=o});
;/*!components/coolEventDropdown/coolEventDropdown.js*/
define("components/coolEventDropdown/coolEventDropdown",function(e){function t(e,t){var n=this;this.$parent=e,this.processOptions(t),this.initModel(),this.handleButtonClick=function(){n.data?n.init():n.initWaiting=!0},this.$button=this.$parent.find(".btn-selector").click(this.handleButtonClick),this.initDefaultEvent()}function n(e,t){this.$parent=e,this.options=$.extend(!0,{},t),this.getData(sensorsdata.bind(this.receiveData,this))}var i=e("components/dataCache/dataCache"),a=e("components/model/eventsCategory"),s=e("components/eventsCategoryManager/eventsCategoryManager"),l={container:'<div class="cool-event-dropdown"></div>',select:'<select style="display:none"></select>',options:Handlebars.template({1:function(e,t,n,i){var a,s,l,o=t.helperMissing,r="function",c=this.escapeExpression,h='  <option value="'+c((s=null!=(s=t.name||(null!=e?e.name:e))?s:o,typeof s===r?s.call(e,{name:"name",hash:{},data:i}):s))+'"';return s=null!=(s=t.disabled||(null!=e?e.disabled:e))?s:o,l={name:"disabled",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i},a=typeof s===r?s.call(e,l):s,t.disabled||(a=t.blockHelperMissing.call(e,a,l)),null!=a&&(h+=a),h+' title="'+c((s=null!=(s=t.cname||(null!=e?e.cname:e))?s:o,typeof s===r?s.call(e,{name:"cname",hash:{},data:i}):s))+'">'+c((s=null!=(s=t.cname||(null!=e?e.cname:e))?s:o,typeof s===r?s.call(e,{name:"cname",hash:{},data:i}):s))+"</option>\n"},2:function(){return' disabled="disabled"'},4:function(e,t,n,i){var a,s,l,o=t.helperMissing,r="function",c='  <optgroup label="'+this.escapeExpression((s=null!=(s=t.title||(null!=e?e.title:e))?s:o,typeof s===r?s.call(e,{name:"title",hash:{},data:i}):s))+'">\n';return s=null!=(s=t.events||(null!=e?e.events:e))?s:o,l={name:"events",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i},a=typeof s===r?s.call(e,l):s,t.events||(a=t.blockHelperMissing.call(e,a,l)),null!=a&&(c+=a),c+"  </optgrop>\n"},5:function(e,t,n,i){var a,s,l,o=t.helperMissing,r="function",c=this.escapeExpression,h='      <option value="'+c((s=null!=(s=t.name||(null!=e?e.name:e))?s:o,typeof s===r?s.call(e,{name:"name",hash:{},data:i}):s))+'" data-pinyin="'+c((s=null!=(s=t.pinyin||(null!=e?e.pinyin:e))?s:o,typeof s===r?s.call(e,{name:"pinyin",hash:{},data:i}):s))+'" ';return s=null!=(s=t.disabled||(null!=e?e.disabled:e))?s:o,l={name:"disabled",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i},a=typeof s===r?s.call(e,l):s,t.disabled||(a=t.blockHelperMissing.call(e,a,l)),null!=a&&(h+=a),h+' title="'+c((s=null!=(s=t.cname||(null!=e?e.cname:e))?s:o,typeof s===r?s.call(e,{name:"cname",hash:{},data:i}):s))+'">'+c((s=null!=(s=t.cname||(null!=e?e.cname:e))?s:o,typeof s===r?s.call(e,{name:"cname",hash:{},data:i}):s))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,s,l,o=t.helperMissing,r="function",c=t.blockHelperMissing,h="";return s=null!=(s=t.everyEvent||(null!=e?e.everyEvent:e))?s:o,l={name:"everyEvent",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i},a=typeof s===r?s.call(e,l):s,t.everyEvent||(a=c.call(e,a,l)),null!=a&&(h+=a),s=null!=(s=t.groups||(null!=e?e.groups:e))?s:o,l={name:"groups",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i},a=typeof s===r?s.call(e,l):s,t.groups||(a=c.call(e,a,l)),null!=a&&(h+=a),h},useData:!0}),filterContainer:'<div class="cool-dropdown-filter"></div>',filterContent:Handlebars.template({1:function(e,t,n,i){var a,s,l,o=t.helperMissing,r="function",c=t.blockHelperMissing,h=this.escapeExpression,d="    <li";return s=null!=(s=t.selected||(null!=e?e.selected:e))?s:o,l={name:"selected",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i},a=typeof s===r?s.call(e,l):s,t.selected||(a=c.call(e,a,l)),null!=a&&(d+=a),d+=' data-method="filter.category" data-name="'+h((s=null!=(s=t.name||(null!=e?e.name:e))?s:o,typeof s===r?s.call(e,{name:"name",hash:{},data:i}):s))+'">\n      '+h((s=null!=(s=t.cname||(null!=e?e.cname:e))?s:o,typeof s===r?s.call(e,{name:"cname",hash:{},data:i}):s))+"\n",s=null!=(s=t.selected||(null!=e?e.selected:e))?s:o,l={name:"selected",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i},a=typeof s===r?s.call(e,l):s,t.selected||(a=c.call(e,a,l)),null!=a&&(d+=a),d+"    </li>\n"},2:function(){return' class="selected"'},4:function(){return'      <span class="icon-finish"></span>\n'},6:function(e,t,n,i){var a,s,l,o='  <ul class="filter-tag">\n';return s=null!=(s=t.tags||(null!=e?e.tags:e))?s:t.helperMissing,l={name:"tags",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i},a="function"==typeof s?s.call(e,l):s,t.tags||(a=t.blockHelperMissing.call(e,a,l)),null!=a&&(o+=a),o+"  </ul>\n"},7:function(e,t,n,i){var a,s,l,o=t.helperMissing,r="function",c=t.blockHelperMissing,h=this.escapeExpression,d="    <li";return s=null!=(s=t.selected||(null!=e?e.selected:e))?s:o,l={name:"selected",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i},a=typeof s===r?s.call(e,l):s,t.selected||(a=c.call(e,a,l)),null!=a&&(d+=a),d+=' data-method="filter.tag" data-id="'+h((s=null!=(s=t.id||(null!=e?e.id:e))?s:o,typeof s===r?s.call(e,{name:"id",hash:{},data:i}):s))+'">\n      <span class="tag-icon '+h((s=null!=(s=t.color||(null!=e?e.color:e))?s:o,typeof s===r?s.call(e,{name:"color",hash:{},data:i}):s))+'"></span>\n      '+h((s=null!=(s=t.name||(null!=e?e.name:e))?s:o,typeof s===r?s.call(e,{name:"name",hash:{},data:i}):s))+"\n",s=null!=(s=t.selected||(null!=e?e.selected:e))?s:o,l={name:"selected",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i},a=typeof s===r?s.call(e,l):s,t.selected||(a=c.call(e,a,l)),null!=a&&(d+=a),d+"    </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,s,l,o='<div class="filter-bd">\n  <ul class="filter-category">\n';return s=null!=(s=t.category||(null!=e?e.category:e))?s:t.helperMissing,l={name:"category",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i},a="function"==typeof s?s.call(e,l):s,t.category||(a=t.blockHelperMissing.call(e,a,l)),null!=a&&(o+=a),o+"  </ul>\n"+(null!=(a=t["if"].call(e,null!=(a=null!=e?e.tags:e)?a.length:a,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")+'  <a href="javascript:void(0)" class="link-reset" data-method="reset">重置筛选</a>\n</div>'},useData:!0}),searchContainer:'<div class="cool-dropdown-search"></div>',searchContent:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<li class="search">\n  <span class="icon-search"></span>\n  <input type="text" placeholder="搜索" data-lang-placeholder="<!--{en}Search-->">\n  <span class="action-filter-menu" data-method="filter-onoff">筛选<!--{en}filter--></span>\n  <span class="action-edit icon-setting" data-method="edit">\n    <span class="line"></span>\n  </span>\n</li>\n'},useData:!0})},o=e("components/util/util");t.prototype=$.extend({},sensorsdata.EventsModule,{processOptions:function(e){this.options=$.extend(!0,{eventName:"",nonSelectedText:sensorsdata.languages.get("请选择事件<!--{en}Please select events-->"),onChange:null,filterMenu:!0,enableFiltering:!0,filter:{template:'<li class="search"><span class="icon-search"></span><input type="text"><span class="action-filter-menu" data-method="filter-onoff">'+sensorsdata.languages.get("筛选<!--{en}filter-->")+'</span><span class="action-edit icon-setting" data-method="edit"><span class="line"></span></span></li>',enableFiltering:!0},filterBehavior:"all",multiselect:{templates:{button:'<button class="btn-selector multiselect" data-toggle="dropdown">              <span class="icon-event"></span><span class="multiselect-selected-text"></span>            </button>',ul:'<ul class="cool-event-menu"></ul>',li:'<li class="item"><a href="javascript:void(0);"><label></label></a></li>',liGroup:'<li class="multiselect-group"><label></label><span class="extar"></span></li>',filter:'<li class="search"><span class="icon-search"></span><input type="text"><span class="action-filter-menu" data-method="filter-onoff">'+sensorsdata.languages.get("筛选<!--{en}filter-->")+'</span><span class="action-edit icon-setting" data-method="edit"><span class="line"></span></span></li>'},maxHeight:500,onChange:sensorsdata.bind(this.multiselectOnChange,this),enableCaseInsensitiveFiltering:!1}},e),this.options.multiselect.nonSelectedText=this.options.nonSelectedText},initDefaultEvent:function(){var e=this.options.nonSelectedText,t=this.options.eventName&&sensorsdata.cache.eventsMap[this.options.eventName];t||(t="ALL"===sensorsdata.authority.eventPermission.type?sensorsdata.CONSTSET.everyEvent:sensorsdata.cache.events[0]),t&&(this.$parent.data("selected-event",t.name),this.currentEventName=t.name,e=t.cname),this.$button.find(".multiselect-selected-text").text(e)},multiselectOnChange:function(e){var t=this.currentEventName=$(e).val();this.$parent.data("selected-event",t),this.hide(),"function"==typeof this.options.onChange&&this.options.onChange(t)},initModel:function(){a.getCurrent(sensorsdata.bind(this.receiveCategoryData,this))},receiveCategoryData:function(e){var t=this;this.data=this.processCategoryData(e),this.initWaiting&&(this.initWaiting=!1,this.init()),this.handleModelUpdate=function(e){t.data=t.processCategoryData(e.data),t.trigger("data.update")},a.on("update",this.handleModelUpdate)},processCategoryData:function(e){var t={groups:$.extend(!0,[],e.groups).filter(function(e){if(e.visible){var t=[];return e.events.forEach(function(e){e.visible&&t.push(e.meta)}),e.events=t,!0}return!1})};return"ALL"===sensorsdata.authority.eventPermission.type&&(t.everyEvent=sensorsdata.CONSTSET.everyEvent),t},filter:function(e){var t=$.extend(!0,{},this.data);if(!e)return t;if(!e.category)return t.groups=null,t;if("all"!==e.category){var n="event"===e.category?!1:!0;t.groups=t.groups.filter(function(e){return e.events=e.events.filter(function(e){return e.virtual===n}),e.events.length})}if(e.tags.length){var i=e.tags;t.groups=t.groups.filter(function(e){return e.events=e.events.filter(function(e){var t=e.tag;if(t.length)for(var n=0,a=t.length;a>n;n++)if(i.indexOf(t[n])>-1)return!0;return!1}),e.events.length})}return t},init:function(){this.isinit||(this.isinit=!0,this.processDataByDisabled(),this.initContainer(),this.createMultiselect(),this.createFilterSearch(),this.options.filterMenu&&(this.createFilterDropdown(),this.bindFilterOnoff()),this.on("data.update",sensorsdata.bind(this.rebuildMultiselect,this)))},initContainer:function(){this.$button.remove(),this.$container=$(l.container).appendTo(this.$parent),this.$container.append($(l.searchContainer))},createFilterSearch:function(){var e=this.$parent.find("ul.cool-event-menu");e.prepend(l.searchContent()),this.$filter=e.find("li.search"),clearTimeout(this.searchTimeOut),this.$filter.on("click",function(e){e.stopPropagation()}).on("input keydown",o.bind(function(t){13===t.which&&t.preventDefault(),clearTimeout(this.searchTimeOut),this.searchTimeOut=this.asyncFunction(o.bind(function(){if(this.query!==t.target.value){this.query=t.target.value;var n,i;$.each($("li",e),$.proxy(function(e,t){var a=$(t);if(!(a.hasClass("multiselect-item-event-tag-title")||a.hasClass("multiselect-item-event-tag")||a.hasClass("event-tag-hidden")||a.hasClass("multiselect-item-event-tag-split"))){var s=$("input",t).length>0?$("input",t).val():"",l=$("label",t).text(),o=($("input",t).attr("data-pinyin")||"").split(" ").filter(function(e){return!!e}).join("").toLowerCase(),r="";if("text"===this.options.filterBehavior?r=l:"value"===this.options.filterBehavior?r=s:"pinyin"===this.options.filterBehavior?r=o:"all"===this.options.filterBehavior&&(r=l+"\n"+s+"\n"+o),s!==this.options.selectAllValue&&l){var c=!1;this.options.enableCaseInsensitiveFiltering&&r.toLowerCase().indexOf(this.query.toLowerCase())>-1?c=!0:r.indexOf(this.query)>-1&&(c=!0),$(t).toggle(c).toggleClass("filter-hidden",!c),$(t).hasClass("multiselect-group")?(n=t,i=c):(c&&$(n).show().removeClass("filter-hidden"),!c&&i&&$(t).show().removeClass("filter-hidden"))}}},this)),this.$select.data("multiselect")&&$.isFunction(this.$select.data("multiselect").updateSelectAll)&&this.$select.data("multiselect").updateSelectAll()}},this),500,this)},this))},asyncFunction:function(e,t,n){var i=Array.prototype.slice.call(arguments,3);return setTimeout(function(){e.apply(n||window,i)},t)},createMultiselect:function(){this.$select=$(l.select).html(this.buildOptionHTML()).appendTo(this.$container).multiselect(this.options.multiselect),this.currentEventName&&this.$select.multiselect("select",this.currentEventName);var e=this.$container.find("select").next("div");setTimeout(function(){e.addClass("open").find("button[data-toggle]").attr("aria-expanded",!0)},50),this.multiselectHotfix()},multiselectHotfix:function(){var e=this;this.$container.find(".cool-event-menu").on("click",function(t){var n=t.target;return n===this||"li"===n.nodeName.toLocaleLowerCase()&&($(n).hasClass("group")||$(n).hasClass("disabled"))||$(n).parents("li.group").length||$(n).parents("li.disabled").length?(e.filterDropdown&&e.filterDropdown.hide(),!1):void 0}).on("scroll",function(){e.filterDropdown&&e.filterDropdown.hide()})},hide:function(){this.$container.find("select").next("div").removeClass("open").find("button[data-toggle]").attr("aria-expanded",!1)},createFilterDropdown:function(){var e=this;this.filterDropdown=new n(this.$container.find("select").next("div"),{}),this.filterDropdown.on("inited",function(){e.$container.addClass("is-filter-menu"),e.filterDropdown.on("filter",function(t){e.rebuildMultiselect(e.filter(t))})}),this.filterDropdown.on("initFailed",function(){e.filterDropdown=null})},filterDropdownInited:function(){var e=this;this.$container.addClass("is-filter-menu"),this.filterDropdown.on("filter",function(t){e.rebuildMultiselect(e.filter(t))})},bindFilterOnoff:function(){var e=this,t=function(){setTimeout(function(){e.$container.find("button.btn-selector").click()},1),s.off("hide",t)};this.$container.find(".action-edit").on("click",function(){s.show(),s.on("hide",t)}),this.filterDropdown&&this.$container.find(".action-filter-menu").on("click",function(){e.filterDropdown.onoff()})},offBindFilterOnoff:function(){this.$container.find(".action-edit").off("click"),this.filterDropdown&&this.$container.find(".action-filter-menu").off("click")},buildOptionHTML:function(e){return l.options(e||this.data)},rebuildMultiselect:function(e){this.offBindFilterOnoff(),this.$select.html(this.buildOptionHTML(e)).multiselect("rebuild"),this.createFilterSearch(),this.bindFilterOnoff(),this.$container.find(".cool-event-menu li.search input").val(""),this.currentEventName&&this.$select.multiselect("select",this.currentEventName)},action:function(e,t){switch(e){case"destroy":this.destroy();break;case"setDisabled":this.handleSetDisabled(t)}},handleSetDisabled:function(e){this.isinit&&(this.disabledEvents="string"==typeof e?[e]:e,this.isinit&&(this.processDataByDisabled(),this.rebuildMultiselect()))},processDataByDisabled:function(){if(this.disabledEvents&&this.disabledEvents.length){var e=this.data,t=$.extend(!0,[],this.disabledEvents),n=t.indexOf(this.currentEventName);if(n>-1&&t.splice(n,1),!t.length)return e.everyEvent&&(e.everyEvent.disabled=!1),void e.groups.forEach(function(e){e.events.forEach(function(e){e.disabled=!1})});e.everyEvent&&(e.everyEvent.disabled=t.indexOf(e.everyEvent.name)>-1?!0:!1),e.groups.forEach(function(e){e.events.forEach(function(e){e.disabled=t.indexOf(e.name)>-1?!0:!1})})}},destroy:function(){a.off("update",this.handleModelUpdate),this.$button.off("click",this.handleButtonClick),this.isinit&&(this.$container.find(".cool-event-menu").off("click").off("scroll"),this.$select.multiselect("destroy"),this.$container.replaceWith(this.$button))}});var r=i.create();n.prototype=$.extend({},sensorsdata.EventsModule,{getData:function(e){var t=r.get("data");t?e($.extend(!0,[],t)):this.request(e)},request:function(e){sensorsdata.ajax({url:sensorsdata.api.get("tag"),success:function(t){r.set("data",t),"function"==typeof e&&e($.extend(!0,[],t))}})},receiveData:function(e){var t=this;return e&&e.length?(this.tags=e,this.tplData=this.buildTplData(),this.$container=$(l.filterContainer).appendTo(this.$parent).delegate("[data-method]","click",function(){return t.handleAction(this),!1}),this.render(),void setTimeout(function(){t.trigger("inited")},1)):void setTimeout(function(){t.trigger("initFailed")},1)},buildTplData:function(){return{category:[{name:"event",cname:sensorsdata.languages.get("元事件<!--{en}Meta event-->"),selected:!0},{name:"virtual",cname:sensorsdata.languages.get("虚拟事件<!--{en}Virtual event-->"),selected:!0}],tags:$.extend(!0,[],this.tags)}},render:function(){this.$container.html(l.filterContent(this.tplData))},handleAction:function(e){var t=e.getAttribute("data-method");switch(t){case"reset":this.reset();break;case"filter.category":this.filterbyCategory(e.getAttribute("data-name"));break;case"filter.tag":this.filterbyTag(e.getAttribute("data-id"))}},onoff:function(){this.isshow?this.hide():this.show()},show:function(){this.isshow||(this.handleClickBody||(this.handleClickBody=sensorsdata.bind(this.handleProxyClickBody,this)),this.isshow=!0,this.$container.addClass("show"),$(document.body).on("click",this.handleClickBody))},hide:function(){this.isshow&&(this.isshow=!1,this.$container.removeClass("show"),$(document.body).off("click",this.handleClickBody))},handleProxyClickBody:function(e){this.$container.has(e.target).length||this.hide()},reset:function(){this.tplData=this.buildTplData(),this.render(),this.trigger("filter")},filterbyCategory:function(e){for(var t=this.tplData.category,n=0,i=t.length;i>n;n++){var a=t[n];if(a.name===e){a.selected=!a.selected;break}}this.render(),this.trigger("filter",this.buildFilterEvent())},filterbyTag:function(e){e=Number(e);for(var t=this.tplData.tags,n=0,i=t.length;i>n;n++){var a=t[n];if(a.id===e){a.selected=!a.selected;break}}this.render(),this.trigger("filter",this.buildFilterEvent())},buildFilterEvent:function(){var e=this.tplData,t={category:"all",tags:[]};return e.category[0].selected||(t.category="virtual"),e.category[1].selected||(t.category=e.category[0].selected?"event":null),e.tags.forEach(function(e){e.selected&&t.tags.push(e.id)}),t}}),$.fn.coolEventDropdown=function(e){var n=$(this);if("string"==typeof e){var i=n.data("coolEventDropdown");i&&i.action.apply(i,arguments),"destroy"===e&&n.removeData("coolEventDropdown")}else n.data("coolEventDropdown",new t(n,e));return this}});
;/*!components/createUserListPanel/createUserListPanel.js*/
define("components/createUserListPanel/createUserListPanel",function(e){var a=e("components/router/router"),t=e("components/model/simpleClustering"),s={savePanelClusterTpl:Handlebars.template({1:function(e,a,t,s){var n,i,r,l='  <div class="panel-push-config form-group">\n    <label>\n      <span>推送</span>\n      <div class="panel-push">\n        <select multiple="multiple" style="display:none;">\n';return i=null!=(i=a.configs||(null!=e?e.configs:e))?i:a.helperMissing,r={name:"configs",hash:{},fn:this.program(2,s,0),inverse:this.noop,data:s},n="function"==typeof i?i.call(e,r):i,a.configs||(n=a.blockHelperMissing.call(e,n,r)),null!=n&&(l+=n),l+"        </select>\n      </div>\n    </label>\n  </div>\n"},2:function(e,a,t,s){var n,i=a.helperMissing,r="function",l=this.escapeExpression;return'            <option value="'+l((n=null!=(n=a.id||(null!=e?e.id:e))?n:i,typeof n===r?n.call(e,{name:"id",hash:{},data:s}):n))+'">'+l((n=null!=(n=a.cname||(null!=e?e.cname:e))?n:i,typeof n===r?n.call(e,{name:"cname",hash:{},data:s}):n))+"</option>\n"},4:function(){return""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,s){var n;return'<div id="savePanelCluster" class="form">\n  <div class="form-group">\n    <label>\n      <span>显示名</span>\n      <input type="text" class="cluster_cname form-control" placeholder="请输入分群显示名" data-error-reg-exp="\\S+" data-error-text="必填">\n    </label>\n  </div>\n  <div class="form-group">\n    <label>\n      <span>分群名</span>\n      <input type="text" class="cluster_name form-control" placeholder="字母开头，可包含数字" data-error-reg-exp="^([a-zA-Z][a-zA-Z\\d_$]{0,99})+$" data-error-text="必填，以字母开头, 只能包含英文、数字和下划线">\n    </label>\n  </div>\n'+(null!=(n=a["if"].call(e,null!=e?e.isShow:e,{name:"if",hash:{},fn:this.program(1,s,0),inverse:this.program(4,s,0),data:s}))?n:"")+"</div>"},useData:!0}),createUserListPanelTpl:Handlebars.template({1:function(){return'    <p class="save-user-list"><span class="icon-profiling"></span>添加用户分群<!--{en}Save as Segment--></p>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,t,s){var n;return'<div id="createUserListPanel">\n  <div class="inner">\n    <div class="close-area"><span class="icon-remove close-user-list"></span></div>\n    <p class="view-user-list"><span class="icon-user-analysis"></span>查看用户列表<!--{en}View Users--></p>\n'+(null!=(n=a.unless.call(e,null!=e?e.isNotAllowed:e,{name:"unless",hash:{},fn:this.program(1,s,0),inverse:this.noop,data:s}))?n:"")+'  </div>\n  <span class="popover-area icon-arrow"></span>\n</div>'},useData:!0})},n=$.extend(!0,{},sensorsdata.EventsModule,{configs:[],isinit:!1,options:$.extend(!0,{queryData:{}}),createUserListManage:function(e){var a=!0;if(a=e.element.hasClass("panel-active"),$(".user-list-manage").is(":visible")&&a)return e.element.removeClass("panel-active"),void $(".user-list-manage").hide();$(".panel-active").removeClass("panel-active"),e.element.addClass("panel-active"),this.options=e,this.isinit||this.init();var t=this.authority&&(this.authority.isNormal||this.authority.isAnalyst&&sensorsdata.cache.config.allow_analyst_higher_privilege!==!0),s=e.element,n=s.offset().top-115+(t?38:0),i=s.offset().left-72+s.outerWidth()-s.width()/2,r=$("body").innerWidth(),l="left",o=i,c="50%",u=window.location.pathname.split("/").filter(function(e){return""!==e});("retention"===u[0]||"addiction"===u[0])&&(o-=20),i+144>r&&(l="right",o=0,c=i+144-r+72),this.show({top:n,positionValue:o,position:l,arrowLeft:c})},init:function(){var e=this;this.isinit||(this.isinit=!0,this.authority=sensorsdata.authority||{},$("body").append(s.createUserListPanelTpl({isNotAllowed:this.authority.isNormal||this.authority.isAnalyst&&sensorsdata.cache.config.allow_analyst_higher_privilege!==!0})),t.getPushConfig(function(a){e.configs=a,e.initEvent()}))},initEvent:function(){var e=this.options,s=this.options.queryData,n=this,i=$("#createUserListPanel");n.createPopover(s),i.off("click.preventdefault").on("click.preventdefault",function(e){return e&&e.preventDefault&&e.preventDefault(),!1}),i.find(".close-user-list").off("click.close").on("click.close",function(){n.hide()}),i.find(".view-user-list").off("click.view").on("click.view",function(){n.hide(),e=n.options;var t=window.location.pathname.split("/").filter(function(e){return""!==e}),s=t[0]||"";a.nav("/"+s+"/users/#"+$.param(e.queryData))}),i.find(".save-user-list").off("click.save").on("click.save",function(){i.find(".popover-area").popover("show");var e=$("#savePanelCluster .cluster_name"),a=$("#savePanelCluster .cluster_cname"),s={};t.getClusteringTasksName(function(t){s=t,a.val(s.cname),e.val(s.name),e.attr("data-old-name",s.name)}),$("#savePanelCluster .cluster_name, #savePanelCluster .cluster_cname").unbind("focusout.clustering").unbind("keyup.clustering").bind("keyup.clustering",function(){var a=$(this),t=a.attr("data-error-reg-exp"),s=a.val().trim();if(a.hasClass("cluster_cname")){var n=e.attr("data-old-name"),i=e.val();if(n&&i&&n!==i)return;var r={items:[s]},l=sensorsdata.api.get("pinyin");sensorsdata.ajax({queueEnable:!0,method:"POST",url:l,showLoader:!1,data:JSON.stringify(r),success:function(a){var t=a[0].replace(/^\d+/,"").replace(/\W/g,"_");e.val(t),e.attr("data-old-name",t)}})}s&&RegExp(t,"g").test(s)?(sensorsdata.form.removeError(a),$(".popover button.pop-is-success").removeAttr("disabled")):($(".popover button.pop-is-success").attr("disabled","disabled"),sensorsdata.form.addError(a,a.attr("data-error-text"),!0))})})},show:function(e){var a=this,t=$("#createUserListPanel");if(t.find(".popover-area").popover("hide"),e){t.removeAttr("style");var s=e.top+"px",n=e.position,i=e.positionValue+"px";t.css("left"===n?{top:s,left:i}:{top:s,right:i}),t.find(".popover-area").css({left:e.arrowLeft})}t.show(),$("body").off("click.hidePanel").on("click.hidePanel",function(e){var t=$(e.target||e.srcElement),s="user-list"===t.data("method");return s?!1:void a.hide()})},hide:function(){$("#createUserListPanel").hide(),$("body").off("click.hidePanel")},destroy:function(){this.isinit=!1,$("#createUserListPanel").remove(),$("body").off("click.hidePanel")},createPopover:function(){var e=this;sensorsdata.popover({ele:$("#createUserListPanel .popover-area"),placement:"top",showNow:!1,title:"保存为用户分群",footer:$("#tpl_popover_footer_state_3").html(),content:s.savePanelClusterTpl({configs:e.configs,isShow:e.configs.length>0}),beforeShow:function(e){e.css("z-index","1020")},onShow:function(){e.hide();var a=$("#savePanelCluster"),t=a.find(".panel-push-config select");t.multiselect("destroy").multiselect({nonSelectedText:sensorsdata.languages.get("可选择<!--{en}Select the push configuration-->"),allSelectedText:sensorsdata.languages.get("推送配置<!--{en}Push configuration-->"),numberDisplayed:1,enableCaseInsensitiveFiltering:!1,buttonText:function(e){return 0===e.length?sensorsdata.languages.get("可选择<!--{en}Select the push configuration-->"):sensorsdata.util.format(sensorsdata.languages.get("推送配置(#{length})<!--{en}Push Configuration(#{length})-->"),e)}}),sensorsdata.languages.update()},success:function(){e.saveUserCluster()}})},saveUserCluster:function(){var e=this.dealParam(this.options.queryData),a=[],s=$("#savePanelCluster"),n=s.find(".cluster_cname").val().trim(),i=s.find(".cluster_name").val().trim();if(s.find(".panel-push-config :checkbox:checked").each(function(e,t){var s=$(t).val();$.isNumeric(s)&&a.push(parseInt(s,10))}),!n||!i)return void sensorsdata.info.show(sensorsdata.languages.get("您没有输入用户分群的名称，请重新创建<!--{en}You did not enter the name of the group clustering, please recreate.-->"));var r={cname:n,name:i,app_push_config_id_list:a,original_request:e};t.saveCluster(r)},dealParam:function(e){if(e.hasOwnProperty("slice_freq")&&!e.slice_freq&&(e.slice_freq=null),e.hasOwnProperty("slice_max_freq")&&!e.slice_max_freq&&(e.slice_max_freq=null),e.hasOwnProperty("slice_by_value"))switch(e.slice_by_value){case sensorsdata.CONSTSET.unknownByValueText:case"":e.slice_by_value=null;break;case sensorsdata.CONSTSET.emptyStringByValueText:e.slice_by_value=""}if(e.hasOwnProperty("slice_by_values")&&e.slice_by_values.length>0)for(var a=0;a<e.slice_by_values.length;a++)switch(e.slice_by_values[a]){case sensorsdata.CONSTSET.unknownByValueText:case"":e.slice_by_values[a]=null;break;case sensorsdata.CONSTSET.emptyStringByValueText:e.slice_by_values[a]=""}else delete e.slice_by_values;return e.hasOwnProperty("slice_date")&&!e.slice_date&&(e.slice_date=null,e.rollup_date="true"),e.hasOwnProperty("filter")||(e.filter={}),$.isNumeric(e.sampling_factor)?e.sampling_factor=parseInt(e.sampling_factor,10):delete e.sampling_factor,e.rollup_date="true"===e.rollup_date||"boolean"==typeof e.rollup_date&&e.rollup_date,e}});$.fn.createUserListPanel=function(e){return e=$.extend(!0,{element:this},e),n.createUserListManage(e),this}});
;/*!components/widgetUTMConfig/primarySetting/primarySetting.js*/
define("components/widgetUTMConfig/primarySetting/primarySetting",function(e,t){var a={template:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,a,n){var s;return'<form class="utm-primary-setting dashboard-config-form form-inline" data-type=\'app\'>\n  <div class="form-group">\n    <label for="dashboardName">渠道来源类型<!--{en}Types of channel sources--></label>\n    <div class="type-block selected" data-type="app" data-method=\'type-change\'>\n      <div class="icon-mobile"></div>\n      <p>App</p>\n      <div class="selected">\n        <span class="icon-selected"></span>\n      </div>\n    </div>\n    <div class="type-block" data-type="web" data-method="type-change">\n      <div class="icon-web"></div>\n      <p>Web</p>\n      <div class="selected">\n        <span class="icon-selected"></span>\n      </div>\n    </div>\n  </div>\n  <div class="form-group utm-type-app">\n    <label for="dashboard-type">iOS 的渠道标识名称<!--{en}Name of channel identifier for iOS--></label>\n    <div class="selector" id="primary-source-name"></div>\n  </div>\n  <div class="form-group utm-type-app">\n    <label for="dashboard-type">Android 的渠道标识名称<!--{en}Name of channel identifier for Android--></label>\n    <div class="selector" id="primary-source-name"></div>\n  </div>\n  <div class="form-group utm-type-web">\n    <label for="dashboard-type">Web 渠道标识名称<!--{en}Name of channel identifier for Web--></label>\n    <div class="selector" id="primary-source-name"></div>\n  </div>\n  <div class="form-group">\n    <label for="dashboard-comment">组件名称<!--{en}Component name--></label>\n    <input type="text" class="form-control" id="primary-component-name" value="'+this.escapeExpression((s=null!=(s=t.name||(null!=e?e.name:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{name:"name",hash:{},data:n}):s))+'">\n  </div>\n  <div class="form-group">\n    <label for="time-range">时间范围<!--{en}Time range--></label>\n    <div class="report-date-picker-wrap">\n      <span class="icon-date-picker"></span>\n      <input id="inputDate" style="width: 100%;" type="text" class="form-control" readonly="readonly" data-placement="top" data-container="body" title="" data-original-title="事件发生的时间范围" data-calendar-status-refresh-time="1516602699">\n    </div>\n  </div>\n</form>\n'},useData:!0}),multiselect:Handlebars.template({1:function(){return""},3:function(e,t,a,n){var s,i,o=t.helperMissing,r="function",c=this.escapeExpression;return'    <option value="'+c((i=null!=(i=t.name||(null!=e?e.name:e))?i:o,typeof i===r?i.call(e,{name:"name",hash:{},data:n}):i))+'" data-index="'+c((i=null!=(i=t.index||(null!=e?e.index:e))?i:o,typeof i===r?i.call(e,{name:"index",hash:{},data:n}):i))+'" '+(null!=(s=t["if"].call(e,null!=e?e.selected:e,{name:"if",hash:{},fn:this.program(4,n,0),inverse:this.noop,data:n}))?s:"")+' title="'+c((i=null!=(i=t.name||(null!=e?e.name:e))?i:o,typeof i===r?i.call(e,{name:"name",hash:{},data:n}):i))+'">'+(null!=(i=null!=(i=t.cname||(null!=e?e.cname:e))?i:o,s=typeof i===r?i.call(e,{name:"cname",hash:{},data:n}):i)?s:"")+"</option>\n"},4:function(){return'selected="selected"'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,a,n){var s;return'<select class="" name="">\n'+(null!=(s=t["if"].call(e,null!=e?e.app:e,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?s:"")+(null!=(s=t.each.call(e,null!=e?e.list:e,{name:"each",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?s:"")+"</select>\n"},useData:!0})},n={},s={componentName:{app:"app渠道对比组件",web:"web渠道对比组件"},timeFormat:"YYYY-MM-DD",utmSource:"user.$utm_source"},i=function(e){return void 0===e.container?new Error("container不可为空"):(this.supportUtm=this.checkSupportUtmType(),e.data=e.data?JSON.parse(e.data.data):{},this.options=e,this.$container_=e.container,this.utmType=e.data&&e.data.utm_source||"app",this.$container_.append(a.template()),this.conBox=this.$container_.find(".utm-primary-setting"),this.$utmSourceName=this.$container_.find('[data-method="type-change"]'),this.$utmComponentName=this.$container_.find("#primary-component-name"),this.inputDate=this.$container_.find("#inputDate"),this.utmSourceType=this.$container_.prev().find(".utm-source-type"),void this.init())};i.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){"both"===this.supportUtm||"app"===this.supportUtm?this.request("app"):this.$utmSourceName.eq(0).hide(),"both"===this.supportUtm||"web"===this.supportUtm?(this.utmType="web",this.request("web")):this.$utmSourceName.eq(1).hide(),this.options.data&&this.options.data.utm_source&&(this.utmType=this.options.data.utm_source),this.renderMeta(),this.initEvent()},request:function(e){var t="event/properties?events=";switch(e){case"web":t+="$pageview";break;case"app":t+="$AppViewScreen"}sensorsdata.ajax({url:t,success:function(t){this.handleUtmSourceName(t,e)}.bind(this)})},renderMeta:function(){var e=this.options.data,t={allowRelative:!0,drops:"up"};e.from_date?(t.startDate=e.from_date,t.endDate=e.to_date,t.chosenLabel=e.rangeText):t.chosenLabel="过去 7 天",sensorsdata.initDateRangeInput(this.inputDate,t),this.$utmComponentName.val(e.component_name||s.componentName[this.utmType]),(e.utm_source&&"web"===e.utm_source||"web"===this.utmType)&&(this.$utmSourceName.eq(0).removeClass("selected").next().addClass("selected").closest("form").attr("data-type","web"),this.utmSourceType.text("Web "))},initEvent:function(){this.conBox.off("click").on("click",function(e){var t=$(e.target||e.srcElement),a=t.closest("[data-method]"),n=a.attr("data-method");switch(n){case"type-change":a.addClass("selected").siblings().removeClass("selected"),this.conBox.attr("data-type",a.attr("data-type")),this.utmSourceType.text("web"===a.attr("data-type")?"Web ":"iOS 和 Android "),this.$utmComponentName.val(s.componentName[a.attr("data-type")])}}.bind(this))},handleUtmSourceName:function(e,t){var i=[],o=function(e,t){for(var a=0,n=e.length;n>a;a++){var s=e[a];"event"===t?s.name="event.$Anything."+s.name:"user"===t&&(s.name="user."+s.name),i.push(s)}},r=function(e,t){var a={app:e.app},n=[].concat(e.list);if(a.list=n,t)for(var s=0,i=n.length;i>s;s++){var o=n[s];if(o.name===t){o.selected=!0;break}}return a};if(!$.isEmptyObject(e)){for(var c in e){var p=e[c],l=p.user;o(l,"user")}var d,m={list:i},u=this.options.data;if("app"===t){m.app=!0,d=a.multiselect(r(m,u.ios_source_name||s.utmSource)),this.$container_.find(".utm-type-app .selector").eq(0).html(d),d=a.multiselect(r(m,u.android_source_name||s.utmSource)),this.$container_.find(".utm-type-app .selector").eq(1).html(d);var h=this.$container_.find(".utm-type-app .selector select");n.ios=h.eq(0).multiselect({}),n.android=h.eq(1).multiselect({})}else"web"===t&&(m.app=!1,d=a.multiselect(r(m,u.web_source_name||s.utmSource)),this.$container_.find(".utm-type-web .selector").html(d),n.web=this.$container_.find(".utm-type-web .selector select").multiselect({}))}},get:function(){var e={utm_source:this.conBox.attr("data-type"),ios_source_name:n.ios&&n.ios.val(),android_source_name:n.android&&n.android.val(),web_source_name:n.web&&n.web.val(),component_name:this.$utmComponentName.val(),from_date:this.inputDate.data("startDate").format(s.timeFormat),to_date:this.inputDate.data("endDate").format(s.timeFormat),rangeText:this.inputDate.data("daterangepicker")&&this.inputDate.data("daterangepicker").chosenLabel},t=this.check(e);return $.isEmptyObject(t)?{}:e},check:function(e){if("app"===e.utm_source){if(delete e.web_source_name,"ignore"===e.ios_source_name&&delete e.ios_source_name,"ignore"===e.android_source_name&&delete e.android_source_name,!e.ios_source_name&&!e.android_source_name)return sensorsdata.error.show(sensorsdata.languages.get("请选择渠道标识名称<!--{todo}-->")),!1}else"web"===e.utm_source&&(delete e.ios_source_name,delete e.android_source_name);return e.component_name?e:(sensorsdata.error.show(sensorsdata.languages.get("组件名称不可为空<!--{todo}-->")),!1)},checkSupportUtmType:function(){var e,t=sensorsdata.cache.eventsMap,a=sensorsdata.cache.eventPropertiesMap;return t.AppInstall&&t.$AppStart&&t.$AppEnd&&t.$AppViewScreen&&a.$event_duration&&a.$os&&a.$is_first_day&&(e="app"),t.$pageview&&a.$os&&a.$is_first_day&&(e=e?"both":"web"),e}}),t.create=function(e){return new i(e)}});
;/*!components/widgetUTMConfig/advancedSetting/advancedSetting.js*/
define("components/widgetUTMConfig/advancedSetting/advancedSetting",function(e,a){var n={template:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<form class="utm-advanced-setting dashboard-config-form form-inline default-utm-type" data-state="off">\n  <div class="form-group">\n    <label for="dashboard-type">目标转化事件<!--{en}Target transformation event--></label>\n    <span class="action-onoff form-control" data-method="onoff">\n      <span class="sa-switch"></span>\n    </span>\n  </div>\n  <div class="form-group utm-event">\n    <label for="dashboard-type">目标转化事件<!--{en}Target transformation event--></label>\n    <div class="selector" id="events-list"></div>\n    <div class="aggregator-con">\n\n      <button data-method="by-add" type="button" class="btn btn-link">\n        <span data-method="by-add" class="icon-add"></span>\n        <span>添加指标</span>\n      </button>\n    </div>\n  </div>\n</form>\n'},useData:!0}),multiselectEvents:Handlebars.template({1:function(e,a,n,t){var s,l,r=a.helperMissing,i="function",o=this.escapeExpression;return'    <option value="'+o((l=null!=(l=a.name||(null!=e?e.name:e))?l:r,typeof l===i?l.call(e,{name:"name",hash:{},data:t}):l))+'" data-index="'+o((l=null!=(l=a.index||(null!=e?e.index:e))?l:r,typeof l===i?l.call(e,{name:"index",hash:{},data:t}):l))+'" '+(null!=(s=a["if"].call(e,null!=e?e.selected:e,{name:"if",hash:{},fn:this.program(2,t,0),inverse:this.noop,data:t}))?s:"")+">"+(null!=(l=null!=(l=a.cname||(null!=e?e.cname:e))?l:r,s=typeof l===i?l.call(e,{name:"cname",hash:{},data:t}):l)?s:"")+"</option>\n"},2:function(){return'selected="selected"'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,n,t){var s;return'<select class="" name="">\n'+(null!=(s=a.each.call(e,e,{name:"each",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t}))?s:"")+"</select>\n"},useData:!0}),measurePro:Handlebars.template({1:function(e,a,n,t){var s,l=a.helperMissing,r="function",i=this.escapeExpression;return'        <span class="selected cur-measure" data-event-name="'+i((s=null!=(s=a.event_name||(null!=e?e.event_name:e))?s:l,typeof s===r?s.call(e,{name:"event_name",hash:{},data:t}):s))+'" data-aggregator="'+i((s=null!=(s=a.aggregator||(null!=e?e.aggregator:e))?s:l,typeof s===r?s.call(e,{name:"aggregator",hash:{},data:t}):s))+'" data-field="'+i((s=null!=(s=a.field||(null!=e?e.field:e))?s:l,typeof s===r?s.call(e,{name:"field",hash:{},data:t}):s))+'" >\n          '+i((s=null!=(s=a.measureName||(null!=e?e.measureName:e))?s:l,typeof s===r?s.call(e,{name:"measureName",hash:{},data:t}):s))+"\n        </span>\n"},3:function(e,a,n,t){var s;return'    <ul class="dropdown-menu" data-method="choose-agg-one">\n      <li><a data-cname="总次数" data-aggregator="general" data-field="">总次数<!--{en}Event Totals--></a></li>\n      <li><a data-cname="触发用户数" data-aggregator="unique" data-field="">触发用户数<!--{en}Unique Users--></a></li>\n      <li><a data-cname="人均次数" data-aggregator="average" data-field="">人均次数<!--{en}Average--></a></li>\n    \n'+(null!=(s=a.each.call(e,null!=e?e.measures:e,{name:"each",hash:{},fn:this.program(4,t,0),inverse:this.noop,data:t}))?s:"")+"\n"+(null!=(s=a.each.call(e,null!=e?e.notMeasures:e,{name:"each",hash:{},fn:this.program(6,t,0),inverse:this.noop,data:t}))?s:"")+'    </ul>\n  </div>\n  \n    <button data-method="measure-remove" type="button" class="btn-link event-measure-remove">\n      <span class="icon-remove"></span>\n    </button>\n'},4:function(e,a,n,t){var s,l=a.helperMissing,r="function",i=this.escapeExpression;return'      <li class="dropdown-submenu">\n        <a tabindex="-1">'+i((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:t}):s))+"<!--{en}"+i((s=null!=(s=a.name||(null!=e?e.name:e))?s:l,typeof s===r?s.call(e,{name:"name",hash:{},data:t}):s))+'--></a>\n        <ul class="dropdown-menu" data-method="choose-agg-two">\n          <li><a data-cname="'+i((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:t}):s))+'" data-field="'+i((s=null!=(s=a.measureField||(null!=e?e.measureField:e))?s:l,typeof s===r?s.call(e,{name:"measureField",hash:{},data:t}):s))+'" data-aggregator="SUM">总和<!--{en}Total--></a></li>\n          <li><a data-cname="'+i((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:t}):s))+'" data-field="'+i((s=null!=(s=a.measureField||(null!=e?e.measureField:e))?s:l,typeof s===r?s.call(e,{name:"measureField",hash:{},data:t}):s))+'" data-aggregator="AVG">均值<!--{en}Mean value--></a></li>\n          <li><a data-cname="'+i((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:t}):s))+'" data-field="'+i((s=null!=(s=a.measureField||(null!=e?e.measureField:e))?s:l,typeof s===r?s.call(e,{name:"measureField",hash:{},data:t}):s))+'" data-aggregator="MAX">最大值<!--{en}Max value--></a></li>\n          <li><a data-cname="'+i((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:t}):s))+'" data-field="'+i((s=null!=(s=a.measureField||(null!=e?e.measureField:e))?s:l,typeof s===r?s.call(e,{name:"measureField",hash:{},data:t}):s))+'" data-aggregator="MIN">最小值<!--{en}Min value--></a></li>\n          <li><a data-cname="'+i((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:t}):s))+'" data-field="'+i((s=null!=(s=a.measureField||(null!=e?e.measureField:e))?s:l,typeof s===r?s.call(e,{name:"measureField",hash:{},data:t}):s))+'" data-aggregator="uniqAvg">人均值<!--{en}Value per capita--></a></li>\n          <li><a data-cname="'+i((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:t}):s))+'" data-field="'+i((s=null!=(s=a.measureField||(null!=e?e.measureField:e))?s:l,typeof s===r?s.call(e,{name:"measureField",hash:{},data:t}):s))+'" data-aggregator="uniqCount">去重数<!--{en}Deduplication--></a></li>\n        </ul>\n      </li>\n'},6:function(e,a,n,t){var s,l=a.helperMissing,r="function",i=this.escapeExpression;return'        <li class="dropdown-submenu">\n          <a tabindex="-1">'+i((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:t}):s))+"<!--{en}"+i((s=null!=(s=a.name||(null!=e?e.name:e))?s:l,typeof s===r?s.call(e,{name:"name",hash:{},data:t}):s))+'--></a>\n          <ul class="dropdown-menu" data-method="choose-agg-two">\n            <li>\n              <a data-cname="'+i((s=null!=(s=a.cname||(null!=e?e.cname:e))?s:l,typeof s===r?s.call(e,{name:"cname",hash:{},data:t}):s))+'" data-field="'+i((s=null!=(s=a.measureField||(null!=e?e.measureField:e))?s:l,typeof s===r?s.call(e,{name:"measureField",hash:{},data:t}):s))+'" data-aggregator="uniqCount">去重数<!--{en}Deduplication--></a>\n            </li>\n          </ul>\n        </li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,n,t){var s;return'<div class="aggregator-item">\n  <span>的</span>\n  <div class="selector dropdown">\n    <button data-toggle="dropdown" class="btn-selector dropdown-toggle" data-target="#">\n'+(null!=(s=a.each.call(e,null!=e?e.curMeasure:e,{name:"each",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t}))?s:"")+"    </button>\n"+(null!=(s=a["if"].call(e,null!=e?e.isCanDel:e,{name:"if",hash:{},fn:this.program(3,t,0),inverse:this.noop,data:t}))?s:"")+"</div>\n"},useData:!0})},t=null,s={general:"总次数",unique:"触发用户数",average:"人均次数",SUM:"总和",AVG:"均值",MAX:"最大值",MIN:"最小值",uniqAvg:"人均值",uniqCount:"去重数"},l=function(e){return this.segBase=new sensorsdata.SegmentationBase,e.data=e.data?JSON.parse(e.data.data):{},this.options=e,this.measures=this.options.data.measures||[],this.selectEvent=this.measures.length&&this.measures[0].event_name||"$Anything",this.$container_=e.container,void 0===this.$container_?new Error("container不可为空"):(this.$container_.append(n.template()),this.conBox=this.$container_.find(".utm-advanced-setting"),this.saSwitch=this.$container_.find(".sa-switch"),this.eventsCon=this.$container_.find("#events-list"),this.addBtn=this.$container_.find('button[data-method="by-add"]'),void this.init())};l.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.renderMeta(),this.request("events/all",this.handleEvents),this.initEvent()},renderMeta:function(){var e=this.options.data.measures;e&&e.length&&(this.saSwitch.addClass("on"),this.conBox.attr("data-state","on"))},request:function(e,a){sensorsdata.ajax({url:e,success:function(e){$.isFunction(a)&&a.call(this,e)}.bind(this)})},handleEvents:function(e){e=e||[],e.unshift({name:"$Anything",cname:"任意事件"}),this.findSlected(e,this.selectEvent),this.eventsCon.html(n.multiselectEvents(e)),this.createMultiselect(this.eventsCon.find("select")),this.handleProperties(this.selectEvent)},renderCurMeasureName:function(e,a){var n=s[a.aggregator];if(!a.field)return void(a.measureName=n);for(var t=e.measures,l=e.notMeasures,r=a.field,i=0,o=t.length;o>i;i++)if(t[i].measureField===r)return void(a.measureName=t[i].cname+"的"+n);for(i=0,o=l.length;o>i;i++)if(l[i].measureField===r)return void(a.measureName=l[i].cname+"的"+n)},renderOneAggregator:function(e,a,t){if(this.renderCurMeasureName(e,a),e.curMeasure=[a],e.isCanDel=t,this.addBtn.before(n.measurePro(e)),t){var s=this.addBtn.prev();if(a.field){var l=s.find('[data-field="'+a.field+'"]').filter(function(e,n){return $(n).attr("data-aggregator")===a.aggregator?!0:void 0});l.parent().addClass("active").closest(".dropdown-submenu").addClass("active")}else s.find('[data-aggregator="'+a.aggregator+'"]').parent().addClass("active")}else this.addBtn.prev().find(".selector>ul li").addClass("disabled")},handleProperties:function(e,a){var n=0;a&&(this.conBox.find(".aggregator-item").slice(2).remove(),n=2),this.segBase.getProperties([e],function(a){var s=this.measures;t=this.filterMeasureProperties(a.original[e].event,e),s&&0!==s.length||(s=[{cname:"总次数",aggregator:"general",measureName:"总次数"},{cname:"触发用户数",aggregator:"unique",measureName:"触发用户数"}]);for(var l=n,r=s.length;r>l;l++)this.renderOneAggregator(t,s[l],l>1)}.bind(this))},filterMeasureProperties:function(e){for(var a=[],n=[],t=0,s=e.length;s>t;t++){var l=e[t];l.measureField=["event",l.event_name,l.name].join("."),"$user_id"!==l.name&&"number"===l.data_type&&l.is_measure?(l.isMeasure="is_measure",a.push($.extend(!0,{},l))):(l.isMeasure="not_measure",l.aggregator="uniqCount",n.push($.extend(!0,{},l)))}return{measures:a,notMeasures:n}},initEvent:function(){this.conBox.off("click").on("click",function(e){var a,n,s,l=$(e.target||e.srcElement),r=l.attr("data-method")||l.closest("[data-method]").attr("data-method");switch(r){case"onoff":this.saSwitch.hasClass("on")?(this.saSwitch.removeClass("on"),this.conBox.attr("data-state","off")):(this.saSwitch.addClass("on"),this.conBox.attr("data-state","on"));break;case"by-add":var i={cname:"人均次数",aggregator:"average",measureName:"人均次数"};this.renderOneAggregator(t,i,!0);break;case"measure-remove":var o=l.closest(".aggregator-item");o.remove(),o=null;break;case"choose-agg-one":if(a=l.closest(".aggregator-item").find(".cur-measure"),n=l.closest("li"),n.hasClass("disabled"))return;if(n.hasClass("dropdown-submenu"))return!1;s=n.find("a"),n.addClass("active").siblings().removeClass("active"),a.attr("data-aggregator",s.attr("data-aggregator")).attr("data-field",s.attr("data-field")).text(s.attr("data-cname"));break;case"choose-agg-two":if(a=l.closest(".aggregator-item").find(".cur-measure"),n=l.closest("li"),n.hasClass("disabled"))return;var d=n.index(),u=n.parent(),c=u.prev().children().eq(u.attr("data-index"));s=n.find("a"),c.addClass("active").siblings(".active").removeClass("active"),a.attr("data-aggregator",s.attr("data-aggregator")).attr("data-field",s.attr("data-field")).text(s.attr("data-cname")+"的"+s.text()),c.children().eq(1).children().eq(d).addClass("active").siblings().removeClass("active")}}.bind(this)),this.conBox.off("mouseover").on("mouseover",function(e){var a=$(e.target||e.srcElement),n=a.closest(".drop-one-clone"),t=a.closest(".dropdown-submenu"),s=t.index();if(!(n.length>0)&&(this.conBox.find('[data-method="choose-agg-one"]').next().remove(),t.length>0)){var l=t.children().eq(1).clone(!0),r=this.simuOffset(t);l.addClass("drop-one-clone").attr("data-index",s),l.css({marginTop:r.top,marginLeft:r.left}),l.insertAfter(t.parent())}}.bind(this))},findSlected:function(e,a){for(var n=0,t=e.length;t>n;n++){var s=e[n];if(s.name===a){s.selected=!0;break}}},simuOffset:function(e){var a=e.width(),n=e.height(),t=e.prevAll().length*n-e.parent().scrollTop()+2;return{left:a,top:t}},createMultiselect:function(e,a){var n=e.multiselect({toggleClose:!1,enableCaseInsensitiveFiltering:!1,onChange:function(e){this.selectEvent=e.val(),this.handleProperties(this.selectEvent,!0)}.bind(this)});return a===!1&&e.multiselect("disable"),n},get:function(){if(this.saSwitch.hasClass("on")){for(var e=this.selectEvent,a=[{event_name:e,aggregator:"general"},{event_name:e,aggregator:"unique"}],n=this.conBox.find(".aggregator-item").slice(2),t=0,s=n.length;s>t;t++){var l=n.eq(t).find(".cur-measure");if(l.attr("data-aggregator")){var r={event_name:e,aggregator:l.attr("data-aggregator")};l.attr("data-field")&&(r.field=l.attr("data-field")),a.push(r)}}return{measures:a}}return{measures:[]}}}),a.create=function(e){return new l(e)}});
;/*!components/widgetUTMConfig/container/container.js*/
define("components/widgetUTMConfig/container/container",function(t,n,a){var i=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="modal fade modal-widgetContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" id=\'utm-setting\'>\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">渠道对比设置</h4>\n      </div>\n      <div class="modal-body">\n        <div class="range-label-time sa-tab clearfix" data-set-type=\'primary\'>\n          <div class="selected" data-set-type="primary">基础设置<!--{en}Basic setting--></div>\n          <div data-set-type="advanced">高级设置<!--{en}Advanced setting--></div>\n        </div>\n        <div class="setting-summary" data-utm-type=\'app\'>\n          <div class="primary">\n            <span><span class="utm-source-type">iOS 和 Android </span>渠道标识名称默认为用户属性的 $utm_source 属性，</span>\n            <span>若埋点时进了自定义处理，请与分析师或开发确认，更改为正确的渠道标识字段。</span>\n          </div>\n          <div class="advanced">\n            <span>系统根据全埋点数据已为您生成了每个渠道新客的访问，留存等数据。</span>\n            <span>若您需要观察某个事件的新用户转化情况，请开启自定义转化事件。</span>\n          </div>\n        </div>\n        <div class="primary-setting">\n\n        </div>\n        <div class="advanced-setting">\n\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="pop-is-cancel btn btn-link btn-small" data-dismiss="modal">取消<!--{en}Cancel--></button>\n        <button type="button" class="pop-is-success btn btn-primary btn-small">确定<!--{en}Confirm--></button>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0}),s=t("components/widgetUTMConfig/primarySetting/primarySetting"),e=t("components/widgetUTMConfig/advancedSetting/advancedSetting"),d=$.extend(!0,{},sensorsdata.EventsModule,{show:function(t,n){this.options=t,this.callback=n,this.primarySetting=null,this.advancedSetting=null,this.primarySettingCon=null,this.advancedSettingCon=null,this.$modal&&(this.$modal.remove(),this.$modal=null),this.$modal=$(i()),$("body").addClass("modal-open"),this.primarySettingCon=this.$modal.find(".primary-setting"),this.advancedSettingCon=this.$modal.find(".advanced-setting"),this.primarySetting=s.create({container:this.primarySettingCon,data:this.options&&this.options.widget&&this.options.widget.bookmark,utmType:"string"==typeof this.options?this.options:null}),this.advancedSetting=e.create({container:this.advancedSettingCon,data:this.options&&this.options.widget&&this.options.widget.bookmark}),this.$modal.modal("show"),this.$modal.on("shown.bs.modal",function(){$("body").addClass("modal-open"),this.$container=$("#utm-setting"),this.initEvent.call(this)}.bind(this))},initEvent:function(){this.$container.off("click",".sa-tab").on("click",".sa-tab",function(t){var n=$(t.target);n.addClass("selected").siblings().removeClass("selected"),$(this).attr("data-set-type",n.attr("data-set-type"))}),this.$container.off("click",".pop-is-success").on("click",".pop-is-success",function(){var t={},n=this.primarySetting.get(),a=this.advancedSetting.get();if($.isEmptyObject(n))return!1;t=$.extend(!0,n,a);var i={name:t.component_name,data:JSON.stringify(t),type:"/utm/"};this.$modal.modal("hide"),$.isFunction(this.callback)&&this.callback(this.supplyWidgetData(i))}.bind(this))},supplyWidgetData:function(t){var n=this.options;if(n&&n.widget){var a=n.widget;return a.bookmark.data=t.data,a.bookmark.name=t.name,a}return t}});a.exports=d});
;/*!components/dashboardCreateNav/dashboardCreateNav.js*/
define("components/dashboardCreateNav/dashboardCreateNav",function(n,a,s){var e=n("components/widgetUTMConfig/container/container"),t={template:Handlebars.template({1:function(){return"has-utm"},3:function(){return"no-utm"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,a,s,e){var t;return'<div class="modal fade modal-dashboardcreate" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content '+(null!=(t=a["if"].call(n,null!=n?n.hasUtm:n,{name:"if",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?t:"")+'">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">选择分析类型<!--{en}Select analysis type--></h4>\n      </div>\n      <div class="modal-body">\n        <div style="display: inline-block;" class="split-block">\n          <div class="split-block-label">模型分析<!--{en}Model analysis--></div>\n          <div class="nav-block" nav="segmentation">\n            <div>\n              <span class="icon-nav-event-analysis"></span>\n            </div>\n            <span>事件分析<!--{en}Segmentation--></span>\n          </div>\n          <div class="nav-block" nav="funnel">\n            <div>\n              <span class="icon-nav-funnel"></span>\n            </div>\n            <span>漏斗分析<!--{en}Funnel--></span>\n          </div>\n          <div class="nav-block" nav="retention">\n            <div>\n              <span class="icon-nav-retention"></span>\n            </div>\n            <span>留存分析<!--{en}Retention--></span>\n          </div>\n          <div class="nav-block" nav="addiction">\n            <div>\n              <span class="icon-distribute"></span>\n            </div>\n            <span>分布分析<!--{en}Distribution--></span>\n          </div>\n          <div class="nav-block" nav="user_analytics">\n            <div>\n              <span class="icon-user-analysis"></span>\n            </div>\n            <span>属性分析<!--{en}User Analytics--></span>\n          </div>\n        </div>\n        <span class="sa-h-split"></span>\n          <div class="split-block">\n            <div class="split-block-label">渠道对比<!--{en}Channel comparison--></div>\n            <div class="nav-block  '+(null!=(t=a["if"].call(n,null!=n?n.hasUtm:n,{name:"if",hash:{},fn:this.noop,inverse:this.program(3,e,0),data:e}))?t:"")+'" data-toggle="tooltip" data-placement="top" nav="utm">\n              <div>\n                <span class="icon-utm"></span>\n              </div>\n              <span>渠道对比<!--{en}Channel comparison--></span>\n            </div>\n          </div>\n        <div class="block-info">　</div>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0})},i=n("components/router/router"),o={segmentation:sensorsdata.languages.get("通过条件筛选、分组和聚合能力，多维分析用户行为<!--{en}Multidimensional analysis of user behavior through conditional filtering, clustering and aggregation-->"),funnel:sensorsdata.languages.get("分析一个多步骤过程中每一步的转化和流失情况<!--{en}Analyze the transformation and loss of each step in a multi-step process-->"),retention:sensorsdata.languages.get("分析用户参与情况和活跃程度<!--{en}Analysis of user participation and activity level-->"),addiction:sensorsdata.languages.get("分析用户行为在一段时间内的频次和指标的分布<!--{en}Analyze the frequency and metric distribution of user behavior over a period of time.-->"),user_analytics:sensorsdata.languages.get("对用户属性的可视化统计和分析<!--{en}Visual statistics and analysis of user attributes-->"),"default":"　",utm:sensorsdata.languages.get("根据您的产品特性合理配置追踪事件和属性<!--{en}Configure traced events and attributes reasonably according to your product characteristics-->")},l={utm:!0},d=n("components/model/widgetModel"),c=$.extend(!0,{},sensorsdata.EventsModule,{show:function(n,a){var s=sensorsdata.cache.eventsMap,c=sensorsdata.cache.eventPropertiesMap,r=!1,v=null;s.AppInstall&&s.$AppStart&&s.$AppEnd&&s.$AppViewScreen&&c.$event_duration&&c.$os&&c.$is_first_day&&(r=!0,v="app"),s.$pageview&&c.$os&&c.$is_first_day&&(r=!0,r?v="both":(r=!0,v="web"));var u=$(t.template({hasUtm:r}));u.modal(),u.on("shown.bs.modal",function(){$(".no-utm").attr("data-original-title","使用渠道对比功能需接入全埋点数据采集。").tooltip("destroy").tooltip()}),u.find(".nav-block").off("mouseover").on("mouseover",function(){$(this).hasClass("no-utm")||($(this).addClass("active").siblings().removeClass("active"),u.find("div.block-info").text(o[$(this).attr("nav")]))}),u.find(".nav-block").off("mouseout").on("mouseout",function(){$(this).removeClass("active").siblings().removeClass("active"),u.find("div.block-info").text(o.default)}),u.find(".nav-block").off("click").on("click",function(){if(!$(this).hasClass("no-utm")){u.modal("hide");var s=$(this).attr("nav"),t="/"+s+"/";return l[s]?void e.show(v,function(n){d.set(n,function(n){d.get(n.id,function(n){$.isFunction(a)&&a(n)})})}):void(n?i.nav(t,{from:"dashboard",action:"add",dashid:n}):i.nav(t))}})}});s.exports=c});
;/*!components/dashboardNoResult/dashboardNoResult.js*/
define("components/dashboardNoResult/dashboardNoResult",function(a,n){var e=a("components/dashboardCreateNav/dashboardCreateNav"),s=Handlebars.template({1:function(){return'    <button class="btn btn-primary" data-method="create"><span class="icon-add"></span>新建组件</button>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,n,e,s){var t;return'<div class="dashboard-no-result">\n  <div>\n    <div class="icon"><img src="/res/img/none-widget.png"></div>\n    <p class="msg">还未添加指标组件</p>\n'+(null!=(t=n.unless.call(a,null!=a?a.isShareDash:a,{name:"unless",hash:{},fn:this.program(1,s,0),inverse:this.noop,data:s}))?t:"")+"  </div>\n</div>"},useData:!0});n.create=function(a,n,t,o){var r=$(s({isShareDash:t})).appendTo(a);return r.find("[data-method=create]").click(function(){n?e.show(n,o):e.show(null,o)}),{destroy:function(){r.remove()}}}});
;/*!components/dashboardPerformanceConfigPanel/dashboardPerformanceConfigPanel.js*/
define("components/dashboardPerformanceConfigPanel/dashboardPerformanceConfigPanel",function(a,n,t){var i={template:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,n,t,i){var e,o=n.helperMissing,s="function",l=this.escapeExpression;return'<div class="modal fade modal-dashboard-performance-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">概览性能设置</h4>\n      </div>\n      <div class="info-container">\n        <p>选择合适的配置以提高概览的展现效率。</p>\n        <p>例如，对于数据量大且更关注数据趋势呈现的概览，可选择计算精度为“仅合计值近似”或“全部近似”。</p>\n        <p>设置只对本概览有效。</p>\n      </div>\n      <div class="modal-body">\n        <div class="config-item approx">\n          <div>计算精度</div>\n          <label class="common-radio">\n            <input data-tip="概览中所有数据完全精确计算" value="DISABLE" name="approx" type="radio"/>\n            <span class="radio-icon"></span>\n            完全精确\n          </label>\n          <label class="common-radio">\n            <input data-tip="对概览中所有去重数的合计值近似计算，其他数据精确计算" value="DASHBOARD_ROLLUP" name="approx" type="radio"/>\n            <span class="radio-icon"></span>\n            <span>仅合计值近似</span>\n          </label>\n          <label class="common-radio">\n            <input data-tip="对概览中所有去重数近似计算，其他数据精确计算" value="DASHBOARD_ALL" name="approx" type="radio"/>\n            <span class="radio-icon"></span>\n            <span>全部近似</span>\n          </label>\n          <div class="select"></div>\n        </div>\n        <div class="config-item policy">\n          <div>数据更新</div>\n          <label class="common-radio">\n            <input data-tip="实时" value="NORMAL" name="policy" type="radio"/>\n            <span class="radio-icon"></span>\n            <span>实时</span>\n          </label>\n          <label class="common-radio">\n            <input data-tip="每日 '+l((e=null!=(e=n.update_time||(null!=a?a.update_time:a))?e:o,typeof e===s?e.call(a,{name:"update_time",hash:{},data:i}):e))+' " value="FASTEST" name="policy" type="radio"/>\n            <span class="radio-icon"></span>\n             <span>每日 '+l((e=null!=(e=n.update_time||(null!=a?a.update_time:a))?e:o,typeof e===s?e.call(a,{name:"update_time",hash:{},data:i}):e))+'</span>\n          </label>\n          <div>数据<span class="select"></span>更新</div>\n        </div>\n        <div class="config-item sampling-factor">\n          <div>抽样系数</div>\n          <div class="sampling">\n            <div>\n              <span class="sampling-factor-label">全量<!--{en}Total--></span>\n              <input id="sampling-factor-slider" type="text" value="" style="display:none;width:100px;" data-slider-min="0" data-slider-max="6" data-slider-step="1" data-slider-value="" data-slider-orientation="0" data-slider-selection="after">\n            </div>\n          </div>\n          <div><span class="select"></span></div>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="pop-is-cancel btn btn-link btn-small" data-dismiss="modal">取消<!--{en}Cancel--></button>\n        <button type="button" class="pop-is-success btn btn-primary btn-small">确定<!--{en}Confirm--></button>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0})},e=$.extend(!0,{},sensorsdata.EventsModule,{show:function(a,n){var t=this,e=sensorsdata.cache.config,o="FAST"===e.dashboard_cache_policy?"NORMAL":e.dashboard_cache_policy;this.options=$.extend(!0,{approximate_policy:e.approximate_policy,dashboard_cache_policy:o,sampling_factor:e.sampling_factor,update_time:"定时"},a),$(".modal-dashboard-performance-config").remove();var s=$(i.template(this.options));s.attr("data-type","dashboardPerformanceConfig"),s.modal(),s.on("shown.bs.modal",function(){t.$container=$(".modal-dashboard-performance-config"),setTimeout(function(){t.initRadio(),t.initSampleSlider(),t.initEvents()},0)}),s.find("button.pop-is-success").unbind("click.confirm").bind("click.confirm",function(){n(t.options),s.modal("hide")}),s.on("hide.bs.modal",function(){s.off("hide.bs.modal")})},initRadio:function(){var a=this,n=this.$container.find('.approx input[type=radio][name="approx"][value="'+a.options.approximate_policy+'"]'),t=this.$container.find('.policy input[type=radio][name="policy"][value="'+a.options.dashboard_cache_policy+'"]');n.attr("checked","checked"),this.$container.find(".approx div.select").text(n.attr("data-tip")),t.attr("checked","checked"),this.$container.find(".policy span.select").text(t.attr("data-tip"))},initEvents:function(){var a=this;this.$container.find('.approx input[type=radio][name="approx"]').change(function(){a.options.approximate_policy=this.value,a.$container.find(".approx div.select").text($(this).attr("data-tip"))}),this.$container.find('.policy input[type=radio][name="policy"]').change(function(){a.options.dashboard_cache_policy=this.value,a.$container.find(".policy span.select").text($(this).attr("data-tip"))})},dealSamplingValue:function(a){return $.isNumeric(a)?(a=parseInt(a,10),Math.log(a)/Math.log(2)%1!==0?64:a>64?64:a):64},getSamplingValue:function(a){return(!$.isNumeric(a)||0>a||a>6)&&(a=parseInt(this.$container.find("#sampling-factor-slider").val(),10)),(0>a||a>6)&&(a=6),Math.pow(2,a)},initSampleSlider:function(){var a=this,n=this.options,t=n.sampling_factor,i=this.dealSamplingValue(t)||"",e="#sampling-factor-slider",o=this.$container.find(e),s=this.$container.find(".sampling-factor-label"),l=this.$container.find(".sampling-factor span.select");i=Math.log(i)/Math.log(2);var d=function(a){return a=parseInt(a)||64,64===a?sensorsdata.languages.get("全量<!--{en}Total-->"):"1/"+64/a},p=function(a){var n=sensorsdata.languages.get("对全量数据计算<!--{en}Total data calculation-->");return 64!==a&&(n=sensorsdata.util.format(sensorsdata.languages.get("对全量数据抽样1/#{value}计算<!--{en}1/#{value} random sample of total data calculation-->"),{value:64/a})),n},c=d(t);s.text(c),l.text(p(t)),o.val(i),this.samplingSlider_=new Slider(e,{value:i,tooltip:"hide",tooltip_position:"bottom",formatter:function(n){return 6===n?sensorsdata.languages.get("对全量数据计算<!--{en}Total data calculation-->"):(n=a.getSamplingValue(n),sensorsdata.util.format(sensorsdata.languages.get("对全量数据抽样1/#{value}计算<!--{en}1/#{value} random sample of total data calculation-->"),{value:64/n}))}}),sensorsdata.authority.isNormal&&this.samplingSlider_.disable(),this.$container.delegate(e,"change",function(){var n=a.getSamplingValue();a.options.sampling_factor=n,c=d(n),s.text(c),l.text(p(n))})}});t.exports=e});
;/*!components/dashboardsNav/dashboardsNav.js*/
define("components/dashboardsNav/dashboardsNav",function(e,a,n){var t=e("components/model/dashboards"),o=t.dashboardModel,s=t.dashboardsNavModel,r=!1,i=$.Deferred(),l=null,d={content:Handlebars.template({1:function(e,a,n,t,o,s){var r,i,l,d=a.helperMissing,p="function",u=this.escapeExpression,h='  <div class="default-group" data-id="'+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'">\n    <ul data-id="'+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'">\n';return i=null!=(i=a.dashboards||(null!=e?e.dashboards:e))?i:d,l={name:"dashboards",hash:{},fn:this.program(2,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.dashboards||(r=a.blockHelperMissing.call(e,r,l)),null!=r&&(h+=r),h+"    </ul>\n  </div>\n"},2:function(e,a,n,t,o,s){var r,i,l,d=a.helperMissing,p="function",u=this.escapeExpression,h=a.blockHelperMissing,c='      <li data-nav="/dashboard/#dashid='+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'" data-id="'+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'"';return i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(3,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=h.call(e,r,l)),null!=r&&(c+=r),c+='>\n        <a href="/dashboard/?project='+u(this.lambda(null!=s[2]?s[2].project:s[2],e))+"#dashid="+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'" data-href="/dashboard/#dashid='+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'" title="'+u((i=null!=(i=a.name||(null!=e?e.name:e))?i:d,typeof i===p?i.call(e,{name:"name",hash:{},data:t}):i))+'"><span class="',i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(5,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=h.call(e,r,l)),null!=r&&(c+=r),i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.noop,inverse:this.program(7,t,0,o,s),data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=h.call(e,r,l)),null!=r&&(c+=r),c+='"></span><span class="title">'+u((i=null!=(i=a.name||(null!=e?e.name:e))?i:d,typeof i===p?i.call(e,{name:"name",hash:{},data:t}):i)),i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(9,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=h.call(e,r,l)),null!=r&&(c+=r),c+"</span></a>\n      </li>\n"},3:function(){return' data-share="true"'},5:function(){return"icon-dashboard-share"},7:function(){return"icon-overview"},9:function(e,a,n,t){var o;return" <i>("+this.escapeExpression((o=null!=(o=a.username||(null!=e?e.username:e))?o:a.helperMissing,"function"==typeof o?o.call(e,{name:"username",hash:{},data:t}):o))+")</i>"},11:function(e,a,n,t,o,s){var r,i,l,d=a.helperMissing,p="function",u=a.blockHelperMissing,h=this.escapeExpression,c='    <div class="group';return i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(12,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=u.call(e,r,l)),null!=r&&(c+=r),c+=' onoff-off" data-status="off" data-id="'+h((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'">\n      ',i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(14,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=u.call(e,r,l)),null!=r&&(c+=r),c+="\n      <h5>\n",i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(16,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=u.call(e,r,l)),null!=r&&(c+=r),i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.noop,inverse:this.program(18,t,0,o,s),data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=u.call(e,r,l)),null!=r&&(c+=r),c+='        <span class="title">'+h((i=null!=(i=a.title||(null!=e?e.title:e))?i:d,typeof i===p?i.call(e,{name:"title",hash:{},data:t}):i))+"</span>\n",i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.noop,inverse:this.program(20,t,0,o,s),data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=u.call(e,r,l)),null!=r&&(c+=r),c+='        <span class="action-onoff" data-method="expandGroup" data-id="'+h((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'">\n          <span class="icon-collapse-up"></span>\n          <span class="icon-expand-down"></span>\n        </span>\n      </h5>\n      <ul data-id="'+h((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'">\n',i=null!=(i=a.dashboards||(null!=e?e.dashboards:e))?i:d,l={name:"dashboards",hash:{},fn:this.program(22,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.dashboards||(r=u.call(e,r,l)),null!=r&&(c+=r),c+"      </ul>\n    </div>\n"},12:function(){return" group-share"},14:function(){return'<div class="extra"></div>'},16:function(){return'        <span class="icon-share"></span>\n'},18:function(){return'        <span class="icon-folder"></span>\n'},20:function(e,a,n,t){var o,s=a.helperMissing,r="function",i=this.escapeExpression;return'        <span class="icon-edit" data-method="editGroup" data-id="'+i((o=null!=(o=a.id||(null!=e?e.id:e))?o:s,typeof o===r?o.call(e,{name:"id",hash:{},data:t}):o))+'" data-title="'+i((o=null!=(o=a.title||(null!=e?e.title:e))?o:s,typeof o===r?o.call(e,{name:"title",hash:{},data:t}):o))+'"></span>\n'},22:function(e,a,n,t,o,s){var r,i,l,d=a.helperMissing,p="function",u=this.escapeExpression,h=a.blockHelperMissing,c='        <li data-nav="/dashboard/#dashid='+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'" data-id="'+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'"';return i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(3,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=h.call(e,r,l)),null!=r&&(c+=r),c+='>\n          <a href="/dashboard/?project='+u(this.lambda(null!=s[2]?s[2].project:s[2],e))+"#dashid="+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'" data-href="/dashboard/#dashid='+u((i=null!=(i=a.id||(null!=e?e.id:e))?i:d,typeof i===p?i.call(e,{name:"id",hash:{},data:t}):i))+'" title="'+u((i=null!=(i=a.name||(null!=e?e.name:e))?i:d,typeof i===p?i.call(e,{name:"name",hash:{},data:t}):i)),i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(23,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=h.call(e,r,l)),null!=r&&(c+=r),c+='"><span class="',i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(5,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=h.call(e,r,l)),null!=r&&(c+=r),i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.noop,inverse:this.program(7,t,0,o,s),data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=h.call(e,r,l)),null!=r&&(c+=r),c+='"></span><span class="title">'+u((i=null!=(i=a.name||(null!=e?e.name:e))?i:d,typeof i===p?i.call(e,{name:"name",hash:{},data:t}):i)),i=null!=(i=a.isShare||(null!=e?e.isShare:e))?i:d,l={name:"isShare",hash:{},fn:this.program(9,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.isShare||(r=h.call(e,r,l)),null!=r&&(c+=r),c+"</span></a>\n        </li>\n"},23:function(e,a,n,t){var o;return" ("+this.escapeExpression((o=null!=(o=a.username||(null!=e?e.username:e))?o:a.helperMissing,"function"==typeof o?o.call(e,{name:"username",hash:{},data:t}):o))+")"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,n,t,o,s){var r,i,l,d=a.helperMissing,p="function",u=a.blockHelperMissing,h="";return i=null!=(i=a.default_group||(null!=e?e.default_group:e))?i:d,l={name:"default_group",hash:{},fn:this.program(1,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.default_group||(r=u.call(e,r,l)),null!=r&&(h+=r),h+='<div class="groups">\n',i=null!=(i=a.groups||(null!=e?e.groups:e))?i:d,l={name:"groups",hash:{},fn:this.program(11,t,0,o,s),inverse:this.noop,data:t},r=typeof i===p?i.call(e,l):i,a.groups||(r=u.call(e,r,l)),null!=r&&(h+=r),h+"</div>"},useData:!0,useDepths:!0}),popover:{create:Handlebars.template({1:function(){return"分组名称"},3:function(){return"概览名称"},5:function(){return"请输入分组名称"},7:function(){return"请输入数据概览名称"},9:function(){return"Please input group name"},11:function(){return"please input dashboard name"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,n,t){var o,s,r,i=a.helperMissing,l="function",d=a.blockHelperMissing,p="<p>";return s=null!=(s=a.isGroup||(null!=e?e.isGroup:e))?s:i,r={name:"isGroup",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t},o=typeof s===l?s.call(e,r):s,a.isGroup||(o=d.call(e,o,r)),null!=o&&(p+=o),s=null!=(s=a.isGroup||(null!=e?e.isGroup:e))?s:i,r={name:"isGroup",hash:{},fn:this.noop,inverse:this.program(3,t,0),data:t},o=typeof s===l?s.call(e,r):s,a.isGroup||(o=d.call(e,o,r)),null!=o&&(p+=o),p+='<!--{en}Name:--></p>\n<input type="text" name="name" value="" placeholder="',s=null!=(s=a.isGroup||(null!=e?e.isGroup:e))?s:i,r={name:"isGroup",hash:{},fn:this.program(5,t,0),inverse:this.noop,data:t},o=typeof s===l?s.call(e,r):s,a.isGroup||(o=d.call(e,o,r)),null!=o&&(p+=o),s=null!=(s=a.isGroup||(null!=e?e.isGroup:e))?s:i,r={name:"isGroup",hash:{},fn:this.noop,inverse:this.program(7,t,0),data:t},o=typeof s===l?s.call(e,r):s,a.isGroup||(o=d.call(e,o,r)),null!=o&&(p+=o),p+='" data-lang-placeholder="<!--{en}',s=null!=(s=a.isGroup||(null!=e?e.isGroup:e))?s:i,r={name:"isGroup",hash:{},fn:this.program(9,t,0),inverse:this.noop,data:t},o=typeof s===l?s.call(e,r):s,a.isGroup||(o=d.call(e,o,r)),null!=o&&(p+=o),s=null!=(s=a.isGroup||(null!=e?e.isGroup:e))?s:i,r={name:"isGroup",hash:{},fn:this.noop,inverse:this.program(11,t,0),data:t},o=typeof s===l?s.call(e,r):s,a.isGroup||(o=d.call(e,o,r)),null!=o&&(p+=o),p+'-->" autocomplete="off">\n'},useData:!0}),editGroup:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,n,t){var o;return'<div class="popover-group-edit">\n  <span>名称：<!--{en}Name:--></span><input type="text" name="name" value="'+this.escapeExpression((o=null!=(o=a.title||(null!=e?e.title:e))?o:a.helperMissing,"function"==typeof o?o.call(e,{name:"title",hash:{},data:t}):o))+'" placeholder="请输入分组名称" data-lang-placeholder="<!--{en}Please input cluster name-->" autocomplete="off" />\n</div>\n<div class="popover-group-delete" style="display:none">\n  <p style="width:160px;margin:0;">确认删除吗？<!--{todo}--></span>\n  <p style="margin:0;color:#B2B0BB;font-size:13px;" class="popover-group-delete-tip">自己创建的概览可被删除，他人共享的概览不可删除<!--{todo}--></p>\n</div>'},useData:!0}),footCreate:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return""},useData:!0}),footEditGroup:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,n,t){var o,s=a.helperMissing,r="function",i=this.escapeExpression;return'<div class="popover-group-edit">\n  <div class="popover-footer-left">\n    <button type="button" class="btn-delete btn btn-red pop-is-delete" data-id="'+i((o=null!=(o=a.id||(null!=e?e.id:e))?o:s,typeof o===r?o.call(e,{name:"id",hash:{},data:t}):o))+'">\n      <span class="glyphicon glyphicon-trash"></span><span>删除<!--{en}Delete--></span>\n    </button>\n  </div>\n  <div class="popover-footer-right">\n    <button type="button" class="pop-is-cancel btn btn-link btn-small">取消<!--{en}Cancel--></button>\n    <button type="button" class="pop-is-success btn btn-primary btn-small" data-id="'+i((o=null!=(o=a.id||(null!=e?e.id:e))?o:s,typeof o===r?o.call(e,{name:"id",hash:{},data:t}):o))+'">保存<!--{en}Save--></button>\n  </div>\n</div>\n<div class="popover-group-delete" style="display:none">\n  <div class="popover-footer-right">\n    <button type="button" class="pop-is-cancel btn btn-link btn-small">取消<!--{en}Cancel--></button>\n    <button type="button" class="btn btn-primary btn-small btn-delete-all" style="margin-right:7px;">删除分组和概览<!--{en}Delete the group and dashboard--></button>\n    <button type="button" class="btn btn-primary btn-small btn-delete-group">删除分组，保留概览<!--{en}Delete the group, save the dashboard--></button>\n    <button type="button" class="btn btn-primary btn-small btn-delete-empty" style="display:none">确认<!--{en}OK--></button>\n  </div>\n</div>'},useData:!0}),menu:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,n,t){var o,s=a.helperMissing,r="function",i=this.escapeExpression;return'<ul id="popoverMenu">\n  <li class="icon-overview" data-method="addDashboard" data-status="on">'+i((o=null!=(o=a.newOverView||(null!=e?e.newOverView:e))?o:s,typeof o===r?o.call(e,{name:"newOverView",hash:{},data:t}):o))+'</li>\n  <li class="icon-folder" data-method="addGroup" data-status="on">'+i((o=null!=(o=a.newClustering||(null!=e?e.newClustering:e))?o:s,typeof o===r?o.call(e,{name:"newClustering",hash:{},data:t}):o))+"</li>\n</ul>"},useData:!0}),menuTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover popover-customize-position" role="tooltip">\n  <div class="popover-content" id="popover-menu-content"></div>\n</div>'},useData:!0}),createTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover popover-customize-position popover-customize-create" role="tooltip">\n  <h3 class="popover-title" id="popover-create-title"></h3>\n  <div class="popover-content" id="popover-create-content"></div>\n  <div class="popover-footer-right">\n    <button type="button" class="pop-is-cancel btn btn-link btn-small">取 消<!--{en}Cancel--></button>\n    <button type="button" class="pop-is-success btn btn-primary btn-small">创 建<!--{en}Create--></button>\n  </div>\n</div>'},useData:!0})}},p={init:function(){return r?void 0:(r=!0,this.$container=$("#dashboardsNav"),this.$bd=this.$container.find(".bd"),this.loadData(),this.bindEvents(),i)},loadData:function(){var e=this;s.getFull(function(a){l=a,e.render(),i.resolve()})},render:function(){this.destorySortable();var e=sensorsdata.cache.project&&sensorsdata.cache.project.name;l.project=e,l.groups=(l.groups||[]).map(function(e){return 999999===e.id&&(e.title=sensorsdata.languages.get("分享给我的概览<!--{en}Shared Dashboard-->")),e}),this.$bd.html(d.content(l)),this.createSortable();var a=sensorsdata.unparam(location.hash).dashid;a&&this.setAction(Number(a))},destorySortable:function(){this.sortables&&(this.sortables.groups.forEach(function(e){e.destroy()}),this.sortables.groupsList.destroy(),this.sortables=null)},createSortable:function(){var e=this,a=this.sortables={groups:[],groupsMap:{}},n=this.$bd.find(".default-group, .group"),t=[],o=0,s=function(){2===++o&&(e.updateOrders("dashboard"),o=0)};n.each(function(e,a){t.push(a.getAttribute("data-id"))}),n.each(function(n,o){var r=$.extend(!0,[],t),i=o.getAttribute("data-id");r.splice(r.indexOf(i),1),a.groups.push(a.groupsMap[i]=Sortable.create($(o).find("ul")[0],{group:{name:i,put:r},animation:200,onStart:function(a){e.$bd.addClass("dragging"),a.item.getAttribute("data-share")||e.$bd.find(".group-share").addClass("disabled")},onEnd:function(a){e.$bd.removeClass("dragging"),a.item.getAttribute("data-share")||e.$bd.find(".group-share").removeClass("disabled")},onUpdate:function(){e.updateOrders("dashboard")},onAdd:s,onRemove:s,onMove:function(a){var n=$(a.to).parent();"off"===n.attr("data-status")&&e.expandGroup(n.attr("data-id"))}}))}),a.groupsList=Sortable.create(this.$bd.find(".groups")[0],{raggable:".group",animation:200,onUpdate:function(){e.updateOrders("group")}})},updateOrders:function(){if(this.sortables){var e=this;this.waitingUpdateOrders=!0,sensorsdata.deferManager.add({name:"dashboardsNavUpdateOrders",time:5e3,method:function(){e.waitingUpdateOrders&&(e.updateOrdersProxy(),e.waitingUpdateOrders=!1)}})}},updateOrdersProxy:function(e){var a={};if(e&&"group"!==e||(a.groupOrders=this.sortables.groupsList.toArray().map(function(e){return Number(e)})),!e||"dashboard"===e){var n=a.dashboardsOrders={},t=this.sortables.groupsMap;for(var o in t)t.hasOwnProperty(o)&&(n[o]=t[o].toArray().map(function(e){return Number(e)}))}s.updateOrders(a)},bindEvents:function(){var e=this;this.$container.delegate("[data-method]","click",function(a){a.preventDefault(),e.handleUIAction(this)}),this.$container.mouseleave(sensorsdata.bind(this.mouseleaveHandle,this)),s.on("update",sensorsdata.bind(this.handleModelAction,this))},handleUIAction:function(e){var a=e.getAttribute("data-method");switch(a){case"showMenu":this.showMenu(e);break;case"editGroup":this.editGroupHandle(e);break;case"expandGroup":this.expandGroupHandle(e)}},showMenu:function(e){var a=this,n=this.scrollToHide;sensorsdata.popover({ele:$(e),showNow:!0,placement:"bottom",template:d.popover.menuTpl(),content:d.popover.menu({newOverView:sensorsdata.languages.get("新建概览<!--{en}New Dashboard-->"),newClustering:sensorsdata.languages.get("新建分组<!--{en}New Folder-->")}),container:"#sa_sidebar",onShow:function(e){e.$tip.find("#popover-menu-content li[data-method]").unbind("click").bind("click",function(){var n=$(this).attr("data-method");"addGroup"===n?(e.$tip.popover("hide"),a.addHandle("group",this)):"addDashboard"===n&&(e.$tip.popover("hide"),a.addHandle("dashboard",this))}),n(e,[$(window),$("#sa_sidebar").children(".sa-sidebar-scroll-wrap")])}})},addHandle:function(e,a){var n=this,t=this.scrollToHide;a.removeAttribute("data-method"),sensorsdata.popover({ele:$(a),showNow:!0,placement:"bottom",title:sensorsdata.languages.get("group"===e?"新建分组<!--{en}Create new group-->":"新建概览<!--{en}Create New Dashboard-->"),template:d.popover.createTpl(),content:d.popover.create({isGroup:"group"===e?!0:!1}),container:"#sa_sidebar",footer:d.popover.footCreate(),beforeShow:function(e){var a='<span id="return-btn" class="icon-arrow-left" data-method="return-btn"></span>';e.find(".popover-title").css("text-align","center").before(a),e.find(".arrow").hide()},onShow:function(a){var o=a.$tip.find("input[name=name]"),s=a.$tip.find('#return-btn[data-method="return-btn"]');sensorsdata.form.removeChildrenError(a.$tip),o.focus(),a.$tip.find(".pop-is-success").unbind("click").bind("click",function(){var t=$.trim(o.val());return t?void n["group"===e?"addGroup":"addDashboard"](t,o,function(){a.hide()}):void sensorsdata.form.addError(o,o.attr("placeholder"),!0,{container:a.$tip,placement:"top"})}),s.unbind("click").bind("click",function(){a.$tip.popover("hide"),$('section#dashboardsNav [data-method="showMenu"]').click()}),t(a,[$(window),$("#sa_sidebar").children(".sa-sidebar-scroll-wrap")])}})},addGroup:function(e,a,n){var t=this.$bd.find(".default-group li.active, .group li.active").parent().attr("data-id");s.add(e,t&&Number(t),function(t){return t&&t.error?(sensorsdata.error.show(t.error),a.focus(),void(a[0].setSelectionRange&&a[0].setSelectionRange(-1,-1))):("function"==typeof n&&n(),void sensorsdata.track("create_dashboard_group",{dashboard_group_title:e}))})},addDashboard:function(e,a,n){o.add({name:e},function(e){return e&&e.error?(sensorsdata.error.show(e.error),a.focus(),void(a[0].setSelectionRange&&a[0].setSelectionRange(-1,-1))):void("function"==typeof n&&n())})},editGroupHandle:function(e){var a=this,n=this.scrollToHide,t=Number(e.getAttribute("data-id"));e.removeAttribute("data-method"),sensorsdata.popover({ele:$(e),showNow:!0,title:sensorsdata.languages.get("编辑分组<!--{en}Edit group-->"),placement:"bottom",container:"#dashboardsNav",content:d.popover.editGroup({title:e.getAttribute("data-title")}),footer:d.popover.footEditGroup({id:t}),beforeShow:function(a){a.find("h3").show(),a.find(".arrow").css("left",109),a.find(".popover-content .popover-group-edit").show(),a.find(".popover-content .popover-group-delete").hide(),a.find(".popover-content-footer .popover-group-edit").show(),a.find(".popover-content-footer .popover-group-delete").hide(),$(e).css("display","block")},onShow:function(o){var r=o.$tip,i=r.find("input[name=name]"),l=a.$bd.find("ul[data-id="+t+"] li").length>0;i.focus(),i[0].setSelectionRange&&i[0].setSelectionRange(-1,-1),sensorsdata.form.removeChildrenError(r),r.find(".popover-group-edit .pop-is-success").unbind("click").bind("click",function(){var e=$.trim(i.val());return e?void a.editGroup(t,e,i,function(){o.hide()}):void sensorsdata.form.addError(i,i.attr("placeholder"),!0,{container:r,placement:"top"})}),r.find(".popover-group-edit .pop-is-delete").unbind("click").bind("click",function(){var e=r.find(".popover-content-footer");r.find("h3").hide(),r.find(".arrow").css("left",109),r.find(".popover-content .popover-group-edit").hide(),r.find(".popover-content .popover-group-delete").show(),r.find(".popover-content-footer .popover-group-edit").hide(),r.find(".popover-content-footer .popover-group-delete").show(),r.find(".popover-content .popover-group-delete .popover-group-delete-tip")[l?"show":"hide"](),e.find(".btn-delete-all, .btn-delete-group")[l?"show":"hide"](),e.find(".btn-delete-empty")[l?"hide":"show"]()}),r.find(".popover-group-delete .btn-delete-all").unbind("click").bind("click",function(){s.del(t,!0),o.hide()}),r.find(".popover-group-delete .btn-delete-group, .popover-group-delete .btn-delete-empty").unbind("click").bind("click",function(){s.del(t),o.hide()}),n(o,[$(window),$("#sa_sidebar").children(".sa-sidebar-scroll-wrap")],function(){$(e).css("display","none")}),$(e).off("hide.bs.popover.edit").on("hide.bs.popover.edit",function(){$(e).css("display","none")})}})},editGroup:function(e,a,n,t){var o=this.$bd.find(".group[data-id="+e+"]");return o.find("h5 .title").text()===a?void("function"==typeof t&&t()):void s.update(e,a,function(e){return e.error?(sensorsdata.error.show(e.error),n.focus(),void(n[0].setSelectionRange&&n[0].setSelectionRange(-1,-1))):void("function"==typeof t&&t())})},expandGroupHandle:function(e){this.expandGroup(e.getAttribute("data-id"))},expandGroup:function(e){var a=this.$bd.find(".group[data-id="+e+"]"),n="on"===a.attr("data-status")?"off":"on";a.removeClass("onoff-on, onoff-off").addClass("onoff-"+n).attr("data-status",n);var t=this;this.queueExpandGroups=this.queueExpandGroups||[],this.queueExpandGroups.push([e,n]),sensorsdata.deferManager.add({name:"dashboardsNavExpandGroup",time:5e3,method:function(){t.queueExpandGroups.length&&(s.setGroupExpand($.extend(!0,[],t.queueExpandGroups)),t.queueExpandGroups.length=0)}})},mouseleaveHandle:function(){this.queueExpandGroups&&this.queueExpandGroups.length&&(sensorsdata.deferManager.remove("dashboardsNavExpandGroup"),s.setGroupExpand($.extend(!0,[],this.queueExpandGroups)),this.queueExpandGroups.length=0),this.waitingUpdateOrders&&(this.waitingUpdateOrders=!1,this.updateOrdersProxy())},handleModelAction:function(e){switch(e.action){case"add":this.addGroupHandle(e);break;case"del":this.deleteGroupHandle(e);break;case"update":this.updateGroupHandle(e);break;case"addDashboard":this.addDashboardHandle(e);break;case"deleteDashboard":this.deleteDashboardHandle(e);break;case"updateDashboard":this.updateDashboardHandle(e)}},addGroupHandle:function(e){l=e.data,this.render()},deleteGroupHandle:function(e){var a=Number(this.$bd.find("li.active").attr("data-id"));l=e.data,this.render(),a&&(this.$bd.find("li[data-id="+a+"]").length?this.setAction(a):this.selectFirstDashboard())},updateGroupHandle:function(e){l=e.data,this.render()},addDashboardHandle:function(e){l=e.data,this.render(),this.$bd.find("li[data-id="+e.dashboard.id+"]").click()},deleteDashboardHandle:function(e){var a=Number(this.$bd.find("li.active").attr("data-id"));l=e.data,this.render(),a&&e.dashboard.id===a&&this.selectFirstDashboard()},updateDashboardHandle:function(e){var a=e.dashboard;this.$bd.find("li[data-id="+a.id+"] .title").text(a.name),l=e.data},setAction:function(e){var a=this.$bd.find("li.active");if(Number(a.attr("data-id"))!==e){var n=this.$bd.find("li[data-id="+e+"]"),t=n.parents(".group");"off"===t.attr("data-status")&&this.expandGroup(t.attr("data-id")),a.removeClass("active"),n.addClass("active")}},selectFirstDashboard:function(){var e=this.$bd.find("li").eq(0);if(e.length){var a=e.parents(".group");"off"===a.attr("data-status")&&this.expandGroup(a.attr("data-id")),e.click()}else $("#sa_sidebar li[data-nav]").eq(0).click()},scrollToHide:function(e,a,n){e&&$.isArray(a)&&0!==a.length&&($.each(a,function(){$(this).off("scroll.hide-popover").on("scroll.hide-popover",function(){e.$tip.popover("hide"),$(this).off("scroll.hide-popover"),n&&n()})}),e.$element.unbind("hidden.bs.popover").bind("hidden.bs.popover",function(){$.each(a,function(){$(this).off("scroll.hide-popover")})}))}};n.exports=p});
;/*!components/dashboardTopbar/dashboardTopbar.js*/
define("components/dashboardTopbar/dashboardTopbar",function(a,n){function t(a){this.options=a,this.init()}var e=a("components/model/dashboards").dashboardModel,o=a("components/dashboardCreateNav/dashboardCreateNav"),i=a("components/dashboardPerformanceConfigPanel/dashboardPerformanceConfigPanel"),s=a("components/util/util"),d={dashboardTopbarTpl:Handlebars.template({1:function(){return'  <span class="icon-edit not-match-authority" data-method="edit-focus"></span>\n  <div class="pull-right">\n    <div class="date-content">\n      <div class="dashboard-date-picker-wrap">\n        <span class="icon-date-picker"></span>\n        <input type="text" class="inputDate input-date-picker" readonly="readonly"\n          data-placement="top" data-container="body" title="时间范围" data-lang-title="<!--{en}Time range-->">\n      </div>\n      <div class="dropdown selector" style="display:none">\n        <button type="button" class="dashboard-unit btn btn-default btn-selector dropdown-toggle" data-toggle="dropdown" data-value="">\n          <span class="selected" data-value="">默认<!--{en}Default--></span>\n        </button>\n        <ul class="dropdown-menu pull-right" role="menu">\n          <li><a data-value="">默认<!--{en}Default--></a></li>\n          <li><a data-value="rollup">合计<!--{en}Total--></a></li>\n          <li><a data-value="minute">分钟<!--{en}Minute--></a></li>\n          <li><a data-value="hour">小时<!--{en}Hour--></a></li>\n          <li><a data-value="day">天<!--{en}Day--></a></li>\n          <li><a data-value="week">周<!--{en}Week--></a></li>\n          <li><a data-value="month">月<!--{en}Month--></a></li>\n        </ul>\n      </div>\n      <span class="icon-remove" data-method="remove-date"></span>\n    </div>\n    <div class="btn-group right-btn">\n      <button class="my_dashboard_date_btn btn btn-default btn-icon">\n        <span class="icon-date-picker"></span>\n      </button>\n    </div>\n    <div class="method-group">\n      <div data-method="refresh" class="dashboard_refresh_btn">\n        <span data-toggle="tooltip" title="点击按钮，刷新概览中失效数据，按住 shift 点击，刷新全部数据" data-placement="bottom" class="icon-refresh"></span>\n      </div>\n      <div data-method="dashboardEmaile" class="dashboard-email not-match-authority">\n        <span class="icon-envelope"></span>\n      </div>\n      <div class="dropdown dashboard-setting not-match-authority">\n        <span data-method="dashboardSetting" class="dropdown-toggle icon-setting" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"></span>\n        <ul class="dropdown-menu">\n          <li data-method="set" class=""><a>性能设置<!--{en}Setting--></a></li>\n          <li data-method="del" class=""><a>删除概览<!--{en}Delete--></a></li>\n        </ul>\n      </div>\n    </div>\n    <div class="btn-group not-match-authority">\n      <button class="dashboard-add btn btn-default btn-icon">\n        <span class="icon-add"></span>\n      </button>\n    </div>\n  </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,n,t,e){var o,i,s=n.helperMissing,d="function",r=this.escapeExpression;return'<div class="dashboard-toolbar">\n  <span contenteditable="false" class="dashboard-name" data-originName="'+r((i=null!=(i=n.name||(null!=a?a.name:a))?i:s,typeof i===d?i.call(a,{name:"name",hash:{},data:e}):i))+'">'+r((i=null!=(i=n.name||(null!=a?a.name:a))?i:s,typeof i===d?i.call(a,{name:"name",hash:{},data:e}):i))+"</span>\n"+(null!=(o=n.unless.call(a,null!=a?a.isEmail_:a,{name:"unless",hash:{},fn:this.program(1,e,0),inverse:this.noop,data:e}))?o:"")+'  <div class="dashboard-indicators-list">\n    <div class="menu-content"></div>\n    <div class="bookmark-list-content"></div>\n  </div>\n</div>\n'},useData:!0}),addDashboard:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="add-by-bookmark"><span class="icon-faved"></span>从书签添加<span class="icon-arrow-right"></span></div>\n<div class="add-new-widget"><span class="icon-add"></span>新建组件</div>\n'},useData:!0}),bookmarkList:Handlebars.template({1:function(){return'  <div class="dashboard-no-item">\n    <div class="icon"><img src="/res/img/none-widget.png"></div>\n    <p>暂无书签<!--{en}No bookmark--></p>\n    <p>先将分析模型保存为书签<!--{en}Save the analysis model as a bookmark--></p>\n  </div>\n'},3:function(a,n,t,e){var o,i,s,d=n.helperMissing,r="function",l='  <div class="header">'+this.escapeExpression((i=null!=(i=n.glistType||(null!=a?a.glistType:a))?i:d,typeof i===r?i.call(a,{name:"glistType",hash:{},data:e}):i))+"</div>\n";return i=null!=(i=n.glistRows||(null!=a?a.glistRows:a))?i:d,s={name:"glistRows",hash:{},fn:this.program(4,e,0),inverse:this.noop,data:e},o=typeof i===r?i.call(a,s):i,n.glistRows||(o=n.blockHelperMissing.call(a,o,s)),null!=o&&(l+=o),l},4:function(a,n,t,e){var o,i=n.helperMissing,s="function",d=this.escapeExpression;return'  <div class="add-item" data-bookmarkid="'+d((o=null!=(o=n.id||(null!=a?a.id:a))?o:i,typeof o===s?o.call(a,{name:"id",hash:{},data:e}):o))+'">\n    <!-- <button class="icon-add pull-right btn"></button> -->\n    <div class="content">\n      <div class="item-title" title="'+d((o=null!=(o=n.name||(null!=a?a.name:a))?o:i,typeof o===s?o.call(a,{name:"name",hash:{},data:e}):o))+'">'+d((o=null!=(o=n.name||(null!=a?a.name:a))?o:i,typeof o===s?o.call(a,{name:"name",hash:{},data:e}):o))+'</div>\n      <div class="item-saved-time">'+d((o=null!=(o=n.timeFix||(null!=a?a.timeFix:a))?o:i,typeof o===s?o.call(a,{name:"timeFix",hash:{},data:e}):o))+"</div>\n    </div>\n  </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,n,t,e){var o,i,s,d=n.helperMissing,r="function",l=n.blockHelperMissing,c='<div class="dashboard-add-bookmark">\n  <div class="dashboard-bookmark-title">\n    <span class="icon-arrow-left"></span>\n    <div>选择书签</div>\n  </div>\n  <div class="mod-bd">\n';return i=null!=(i=n.glist||(null!=a?a.glist:a))?i:d,s={name:"glist",hash:{},fn:this.noop,inverse:this.program(1,e,0),data:e},o=typeof i===r?i.call(a,s):i,n.glist||(o=l.call(a,o,s)),null!=o&&(c+=o),i=null!=(i=n.glist||(null!=a?a.glist:a))?i:d,s={name:"glist",hash:{},fn:this.program(3,e,0),inverse:this.noop,data:e},o=typeof i===r?i.call(a,s):i,n.glist||(o=l.call(a,o,s)),null!=o&&(c+=o),c+"  </div>\n</div>"},useData:!0}),del:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="popover">\n    <div class="arrow"></div>\n    <h2 class="popover-title"></h2>\n    <div class="popover-content"></div>\n    <div class="popover-content-footer clearfix">\n      <div class="popover-footer-right">\n        <button type="button" class="pop-is-cancel btn-link">取消<!--{en}Cancel--></button>\n        <button type="button" class="pop-is-success btn btn-primary">确定<!--{en}Ok--></button>\n      </div>\n    </div>\n  </div>'},useData:!0})};t.prototype=$.extend({},sensorsdata.EventsModule,{timeFormat:sensorsdata.CONSTSET.dateFormat,init:function(){var a=this;e.getItem(parseInt(a.options.id,10),function(n){a.options.placeholder.replaceWith(d.dashboardTopbarTpl($.extend(!0,{},n,{isEmail_:!!a.options.isEmail_}))),a.name=n.name}),this.$container=$(".dashboard-toolbar"),this.$container.find(".date-content").hide(),this.initDateInput(),this.initEvents(),this.setContainWidget(),this.setShare(!0),this.checkDefaultDashboardConfig()},initDateInput:function(){var a={startDate:moment(sensorsdata.getBeginDate("week"),this.timeFormat),endDate:moment(moment(),this.timeFormat),showCompare:!1,chosenLabel:"",className:"dashboard-topbar-daterangepicker",allowRelative:!0};sensorsdata.initDateRangeInput(this.$container.find(".inputDate"),a)},initEvents:function(){var a=this;this.$container.find('[data-toggle="tooltip"]').tooltip(),this.$container.delegate('[data-method="dashboardSetting"]',"click.toggle",function(){$(this).data("bs.popover")&&$(this).popover("destroy"),a.bookmarksPopupShown&&(a.$container.find(".dashboard-indicators-list").hide(),a.bookmarksPopupShown=!1)}),this.$container.delegate("[data-method]","click.method",function(n){var t=$(this).attr("data-method");switch(t){case"edit-focus":$(this).hide();var o=a.$container.find(".dashboard-name");if(o.attr("contenteditable",!0),!o.length)return;if(o[0].focus(),o.scrollLeft(9999),window.getSelection){var r=window.getSelection();r.selectAllChildren(o[0]),r.collapseToEnd()}break;case"refresh":n.shiftKey?a.options.onDeepRefresh():a.options.onPolicyRefresh({dashboard_cache_policy:"NORMAL"}),sensorsdata.track("dashboard_refresh");break;case"dashboardEmaile":var l=new sensorsdata.DashboardEmailConfig(a.options.id);l.modal();break;case"set":var c=a.options.dashboardConfig;i.show(c,function(n){s.json.stringify(n)!==s.json.stringify(a.options.dashboardConfig)&&(a.options.dashboardConfig=n,e.update(parseInt(a.options.id,10),{config:s.json.stringify(n)},!0,function(){a.checkDefaultDashboardConfig(),a.options.onRefresh()}))});break;case"del":sensorsdata.popover({ele:a.$container.find('[data-method="dashboardSetting"]'),container:a.$container,placement:"bottom",showNow:!0,template:d.del(),content:sensorsdata.languages.get("确定删除吗?<!--{en}Are you sure to delete it?-->"),successAfter:function(){e.del(parseInt(a.options.id,10),!0,function(a){console.log("删除概览成功",a)})}})}}),this.$container.delegate(".dashboard-name","keydown",function(a){var n=$(this),t=Number(a.keyCode);return 13===t?(n.blur(),!1):27===t?(n.text(n.attr("data-originName")),n.blur(),!1):void 0}),this.$container.find(".dashboard-name").on("blur",function(n){if(27!==n.keyCode){var t=$(this),o=t.text().trim();if(a.$container.find('[data-method="edit-focus"]').show(),!o)return t.text(t.attr("data-originName")),sensorsdata.info.show(sensorsdata.languages.get("请输入概览名称<!--{en}Please input the dashboard name-->"));t.attr("data-originName",t.text()),t.attr("contenteditable",!1),e.update(parseInt(a.options.id,10),{name:o},!0,function(a){console.log("修改概览名称成功",a)})}}),e.on("update",function(n){if(n&&"update"===n.action){var t=n.dashboard.name;a.$container.find(".dashboard-name").text(t)}}),this.$container.find('[data-method="remove-date"]').on("click",function(){a.$container.find(".date-content").hide(),a.$container.find(".my_dashboard_date_btn").removeAttr("disabled"),a.isSet&&(a.isSet=!1,a.options.onRemoveConfig())}),this.$container.find(".my_dashboard_date_btn").on("click",function(){a.$container.find(".date-content").show(),a.$container.find(".inputDate").val("请选择临时时间范围").trigger("click"),$(this).attr("disabled","disabled")});var n=this.$container.find(".inputDate");n.unbind("apply.daterangepicker").bind("apply.daterangepicker",function(){var t=n.data("startDate").format(a.timeFormat),e=n.data("endDate").format(a.timeFormat);return a.isSet=!0,a.options.onSetTime({widgetTime:{from_date:t,to_date:e,relativeValue:n.data("relativeValue")}}),!1}),this.$container.find(".dashboard-unit").saDropdown({value:"",onSelected:function(n){a.isSet=!0,a.options.onSetTime({widgetUnit:n})}}),this.$container.find(".dashboard-add").off("click").bind("click",function(){var n=a.$container.find(".dashboard-indicators-list");if(a.bookmarksPopupShown)return n.hide(),void(a.bookmarksPopupShown=!1);var t=a.$container.find(".dashboard-indicators-list .menu-content"),e=a.$container.find(".dashboard-indicators-list .bookmark-list-content");t.html(d.addDashboard()).show(),e.hide(),sensorsdata.showFloatLayer({floatEle:n,clickEleBtn:a.$container.find(".dashboard-add"),onLoad:function(){n.show(),a.bookmarksPopupShown=!0},onClose:function(){n.hide(),a.bookmarksPopupShown=!1}})}),this.$container.delegate(".add-new-widget","click",function(){o.show(a.options.id,function(n){a.options.onAddWidget(n)})}),this.$container.delegate(".icon-arrow-left","click",function(){a.$container.find(".dashboard-indicators-list .menu-content").show(),a.$container.find(".dashboard-indicators-list .bookmark-list-content").hide()}),this.$container.delegate(".add-by-bookmark","click",function(){var n=a.$container.find(".dashboard-indicators-list .menu-content"),t=a.$container.find(".dashboard-indicators-list .bookmark-list-content");n.hide(),a.options.getAddableBookmarks(function(a){t.html($.isArray(a)&&a.length>0?d.bookmarkList({glist:a}):d.bookmarkList())}),t.show()}),this.$container.find(".dashboard-indicators-list").off("click").on("click",".add-item",function(){var n=$(this).attr("data-bookmarkid");a.options.onAddWidget(n),a.$container.find(".dashboard-indicators-list").hide(),a.bookmarksPopupShown=!1})},checkDefaultDashboardConfig:function(){var a=this.options.dashboardConfig,n=sensorsdata.cache.config,t=a.approximate_policy||n.approximate_policy,e=a.sampling_factor||n.sampling_factor,o=a.dashboard_cache_policy||("FAST"===n.dashboard_cache_policy?"NORMAL":n.dashboard_cache_policy);$.isEmptyObject(a)||"DISABLE"===t&&64===e&&"NORMAL"===o?this.$container.find('[data-method="dashboardSetting"]').removeClass("active"):this.$container.find('[data-method="dashboardSetting"]').addClass("active")},setConfig:function(a){this.options.dashboardConfig=a,this.checkDefaultDashboardConfig()},setShare:function(a){this.isShareDash=a,a?this.$container.addClass("share"):this.$container.removeClass("share")},setContainWidget:function(a){a?(this.$container.removeClass("empty"),this.setShare(this.isShareDash)):this.$container.addClass("empty")},disableEdit:function(){this.$container.find(".icon-edit").hide()},destroy:function(){}}),n.create=function(a){return new t(a)}});
;/*!components/dispatcher/dispatcher.js*/
define("components/dispatcher/dispatcher",function(e,t,r){var n=e("tracker"),c={initTracker:function(e){n.initTracker(e)},setProfile:function(e,t){n.setProfile(e,t)},track:function(e){n.createTracker()({getState:null})()(e)}};r.exports=c});
;/*!components/expressionInput/modelUtil.js*/
define("components/expressionInput/modelUtil",function(e,t,n){var r=e("components/util/util"),a=e("components/dataCache/dataCache").create({expires:6e5}),o=0,s={guid:function(){return++o},stringToArray:function(e){var t=new RegExp(['(?:\\.|\\+|\\-|\\*|\\/|\\(){0,1}\\"[^\\"]+\\"(?:\\{\\{\\$\\$\\}\\}\\d+){0,1}',"\\d+(\\.\\d+){0,1}","(?:^|\\+|\\-|\\*|\\/|\\(|\\.)\\s*(?:\\d+(\\.\\d+){0,1}|[^\\+\\-\\*\\/\\(\\)\\.]+)","[\\.\\+\\-\\*\\/\\(\\)]"].join("|"),"g"),n=/^\s+|\s+$/g,r=e.match(t),a=[];return r&&r.forEach(function(e){e=e.replace(n,""),e.length>1&&/^(\.|\+|\-|\*|\/|\()/.test(e)?(a.push(e[0]),a.push(e.substr(1).replace(n,""))):a.push(e)}),a},textToFunction:function(e,t){"string"==typeof e&&(e=[e]),sensorsdata.ajax({url:sensorsdata.api.get("indicatorTransform"),type:"post",data:JSON.stringify(e),showLoader:!1,isCommonError:!1,success:function(n){"function"==typeof t&&t("string"==typeof e?n[0]:n)},error:function(e){"function"==typeof t&&t({error:e&&e.responseJSON&&e.responseJSON.error||"自定义表达式错误"})}})},functionToText:function(e,t){"string"==typeof e&&(e=[e]),sensorsdata.ajax({url:sensorsdata.api.get("indicatorReverse"),type:"post",data:JSON.stringify(e),showLoader:!1,success:function(n){"function"==typeof t&&t("string"==typeof e?n[0]:n)}})},validation:{regex:{tag:/^\s*(?![\.\+\-\*\/\(\)])/,connector:/^\s*\.\s*$/,operator:/^\s*\)?\s*[\+\-\*\/\(\)]\s*$/,specialChars:/(\?)|(\:)|(\|\|)|(\|)|(\&\&)|(\&)|(==)|(\!=)|(<=)|(\>=)|(<)|(\>)|(\+)|(\-)|(\*)|(\/)|(\%)|(\!)|(\s)|(\{)|(\})|(\()|(\))|($[1-9])|(^[1-9]+\w+)|(？)|(：)|(！=)|(——)|(—)|(！)|(（)|(）)|(\[)|(\])/},isTag:function(e){return this.regex.tag.test(e)},isConnector:function(e){return this.regex.connector.test(e)},isOperator:function(e){return this.regex.operator.test(e)}},checkType:function(e){for(var t=["Tag","Connector","Operator"],n=0,r=t.length;r>n;n++)if(this.validation["is"+t[n]](e))return t[n].toLowerCase();return!1},getIndicatorData:function(e,t){if(e&&e.type&&"function"==typeof t&&("property"!==e.type||e.parent)&&("aggregator"!==e.type||e.parent))switch(e.type){case"property":this.getEventPropsToEvent($.trim(e.parent),t);break;case"aggregator":this.getAggregator($.trim(e.parent),$.trim(e.parentParent),t);break;default:this.getEvents(t)}},getEvents:function(e){var t=a.get("events");return t?void e($.extend(!0,[],t)):(t=$.extend(!0,[],sensorsdata.cache.events),t.unshift(sensorsdata.CONSTSET.everyEvent),t=t.map(function(e){return{name:e.name,cname:e.cname,pinyin:e.pinyin,pinyinNoBlank:e.pinyin.replace(/\W/g,"")}}),a.set("events",t),void e($.extend(!0,[],t)))},getPropsToEvent:function(e,t){var n=this.getEvent("cname",e);if(!n)return void t();var r=sensorsdata.api.get("eventProps",{eventName:n.name}),o=a.get(r);return o?void t($.extend(!0,{},o)):void sensorsdata.ajax({url:r,showLoader:!1,success:function(e){return e&&e.event&&e.event.length?(a.set(r,$.extend(!0,{},e)),void t(e)):void t()}})},getEventPropsToEvent:function(e,t){var n=this.getEvent("cname",e.replace(/^\"|\"$/g,""));if(!n)return void t();var r=sensorsdata.api.get("eventProps",{eventName:n.name}),o=a.get("event"+r);if(o)return void t($.extend(!0,[],o));var s=this;sensorsdata.ajax({url:r,showLoader:!1,success:function(e){if(!(e&&e.event&&e.event.length))return void t();a.set(r,$.extend(!0,{},e));var n=s.getMeasureFunctions("event");n.length&&(n[n.length-1].isGroupLast=!0);var o=e.event.filter(function(e){return"number"===e.data_type&&e.is_measure===!0});o=o.concat(e.event.filter(function(e){return!("number"===e.data_type&&e.is_measure===!0)})),n=n.concat(o.map(function(e){return{name:e.name,cname:e.cname,pinyin:e.pinyin,pinyinNoBlank:e.pinyin.replace(/\W/g,""),data_type:e.data_type}})),a.set("event"+r,$.extend(!0,[],n)),t(n)}})},getAggregator:function(e,t,n){e=e.replace(/^\"|\"$/g,"");var r=this,a=this.getProperty("cname",e),o=function(){n("number"===a.data_type?r.getMeasureFunctions("property"):[sensorsdata.CONSTSET.measureFunctions.uniqCount])};return a?void o():void this.getEventPropsToEvent(t,function(t){if(!t||!t.length)return void n();for(var r=0,s=t.length;s>r;r++)if(t[r].cname===e)return a=t[r],void o()})},getMeasureFunctions:function(e){var t=[],n=sensorsdata.CONSTSET.measureFunctions;for(var r in n)n.hasOwnProperty(r)&&n[r].type===e&&"exit_rate"!==r&&t.push({name:r,cname:n[r].cname,pinyin:n[r].pinyin,pinyinNoBlank:n[r].pinyin.replace(/\W/g,"")});return t},getEvent:r.getEvent,getProperty:r.getProperty};n.exports=s});
;/*!components/expressionInput/expressionModel.js*/
define("components/expressionInput/expressionModel",function(e,t){function n(e){this.data={expression:[],filters:{}},e&&e.expression&&e.expression.length&&this.setDefaultData(e)}var s=e("components/expressionInput/modelUtil");n.prototype=$.extend(!0,{},sensorsdata.EventsModule,{setDefaultData:function(e){var t=this.buildExpression(e.expression);if(t&&t.expression){var n=this,r=e.filters;if(r instanceof Array&&r.length){var i=t.expression.filter(function(e){return"event"===e.type});r.forEach(function(e,t){if(!$.isEmptyObject(e)&&i[t]){var r=s.guid();n.data.filters[r]=e,i[t].value+="{{$$}}"+r}})}this.data.expression=t.expression,this.data.validated=t.validated}},get:function(){return $.extend(!0,{},this.data)},getExpression:function(e){var t=this,n=this.data.expression.map(function(e){var t=e.type,n=e.value.replace(/^\s*|\s*$/g,"").split("{{$$}}")[0];return("event"===t||"aggregator"===t||"property"===t&&s.validation.regex.specialChars.test(n))&&!/^".+"$/.test(n)&&(n='"'+n+'"'),n}).join("");s.textToFunction([{expression:n}],function(n){e(n&&n.length?$.extend(!0,{},{events:n[0].events,expression:n[0].expression,expression_filters:t.buildExpressionFilter()}):n)})},buildExpressionFilter:function(){var e=[],t=this.data.filters,n=!1;return this.data.expression.forEach(function(s){"event"===s.type&&(s.filterID&&t[s.filterID]&&t[s.filterID].conditions&&t[s.filterID].conditions.length?(e.push(t[s.filterID]),n=!0):e.push({}))}),n?e:[]},updateExpression:function(e,t){var n=this.buildExpression(e);return n&&n.expression?(this.data.expression=n.expression,this.data.validated=n.validated,t!==!1&&this.trigger("update",$.extend(!0,{},this.data)),!0):!1},buildExpression:function(e){for(var t={},n=[],r=null,i=0,o=e.length;o>i;i++){r=s.stringToArray(e[i]);for(var a=0,p=r.length;p>a;a++)n.push(this.buildExpressionItem(n,r[a]))}return n=this.buildPostprocessor(n),n&&(t={expression:n,validated:!n.filter(function(e){return"none"===e.type}).length}),t},buildExpressionItem:function(e,t){var n=e[e.length-1],r=null;switch(s.checkType(t)){case"tag":r={type:"tag",value:t};break;case"connector":n&&"tag"===n.type&&(r={type:"connector",value:t});break;case"operator":(/^\s*\(\s*$/.test(t)&&(!n||"operator"===n.type&&/^\s*[\+\-\*\/]\s*$/.test(n.value))||/^\s*\)\s*$/.test(t)&&n&&"tag"===n.type||n&&("tag"===n.type||"operator"===n.type&&/^\s*\)\s*$/.test(n.value)))&&(r={type:"operator",value:t})}return r},buildPostprocessor:function(e){return e.forEach(function(t,n){if("tag"===t.type){var r=e[n-1],i=e[n-2];if(/^\s*\d+(\.\d+){0,1}\s*$/.test(t.value)?t.type="number":0===n||"operator"===r.type||r.value.indexOf("{{$$}}")>-1?t.type="event":"connector"===r.type&&i?(t.type="event"===i.type?"property":"property"===i.type?"aggregator":"none",t.parent=i.value):t.type=s.getEvent(t.value)?"event":"none","event"===t.type){var o=t.value.split("{{$$}}");o[1]&&(t.filterID=Number(o[1]))}}}),e},updateFilter:function(e,t){return"object"==typeof e&&void 0===t&&(t=e,e=s.guid()),this.data.filters[e]=t,e}}),t.create=function(e){return new n(e)}});
;/*!components/expressionInput/expressionMenu.js*/
define("components/expressionInput/expressionMenu",function(e,t){function i(e){this.options=$.extend(!0,{container:$(document.body),filterFunc:function(e,t){return e.text&&e.text.indexOf(t)>-1}},e),this.data=this.options.data||null,this.renderData=this.data,this.currentIndex=-1,this.itemHeight=0,this.displayableNum=0,this.isScrollable=!1,this.isShow=!1,this.isSearchable=!0,this.handleBodyClick=sensorsdata.bind(this.handleProxyClickBody,this),this.init()}var s={container:'<div class="expression-menu" style="display:none"></div>',items:Handlebars.template({1:function(e,t,i,s){var n;return'<div class="expression-menu-search-container">\n  <span class="icon-search"></span>\n  <input id="expression-menu-search" class="icon-search expression-menu-search" type="text" placeholder="搜索" value="'+this.escapeExpression((n=null!=(n=t.keyword||(null!=e?e.keyword:e))?n:t.helperMissing,"function"==typeof n?n.call(e,{name:"keyword",hash:{},data:s}):n))+'"></input>\n</div>\n'},3:function(){return"margin-top: 36px;"},5:function(e,t,i,s){var n,a,r,h=t.helperMissing,o="function",l=this.escapeExpression,c='    <li data-index="'+l((a=null!=(a=t.index||s&&s.index)?a:h,typeof a===o?a.call(e,{name:"index",hash:{},data:s}):a))+'"';return a=null!=(a=t.isGroupLast||(null!=e?e.isGroupLast:e))?a:h,r={name:"isGroupLast",hash:{},fn:this.program(6,s,0),inverse:this.noop,data:s},n=typeof a===o?a.call(e,r):a,t.isGroupLast||(n=t.blockHelperMissing.call(e,n,r)),null!=n&&(c+=n),c+">"+l((a=null!=(a=t.cname||(null!=e?e.cname:e))?a:h,typeof a===o?a.call(e,{name:"cname",hash:{},data:s}):a))+"</li>\n"},6:function(){return' class="group-last"'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,i,s){var n,a,r,h=t.helperMissing,o="function",l=t.blockHelperMissing,c="";return a=null!=(a=t.query||(null!=e?e.query:e))?a:h,r={name:"query",hash:{},fn:this.program(1,s,0),inverse:this.noop,data:s},n=typeof a===o?a.call(e,r):a,t.query||(n=l.call(e,n,r)),null!=n&&(c+=n),c+='<div class="overflow-wrapper" style="',a=null!=(a=t.isSearchable||(null!=e?e.isSearchable:e))?a:h,r={name:"isSearchable",hash:{},fn:this.program(3,s,0),inverse:this.noop,data:s},n=typeof a===o?a.call(e,r):a,t.isSearchable||(n=l.call(e,n,r)),null!=n&&(c+=n),c+='">\n  <ul class="expression-menu-list">\n',a=null!=(a=t.data||(null!=e?e.data:e))?a:h,r={name:"data",hash:{},fn:this.program(5,s,0),inverse:this.noop,data:s},n=typeof a===o?a.call(e,r):a,t.data||(n=l.call(e,n,r)),null!=n&&(c+=n),c+"  </ul>\n</div>"},useData:!0})},n={SEARCH_H:40,ITEM_H:32,WRAPPER_MAX_H:459};i.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){var e=this;this.$menu=$(s.container).appendTo(this.options.container).delegate("li","click",function(){e.select(this.getAttribute("data-index"))}),"object"==typeof this.options.css&&this.$menu.css(this.options.css)},show:function(e){if(this.menuConfig(e),this.bindKeyEvent(),this.isShow||!this.renderData||!this.renderData.length)return this.$searchInput&&this.$searchInput.length>0&&this.$searchInput.focus(),void this.moveSelectionRange(-1,-1);var t=this;this.isShow=!0,this.$menu.show(),this.isScrollable=this.$menu.height()<this.$menu.find(".expression-menu-list").height(),this.itemHeight=this.$items.outerHeight(),this.displayableNum=Math.floor(this.isSearchable?(this.$menu.height()-n.SEARCH_H)/this.itemHeight:this.$menu.height()/this.itemHeight),this.$list_wrapper.length>0&&this.$list_wrapper.css({height:this.displayableNum*n.ITEM_H,"max-height":n.WRAPPER_MAX_H}),this.$searchInput.focus(),this.moveSelectionRange(-1,-1),setTimeout(function(){$(document.body).on("click",t.handleBodyClick)},0)},hide:function(){this.isShow&&(this.isShow=!1,this.$menu.hide(),this.$searchInput.off("keyup keydown"),$(document.body).off("click",this.handleBodyClick))},search:function(e){if(this.data&&this.data.length){var t=this.options.filterFunc;e=$.trim(e),this.renderData=e?this.data.filter(function(i){return t(i,e)}):this.data,this.render(e),this.bindKeyEvent(),this.$searchInput.focus(),this.moveSelectionRange(-1,-1)}},movePointer:function(e){if(this.isShow&&("top"===e||"bottom"===e)){var t=this.currentIndex,i=this.$items;"top"===e?(t--,0>t&&(t=this.renderData.length-1)):(t++,t===this.renderData.length&&(t=0)),i.eq(this.currentIndex).removeClass("active"),i.eq(t).addClass("active"),this.currentIndex=t,this.setScrollTop(e)}},moveSelectionRange:function(e,t){e&&t&&this.$searchInput&&this.$searchInput.length>0&&this.$searchInput[0].setSelectionRange&&this.$searchInput[0].setSelectionRange(e,t)},setScrollTop:function(e){if(this.isScrollable){var t=this.$list_wrapper[0].scrollTop||0,i=this.currentIndex;if("bottom"===e){if(0===i)this.$list_wrapper[0].scrollTop=0;else if(i>=this.displayableNum){var s=(i-this.displayableNum+1)*this.itemHeight;s>t&&(this.$list_wrapper[0].scrollTop=s)}}else if(i===this.renderData.length-1)this.$list_wrapper[0].scrollTop=this.$items.length*this.itemHeight;else if(t>0){var n=i*this.itemHeight;t>n&&(this.$list_wrapper[0].scrollTop=n)}}},select:function(e){this.hide();var t=this.renderData[void 0===e?this.currentIndex:e];if(t){var i={data:$.extend(!0,{},t),marker:this.marker};this.trigger("select",i),"function"==typeof this.onSelect&&this.onSelect(i)}},getMarker:function(){return this.marker},getStatus:function(){return this.isShow},getIndex:function(){return this.currentIndex},setStyle:function(e){"object"==typeof e&&this.$menu.css(e)},update:function(e){e instanceof Array&&e.length&&(this.data=this.renderData=e,this.render())},menuConfig:function(e){if(e&&e.marker&&e.marker===this.marker||(this.onSelect=null),e){if(e.isSearchable===!1&&(this.isSearchable=!1),e.data){this.data=this.renderData=e.data;var t=e.query;t&&(this.renderData=this.data.filter(function(e){return e.text.indexOf(t)>-1})),this.render()}e.marker&&(this.marker=e.marker),e.onSelect&&(this.onSelect=e.onSelect),this.setStyle(e.css)}},render:function(e){if(this.renderData instanceof Array){this.isSearchable?e?(this.$list_wrapper.replaceWith(s.items({data:this.renderData,query:!1,isSearchable:!0})),this.$menu.attr("data-length",this.renderData.length)):this.$menu.html(s.items({data:this.renderData,query:{keyword:""},isSearchable:!0})).attr("data-length",this.renderData.length):this.$menu.html(s.items({data:this.renderData,query:!1,isSearchable:!1})).attr("data-length",this.renderData.length).addClass(this.renderData.length?"":"expression-menu-nodata").removeClass(this.renderData.length?"expression-menu-nodata":""),this.$items=this.$menu.find("li"),this.currentIndex=-1,this.$searchInput=this.$menu.find("#expression-menu-search"),this.$list_wrapper=this.$menu.find(".overflow-wrapper");var t=this.renderData.length*n.ITEM_H;this.$list_wrapper.length>0&&this.$list_wrapper.css({height:this.isSearchable?t+12:t,"max-height":n.WRAPPER_MAX_H})}},handleProxyClickBody:function(e){this.$menu.has(e.target).length||this.$menu[0]===e.target||"function"==typeof this.options.hidePreCheck&&this.options.hidePreCheck(e.target)===!1||this.hide()},handleKeyup:function(e,t){var i=this,s={inputExp:/^\s*\)?\s*[\.\+\-\*\/\(]?\s*\(?\s*(\d+(\.\d+)?\s*[\+\-\*\/]\s*)*/};if(e.length>0&&"undefined"!==$.type(e.val())){var n=$.trim(e.val()).replace(s.inputExp,"");if("number"==typeof t)switch(t){case 38:case 40:return;case 37:case 39:return void(""===i.lastQuery&&i.hide());case 13:return void(-1!==i.getIndex()&&i.select());case 8:case 46:if(""===i.lastQuery)return void i.hide();break;case 27:return void i.hide()}!n&&""!==n||37===t&&39===t||this.search(n)}},handleKeydown:function(e){var t=this;if(e&&"number"==typeof e)switch(e){case 38:return void(t.getStatus()&&t.movePointer("top"));case 40:return void(t.getStatus()&&t.movePointer("bottom"))}},bindKeyEvent:function(){var e=this;if("undefined"!==$.type(this.$searchInput)&&this.$searchInput.length>0){var t=this.$searchInput;t.off("keyup.search").on("keyup.search",function(t){var i=t.keyCode||t.charCode;e.handleKeyup($(this),i)}),t.off("keydown.search").on("keydown.search",function(t){e.lastQuery=$(this).val();var i=t.keyCode||t.charCode;e.handleKeydown(i)})}}}),t.create=function(e){return new i(e)},t.isInstanceof=function(e){return e instanceof i}});
;/*!components/expressionInput/expressionSuggest.js*/
define("components/expressionInput/expressionSuggest",function(t,e){function n(t){this.$container=$(t.container),this.onChange=t.onChange,this.menu=t.menu,this.bindEvent()}var a=t("components/expressionInput/modelUtil"),r=a.validation,i={inputExp:/^\s*\)?\s*[\.\+\-\*\/\(]?\s*\(?\s*(\d+(\.\d+)?\s*[\+\-\*\/]\s*)*/};n.prototype=$.extend(!0,{},sensorsdata.EventsModule,{bindEvent:function(){var t=this;this.menu.on("select",function(e){t.handleMenuSelect(e)}),this.$container.delegate("input","focus",function(){var e=t.$currentInput=$(this);r.isConnector(e.val())&&e.parent("li").next("li").attr("data-tag")||t.showMenu(this)}).delegate("input","keydown",function(e){return t.handleKeydown(e.keyCode)}).delegate("input","keyup",function(e){t.handleKeyup(this,e.keyCode)})},handleKeydown:function(t){switch(t){case 38:if(this.menu.getStatus())return this.menu.movePointer("top"),!1;break;case 40:this.menu.getStatus()&&this.menu.movePointer("bottom")}},handleKeyup:function(t,e){switch(e){case 38:break;case 40:break;case 13:-1!==this.menu.getIndex()&&this.menu.select();break;default:this.handleInputChange(t)}},handleInputChange:function(t){var e=$.trim(t.value);if(!r.isConnector(e)||!$(t).parent("li").next("li").attr("data-tag"))return e&&1!==e.length&&1!==e.replace(/\)\s*/,"").length?void(this.menu.getStatus()&&this.menu.search(e.replace(i.inputExp,""))):void this.showMenu(t)},showMenu:function(t){var e=this,n=this.menuMeta=this.getInputMenuMate(t);return n&&n.type?void a.getIndicatorData(n,function(n){e.menu.show({data:n,css:{left:$(t).parent("li").position().left-e.$container.position().left},marker:t,isSearchable:!1});var a=t.value,r=$.trim(a).replace(i.inputExp,"");r&&e.menu.search(r)}):void this.menu.hide()},getInputMenuMate:function(t){var e=$.trim(t.value),n=null,a="";if(!$(t).parent("li").prev("li").length)return{type:"event"};if(e){if(r.isOperator(e))return{type:"event"};if(r.isConnector(e)&&(n=$(t).parent("li").prev("li"),n.length))return a=n.attr("data-type"),{type:"event"===a?"property":"property"===a?"aggregator":"",parent:n.attr("data-value"),parentParent:n.find(".tag").attr("data-parent")};if(n=$(t).parent("li").prev("li"),a=n.attr("data-type")){if("operator"===a)return{type:"event"};if("connector"===a){var i=n.prev("li"),o=n.prev("li").attr("data-type"),p="event"===o?"property":"property"===o?"aggregator":"";if(p)return{type:p,parent:i.attr("data-value"),parentParent:i.find(".tag").attr("data-parent")}}}}else{n=$(t).parent("li").prev("li");var u=n.find("input").val();if(u){if(r.isOperator(u))return{type:"event"};if(r.isConnector(u))return a=n.prev("li").attr("data-type"),{type:"event"===a?"property":"property"===a?"aggregator":"",parent:n.prev("li").attr("data-value")}}}},handleMenuSelect:function(t){var e=this.$currentInput,n=e.val().match(i.inputExp),r=this.menuMeta.type,o=t.data,p=!/^\"[^\"]+\"$/.test(o.cname)&&("event"===r||"property"===r&&a.validation.regex.specialChars.test(o.cname))?'"'+o.cname+'"':o.cname,u=(n?n[0]:"")+p+("event"===r||"property"===r&&("number"===o.data_type||"string"===o.data_type||"bool"===o.data_type)?" . ":"");e.val(u).attr("data-changed",!0),e.prev(".placeholder").html(u),this.trigger("change"),"function"==typeof this.onChange&&this.onChange()}}),e.create=function(t){return new n(t)},e.isInstanceof=function(t){return t instanceof n}});
;/*!components/expressionInput/expressionInput.js*/
define("components/expressionInput/expressionInput",function(t){function e(t,e){this.options=$.extend(!0,{isFocus:!1},e),this.$input=t.hide(),this.$outer=$(l.container()).insertBefore(this.$input),this.$container=this.$outer.find(".expression-unit"),this.outerOffset=this.$outer.offset(),this.$currentInput=null,this.containerLeft=this.$container.position().left,this.containerTop=this.$container.position().top,this.markerHeight=35,this.focusIndex=this.options.isFocus?-1:!1,this.initModel().then(sensorsdata.bind(function(){this.initMenu(),this.initSuggest(),this.initFilterPanel(),this.initInput(),this.bindEvent()},this))}var n=t("components/expressionInput/modelUtil"),i=t("components/expressionInput/expressionModel"),a=t("components/expressionInput/expressionMenu"),s=t("components/expressionInput/expressionSuggest"),r=t("components/filterPanel/filterPanel"),l={container:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="expression-input">\n  <div class="mask"></div>\n  <div class="expression-unit">\n    <div class="action-focus" data-method="focus"></div>\n    <ul>\n      <li data-type="none"><input type="text" value="" /></li>\n    </ul>\n  </div>\n</div>'},useData:!0}),expression:Handlebars.template({1:function(t,e,n,i){var a,s,r,l=e.helperMissing,o="function",u=e.blockHelperMissing,p="";return s=null!=(s=e.isInput||(null!=t?t.isInput:t))?s:l,r={name:"isInput",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i},a=typeof s===o?s.call(t,r):s,e.isInput||(a=u.call(t,a,r)),null!=a&&(p+=a),s=null!=(s=e.isInput||(null!=t?t.isInput:t))?s:l,r={name:"isInput",hash:{},fn:this.noop,inverse:this.program(4,i,0),data:i},a=typeof s===o?s.call(t,r):s,e.isInput||(a=u.call(t,a,r)),null!=a&&(p+=a),p},2:function(t,e,n,i){var a,s=e.helperMissing,r="function",l=this.escapeExpression;return'    <li data-input="true" data-type="'+l((a=null!=(a=e.type||(null!=t?t.type:t))?a:s,typeof a===r?a.call(t,{name:"type",hash:{},data:i}):a))+'"><span class="placeholder">'+l((a=null!=(a=e.value||(null!=t?t.value:t))?a:s,typeof a===r?a.call(t,{name:"value",hash:{},data:i}):a))+'</span><input type="text" value="'+l((a=null!=(a=e.value||(null!=t?t.value:t))?a:s,typeof a===r?a.call(t,{name:"value",hash:{},data:i}):a))+'" /></li>\n'},4:function(t,e,n,i){var a,s,r,l=e.helperMissing,o="function",u=this.escapeExpression,p=e.blockHelperMissing,c='    <li data-tag="true" data-type="'+u((s=null!=(s=e.type||(null!=t?t.type:t))?s:l,typeof s===o?s.call(t,{name:"type",hash:{},data:i}):s))+'" data-value="'+u((s=null!=(s=e.value||(null!=t?t.value:t))?s:l,typeof s===o?s.call(t,{name:"value",hash:{},data:i}):s))+'"'+(null!=(a=e["if"].call(t,null!=t?t.filterID:t,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+'>\n      <span class="tag"';return s=null!=(s=e.isNone||(null!=t?t.isNone:t))?s:l,r={name:"isNone",hash:{},fn:this.noop,inverse:this.program(7,i,0),data:i},a=typeof s===o?s.call(t,r):s,e.isNone||(a=p.call(t,a,r)),null!=a&&(c+=a),c+=">"+u((s=null!=(s=e.value||(null!=t?t.value:t))?s:l,typeof s===o?s.call(t,{name:"value",hash:{},data:i}):s))+"</span>",s=null!=(s=e.isEvent||(null!=t?t.isEvent:t))?s:l,r={name:"isEvent",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i},a=typeof s===o?s.call(t,r):s,e.isEvent||(a=p.call(t,a,r)),null!=a&&(c+=a),c+"\n    </li>\n"},5:function(t,e,n,i){var a;return' data-filter-id="'+this.escapeExpression((a=null!=(a=e.filterID||(null!=t?t.filterID:t))?a:e.helperMissing,"function"==typeof a?a.call(t,{name:"filterID",hash:{},data:i}):a))+'"'},7:function(t,e,n,i){var a,s,r=e.helperMissing,l="function",o=this.escapeExpression;return' data-type="'+o((s=null!=(s=e.type||(null!=t?t.type:t))?s:r,typeof s===l?s.call(t,{name:"type",hash:{},data:i}):s))+'" data-method="select" data-value="'+o((s=null!=(s=e.value||(null!=t?t.value:t))?s:r,typeof s===l?s.call(t,{name:"value",hash:{},data:i}):s))+'"'+(null!=(a=e["if"].call(t,null!=t?t.parent:t,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?a:"")},8:function(t,e,n,i){var a;return' data-parent="'+this.escapeExpression((a=null!=(a=e.parent||(null!=t?t.parent:t))?a:e.helperMissing,"function"==typeof a?a.call(t,{name:"parent",hash:{},data:i}):a))+'"'},10:function(t,e,n,i){var a,s;return'<span class="action-filter-set'+(null!=(a=e["if"].call(t,null!=t?t.filterID:t,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+'" data-method="set-filter" data-event="'+this.escapeExpression((s=null!=(s=e.value||(null!=t?t.value:t))?s:e.helperMissing,"function"==typeof s?s.call(t,{name:"value",hash:{},data:i}):s))+'"'+(null!=(a=e["if"].call(t,null!=t?t.filterID:t,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?a:"")+'><span class="icon-filter-set"></span></span>'},11:function(){return" has-filter"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,i){var a,s,r,l='<ul data-method="focus">\n';return s=null!=(s=e.expression||(null!=t?t.expression:t))?s:e.helperMissing,r={name:"expression",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i},a="function"==typeof s?s.call(t,r):s,e.expression||(a=e.blockHelperMissing.call(t,a,r)),null!=a&&(l+=a),l+"</ul>"},useData:!0})};e.prototype={initModel:function(){var t=this,e=$.Deferred(),a=this.$input.attr("data-measure-express"),s=this.$input.attr("data-expression-filters");if(s)try{s=JSON.parse(s)}catch(r){}var l=function(a){t.model=a?i.create({expression:n.stringToArray(a),filters:s||[]}):i.create(),t.model.on("update",sensorsdata.bind(t.render,t)),e.resolve()};return a?n.functionToText(a,function(t){l(t[0]&&t[0].expression)}):l(this.$input.val()),e},initMenu:function(){var t=this;this.menu=a.create({container:this.$outer,hidePreCheck:function(e){return t.$container.has(e).length&&"select"===e.getAttribute("data-method")?!1:!0},filterFunc:function(t,e){var n=e.toLocaleUpperCase().trim();return t.cname.toLocaleUpperCase().indexOf(n)>-1||t.pinyin.toLocaleUpperCase().indexOf(n)>-1||"undefined"!=typeof t.pinyinNoBlank&&t.pinyinNoBlank.toLocaleUpperCase().indexOf(n)>-1?!0:!1}})},initSuggest:function(){var t=this;this.suggest=s.create({container:this.$container,menu:a.create({container:this.$outer,hidePreCheck:function(e){return!t.$container.has(e).length||"focus"!==e.getAttribute("data-method")&&e!==(this.$currentInput&&this.$currentInput[0])?!0:!1},filterFunc:function(t,e){var n=e.toLocaleUpperCase().trim();return t.cname.toLocaleUpperCase().indexOf(n)>-1||t.pinyin.toLocaleUpperCase().indexOf(n)>-1||"undefined"!==$.type(t.pinyinNoBlank)&&t.pinyinNoBlank.toLocaleUpperCase().indexOf(e)>-1?!0:!1}}),onChange:function(){t.saveInput()}})},initFilterPanel:function(){var t=this;this.filterPanel=r.create({container:this.$outer,blurHide:!0,blurHidePreCheck:function(e){var n=$(e.target);return!t.$container.has(e.target).length||"set-filter"!==n.attr("data-method")&&"set-filter"!==n.parent().attr("data-method")?void 0:!1}}),this.filterPanel.on("save",sensorsdata.bind(this.saveFilter,this)),this.filterPanel.on("hid",function(){$(t.filterMarker).removeClass("active")})},initInput:function(){var t=this.model.get();t&&t.expression&&t.expression.length&&this.render(t)},bindEvent:function(){var t=this;this.$container.delegate("[data-method]","click",function(e){t.handleClick(this.getAttribute("data-method"),this,e)}).delegate("ul[data-method=focus]","click",function(e){if(this===e.target){var n=t.$container.find("input:last");n.length&&(n.focus(),n[0].setSelectionRange(-1,-1))}}).delegate("input","focus",function(){t.handleFocus(this)}).delegate("input","keydown",function(e){return t.handleKeydown(e.keyCode,this)}).delegate("input","keyup",function(e){return t.handleKeyup(e.keyCode,this)})},handleClick:function(t,e){switch(t){case"select":this.handleSelect(e);break;case"set-filter":this.handleFilter(e)}},handleSelect:function(t){var e=this,i=this.menu;return i.getStatus()&&i.getMarker()===t?void i.hide():i.getMarker()===t?void i.show({marker:t,css:{left:$(t).parent("li").position().left-this.containerLeft}}):void n.getIndicatorData({type:t.getAttribute("data-type"),parent:t.getAttribute("data-parent")},function(a){i.show({marker:t,data:a,css:{top:$(t).parent("li").position().top+e.containerTop+e.markerHeight,left:$(t).parent("li").position().left-e.containerLeft},onSelect:function(i){var a=i&&i.data&&i.data.cname;if(a){var s=$(t),r=s.attr("data-type");if("property"===r&&!/^\"[^\"]+\"$/.test(a)&&n.validation.regex.specialChars.test(a)&&(a='"'+a+'"'),s.html(a).attr("data-value",a).parent().attr("data-value",a),"event"===r){var l=s.parent().next("li").next("li[data-type=property]");s.next(".action-filter-set").attr("data-event",a).removeAttr("data-filter-id").removeClass("has-filter"),l.length&&l.find("span.tag").attr("data-parent",a),e.filterPanel&&e.filterPanel.clean()}}}}),i.$searchInput.length>0&&i.$searchInput.focus()})},handleFilter:function(t){var e=this.filterPanel;if(e.getMarker()===t)return void(e.getStatus()?e.hide():($(t).addClass("active"),e.show()));var i=this,a=t.getAttribute("data-filter-id"),s=null;if(a){var r=this.model.get().filters;s=r[a]}this.filterMarker&&$(this.filterMarker).removeClass("active"),this.filterMarker=t,n.getPropsToEvent(t.getAttribute("data-event").replace(/^\"|\"$/g,""),function(n){if(i.filterMarker===t){var a=$(t);a.addClass("active"),e.show({marker:t,properties:n,expressionFilter:s,arrow:{left:a.offset().left-i.outerOffset.left}})}})},handleFocus:function(t){"error"===this.status&&(this.status="",sensorsdata.form.removeError(this.$outer)),this.$currentInput=$(t)},handleKeydown:function(t,e){var n=this,i=$(e);switch(t){case 37:if(0===e.selectionStart)return setTimeout(function(){n.switchFocus(i,"prev")},0),!1;break;case 39:if(e.selectionStart-e.value.length===0)return setTimeout(function(){n.switchFocus(i,"next")},0),!1;break;case 8:0===e.selectionStart&&0===e.selectionEnd?this.deleteItem(i):this.setInputWidth();break;case 13:break;default:this.setInputWidth()}},handleKeyup:function(t){switch(t){case 13:this.$currentInput.attr("data-changed")||this.saveInput()}},switchFocus:function(t,e){for(var n=t.parent("li")[e]("li");n.length;){var i=n.find("input");if(i.length){i.focus(),"next"===e?i[0].setSelectionRange(0,0):i[0].setSelectionRange(-1,-1);break}n=n[e]("li")}},deleteItem:function(t){var e=this,n=t.parent("li").prev("li");if(n.length){var i=function(){var i=n.prev("li");n.remove(),i.length&&i.attr("data-input")&&!i.find("input").val()&&i.remove(),e.$currentFocusPrev=t.parent("li").prev("li")},a=n.find("input[type=text]");if(a.length&&$.trim(t.val())){var s=a.val().slice(0,-1);s&&t.val(s+t.val())[0].setSelectionRange(s.length,0)}i()}},setInputWidth:function(){var t=this.$currentInput;t.length&&t.prev(".placeholder").html(t.val().replace(/ /g,"&nbsp;")+"一")},saveFocus:function(){var t=this.$currentInput;if(t.length){var e=this.buildExpression(t.parent("li").prevAll("li")).reverse(),n=$.trim(t.val());n&&e.push(n);var i=this.model.buildExpression(e).expression,a=i.length,s=null,r=i[i.length-1];("connector"===r.type||"operator"===r.type)&&a--;for(var l=0,o=a;o>l;l++){var u=i[l];"connector"!==u.type&&"operator"!==u.type&&(s=i[l-1],(!s||"connector"!==s.type&&"operator"!==s.type)&&a++)}this.focusIndex=a}},saveInput:function(){var t=this.buildExpression(this.$container.find("li"));return t.length&&(this.saveFocus(),this.model.updateExpression(t)),!1},saveFilter:function(t){var e=this.filterMarker.getAttribute("data-filter-id");e?this.model.updateFilter(e,t):$(this.filterMarker).attr("data-filter-id",this.model.updateFilter(t)),$(this.filterMarker)[t.conditions&&t.conditions.length?"addClass":"removeClass"]("has-filter")},buildExpression:function(t){var e=[];return t.each(function(t,n){var i=$(n),a=$.trim(i.attr("data-tag")?i.attr("data-value"):i.find("input").val());if(a){"event"!==i.attr("data-type")||/^\"[^\"]+\"$/.test(a)||(a='"'+a+'"');var s=$.trim(i.find("[data-filter-id]").attr("data-filter-id"));s&&(a+="{{$$}}"+s),e.push(a)}}),e},render:function(t){this.$container.html(l.expression(this.buildTplData(t)));var e=this.focusIndex;if(e===!1)return void(this.$currentInput=null);if(-1===e)this.$currentInput=this.$container.find("input:last").focus();else for(var n=this.$container.find("li").eq(e),i=!1;n.length&&!i;){var a=n.find("input");a.length?(this.$currentInput=a,a.focus(),a[0].setSelectionRange(-1,-1),i=!0):n=n.next("li")}this.focusIndex=!1},buildTplData:function(t){var e=t.expression,n=[],i={type:"none",value:"",isInput:!0};e.forEach(function(t){if("connector"===t.type||"operator"===t.type||"number"===t.type)t.isInput=!0;else if("event"===t.type){var e=t.value.split("{{$$}}");t.isEvent=!0,e[1]&&(t.filterID=e[1],t.value=e[0])}});for(var a=0,s=e.length;s>a;a++){var r=e[a];if("connector"!==r.type&&"operator"!==r.type){var l=e[a-1];l&&l.isInput||n.push(i)}n.push(r)}return n.length&&!n[n.length-1].isInput&&n.push(i),t.expression=n,t},action:function(t,e){switch(t){case"get":if("function"==typeof e){var n=this.buildExpression(this.$container.find("li"));this.model.updateExpression(n,!1),this.model.getExpression(e)}break;case"error":this.status="error",sensorsdata.form.addError(this.$outer,"表达式不完整或不合法",!0);break;case"onoff":this.onoff(e);break;case"destroy":this.destroy()}},onoff:function(t){this.$outer[t?"removeClass":"addClass"]("disabled")}},$.fn.expressionInput=function(t){var n=$(this);if("string"==typeof t){var i=n.data("expressionInput");i&&(i.action.apply(i,arguments),"destroy"===t&&n.removeData("expressionInput"))}else n.data("expressionInput",new e(n,t));return this}});
;/*!components/model/intervalCondition.js*/
define("components/model/intervalCondition",function(e,t,n){var a=e("components/util/util"),r=e("lodash"),i={first_event:{relevance_field:"",filter:{conditions:[]},event_name:""},second_event:{filter:{conditions:[]},relevance_field:"",event_name:""},from_date:"",to_date:"",filter:{},unit:"day",measure_type:"other",bookmarkid:"",rollup_date:!0,hasRelation:!1,selected:[],sampling_factor:"64"},s=[0,1,2],o=$.extend(!0,{},sensorsdata.EventsModule,{update:function(e,t){var n=this,a={action:e.action||"update"};switch(a.action){case"update":i=$.extend(!0,{},i,e.params),a.params=i,this.trigger("update",a),$.isFunction(t)&&t();break;case"changeEvent":i=$.extend(!0,{},i,e.params),a.params=i,this.getEventProperties(function(e){n.removeInvalidProperties(e),a.propObj=$.extend(!0,{},e),n.trigger("update",a),$.isFunction(t)&&t(e)});break;case"changeFilter":i=$.extend(!0,{},i,e.params),a.params=i;for(var s in e.params)e.params.hasOwnProperty(s)&&(e.params[s].filter?r.set(i,s+".filter",e.params[s].filter):r.set(i,s,e.params[s]));a.params=i,this.trigger("update",a),$.isFunction(t)&&t();break;case"changeGroup":for(var o in e.params)e.params.hasOwnProperty(o)&&(e.params[o]?this.set(o,e.params[o]):delete i[o]);a.params=i,this.trigger("update",a),$.isFunction(t)&&t();break;case"changeRelavance":if(i=$.extend(!0,{},i,e.params),this.get("first_event").type&&this.get("second_event").type&&this.get("first_event").type!==this.get("second_event").type)return void sensorsdata.error.show(sensorsdata.languages.get("请选择相同类型的属性<!--{en}-->"));this.trigger("update",{params:i});break;case"changeChartGroup":for(var d in e.params)e.params.hasOwnProperty(d)&&(e.params[d]?this.set(d,e.params[d]):delete i[d]);a.params=i,this.trigger(a.action,a)}},initCondition_:function(e){i=this.dealParam_($.extend(!0,{},i,e))},dealParam_:function(e){e.hasRelation="true"===e.hasRelation;var t=sensorsdata.cache.events.filter(function(e){return e.visible&&!e.virtual});if(e.first_event.event_name=e.first_event.event_name||t[0].name,e.second_event.event_name=e.second_event.event_name||t[0].name,e.bucket_params&&$.isArray(e.bucket_params)&&e.bucket_params.length&&(e.bucket_params=e.bucket_params.map(function(e){return e?e:null})),e.by_field||delete e.by_field,e.by_event||delete e.by_event,!e.from_date||!e.to_date){var n=sensorsdata.buildDefaultTimeRange();e.from_date=n[0].format(sensorsdata.CONSTSET.dateFormat),e.to_date=n[1].format(sensorsdata.CONSTSET.dateFormat)}var r=a.getTimeRange(e.rangeText,!1);return e.rangeText&&!$.isEmptyObject(r)&&(e.from_date=r.from_date,e.to_date=r.to_date),e.rollup_date="all"===e.unit,e.selected=$.isArray(e.selected)&&e.selected.length>0?e.selected.map(function(e){return parseInt(e,10)}):s,$.extend(!0,{},e)},get:function(e){return r.get($.extend(!0,{},i),e,$.extend(!0,{},i))},set:function(e,t){return e?void r.set(i,e,t):!1},getEventProperties:function(e){var t=[i.first_event.event_name,i.second_event.event_name],n=this;sensorsdata.ajax({useCache:!0,url:"event/properties?events="+t.join(",")+"&method=mixed",success:sensorsdata.bind(function(t){if($.isEmptyObject(t))return void sensorsdata.error.show(sensorsdata.languages.get("数据格式错误，请联系技术人员<!--{en}Data in wrong format, please contact with technicians-->"));var a=$.extend(!0,{},t);delete a.intersection.session,n.removeInvalidRelavance(a),$.isFunction(e)&&e(a)},this)})},removeInvalidProperties:function(e){i.first_event=this.removeInvalidFilter(i.first_event,e),i.second_event=this.removeInvalidFilter(i.second_event,e),this.removeInvalidGroup(e),this.removeInvalidRelavance(e)},removeInvalidRelavance:function(e){var t=i.first_event.event_name,n=i.first_event.relevance_field.split(".")[2]||"",a=i.second_event.event_name,r=i.second_event.relevance_field.split(".")[2]||"",s=e.original[t].event.filter(function(e){return e.name===n})[0],o=e.original[a].event.filter(function(e){return e.name===r})[0];return s&&o&&s.data_type===o.data_type?void this.set("hasRelation",!0):(this.set("first_event.relevance_field",""),this.set("second_event.relevance_field",""),this.set("hasRelation",!1),void((n||r)&&sensorsdata.info.show(sensorsdata.languages.get("关联属性已不存在<!--{en}-->"))))},removeInvalidGroup:function(e){var t=[],n=[],a="";i.by_field&&(t=i.by_field.split("."),3===t.length?t[1]===i[i.by_event+"_event"].event_name&&(a=t[2],n=e.original[t[1]].event.filter(function(e){return e.name===a})):2===t.length&&(n=e.inetrsection.user.filter(function(e){return e.name===t[1]})),n.length||(sensorsdata.info.show(sensorsdata.util.format(sensorsdata.languages.get("属性 #{field} 已经不存在，已从分组中删除<!--{en}Property#{field} does not exist, and has been deleted from the group-->"),{field:i.by_field})),delete i.by_field,delete i.by_event))},removeInvalidFilter:function(e,t){return e.filter&&e.filter.conditions&&$.isArray(e.filter.conditions)?(e.filter.conditions=e.filter.conditions.filter(function(n){if(!n.field)return!1;var a=n.field.split("."),r=a[0],i=a[a.length-1];if(3===a.length){var s=t.original[e.event_name][r].filter(function(e){return e.name===i});return s.length?!0:(sensorsdata.info.show(sensorsdata.util.format(sensorsdata.languages.get("属性 #{field} 已经不存在，已从过滤中删除<!--{en}Property#{field} does not exist, and has been deleted from the filter-->"),{field:n.field})),!1)}return 2===a.length?t.intersection.user.filter(function(e){return e.name===i}).length:void 0}).map(function(t){var n=t.field.split(".");return n[1]=e.event_name,t.field=n.join("."),t}),e):{}},destroy:function(){this.off("update")}});n.exports=o});
;/*!components/model/intervalResult.js*/
define("components/model/intervalResult",function(t,a,e){var n=t("components/util/util"),i=t("components/model/intervalCondition"),o=$.extend(!0,{},sensorsdata.EventsModule,{request:function(t,a){delete t.hasRelation,delete t.selected;var e="",n=this;e="time_distribution"===t.measure_type?"interval/time_distribution/report/?bookmarkId="+t.bookmarkid:"interval/report/?bookmarkId="+t.bookmarkid,sensorsdata.reportAjax({isAsync:!0,url:e,method:"POST",data:t,queueEnable:!0,success:function(t){var e=n.formatData_(t);n.trigger("update",e),$.isFunction(a)&&a("success")},error:function(){$.isFunction(a)&&a()}})},formatData_:function(t){return{chartData_:this.formatChartData_(t),tableData_:this.formatTableData_(t),byValues:this.formatByValues(t)}},formatByValues:function(t){return $.isArray(t.by_values)&&t.by_values.length>0?t.by_values.map(function(t){var a="$ALL"===t?"总体":""===t?sensorsdata.CONSTSET.emptyStringByValue:t||sensorsdata.CONSTSET.unknownByValue;return{value:t,cname:a}}):[]},formatChartData_:function(t){var a={axisData:[],boxData:[],avgData:[]},e=t.date_list.length>1?1:0;return a.axisData=t.date_list.slice(e).map(function(t){return"$ALL"===t?sensorsdata.languages.get("合计<!--{en}Total-->"):sensorsdata.formatTime(t,i.get("unit"),!0)}),(t.by_values||[]).forEach(function(n,i){for(var o=[],r=[],s=[],u=e;u<t.date_list.length;u++)r=[],r.push(t.min_time[i][u]>-1?t.min_time[i][u]:"-"),r.push(t.quartile1[i][u]>-1?t.quartile1[i][u]:"-"),r.push(t.median_time[i][u]>-1?t.median_time[i][u]:"-"),r.push(t.quartile3[i][u]>-1?t.quartile3[i][u]:"-"),r.push(t.max_time[i][u]>-1?t.max_time[i][u]:"-"),o.push(r),s.push(t.avg_time[i][u]>-1?t.avg_time[i][u]:"-");a.boxData.push({key:"$ALL"===n?"总体":""===n?sensorsdata.CONSTSET.emptyStringByValueText:n||sensorsdata.CONSTSET.unknownByValueText,value:o}),a.avgData.push(s)}),a},formatTableData_:function(t){var a={body:[],extendObj:[]};return(t.by_values||[]).forEach(function(e,i){for(var o={by_value:"$ALL"===e?"总体":""===e?sensorsdata.CONSTSET.emptyStringByValue:e||sensorsdata.CONSTSET.unknownByValue,median_time:n.formatDuration(t.median_time[i][0])||"-",max_time:n.formatDuration(t.max_time[i][0])||"-",min_time:n.formatDuration(t.min_time[i][0])||"-",avg_time:n.formatDuration(t.uniqavg_time[i][0])||"-",count:t.people[i][0]||"-",index:i,extend:!1},r={body:[]},s=1;s<t.date_list.length;s++){var u={index:i,by_value:t.date_list[s]||sensorsdata.CONSTSET.unknownByValue,median_time:n.formatDuration(t.median_time[i][s])||"-",max_time:n.formatDuration(t.max_time[i][s])||"-",min_time:n.formatDuration(t.min_time[i][s])||"-",avg_time:n.formatDuration(t.uniqavg_time[i][s])||"-",count:t.people[i][s]||"-",extend:!0};r.body.push(u)}a.extendObj.push(r),a.body.push(o)}),a},destroy:function(){this.off("update")}});e.exports=o});
;/*!components/intervalCondition/intervalCondition.js*/
define("components/intervalCondition/intervalCondition",function(e,t){var n={content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,a){var i,o=t.helperMissing,s="function",l=this.escapeExpression;return'<section class="condition-field">\n  <div class="interval-label">\n    <label style="font-size: 14px;">\n      <span class="icon-chart-collapse" style="vertical-align: sub; cursor: pointer;" data-method="toggle-condition-field"></span><span>选择事件</span>\n    </label>\n    <div class="interval-relation">\n      <span>设置关联属性<!--{en}Set the associated properties--></span>\n      <span class="sa-switch"></span>\n    </div>\n  </div>\n  <section class="report-ops">\n    <div class="interval-ops ops-item" data-event="first">\n      <div class="">\n        <span class="interval-pos">A</span>\n        <div class="selector" id="select-first" data-method="select-event">\n          <button class="btn-selector multiselect" data-toggle="dropdown">\n            <span class="icon-event"></span><span class="selected" data-value="">请选择事件<!--{en}Please select events--></span>\n          </button>\n        </div>\n        <button data-method="add-filter" type="button" class="btn btn-link">\n          <span class="icon-add"></span><span>筛选条件<!--{en}Filters--></span>\n        </button>\n      </div>\n      <div class="filter-container" data-event="first_event"></div>\n      <div class="relavance-field-container" data-event="first_event" style="display: none;"></div>\n    </div>\n    <div class="interval-ops ops-item" data-event="second">\n      <div class="">\n        <span class="interval-pos">B</span>\n        <div class="selector" id="select-second" data-method="select-event">\n          <button class="btn-selector multiselect" data-toggle="dropdown">\n            <span class="icon-event"></span><span class="selected" data-value="">请选择事件<!--{en}Please select events--></span>\n          </button>\n        </div>\n        <button data-method="add-filter" type="button" class="btn btn-link">\n          <span class="icon-add"></span><span>筛选条件<!--{en}Filters--></span>\n        </button>\n      </div>\n      <div class="filter-container" data-event="second_event"></div>\n      <div class="relavance-field-container" data-event="second_event" style="display: none;"></div>\n    </div>\n    <div class="interval-ops ops-item" id="group-container"></div>\n    <div class="interval-ops ops-item" style="border-bottom: none;">\n      <span>且用户符合</span>\n      <button id="btnAddFilter" type="button" class="btn btn-link">\n        <span class="icon-add"></span><span>筛选条件</span>\n      </button>\n    </div>\n    <div class="interval-ops ops-item interval-common-filter"></div>\n  </section>\n</section>\n<section class="report-chart segmentation-chart">\n  <header>\n    <div class="report-date-picker-wrap">\n      <span class="icon-date-picker"></span>\n      <input id="inputDate" type="text" class="form-control" readonly="readonly" data-container="body" data-placement="top" data-original-title="" title="" data-calendar-status-refresh-time="1511860457">\n    </div>\n    <div class="report-name-wrap">\n      <h4 id="reportName" class="report-name">间隔分析</h4>\n    </div>\n    <div class="report-config selector btn-group">\n      <div class="dropdown chart-config">\n        <button id="charts-config" type="button" class="btn-selector dropdown-toggle" data-toggle="dropdown" data-value="line">显示设置</button>\n        <div class="config" style="display: none;"></div>\n      </div>\n      <div class="dropdown">\n        <button id="charts-unit" type="button" class="btn-selector dropdown-toggle" data-toggle="dropdown" data-value="'+l((i=null!=(i=t.unit||(null!=e?e.unit:e))?i:o,typeof i===s?i.call(e,{name:"unit",hash:{},data:a}):i))+'">\n          <span class="selected" data-value="'+l((i=null!=(i=t.unit||(null!=e?e.unit:e))?i:o,typeof i===s?i.call(e,{name:"unit",hash:{},data:a}):i))+'"></span>\n        </button>\n        <ul class="dropdown-menu pull-right" role="menu">\n          <li><a data-value="all"><span data-value="all">合计</span></a></li>\n          <li class="active"><a data-value="day"><span data-value="day">按天</span></a></li>\n          <li><a data-value="week"><span data-value="week">按周</span></a></li>\n          <li><a data-value="month"><span data-value="month">按月</span></a></li>\n        </ul>\n      </div>\n    </div>\n  </header>\n</section>\n'},useData:!0}),config:Handlebars.template({1:function(e,t,n,a){var i,o,s=t.helperMissing,l="function";return'    <li>\n      <label>\n        <input type="checkbox" value="'+this.escapeExpression((o=null!=(o=t.value||(null!=e?e.value:e))?o:s,typeof o===l?o.call(e,{name:"value",hash:{},data:a}):o))+'">\n        '+(null!=(o=null!=(o=t.cname||(null!=e?e.cname:e))?o:s,i=typeof o===l?o.call(e,{name:"cname",hash:{},data:a}):o)?i:"")+"\n      </label>\n    </li>\n"},3:function(){return"      无分组\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,a){var i;return'<div class="range-label-time sa-tab clearfix">\n  <div data-for="#chart-measure-selector" class="selected" data-index="0">显示指标<!--{en}Display Measures--></div>\n  <div data-for="#chart-by-selector" data-index="1">显示分组<!--{en}Display Groups--></div>\n</div>\n<ul id="chart-measure-selector">\n  <li>\n    <label>\n      <input type="checkbox" value="0" checked="checked">\n      间隔时间\n    </label>\n  </li>\n</ul>\n<ul id="chart-by-selector">\n'+(null!=(i=t.each.call(e,null!=e?e.byValues:e,{name:"each",hash:{},fn:this.program(1,a,0),inverse:this.program(3,a,0),data:a}))?i:"")+"</ul>\n"},useData:!0})},a={container:"body",condition:{}},i=e("components/model/intervalCondition"),o=e("components/model/intervalResult"),s=function(e){this.$container=e.container||a.container,this.reportLoading=e.reportLoading,this.init()};s.prototype.init=function(){var e=this;i.initCondition_(sensorsdata.unparam(window.location.hash)),this.render(),i.getEventProperties(function(t){e.initFilter_(t),e.initGroupControl_(t),e.initRelevanceField(t)}),this.bindEvents()},s.prototype.render=function(){var e=$.extend(!0,[],sensorsdata.cache.events.filter(function(e){return!e.virtual}));this.$container.html(n.content(i.get())),this.$container.find("#select-first").eventDropdown({events:e,eventName:i.get("first_event").event_name||e[0],onChange:function(e){i.update({action:"changeEvent",params:{first_event:{event_name:e}}})}}),this.$container.find("#select-second").eventDropdown({events:e,eventName:i.get("second_event").event_name||e[0],onChange:function(e){i.update({action:"changeEvent",params:{second_event:{event_name:e}}})}}),this.initInputDate_(),this.$container.find("#charts-unit").saDropdown({value:i.get("unit"),onSelected:function(e){i.update({params:{unit:e,rollup_date:"all"===e}})}}),this.$container.find("#charts-config").unbind("click.config").bind("click.config",function(){var e=$(this).next(".config");e.toggle().find("div[data-for]").unbind("click.ul").bind("click.ul",function(){var e=$(this).attr("data-for");$(this).hasClass("selected")||($(this).toggleClass("selected"),$(this).siblings().toggleClass("selected"),$(e).toggle().siblings("ul").toggle())})})},s.prototype.initSingleFilter=function(e,t,n){console.log(e,t,n),e.data("filter",null),e.html("");var a=new sensorsdata.FilterGroupControl;a.init({container:e,propertyObj:t,disabled:sensorsdata.authority.isNormal}),a.val({relation:n&&n.relation,conditions:n&&n.conditions}),a.bindEvent("valueChangedEvent",function(t){var n=$.extend(!0,{},t),a={};e.attr("data-event")?a[e.attr("data-event")]={filter:n}:a={filter:n},i.update({params:a,action:"changeFilter"})}),e.data("filter",a)},s.prototype.initFilter_=function(e){var t=this;this.$container.find(".filter-container").each(function(){var n=i.get($(this).attr("data-event")+".event_name"),a=i.get($(this).attr("data-event")+".filter");t.initSingleFilter($(this),{event:e.original[n].event||[]},a)}),this.$container.find(".interval-common-filter").each(function(){var n=i.get("filter")||{};t.initSingleFilter($(this),{user:e.intersection.user||[]},n)})},s.prototype.initInputDate_=function(){var e=sensorsdata.CONSTSET,t=sensorsdata.buildDefaultTimeRange(),n=$.extend(!0,{},i.get()),a={};a.startDate=moment(n.from_date?n.from_date:t[0],e.dateFormat),a.endDate=moment(n.to_date?n.to_date:t[1],e.dateFormat),a.chosenLabel=n.rangeText,a.allowRelative=!0,sensorsdata.initDateRangeInput(this.$container.find("#inputDate"),a),this.$container.find("#inputDate").unbind("apply.daterangepicker").bind("apply.daterangepicker",function(e,t){i.update({params:{from_date:t.startDate.format(sensorsdata.CONSTSET.dateFormat),to_date:t.endDate.format(sensorsdata.CONSTSET.dateFormat),rangeText:t.chosenLabel}})})},s.prototype.bindEvents=function(){var e=this;i.on("update",function(t){e.reportLoading.showLoading();var n=$.extend(!0,{},i.get());delete n.hasRelation;var a="#"+$.param(n);switch(window.history.pushState(a,"",a),o.request(i.get(),function(t){e.reportLoading.closeLoading(t)}),t.action){case"changeEvent":e.initFilter_(t.propObj),e.initGroupControl_(t.propObj),e.initRelevanceField(t.propObj)}}),this.$container.find(".interval-relation span.sa-switch").off("click.toggle").on("click.toggle",function(){$(this).toggleClass("on");var t=$(this).hasClass("on");e.$container.find("[data-event].relavance-field-container").toggle(t);var n=e.$container.find('[data-id="relation-props-select"]');n.each(function(){t||$(this).find("select").multiselect("select","none")});var a=i.get();i.update({params:{hasRelation:t,first_event:{relevance_field:t?a.first_event.relevance_field:""},second_event:{relevance_field:t?a.second_event.relevance_field:""}},action:"changeRelavance"})}),o.on("update",function(t){e.initChartConfig_(e.$container.find("#charts-config").next(".config"),t.byValues,i.get("selected"))}),this.$container.find('span[data-method="toggle-condition-field"]').unbind("click.toggle").bind("click.toggle",function(){e.$container.find("section.report-ops").toggle(),$(this).attr("class",$(this).hasClass("icon-chart-collapse")?"icon-chart-expand":"icon-chart-collapse")}),this.$container.find("#btnAddFilter").unbind("click.add-filter").bind("click.add-filter",function(){var e=$(this).parents(".ops-item").next(".ops-item");e.data("filter").addFilter()}),this.$container.find('[data-method="add-filter"]').off("click.filter").on("click.filter",function(){var e=$(this),t=e.parents(".interval-ops:first").find(".filter-container");t.data("filter").addFilter()}),$("body").unbind("click.interval.condition").bind("click.interval.condition",function(t){var n=$(t.target||t.srcElement).parents("div.chart-config:first");0===n.size()&&e.$container.find("#charts-config").next(".config").hide()})},s.prototype.initGroupControl_=function(e){var t=[];t.push({label:sensorsdata.languages.get("初始行为事件属性<!--{en}Initial event properties-->"),icon:"icon-event-property",items:$.extend(!0,[],e.original[i.get("first_event").event_name].event).map(function(e){return e.fullName="first.event."+e.event_name+"."+e.name,e})}),t.push({label:sensorsdata.languages.get("后续行为事件属性<!--{en}Properties of subsequent events-->"),icon:"icon-event-property",items:$.extend(!0,[],e.original[i.get("second_event").event_name].event).map(function(e){return e.fullName="second.event."+e.event_name+"."+e.name,e})}),t=t.concat(sensorsdata.convertProperty({user:e.intersection.user})),this.groupControl_=new sensorsdata.GroupControl,this.groupControl_.init({container:this.$container.find("#group-container"),data:t,disabled:sensorsdata.authority.isNormal,btnAddDisplay:!1,showPropertyHelp:!0});var n=i.get();if(n.by_field){var a=(n.by_event?n.by_event+".":"")+n.by_field,o={};n.bucket_param&&(o[n.by_field]=n.bucket_param),this.groupControl_.val({byFields:[a],bucket:o})}else this.groupControl_.val({});this.groupControl_.bindEvent("valueChangedEvent",function(e){var t={by_event:"",by_field:null,bucket_param:null},n=e.byFields||[],a=e.bucket||{};if(n.length>0){var o=n[0].split(".");t.by_event=4===o.length?o.shift():null,t.by_field=o.join("."),t.bucket_param=a[n[0]]}else t.by_event=null;i.update({params:t,action:"changeGroup"})})},s.prototype.initRelevanceField=function(e){var t=this;this.$container.find(".relavance-field-container").each(function(){var n=$(this).attr("data-event");t.initSingleRelevanceField($(this),e.original[i.get(n).event_name],i.get(n+".relevance_field")||"")}),this.$container.find(".interval-relation .sa-switch").toggleClass("on",i.get("hasRelation"))},s.prototype.initSingleRelevanceField=function(e,t,n){var a={propertyObj:{event:[]}},o={label:"",items:t.event};o.items=o.items.map(function(e){return e.fullName="event."+e.event_name+"."+e.name,e}),o.items.unshift({cname:sensorsdata.languages.get("无<!--{en}None-->"),fullName:"none"}),a.propertyObj.event.push(o),e.html(Mustache.render($("#tpl-props-relation").html())),e.find('[data-id="relation-props-select"] select').html(Mustache.render($("#tpl-filter-condition-item-property").html(),a.propertyObj.event));var s=e.find('[data-id="relation-props-select"] > select');s.multiselect({includeFilterClearBtn:!1,enableFiltering:!0,onChange:function(t){var n=$(t).val(),a=e.attr("data-event"),o={action:"changeRelavance",params:{}};o.params[a]={relevance_field:"none"===n?"":n,type:$(t).attr("data-type")},i.update(o)}}),s.multiselect("select",n||"none"),e.toggle(!!n)},s.prototype.initChartConfig_=function(e,t,a){var o=this,s=t.length,l=$.extend(!0,[],t),r=!1;5>s&&(l.unshift({value:"all",cname:sensorsdata.languages.get("全选<!--{en}Select all-->")}),r=!0),e.html(n.config({byValues:l})),a=$.isArray(a)?a:[],a.length>4&&a.splice(-1,1);var c=[];e.find('#chart-by-selector li [type="checkbox"]').each(function(e){var t=r?e-1:e;-1!==a.indexOf(t)&&($(this).attr("checked",!0),c.push($(this)))}),c.length===t.length&&e.find('#chart-by-selector li [type="checkbox"][value="all"]').attr("checked",!0),s>4&&o.groupOver4(e),e.find('#chart-by-selector li [type="checkbox"]').unbind("change.group").bind("change.group",function(){var t=$(this).prop("checked"),n=e.find('#chart-by-selector li [type="checkbox"]').not('[value="all"]');if("all"===$(this).val())e.find('#chart-by-selector li [type="checkbox"]').prop("checked",t);else{var a=n.size()===n.filter(":checked").size();e.find('#chart-by-selector li [type="checkbox"]').filter('[value="all"]').prop("checked",a)}var l=[];n.each(function(){if($(this).is(":checked")){var e=$(this).parents("li:first").index();e=r?e-1:e,l.push(e)}}),i.update({params:{selected:l},action:"changeChartGroup"}),s>4&&o.groupOver4(e)})},s.prototype.groupOver4=function(e){var t=e.find('#chart-by-selector li [type="checkbox"]'),n=t.filter(function(e,t){return t.checked}),a=t.filter(function(e,t){return!t.checked});4===n.length?a.prop("disabled","disabled"):t.prop("disabled","")},s.prototype.destroy=function(){$.isFunction(i.destroy)&&i.destroy(),$.isFunction(o.destroy)&&o.destroy(),$("body").off("click.interval.condition")},t.create=function(e){return new s(e)}});
;/*!components/intervalTable/intervalTable.js*/
define("components/intervalTable/intervalTable",function(n,t){var e={content:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="interval-table-container">\n  <table class="table-normal">\n    <thead class="header">\n      <tr>\n        <th class=""></th>\n        <th></th>\n        <th>间隔时间中位数<!--{en}Median of interval time--></th>\n        <th>最大值<!--{en}Max value--></th>\n        <th>最小值<!--{en}Min value--></th>\n        <th>人均转化时间<!--{en}Conversion time per capita --></th>\n        <th>转化用户数<!--{en}Converted user number--></th>\n      </tr>\n    </thead>\n    <tbody>\n    </tbody>\n  </table>\n</div>\n<div id="table-pagination"></div>\n'},useData:!0}),body:Handlebars.template({1:function(n,t,e,a){var i,l,o=t.helperMissing,s="function",r=this.escapeExpression;return'  <tr data-index="'+r((l=null!=(l=t.index||(null!=n?n.index:n))?l:o,typeof l===s?l.call(n,{name:"index",hash:{},data:a}):l))+'">\n    <th>\n'+(null!=(i=t["if"].call(n,null!=n?n.extend:n,{name:"if",hash:{},fn:this.program(2,a,0),inverse:this.program(4,a,0),data:a}))?i:"")+"    </th>\n    <td>\n"+(null!=(i=t["if"].call(n,null!=n?n.extend:n,{name:"if",hash:{},fn:this.program(6,a,0),inverse:this.program(8,a,0),data:a}))?i:"")+"    </td>\n    <td>"+r((l=null!=(l=t.median_time||(null!=n?n.median_time:n))?l:o,typeof l===s?l.call(n,{name:"median_time",hash:{},data:a}):l))+"</td>\n    <td>"+r((l=null!=(l=t.max_time||(null!=n?n.max_time:n))?l:o,typeof l===s?l.call(n,{name:"max_time",hash:{},data:a}):l))+"</td>\n    <td>"+r((l=null!=(l=t.min_time||(null!=n?n.min_time:n))?l:o,typeof l===s?l.call(n,{name:"min_time",hash:{},data:a}):l))+"</td>\n    <td>"+r((l=null!=(l=t.avg_time||(null!=n?n.avg_time:n))?l:o,typeof l===s?l.call(n,{name:"avg_time",hash:{},data:a}):l))+"</td>\n    <td>"+r((l=null!=(l=t.count||(null!=n?n.count:n))?l:o,typeof l===s?l.call(n,{name:"count",hash:{},data:a}):l))+"</td>\n  </tr>\n"},2:function(){return"        \n"},4:function(){return'        <span style="cursor: pointer;" data-method="toggle-date"><span class="icon-collapse-right icon" style="vertical-align: sub;"></span></span>\n'},6:function(n,t,e,a){var i,l,o=t.helperMissing,s="function";return'        <span data-inserted-row="'+this.escapeExpression((l=null!=(l=t.index||(null!=n?n.index:n))?l:o,typeof l===s?l.call(n,{name:"index",hash:{},data:a}):l))+'">'+(null!=(l=null!=(l=t.by_value||(null!=n?n.by_value:n))?l:o,i=typeof l===s?l.call(n,{name:"by_value",hash:{},data:a}):l)?i:"")+"</span>\n"},8:function(n,t,e,a){var i,l;return"        <span  data-inserted-row>"+(null!=(l=null!=(l=t.by_value||(null!=n?n.by_value:n))?l:t.helperMissing,i="function"==typeof l?l.call(n,{name:"by_value",hash:{},data:a}):l)?i:"")+"</span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,t,e,a){var i,l,o;return l=null!=(l=t.body||(null!=n?n.body:n))?l:t.helperMissing,o={name:"body",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a},i="function"==typeof l?l.call(n,o):l,t.body||(i=t.blockHelperMissing.call(n,i,o)),null!=i?i:""},useData:!0})},a={container:$("body"),data:{}},i=function(n){this.options=$.extend(!0,{},a,n),this.$container=n.container||$("body"),this.$container.html(e.content()),this.init()};i.prototype.init=function(){this.render(),this.bindEvents()},i.prototype.render=function(){var n=this,t=function(t,a){var l={body:i.slice(t,a)};n.$container.find("table > tbody").html(e.body(l))},a=sensorsdata.CONSTSET.paginationSize,i=this.options.data.body;0===i.length?this.$container.html(""):i.length<a?t(0,i.length):sensorsdata.pagination({totalItems:i.length,tableElement:n.$container,paginationElement:n.$container.find("#table-pagination").show(),pageItems:a,clickHandle:sensorsdata.bind(function(n){t(n.range[0]-1,n.range[1])},this),updateHeader:sensorsdata.bind(function(n){n.find("table thead.header-copy").remove(),n.find("table").fixedHeader()},this)}),this.$container.find("table").fixedHeader()},i.prototype.bindEvents=function(){var n=this;this.$container.find("table").delegate('[data-method="toggle-date"]',"click.toggle",function(){var t=$(this).parents("tr:first"),a=parseInt(t.attr("data-index"),10),i=$(this).find("span.icon");if(i.hasClass("icon-collapse-right")){var l=e.body(n.options.data.extendObj[a]);$(l).insertAfter(t)}else n.$container.find('[data-inserted-row="'+a+'"]').parents("tr").remove();i.attr("class",i.hasClass("icon-expand-down")?"icon-collapse-right icon":"icon-expand-down icon")})},t.create=function(n){return new i(n)}});
;/*!components/lego/legoConfig/legoMeasureSet/container.js*/
define("components/lego/legoConfig/legoMeasureSet/container",function(e,a,n){var t={container:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<form class="dashboard-config-form form-inline" data-state="off">\n  <p>使用以下事件生成概览，额外选择数值类型属性，会使用该属性生成相应的指标</p>\n  <div class="events-list">\n\n  </div>\n  <div class="form-group">\n    <button data-method="by-add" type="button" class="btn btn-link">\n      <span class="icon-add"></span>\n      <span>添加事件</span>\n    </button>\n  </div>\n</form>\n'},useData:!0}),multiselectEvents:Handlebars.template({1:function(e,a,n,t){var s,l,i=a.helperMissing,r="function",o=this.escapeExpression;return'        <option value="'+o((l=null!=(l=a.name||(null!=e?e.name:e))?l:i,typeof l===r?l.call(e,{name:"name",hash:{},data:t}):l))+'" data-index="'+o((l=null!=(l=a.index||(null!=e?e.index:e))?l:i,typeof l===r?l.call(e,{name:"index",hash:{},data:t}):l))+'" '+(null!=(s=a["if"].call(e,null!=e?e.selected:e,{name:"if",hash:{},fn:this.program(2,t,0),inverse:this.noop,data:t}))?s:"")+">"+(null!=(l=null!=(l=a.cname||(null!=e?e.cname:e))?l:i,s=typeof l===r?l.call(e,{name:"cname",hash:{},data:t}):l)?s:"")+"</option>\n"},2:function(){return'selected="selected"'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,n,t){var s,l;return'<div class="event-item">\n  <div class="selector">\n    <span class="event-index">'+this.escapeExpression((l=null!=(l=a.index||(null!=e?e.index:e))?l:a.helperMissing,"function"==typeof l?l.call(e,{name:"index",hash:{},data:t}):l))+'</span>\n    <select class="" name="">\n'+(null!=(s=a.each.call(e,null!=e?e.list:e,{name:"each",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t}))?s:"")+'    </select>\n  </div>\n  <button data-method="add-pro" type="button" class="btn btn-link">\n      <span class="icon-add"></span>\n      <span>添加属性</span>\n      <span class="icon-help" data-original-title="请选择数值类型属性，&#10;我们会根据该属性计算出相关指标"></span>\n  </button>\n  <button data-method="measure-remove" type="button" class="btn-link event-measure-remove">\n    <span class="icon-remove"></span>\n  </button>\n</div>'},useData:!0}),measurePro:Handlebars.template({1:function(e,a,n,t){var s,l=a.helperMissing,i="function",r=this.escapeExpression;return'        <span class="selected cur-measure" data-event-name="'+r((s=null!=(s=a.event_name||(null!=e?e.event_name:e))?s:l,typeof s===i?s.call(e,{name:"event_name",hash:{},data:t}):s))+'" data-aggregator="'+r((s=null!=(s=a.aggregator||(null!=e?e.aggregator:e))?s:l,typeof s===i?s.call(e,{name:"aggregator",hash:{},data:t}):s))+'" data-field="'+r((s=null!=(s=a.field||(null!=e?e.field:e))?s:l,typeof s===i?s.call(e,{name:"field",hash:{},data:t}):s))+'" >\n          '+r((s=null!=(s=a.measureName||(null!=e?e.measureName:e))?s:l,typeof s===i?s.call(e,{name:"measureName",hash:{},data:t}):s))+"\n        </span>\n"},3:function(e,a,n,t){var s,l,i=a.helperMissing,r="function",o=this.escapeExpression;return"      <li "+(null!=(s=a["if"].call(e,null!=e?e.selected:e,{name:"if",hash:{},fn:this.program(4,t,0),inverse:this.noop,data:t}))?s:"")+'>\n        <a tabindex="-1" data-field="'+o((l=null!=(l=a.measureField||(null!=e?e.measureField:e))?l:i,typeof l===r?l.call(e,{name:"measureField",hash:{},data:t}):l))+'" data-cname="'+o((l=null!=(l=a.cname||(null!=e?e.cname:e))?l:i,typeof l===r?l.call(e,{name:"cname",hash:{},data:t}):l))+'">'+o((l=null!=(l=a.cname||(null!=e?e.cname:e))?l:i,typeof l===r?l.call(e,{name:"cname",hash:{},data:t}):l))+"<!--{en}"+o((l=null!=(l=a.name||(null!=e?e.name:e))?l:i,typeof l===r?l.call(e,{name:"name",hash:{},data:t}):l))+"--></a>\n      </li>\n"},4:function(){return'class="active"'},6:function(e,a,n,t){var s,l,i=a.helperMissing,r="function",o=this.escapeExpression;return"        <li "+(null!=(s=a["if"].call(e,null!=e?e.selected:e,{name:"if",hash:{},fn:this.program(4,t,0),inverse:this.noop,data:t}))?s:"")+'>\n          <a tabindex="-1" data-field="'+o((l=null!=(l=a.measureField||(null!=e?e.measureField:e))?l:i,typeof l===r?l.call(e,{name:"measureField",hash:{},data:t}):l))+'" data-cname="'+o((l=null!=(l=a.cname||(null!=e?e.cname:e))?l:i,typeof l===r?l.call(e,{name:"cname",hash:{},data:t}):l))+'">'+o((l=null!=(l=a.cname||(null!=e?e.cname:e))?l:i,typeof l===r?l.call(e,{name:"cname",hash:{},data:t}):l))+"<!--{en}"+o((l=null!=(l=a.name||(null!=e?e.name:e))?l:i,typeof l===r?l.call(e,{name:"name",hash:{},data:t}):l))+"--></a>\n        </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,a,n,t){var s;return'<div class="aggregator-item">\n  <span>的</span>\n  <div class="selector dropdown">\n    <button data-toggle="dropdown" class="btn-selector dropdown-toggle" data-target="#">\n'+(null!=(s=a.each.call(e,null!=e?e.curMeasure:e,{name:"each",hash:{},fn:this.program(1,t,0),inverse:this.noop,data:t}))?s:"")+'    </button>\n    <ul class="dropdown-menu" data-method="choose-agg-one">\n'+(null!=(s=a.each.call(e,null!=e?e.measures:e,{name:"each",hash:{},fn:this.program(3,t,0),inverse:this.noop,data:t}))?s:"")+"\n"+(null!=(s=a.each.call(e,null!=e?e.notMeasures:e,{name:"each",hash:{},fn:this.program(6,t,0),inverse:this.noop,data:t}))?s:"")+"    </ul>\n  </div>\n</div>"},useData:!0})},s={general:"总次数",unique:"触发用户数",average:"人均次数",SUM:"总和",AVG:"均值",MAX:"最大值",MIN:"最小值",uniqAvg:"人均值",uniqCount:"去重数"},l={eventName:"$Anything",property:{}},i=$.extend(!0,{},sensorsdata.EventsModule,{init:function(e){this.segBase=new sensorsdata.SegmentationBase,this.$modal=e,this.modalBody=this.$modal.find(".modal-body"),this.eventsCon=null,this.addBtn=null,this.saSwitch=null,this.eventsList=null,this.eventsLength=0,this.request("events/all",this.handleEvents),this.bindEvents()},request:function(e,a){sensorsdata.ajax({url:e,success:function(e){$.isFunction(a)&&a.call(this,e)}.bind(this)})},handleEvents:function(e){e=e||[],e.unshift({name:"$Anything",cname:"任意事件"}),this.eventsList=e},findSlected:function(e,a){for(var n=0,t=e.length;t>n;n++){var s=e[n];if(s.name===a){s.selected=!0;break}}},simuOffset:function(e){var a=e.width(),n=e.height(),t=e.prevAll().length*n-e.parent().scrollTop()+2;return{left:a,top:t}},createMultiselect:function(e,a){var n=e.multiselect({toggleClose:!1,enableCaseInsensitiveFiltering:!1,onChange:function(e){this.selectEvent=e.val(),this.handleProperties(this.selectEvent,!0,e.closest(".event-item"))}.bind(this)});return a===!1&&e.multiselect("disable"),n},show:function(e){this.eventsLength=0,this.modalBody.html(t.container()),this.modalBody=this.$modal.find(".modal-body"),this.eventsCon=this.$modal.find(".events-list"),this.saSwitch=this.$modal.find(".sa-switch");var a=e&&e.measures||[],n=e?e.is_public:!0;if(n||this.saSwitch.removeClass("on"),a&&a.length>0)for(var s=0,l=a.length;l>s;s++){var i=a[s],r=i.event_name;this.addEvent(r),i.field&&this.handleProperties(r,!1,this.eventsCon.children().slice(-1))}},handleProperties:function(e,a,n){this.segBase.getProperties([e],function(t){var s=this.measures;if(this.properties=this.filterMeasureProperties(t.original[e].event,e),a){n.attr("data-event",e);var l=n.find(".aggregator-item");if(!l.length)return;l.remove()}s&&0!==s.length||(s=this.properties.measures[0]||this.properties.notMeasures[0]),n&&this.renderOneAggregator(this.properties,s[0],!1,n)}.bind(this))},filterMeasureProperties:function(e){for(var a=[],n=[],t=0,s=e.length;s>t;t++){var l=e[t];l.measureField=["event",l.event_name,l.name].join("."),"$user_id"!==l.name&&"number"===l.data_type&&l.is_measure?(l.isMeasure="is_measure",a.push($.extend(!0,{},l))):(l.isMeasure="not_measure",l.aggregator="uniqCount",n.push($.extend(!0,{},l)))}return{measures:a,notMeasures:n}},bindEvents:function(){var e=this;this.$modal.off("click",["data-method"]).on("click",["data-method"],function(a){var n,t,s,l=$(a.target||a.srcElement),i=l.attr("data-method")||l.closest("[data-method]").attr("data-method");switch(i){case"onoff":var r=e.saSwitch;r.hasClass("on")?r.removeClass("on"):r.addClass("on");break;case"by-add":e.addEvent();break;case"add-pro":var o=l.closest(".event-item");e.renderOneAggregator(e.properties,"",!1,o);break;case"measure-remove":var d=l.closest(".event-item"),c=d.index();d.remove(),d=null,e.handleListIndex(c);break;case"choose-agg-one":if(n=l.closest(".aggregator-item").find(".cur-measure"),t=l.closest("li"),t.hasClass("disabled"))return;if(t.hasClass("dropdown-submenu"))return!1;s=t.find("a"),t.addClass("active").siblings().removeClass("active"),n.attr("data-aggregator",s.attr("data-aggregator")).attr("data-field",s.attr("data-field")).text(s.attr("data-cname"));break;case"choose-agg-two":if(n=l.closest(".aggregator-item").find(".cur-measure"),t=l.closest("li"),t.hasClass("disabled"))return;var u=t.index(),h=t.parent(),m=h.prev().children().eq(h.attr("data-index"));s=t.find("a"),m.addClass("active").siblings(".active").removeClass("active"),n.attr("data-aggregator",s.attr("data-aggregator")).attr("data-field",s.attr("data-field")).text(s.attr("data-cname")+"的"+s.text()),m.children().eq(1).children().eq(u).addClass("active").siblings().removeClass("active")}}),this.$modal.off("mouseover").on("mouseover",function(e){var a=$(e.target||e.srcElement),n=a.closest(".drop-one-clone"),t=a.closest(".dropdown-submenu"),s=t.index();if(!(n.length>0)&&(this.$modal.find('[data-method="choose-agg-one"]').next().remove(),t.length>0)){var l=t.children().eq(1).clone(!0),i=this.simuOffset(t);l.addClass("drop-one-clone").attr("data-index",s),l.css({marginTop:i.top,marginLeft:i.left}),l.insertAfter(t.parent())}}.bind(this))},renderCurMeasureName:function(e,a){e=JSON.parse(JSON.stringify(e));var n=s[a.aggregator];if(!a.name)return a.measureName=n,e;for(var t=e.measures,l=e.notMeasures,i=a.name,r=0,o=t.length;o>r;r++)if(t[r].name===i)return a.measureName=t[r].cname,t[r].selected=!0,e;for(r=0,o=l.length;o>r;r++)if(l[r].name===i)return a.measureName=l[r].cname,l[r].selected=!0,e},addEvent:function(e){var a=this,n=JSON.parse(JSON.stringify(a.eventsList));e=e||l.eventName,a.findSlected(n,e);var s=$(t.multiselectEvents({index:a.eventsLength+1,list:n}));a.eventsCon.append(s),a.createMultiselect(s.find("select").eq(0)),s.attr("data-event",e).find(".btn-selector").prepend('<span class="icon-event"></span>'),a.eventsLength++,a.handleProperties(e),s.find(".icon-help").tooltip("destroy").tooltip()},renderOneAggregator:function(e,a,n,s){a=a||e.measures[0]||e.notMeasures[0],e=this.renderCurMeasureName(e,a),e.curMeasure=[a],e.isCanDel=n,s.addClass("has-pro").children().slice(-1).before(t.measurePro(e))},handleListIndex:function(e){var a=this,n=a.eventsCon.find(".event-index").slice(e),t=n.length;n.each(function(e,n){var s=a.eventsLength-t+e;$(n).text(s)}),a.eventsLength--},get:function(){var e=[];return this.eventsCon.find(".event-item").each(function(a,n){var t=$(n),s=t.find(".cur-measure"),l={event_name:t.attr("data-event")};s.length>0&&(l.aggregator=s.attr("data-aggregator"),s.attr("data-field")&&(l.field=s.attr("data-field"))),e.push(l)}),this.eventsLength=0,e}});n.exports=i});
;/*!components/lego/legoConfig/legoConfig.js*/
define("components/lego/legoConfig/legoConfig",function(n,s,a){var i=n("components/lego/legoConfig/legoMeasureSet/container"),l=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="modal fade modal-legoContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" id=\'lego-config\'>\n  <div class="modal-dialog modal-start lego-set" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title"></h4>\n      </div> \n      <div class="error-info info-container info">  <span class="icon-warning"></span>\n        <span class="error-text">修改设置中的事件，会同步修改“事件转化”模块的概览</span>\n      </div>\n      <div class="modal-body">\n        \n      </div>\n      <div class="modal-footer">\n        <button type="button" class="pop-is-success btn btn-primary btn-small"><!--{todo}Confirm--></button>\n        <div class="lego-auth">\n          <label>全部人可见<!--{en}Visible to all--></label>\n          <span class="action-onoff" data-method="onoff">\n            <span class="sa-switch on"></span>\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0}),e={tplStart:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="lego-start">\n  <img src="../../../res/img/lego/lego-start.png">\n  <h3>简单设置概览，全面掌控指标！</h3>\n</div>'},useData:!0}),tplLead:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="lego-lead">\n  <h6>我们会为您自动生成以下类型指标</h6>\n  <div class="lego-item-box">\n    <div class="lego-item">\n      <div class="item-head">\n        <div class="img-utm-box">\n          <span class="img-utm gs">\n            <img src="../../../res/img/lego/general-situation.png">\n          </span>\n        </div>\n        <div class="lego-type-info">\n          <span>整体概况</span>\n        </div>\n      </div>\n      <div class="item-body">\n        <p>从产品整体的使用情况出发，自动生成产品的基础的数据指标，可以从宏观上对产品的整体健康情况有基础的了解。</p>\n        <ul>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>实时访问流量</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>整体访问流量</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>整体留存</span>\n          </li>\n          <li><span class="ellipsis">...</span></li>\n        </ul>\n      </div>\n      \n\n    </div>\n    <div class="lego-item">\n      <div class="item-head">\n        <div class="img-utm-box">\n          <span class="img-utm ug">\n            <img src="../../../res/img/lego/user-get.png">\n          </span>\n        </div>\n        <div class="lego-type-info">\n          <span>用户获取</span>\n        </div>\n      </div>\n      <div class="item-body">\n        <p>从获客渠道和版本的方向出发，根据不同渠道、版本生成指标，可以清晰的观察每个渠道的流量、转化等情况。</p>\n        <ul>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>渠道拉新能力</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>渠道访问人数</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>渠道留存</span>\n          </li>\n          <li><span class="ellipsis">...</span></li>\n        </ul>\n      </div>\n      \n\n    </div>\n    <div class="lego-item">\n      <div class="item-head">\n        <div class="img-utm-box">\n          <span class="img-utm ar">\n            <img src="../../../res/img/lego/active-remain.png">\n          </span>\n        </div>\n        <div class="lego-type-info">\n          <span>活跃与留存</span>\n        </div>\n      </div>\n      <div class="item-body">\n        <p>从用户的访问和粘性出发，可以观察出产品在用户访问、回访等方面的趋势变化，清楚地了解用户对产品的粘性和沉浸程度。</p>\n        <ul>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>新老用户访问量</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>新老用户人均访问时长</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>新老用户留存与流失</span>\n          </li>\n          <li><span class="ellipsis">...</span></li>\n        </ul>\n      </div>\n    </div>\n    <div class="lego-item">\n      <div class="item-head">\n        <div class="img-utm-box">\n          <span class="img-utm et">\n            <img src="../../../res/img/lego/event-translate.png">\n          </span>\n        </div>\n        <div class="lego-type-info">\n          <span>事件转化</span>\n        </div>\n      </div>\n      <div class="item-body">\n        <p>根据选择的事件和属性，为您生成该事件的发生次数、人数、分布等数据指标，可以了解整体的用户转化以及收益相关的数据情况。</p>\n        <ul>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>关键事件发生次数</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>关键事件的事件分布</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>关键事件的收益金额</span>\n          </li>\n          <li><span class="ellipsis">...</span></li>\n        </ul>\n      </div>\n    </div>\n    <div class="lego-item">\n      <div class="item-head">\n        <div class="img-utm-box">\n          <span class="img-utm up">\n            <img src="../../../res/img/lego/user-profile.png">\n          </span>\n        </div>\n        <div class="lego-type-info">\n          <span>用户特征</span>\n        </div>\n      </div>\n      <div class="item-body">\n        <p>根据地址位置、性别、操作系统等一些基础属性，将用户进行分组，方便您更加了解用户的分布占比情况。</p>\n        <ul>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>地域分布</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>性别分布</span>\n          </li>\n          <li>\n            <span class="icon-circle-correct"></span>\n            <span>操作系统分布</span>\n          </li>\n          <li><span class="ellipsis">...</span></li>\n        </ul>\n      </div>\n    </div>\n    \n  </div>\n</div>'},useData:!0})},t=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.$modal&&(this.$modal.remove(),this.$modal=null),this.$modal=$(l()),this.$title=this.$modal.find(".modal-title"),this.$body=this.$modal.find(".modal-body"),this.$confirmBtn=this.$modal.find(".pop-is-success"),this.$modalContent=this.$modal.find(".modal-content"),this.$saSwitch=this.$modal.find(".sa-switch"),this.initEvent.call(this),i.init(this.$modal)},show:function(n,s){this.options=n,this.callback=s,$("body").addClass("modal-open"),n?this.handleConf():(this.$modalContent.addClass("welcom-page"),this.$title.text("预置概览设置"),this.$confirmBtn.text("开始设置").removeClass("lego-save").addClass("lego-start"),this.$body.html(e.tplStart())),this.$modal.modal("show")},initEvent:function(){var n=this;this.$modal.off("click",".pop-is-success").on("click",".pop-is-success",function(){var s=$(this),a=$("#lego-config").children().eq(0);s.hasClass("lego-start")?n.handleStart(a):s.hasClass("lego-lead")?n.handleLead(a):($.isFunction(n.callback)&&n.callback({measures:i.get(),is_public:n.$saSwitch.hasClass("on")}),n.$modal.modal("hide"))}),this.$modal.on("hidden.bs.modal",function(){this.$modal.children().removeClass("lead-content")}.bind(this))},handleStart:function(n){this.$title.text("预置概览指标设置"),this.$confirmBtn.text("设置事件").removeClass("lego-start").addClass("lego-lead"),this.$body.html(e.tplLead()),n.addClass("lead-content")},handleLead:function(n,s){this.$saSwitch.addClass("on"),this.$title.text("预置概览设置"),this.$confirmBtn.text("保存").removeClass("lego-lead").addClass("lego-save"),this.$body.html(e.tplLead()),n.removeClass("lead-content").addClass("lego-set"),this.$modalContent.removeClass("welcom-page"),i.show(s)},handleConf:function(){sensorsdata.ajax({url:"lego/config",method:"GET",success:function(n){this.handleLead($("#lego-config").children().eq(0),n)}.bind(this)})}});a.exports=t});
;/*!components/model/legos.js*/
define("components/model/legos",function(e,o,a){var t=e("components/dataCache/dataCache").create,n=t(),r={checkId:function(e,o,a){if("number"!=typeof e)throw new Error(o+": "+a+" id 参数不能为空且必须为 number 类型")},checkTitle:function(e,o,a){if(!e)throw new Error(o+": "+a+" title 参数不能为空")},checkCallback:function(e,o,a){if("function"!=typeof e)throw new Error(o+": "+a+" callback 参数不能为空，且必须为 function")},checkArray:function(e,o,a){if(!(e instanceof Array))throw new Error(o+": "+a+" data 参数不能为空，且必须为 Array 类型")},checkObject:function(e,o,a){if("object"!=typeof e)throw new Error(o+": "+a+" options 参数不能为空，且必须为 Object 类型")},checkSortNav:function(e,o){var a=function(e){return"number"==typeof e},t=function(e){return e&&"number"==typeof e.newIndex&&"number"==typeof e.oldIndex?!0:!1};if("group"!==e&&"dashboard"!==e)throw new Error("dashboardsNavDB: sort type 参数值只能为 group 或 dashboard");if("group"===e){if(!o||!t(o.update))throw new Error("dashboardsNavDB: sort 分组排序必须设置 options.update 参数，且标识 newIndex 和 oldIndex")}else if(!o||!(t(o.update)&&a(o.update.id)||t(o.add)&&t(o.del)&&a(o.add.id)&&a(o.del.id)))throw new Error("dashboardsNavDB: sort 概览页排序必须设置 options.update 参数或 options.add && options.delete 参数，且标识 id、newIndex、oldIndex")}},d=$.extend({},sensorsdata.EventsModule,{get:function(e,o){var a;o||(a=n.get("legos")),a?e(a):sensorsdata.ajax({url:"lego",showLoader:!1,success:function(o){n.set("legos",o||[]),e(o)}})},getMap:function(e,o){this.get(function(o){e(o)},o)},getItem:function(e,o){this.getMap(function(a){o(sensorsdata.util.arrayToMap(a,"id")[e])})},checkId:function(e,o){r.checkId(e,"dashboardModel","checkId"),r.checkCallback(o,"dashboardModel","checkId"),this.getMap(function(a){o(!!sensorsdata.util.arrayToMap(a,"id")[e])})}}),s=$.extend({},sensorsdata.EventsModule,{get:function(e){sensorsdata.ajax({url:"legosNav",showLoader:!1,success:function(o){e(o)}})},getFull:function(e,o){var a=this,t=null,n=function(){var o=a.handleDashboads(t);e(o)};d.getMap(function(e){t=e,n()},o)},handleDashboads:function(e){for(var o,a=[],t={},n=0;n<e.length;n++){var r=e[n],d=r.navigation_name;void 0!==d&&(t[d]?t[d].dashboards.push(r):t[d]={title:d,isShare:!!sensorsdata.authority.role,status:"off",dashboards:[r],id:999999+n})}for(var s in t){var i=t[s],c=i.dashboards;"事件转化"!==s?(this.handleMulDashboad(s,c),a.push(t[s])):o=t[s]}return o&&a.push(o),{groups:a}},setGroupExpand:function(e,o){var a={};e instanceof Array?e.forEach(function(e){a[e[0]]=e[1]}):a[e]=o,this.get(function(e){e.groups.forEach(function(e){var o=a[e.id];("on"===o||"off"===o)&&(e.status=o)})})},handleMulDashboad:function(e,o){if("事件转化"!==e)for(var a=function(){for(var e,o=sensorsdata.cache.events,a=0,t=o.length;t>a;a++){var n=o[a];"$pageview"===n.name&&(e=e?"both":"Web"),"$AppStart"===n.name&&(e=e?"both":"App")}return e}(),t={},n=0;n<o.length;){var r=o[n],d=t[r.name];if(void 0!==r.source_type)if(void 0!==d)if("WEB"!==r.source_type||"Web"!==a&&"both"!==a)"App"===a?(o[d].dataId=o[d].dataId+";"+r.id,o.splice(n,1)):o.splice(n,1);else{var s=o.splice(n,1)[0];r.dataId=r.id+";"+o[d].dataId,o.splice(d,1,s)}else t[r.name]=n,r.dataId=r.id,n++;else n++}}});a.exports={legoModel:d,legosNavModel:s}});
;/*!components/lego/legosNav/legosNav.js*/
define("components/lego/legosNav/legosNav",function(a,n,e){var s=a("components/model/legos"),t=a("components/lego/legoConfig/legoConfig"),l=s.legosNavModel,i=!1,o=$.Deferred(),d=null,r={content:Handlebars.template({1:function(a,n,e,s){var t,l,i,o=n.helperMissing,d="function",r=n.blockHelperMissing,h=this.escapeExpression,u='    <div class="group';return l=null!=(l=n.isShare||(null!=a?a.isShare:a))?l:o,i={name:"isShare",hash:{},fn:this.program(2,s,0),inverse:this.noop,data:s},t=typeof l===d?l.call(a,i):l,n.isShare||(t=r.call(a,t,i)),null!=t&&(u+=t),u+=" onoff-"+h((l=null!=(l=n.status||(null!=a?a.status:a))?l:o,typeof l===d?l.call(a,{name:"status",hash:{},data:s}):l))+'" data-status="'+h((l=null!=(l=n.status||(null!=a?a.status:a))?l:o,typeof l===d?l.call(a,{name:"status",hash:{},data:s}):l))+'" data-id="'+h((l=null!=(l=n.id||(null!=a?a.id:a))?l:o,typeof l===d?l.call(a,{name:"id",hash:{},data:s}):l))+'">\n      ',l=null!=(l=n.isShare||(null!=a?a.isShare:a))?l:o,i={name:"isShare",hash:{},fn:this.program(4,s,0),inverse:this.noop,data:s},t=typeof l===d?l.call(a,i):l,n.isShare||(t=r.call(a,t,i)),null!=t&&(u+=t),u+='\n      <h5>\n        <span class="icon-share"></span>\n',l=null!=(l=n.isShare||(null!=a?a.isShare:a))?l:o,i={name:"isShare",hash:{},fn:this.noop,inverse:this.program(6,s,0),data:s},t=typeof l===d?l.call(a,i):l,n.isShare||(t=r.call(a,t,i)),null!=t&&(u+=t),u+='        <span class="title">'+h((l=null!=(l=n.title||(null!=a?a.title:a))?l:o,typeof l===d?l.call(a,{name:"title",hash:{},data:s}):l))+'</span>\n        <span class="action-onoff" data-method="expandGroup" data-id="'+h((l=null!=(l=n.id||(null!=a?a.id:a))?l:o,typeof l===d?l.call(a,{name:"id",hash:{},data:s}):l))+'">\n          <span class="icon-collapse-up"></span>\n          <span class="icon-expand-down"></span>\n        </span>\n      </h5>\n      <ul data-id="'+h((l=null!=(l=n.id||(null!=a?a.id:a))?l:o,typeof l===d?l.call(a,{name:"id",hash:{},data:s}):l))+'">\n',l=null!=(l=n.dashboards||(null!=a?a.dashboards:a))?l:o,i={name:"dashboards",hash:{},fn:this.program(8,s,0),inverse:this.noop,data:s},t=typeof l===d?l.call(a,i):l,n.dashboards||(t=r.call(a,t,i)),null!=t&&(u+=t),u+"      </ul>\n    </div>\n"},2:function(){return" group-share"},4:function(){return'<div class="extra"></div>'},6:function(){return""},8:function(a,n,e,s){var t,l,i,o=n.helperMissing,d="function",r=this.escapeExpression,h=n.blockHelperMissing,u='        <li data-nav="/lego/#dashid='+r((l=null!=(l=n.id||(null!=a?a.id:a))?l:o,typeof l===d?l.call(a,{name:"id",hash:{},data:s}):l))+'" data-id="'+r((l=null!=(l=n.id||(null!=a?a.id:a))?l:o,typeof l===d?l.call(a,{name:"id",hash:{},data:s}):l))+'"';return l=null!=(l=n.isShare||(null!=a?a.isShare:a))?l:o,i={name:"isShare",hash:{},fn:this.program(9,s,0),inverse:this.noop,data:s},t=typeof l===d?l.call(a,i):l,n.isShare||(t=h.call(a,t,i)),null!=t&&(u+=t),u+=" ",l=null!=(l=n.dataId||(null!=a?a.dataId:a))?l:o,i={name:"dataId",hash:{},fn:this.program(11,s,0),inverse:this.noop,data:s},t=typeof l===d?l.call(a,i):l,n.dataId||(t=h.call(a,t,i)),null!=t&&(u+=t),u+='>\n          <a href="/lego/#dashid='+r((l=null!=(l=n.id||(null!=a?a.id:a))?l:o,typeof l===d?l.call(a,{name:"id",hash:{},data:s}):l))+'" data-href="/lego/#dashid='+r((l=null!=(l=n.id||(null!=a?a.id:a))?l:o,typeof l===d?l.call(a,{name:"id",hash:{},data:s}):l))+'" title="'+r((l=null!=(l=n.name||(null!=a?a.name:a))?l:o,typeof l===d?l.call(a,{name:"name",hash:{},data:s}):l))+'">\n            <span class="icon-dashboard-share"></span>\n            <span class="title">'+r((l=null!=(l=n.name||(null!=a?a.name:a))?l:o,typeof l===d?l.call(a,{name:"name",hash:{},data:s}):l)),l=null!=(l=n.isShare||(null!=a?a.isShare:a))?l:o,i={name:"isShare",hash:{},fn:this.program(13,s,0),inverse:this.noop,data:s},t=typeof l===d?l.call(a,i):l,n.isShare||(t=h.call(a,t,i)),null!=t&&(u+=t),u+"</span></a>\n        </li>\n"},9:function(){return' data-share="true"'},11:function(a){return'data-mul-id="'+this.escapeExpression(this.lambda(a,a))+'"'},13:function(a,n,e,s){var t;return" <i>("+this.escapeExpression((t=null!=(t=n.username||(null!=a?a.username:a))?t:n.helperMissing,"function"==typeof t?t.call(a,{name:"username",hash:{},data:s}):t))+")</i></i>"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,n,e,s){var t,l,i,o='<div class="groups">\n';return l=null!=(l=n.groups||(null!=a?a.groups:a))?l:n.helperMissing,i={name:"groups",hash:{},fn:this.program(1,s,0),inverse:this.noop,data:s},t="function"==typeof l?l.call(a,i):l,n.groups||(t=n.blockHelperMissing.call(a,t,i)),null!=t&&(o+=t),o+"</div>"},useData:!0}),addLego:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="add-lego">\n  <div data-method="addLego">\n    <span class="add-lego-icon"></span>\n    <span>一键生成概览</span>\n  </div>\n</div>'},useData:!0})},h=["整体概况","用户获取","活跃与留存","事件转化","用户特征"],u={init:function(){if(!i){i=!0,this.$container=$("#legosNav"),this.$bd=this.$container.find(".bd");var a=this;return sensorsdata.ajax({url:"events/all",success:function(n){$.isArray(n)||sensorsdata.error.show(sensorsdata.languages.get("数据格式错误，请联系技术人员<!--{en}Data in wrong format, please contact with technicians-->")),sensorsdata.cache.events=n,a.loadData(),a.bindEvents(),t.init()}}),o}},loadData:function(a){var n=this;l.getFull(function(a){d=a,n.render(),o.resolve()},a)},render:function(){if(d.groups&&d.groups.length>0){for(var a=d.groups,n=[],e=0,s=h.length;s>e;e++)for(var t=h[e],l=0,i=a.length;i>l;l++){var o=a[l];if(t===o.title){n.push(o);break}}d.groups=n,this.$bd.html(r.content(d))}else this.$bd.html(r.addLego());var u=sensorsdata.unparam(location.hash).dashid;u&&this.setAction(Number(u))},bindEvents:function(){var a=this;this.$container.delegate("[data-method]","click",function(n){n.preventDefault(),a.handleUIAction(this)}),this.$container.mouseleave(sensorsdata.bind(this.mouseleaveHandle,this))},handleModelAction:function(a){switch(a.action){case"add":this.addGroupHandle(a);break;case"del":this.deleteGroupHandle(a);break;case"update":this.updateGroupHandle(a);break;case"addDashboard":this.addDashboardHandle(a);break;case"deleteDashboard":this.deleteDashboardHandle(a);break;case"updateDashboard":this.updateDashboardHandle(a)}},mouseleaveHandle:function(){this.queueExpandGroups&&this.queueExpandGroups.length&&(sensorsdata.deferManager.remove("dashboardsNavExpandGroup"),this.queueExpandGroups.length=0),this.waitingUpdateOrders&&(this.waitingUpdateOrders=!1,this.updateOrdersProxy())},handleUIAction:function(a){var n=a.getAttribute("data-method");switch(n){case"expandGroup":this.expandGroupHandle(a);break;case"addLego":if(sensorsdata.authority.role)return void sensorsdata.info.show("请联系管理员添加");t.show(null,sensorsdata.bind(this.handleConfig,this));break;case"edit-conf":t.show(d&&d.groups&&d.groups.length>0,sensorsdata.bind(this.handleConfig,this))}},expandGroupHandle:function(a){this.expandGroup(a.getAttribute("data-id"))},expandGroup:function(a){var n=this.$bd.find(".group[data-id="+a+"]"),e="on"===n.attr("data-status")?"off":"on";n.removeClass("onoff-on, onoff-off").addClass("onoff-"+e).attr("data-status",e)},setAction:function(a){var n=this.$bd.find("li.active");if(Number(n.attr("data-id"))!==a){var e=this.$bd.find("li[data-id="+a+"]"),s=e.parents(".group");"off"===s.attr("data-status")&&this.expandGroup(s.attr("data-id")),n.removeClass("active"),e.addClass("active")}},handleConfig:function(a){var n=this;sensorsdata.ajax({url:"lego/config",method:"POST",data:JSON.stringify(a),success:function(){n.loadData(!0)}})}};e.exports=u});
;/*!components/legoboardTopbar/legoboardTopbar.js*/
define("components/legoboardTopbar/legoboardTopbar",function(t,n){function a(t){this.options=t,this.init()}var e=t("components/model/legos").legoModel,s={dashboardTopbarTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,n,a,e){var s,i=n.helperMissing,o="function",d=this.escapeExpression;return'<div class="dashboard-toolbar">\n  <span contenteditable="false" class="dashboard-name" data-originName="'+d((s=null!=(s=n.name||(null!=t?t.name:t))?s:i,typeof s===o?s.call(t,{name:"name",hash:{},data:e}):s))+'">'+d((s=null!=(s=n.name||(null!=t?t.name:t))?s:i,typeof s===o?s.call(t,{name:"name",hash:{},data:e}):s))+'</span>\n  <div class="pull-right btn-group">\n    <button type="button" class="btn btn-default" data-method="trends">Web</button>\n    <button type="button" class="btn btn-default" data-method="overview">App</button>\n  </div>\n  <div class="btn-group">\n    <button class="my_dashboard_refresh_btn btn btn-default btn-icon right-btn">\n      <span class="icon-refresh"></span>\n    </button>\n  </div>\n</div>\n'},useData:!0})};a.prototype=$.extend({},sensorsdata.EventsModule,{timeFormat:sensorsdata.CONSTSET.dateFormat,init:function(){var t=this;e.getItem(parseInt(t.options.id,10),function(n){t.options.placeholder.replaceWith(s.dashboardTopbarTpl($.extend(!0,{},n,{isEmail_:!!t.options.isEmail_}))),"function"==typeof t.options.callback&&t.options.callback()}),this.$container=$(".dashboard-toolbar"),this.$container.find(".date-content").hide(),this.initEvents(),this.setContainWidget(),this.setShare(!0)},initEvents:function(){var t=this;this.$container.find(".my_dashboard_refresh_btn").off("click").bind("click",function(){t.options.onRefresh()})},setShare:function(t){this.isShareDash=t,t?this.$container.find(".not-match-authority").hide():this.$container.find(".not-match-authority").show()},setContainWidget:function(t){t?(this.$container.find(".right-btn").show(),this.setShare(this.isShareDash)):this.$container.find(".right-btn").hide()},setDashActive:function(t){var n=this.$container.find(".pull-right button");switch(t){case"both":n.removeClass("active").eq(0).addClass("active");break;case"Web":n.removeClass("active").eq(0).addClass("active"),n.eq(1).addClass("disabled");break;case"App":n.removeClass("active").eq(1).addClass("active"),n.eq(0).addClass("disabled");break;default:n.removeClass("active").addClass("disabled")}},destroy:function(){}}),n.create=function(t){return new a(t)}});
;/*!components/model/reportUtm.js*/
define("components/model/reportUtm",function(r,e){var o={query:function(r,e,o){var s=this.processQueryParams(r.param),n=this.processConfig(r.config),a=sensorsdata.api.get("utm")+"?bookmarkId="+r.bookmarkid;sensorsdata.reportAjax({queueEnable:!0,queueKey:"POST-"+a+JSON.stringify(s),method:"POST",url:a,showLoader:n.showLoader,showCommonError:n.showCommonError,data:s,success:function(r){$.isFunction(e)&&e(r)},error:o})},processQueryParams:function(r){var e=$.extend(!0,{},r);return $.isArray(e.measures)&&0!==e.measures.length||delete e.measures,e},processConfig:function(r){var e=$.extend(!0,{showCommonError:!1,showLoader:!1},r);return e}};e.query=function(r,e,s){return o.query(r,e,s)}});
;/*!components/model/queryModel.js*/
define("components/model/queryModel",function(e,o){var t={report:{defaultModel:e("components/model/reportModel"),customModel:{utm:e("components/model/reportUtm")},get:function(e){return this.customModel[e]||this.defaultModel}}};o.get=function(e,o){return t[o||"report"].get(e)}});
;/*!components/model/dashboard.chart.js*/
define("components/model/dashboard.chart",function(e,t){function a(e){this.saveConfig(e)}var r=e("components/model/queryModel"),o=e("components/chartDataFactory/chartDataFactory"),i=e("components/config/dashboard.size").checkSize,n=e("components/config/dashboard.size").get,c=e("components/config/dashboard.widget"),s=e("components/util/util"),d={regs:{date:/^\d{4}-\d{1,2}-\d{1,2}/},checkOptions:function(e){var t=[{check:function(){return"object"===$.type(e)},msg:"options 参数必须是 Object 类型"},{check:function(){return"object"===$.type(e.bookmark)&&"string"===$.type(e.bookmark.name)&&"string"===$.type(e.bookmark.type)&&e.bookmark.type&&("string"===$.type(e.bookmark.data)||"object"===$.type(e.bookmark.data))},msg:"options.bookmark 参数不是 Object 类型，或参数值的数据结构有误"}];t.forEach(function(e){if(!e.check())throw new Error("model/ChartModel: "+e.msg)})},checkCallback:function(e){if(!$.isFunction(e))throw new Error("model/ChartModel: 第 1 个参数必须是 function 类型")}},u={},f=["line","column","pie","stack"];a.prototype=$.extend(!0,{},sensorsdata.EventsModule,{saveConfig:function(e){var t=$.extend(!0,{config:{}},e.bookmark);u[this.__id__=s.guid()]={bookmark:t,config:s.json.parse(e.config)},t.data=s.json.parse(t.data),t.config=s.json.parse(t.config)},getMeta:function(e){var t=u[this.__id__],a=t.bookmark,r=a.data;r.rangeText&&(r.rangeText=r.rangeText.replace(/过去(\d+)天/g,function(e,t){return"过去 "+t+" 天"}));var o=this.getChartsType(a),i=this.getFirstSize(t),c=a.type.replace(/\//g,""),d=n({type:c,queryParams:a.data,size:i,chartsType:o}),m=$.param(a.data),p=r.rangeText,_=e&&e.widgetTime;_&&_.from_date&&_.to_date&&_.relativeValue&&(p=s.getRangeText(_.relativeValue)||""),"segmentation"===c&&f.indexOf(o)>=0&&(m=$.param($.extend(!0,a.data,{chartsType:o}))),d.forEach(function(e){e.name===i&&(e.selected=!0)});var h=a.config.compareKey,g=sensorsdata.cache.project&&sensorsdata.cache.project.name;return $.extend(!0,{bookmarkConfig:a.config,id:a.id,name:a.name,url:a.type+"?project="+g+"#"+m+"&bookmarkid="+a.id,chartsType:o,queryParams:a.data,type:a.type.replace(/\//g,""),sizes:d,currentSize:this.getFirstSize(t),filter:t.filter,rangeText:p,singleMeasure:this.identifySingleMeasure(o,a.data),tabName:this.getActiveTab(t.config)},this.getDataParams(r,e,h))},getUpdateTime:function(e){var t=u[this.__id__];if(t){var a=e&&e.data||t.data;return{data_sufficient_update_time:a.data_sufficient_update_time,data_update_time:a.data_update_time,report_update_time:a.report_update_time}}},getFirstSize:function(e){var t={"/utm/":!0};return e.config.size?e.config.size:t[e.bookmark.type]?"large":"normal"},getChartsType:function(e){var t="";switch(e.type){case"/funnel/":t="funnel";break;case"/retention/":t="line";break;case"/addiction/":t="column";break;case"/utm/":t="table";break;case"/user_analytics/":var a=e.data.by_fields||[];t=a.length>0?"pie":"number";break;default:t=e.config.chartsType||e.data.chartsType||"line"}return t},identifySingleMeasure:function(e,t){return"line"!==e&&"column"!==e&&"stack"!==e?!1:t.measures&&1===t.measures.length&&t.by_fields&&t.by_fields.length>0?!0:!1},getActiveTab:function(e){return e.tab_name?e.tab_name:"default"},getDataParams:function(e,t,a){if(t&&"object"===$.type(t.widgetTime))return{from_date:t.widgetTime.from_date,to_date:t.widgetTime.to_date};var r={compareKey:a,from_date:e.from_date,to_date:e.to_date,compare_from_date:e.compare_from_date,compare_to_date:e.compare_to_date},o=s.getTimeRange(e.rangeText,e.compare_from_date&&e.compare_to_date,r),i="hour"===e.unit||"minute"===e.unit,n=i?sensorsdata.CONSTSET.timeFormat:sensorsdata.CONSTSET.dateFormat;if(e.rangeText&&!$.isEmptyObject(o)){if(i){var c=moment(e.from_date).hour(),u=moment(e.to_date).hour()||23;o.from_date=moment(o.from_date).hour(c).format(n),o.to_date=moment(o.to_date).hour(u).format(n)}return o}return e.from_date&&d.regs.date.test(e.from_date)&&e.to_date&&d.regs.date.test(e.to_date)?{from_date:e.from_date,to_date:e.to_date}:{}},get:function(e,t){if(t=$.isFunction(e)?e:t,e="object"===$.type(e)?e:{},d.checkCallback(t),this.checkCache(e))return void this.buildChartData(e,t);var a=this.buildReportParams(e);r.get(a.type).query(a,s.bind(function(a){u[this.__id__]&&("object"===$.type(e.widgetTime)&&e.widgetTime||(u[this.__id__].data=a),e.data=a,this.buildChartData(e,t))},this),s.bind(function(e){this.trigger("error",e&&e.responseJSON&&e.responseJSON.error)},this))},checkCache:function(e){for(var t=u[this.__id__],a=[function(){return t.data},function(){return!e},function(){return!e||!e.dashboard_cache_policy},function(){return!e||e.useCache!==!1},function(){return!(e&&"object"===$.type(e.widgetTime))},function(){return!e||!e.filter||!e.filter.unit||"rollup"===e.filter.unit}],r=0,o=a.length;o>r;r++)if(!a[r]())return!1;return!0},buildReportParams:function(e){var t=u[this.__id__],a=t.bookmark,r=$.extend(!0,{},a.data),o=a.type.replace(/\//g,""),i=e&&e.filter&&e.filter.unit||t&&t.filter&&t.filter.unit;return $.extend(!0,r,this.getDataParams(r,e,a.config&&a.config.compareKey)),i&&"rollup"!==i&&(r.unit=i),e&&e.useCache===!1&&(r.use_cache=!1),e&&e.dashboard_cache_policy&&(r.dashboard_cache_policy=e.dashboard_cache_policy),r.ignore_cache_expire=!0,this.processQueryParams(o,r),r.x_axis_field&&delete r.x_axis_field,"funnel"===o&&$.isArray(r.bucket_param)?r.bucket_param=sensorsdata.buildBucketPopoverValue(r.bucket_param):"funnel"===o&&delete r.bucket_param,{type:o,param:r,bookmarkid:a.id,config:{showLoader:!1,showCommonError:!1,loadCompare:this.checkNeedCompare({reportType:o,chartsType:this.getChartsType(a),queryParams:r,config:a.config})}}},processQueryParams:function(e,t){switch(e){case"segmentation":t.detail_and_rollup=!0;break;case"addiction":t.rollup_date=!0}delete t.dashboard_id,delete t.chartsType,delete t.rangeText},checkNeedCompare:function(e){return"segmentation"!==e.reportType||"table"===e.chartsType||e.config&&"rollup"===e.config.unit||!c({chartsType:"number",queryParams:e.queryParams}).support?!1:!0},buildChartData:function(e,t){var a=u[this.__id__],r=e&&e.data||a.data;if($.isEmptyObject(r))return void t({});var i=a.bookmark,n=i.config.chartsType||i.data.chartsType||"line",c=i.config.compareKey,s=$.extend(!0,{},i.data,this.getDataParams(i.data,e,c));e&&e.useCache===!1&&(s.use_cache=!1);var d={reportType:i.type.replace(/\//g,""),chartsType:n,queryParams:s,data:r,config:i.config,bookmarkid:i.id,filter:a.filter},f={meta:this.getMeta(e),numberData:null,chartsData:null,updateTime:this.getUpdateTime(e)},m="number"!==n?2:1;o.reportToCharts($.extend(!0,{},d,{chartsType:"number"}),function(e){f.numberData=e,m--,m||t(f)}),"number"!==n&&o.reportToCharts(d,function(e){f.chartsData=e,m--,m||t(f)})},update:function(e,t){if("object"===$.type(e)&&!$.isEmptyObject(e)){var a=u[this.__id__];if("object"===$.type(e.bookmark)&&!$.isEmptyObject(e.bookmark)){var r=a.bookmark,o=a.bookmark=e.bookmark;o.data=s.json.parse(o.data),o.config=s.json.parse(o.config),r&&s.diff(r.data,o.data)||(a.data=null)}if("object"===$.type(e.config)&&(a.config=s.json.parse(e.config)),"object"===$.type(e.filter)){a.filter=a.filter||{};for(var i in e.filter)e.filter.hasOwnProperty(i)&&(a.filter[i]=e.filter[i])}t!==!1&&this.refresh(e)}},refresh:function(e){var t=this;this.trigger("clean"),this.get(e,function(e){t.trigger("update",e)},function(e){t.trigger("error",e)})},updateSize:function(e){var t=i.checkSize({bookmark:u[this.__id__].bookmark,data:u[this.__id__].data},e);this.trigger("update",{statusCode:t?1:2,size:e})},destroy:function(){delete u[this.__id__],this.trigger("destroy")}}),t.create=function(e){return d.checkOptions(e),new a(e)},t.isInstanceof=function(e){return e instanceof a}});
;/*!components/model/trackManager.js*/
define("components/model/trackManager",function(n,a,e){var s={queryReport:function(n,a){sensorsdata.ajax({url:"data_source/report",method:"POST",showLoader:!0,data:JSON.stringify(n),success:function(n){$.isFunction(a)&&a(n)}})},getDisabled:function(n){sensorsdata.ajax({url:"data_source/disabled",success:sensorsdata.bind(function(a){$.isFunction(n)&&n(a)},this)})},getSourceCategory:function(n){sensorsdata.ajax({method:"GET",url:"data_source/category",success:function(a){var e=(a.app_version||[]).map(function(n){return{name:n,cname:"unknown"===n?sensorsdata.languages.get("未知<!--{en}unknown-->"):n}});e.unshift({name:"all",cname:sensorsdata.languages.get("全部<!--{en}All-->")});var s=(a.lib||[]).map(function(n){return{name:n,cname:"unknown"===n?sensorsdata.languages.get("未知<!--{en}unknown-->"):n}});s.unshift({name:"all",cname:sensorsdata.languages.get("全部<!--{en}All-->")}),$.isFunction(n)&&n({lib:s,app_version:e})}})},queryErrorInfo:function(n,a){delete n.status,sensorsdata.ajax({url:"data_source/error_info",data:JSON.stringify(n),method:"POST",showLoader:!0,success:function(n){$.isFunction(a)&&a(n)}})}};e.exports=s});
;/*!components/profilingTable/profilingTable.js*/
define("components/profilingTable/profilingTable",function(a,t){function e(a,t){this.$container=a,this.options=t,this.createTable()}var n=a("components/util/util"),l={profilingTableContainerTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="profiling-table" class="profiling-table">\n  <div class="toolbar">\n    <span>监控历史查询</span>\n    <div id="type-selector" class="selector" data-query="queryStatus">\n      <button class="btn-selector multiselect" data-toggle="dropdown">\n        <span class="multiselect-selected-text">筛选类型\n        </span>\n      </button>\n      <ul class="dropdown-menu" role="menu">\n        <li>\n          <a data-value="">所有查询</a>\n        </li>\n        <li>\n          <a data-value="EXCEPTION">失败的查询</a>\n        </li>\n        <li>\n          <a data-value="EXCEPTION">取消的查询</a>\n        </li>\n      </ul>\n    </div>\n    <div id="period-selector" class="selector" data-query="timeFilter">\n      <button class="btn-selector multiselect" data-toggle="dropdown">\n        <span class="multiselect-selected-text">筛选时间\n        </span>\n      </button>\n      <ul class="dropdown-menu" role="menu">\n        <li>\n          <a data-value="running">当前运行中查询</a>\n        </li>\n        <li>\n          <a data-value="30m">最近30分钟</a>\n        </li>\n        <li>\n          <a data-value="1h">最近1小时</a>\n        </li>\n        <li>\n          <a data-value="12h">最近12小时</a>\n        </li>\n        <li>\n          <a data-value="24h">最近24小时</a>\n        </li>\n      </ul>\n    </div>\n  </div>\n\n  <div class="table-container">\n  </div>\n\n  <div id="profiling-modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog">\n    <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n          <h4 id="modal-title" class="modal-title"></h4>\n        </div>\n        <div class="modal-body">\n          <p class="modal-text"></p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'},useData:!0}),profilingTableTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<table class="table" id="profiling-query" data-toolbar="#toolbar">\n</table>'},useData:!0}),noData:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="nodata-container">\n  <p class="nodata">\n    <svg width="79px" height="79px" viewBox="0 0 79 79" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <desc>nodata</desc>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Group-17" transform="translate(-94.000000, 0.000000)">\n          <g id="Group-13" transform="translate(94.000000, 0.000000)">\n            <circle id="Oval-8" fill="#F4F8FD" cx="39.5" cy="39.5" r="39.5"></circle>\n            <g id="repair" transform="translate(20.000000, 19.000000)" fill-rule="nonzero">\n              <path d="M37.5139181,26.0078125 C35.6191813,24.109375 32.905809,23.2657031 30.2859259,23.7344531 L25.8324366,19.15625 C25.3646004,18.6875 24.6159844,18.7109375 24.17154,19.1796875 L21.785653,21.5702344 L19.3059649,24.0546094 C18.8382066,24.5233594 18.8382066,25.2499219 19.3059649,25.71875 L23.6659649,30.3671094 C23.2215205,32.96875 24.0401559,35.7109375 25.9582846,37.609375 C29.1396491,40.796875 34.3326316,40.796875 37.5138402,37.609375 C40.7185965,34.3984375 40.7185965,29.1953125 37.5139181,26.0078125 Z M29.2566862,34.2813281 C28.5782456,33.6015625 28.2274464,32.7109375 28.2274464,31.7969531 C28.2274464,30.9063281 28.5782456,30.0157031 29.2566862,29.3125781 C30.6134893,27.953125 32.8589474,27.953125 34.2157505,29.3125781 C35.5957895,30.6953125 35.5957895,32.921875 34.2157505,34.2813281 C32.8590253,35.6640625 30.6134893,35.6640625 29.2566862,34.2813281 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M37.5139181,37.609375 C34.3326316,40.796875 29.1397271,40.796875 25.9583626,37.609375 C24.0402339,35.7109375 23.2215984,32.9688281 23.6660429,30.3671094 L19.3060429,25.71875 C18.8382846,25.25 18.8382846,24.5234375 19.3060429,24.0546094 L21.785731,21.5702344 L29.2566862,29.3125781 C28.5782456,30.0157031 28.2274464,30.9063281 28.2274464,31.7969531 C28.2274464,32.7109375 28.5782456,33.6015625 29.2566862,34.2813281 C30.6134893,35.6640625 32.8589474,35.6640625 34.2157505,34.2813281 L37.5139181,37.609375 Z"\n                id="Shape" fill="#2DCA93"></path>\n              <path d="M20.7797271,14.2578125 L16.1813645,10.0078125 C16.7895517,7.26570313 15.994152,4.40625 13.9825341,2.390625 C10.7778558,-0.796875 5.58479532,-0.796875 2.40358674,2.390625 C-0.801091618,5.6015625 -0.801091618,10.7813281 2.40358674,13.9921875 C4.29832359,15.890625 7.03524366,16.7342969 9.63173489,16.2655469 L14.3470565,20.75 C14.5576608,20.9608594 14.8617544,21.078125 15.165848,21.078125 C15.4699415,21.078125 15.7506433,20.9608594 15.9844834,20.75 L18.4640156,18.2421875 L20.8031969,15.8984375 C21.2710331,15.453125 21.2476413,14.703125 20.7797271,14.2578125 Z M5.70191033,10.6874219 C5.02346979,9.98429687 4.67267057,9.09367187 4.67267057,8.20304687 C4.67267057,7.2890625 5.02346979,6.3984375 5.70191033,5.71867187 C7.03524366,4.38273437 9.35103314,4.38273437 10.6843665,5.71867187 C12.0410136,7.078125 12.0410136,9.3046875 10.6609747,10.6874219 C9.30417154,12.046875 7.08194932,12.046875 5.70191033,10.6874219 Z"\n                id="Shape" fill="#68D9B1"></path>\n              <path d="M18.4640156,18.2421875 L15.9844834,20.75 C15.7506433,20.9608594 15.4699415,21.078125 15.165848,21.078125 C14.8617544,21.078125 14.5576608,20.9608594 14.3470565,20.75 L9.63173489,16.2655469 C7.03524366,16.7342969 4.29832359,15.890625 2.40358674,13.9921875 C-0.801091618,10.78125 -0.801091618,5.60148438 2.40358674,2.390625 L5.70191033,5.71867187 C5.02346979,6.3984375 4.67267057,7.2890625 4.67267057,8.20304687 C4.67267057,9.09367187 5.02346979,9.98429687 5.70191033,10.6874219 C7.08194932,12.046875 9.30417154,12.046875 10.6609747,10.6874219 L18.4640156,18.2421875 Z"\n                id="Shape" fill="#2DCA93"></path>\n              <path d="M39.1359844,4.65773437 C38.7850292,3.95460937 37.8260429,3.76726562 37.2412476,4.35320312 L33.7793372,7.821875 C33.3582846,7.72820312 33.0073294,7.5171875 32.7032359,7.2359375 C32.4225341,6.93125 32.2119298,6.57960937 32.1184405,6.15773437 L35.5803509,2.6890625 C36.1651462,2.1265625 36.0015595,1.14210937 35.2762573,0.790625 C32.1418324,-0.6859375 28.3992203,-0.053125 25.942924,2.4078125 C23.9780897,4.37648437 23.1826901,7.16554687 23.7207797,9.83742187 C18.691462,14.8530469 14.6661209,18.70375 9.63680312,23.7192187 C7.01692008,23.2271094 4.25668616,24.0708594 2.29185185,26.0864062 C-0.912826511,29.4146094 -0.655516569,34.5707812 2.43220273,37.6177344 C5.6602729,40.8286719 10.8766472,40.8052344 14.0812476,37.4769531 C15.9759844,35.5082812 16.7011306,32.8832812 16.2566862,30.3520312 L30.4809357,16.30625 C33.0073294,16.7046094 35.6271345,15.9078906 37.5218713,14.0094531 C39.9780117,11.5483594 40.6096686,7.79835937 39.1359844,4.65773437 Z M10.6660429,34.2660937 C9.30939571,35.6489844 7.1105653,35.6489844 5.73037037,34.2895312 L5.70697856,34.2660937 C4.35033138,32.9067969 4.35033138,30.6802344 5.70697856,29.2973437 C7.08717349,27.9380469 9.30939571,27.9380469 10.6660429,29.2973437 C12.0462378,30.6802344 12.0462378,32.906875 10.6660429,34.2660937 Z"\n                id="Shape" fill="#D7ECF6"></path>\n              <path d="M37.5218713,14.009375 C35.6271345,15.9078125 33.0072515,16.7046094 30.4809357,16.3061719 L16.2567641,30.3521094 C16.7012086,32.8834375 15.9760624,35.5083594 14.0813255,37.4770313 C10.8766472,40.8052344 5.66035088,40.82875 2.4322807,37.6178125 L5.73044834,34.2896094 C7.11064327,35.6490625 9.30947368,35.6490625 10.6661209,34.2661719 C12.0463158,32.906875 12.0463158,30.6803125 10.6661209,29.2974219 L32.7032359,7.2359375 C33.0073294,7.5171875 33.3582846,7.72820313 33.7793372,7.821875 L37.2412476,4.35320313 C37.8260429,3.76726563 38.7850292,3.9546875 39.1359844,4.65773438 C40.6096686,7.79835938 39.9780117,11.5483594 37.5218713,14.009375 Z"\n                id="Shape" fill="#C1DBE8"></path>\n            </g>\n          </g>\n        </g>\n      </g>\n    </svg>\n    <br /> 暂无监控历史查询\n    <!--{todo}-->\n    <br />\n  </p>\n</div>'},useData:!0})};e.prototype.createTable=function(){this.$container.html(l.profilingTableContainerTpl()),this.showTable()},e.prototype.showTable=function(){var a=this.$container;this.renderTable(a),this.initSelector(),this.initEvent()},e.prototype.renderTable=function(a){var t=this,e=t.showDialog,n=this.loadData;a.find(".table-container").html(l.profilingTableTpl()),$("#profiling-query").bootstrapTable({onClickCell:function(a,t,n,l){l.hasClass("clickable")&&e(a,t)},fixedColumns:!0,fixedNumber:2,columns:[{field:"project",title:"项目",width:"120"},{field:"user",title:"用户",width:"120"},{field:"duration",title:"持续时间",width:"160",sortable:!0},{field:"hdfs_byte_read",title:"读取HDFS数据量",width:"160",sortable:!0},{field:"memory_accrual",title:"内存占用量",width:"160",sortable:!0},{field:"thread_cpu_time",title:"CPU累积耗时",width:"180",sortable:!0},{field:"query_type",title:"查询类型",width:"160"},{field:"dashboard_id",title:"来自概览",width:"160"},{field:"bookmark_id",title:"来自书签",width:"160"},{field:"start_to_end",title:"起止时间",width:"300"},{field:"sql",title:"SQL",width:"140","class":"clickable"},{field:"request",title:"关联的原始请求",width:"140","class":"clickable"},{field:"sampling_factor",title:"抽样系数",width:"80"},{field:"reason",title:"是否成功",width:"120"}],sortable:!0,cache:!0,pagination:!0,sidePagination:"client",pageSize:20,showPaginationSwitch:!0,paginationLoop:!1,paginationPreText:"",paginationNextText:""}),n();var i=['<span class="icon_selector">',"</span>"].join("");$("#profiling-table .sortable").append(i)},e.prototype.initEvent=function(){var a=this.loadData,t={};$(".profiling-table .toolbar [data-value]").on("click",function(e){var n=$(e.target);if(!(n.hasClass("disabled")||$(".profiling-table .selector a[data-value='running']").hasClass("active")&&""===n.attr("data-value"))){var l=n.parents(".selector[data-query]").attr("data-query"),i=n.attr("data-value"),o=n.text();n.parent().parent().find(".active").removeClass("active"),n.addClass("active"),$(".profiling-table .selector[data-query='"+l+"'] button span").text(o),i?t[l]=i:delete t[l];var r=$(".selector>ul>li").find("a[data-value='EXCEPTION']");"running"===t[l]?(t={queryStatus:["RUNNING","CREATED","INITIALIZED","COMPILED"]},r.removeClass("active").addClass("disabled"),$(".selector[data-query='queryStatus'] button span").text("所有查询"),$(".selector[data-query='queryStatus'] a[data-value='']").addClass("active")):Array.isArray(t.queryStatus)&&"RUNNING".indexOf(t.queryStatus)&&r.removeClass("disabled"),t.timeFilter&&Array.isArray(t.queryStatus)&&"RUNNING".indexOf(t.queryStatus)&&(t={timeFilter:t.timeFilter}),a(t)}});var e=$("#profiling-table .fixed-table-header-columns"),n=$("#profiling-table .fixed-table-body-columns"),i=!1;$("#profiling-table .fixed-table-body").on("scroll",function(){0===this.scrollLeft?(e.removeClass("decorate-shadow").addClass("no-shadow"),n.removeClass("decorate-shadow").addClass("no-shadow"),i=!1):i||(e.removeClass("no-shadow").addClass("decorate-shadow"),n.removeClass("no-shadow").addClass("decorate-shadow"),i=!0)}),$("#profiling-query").on("post-body.bs.table",function(){if($("#profiling-table tbody .clickable").length&&$.each($("#profiling-table tbody .clickable"),function(a,t){"-"===$(t).text()&&$(t).removeClass("clickable")}),!$("#profiling-table ul.pagination .icon_pre").length){var a=['<span class="icon_pre">',"</span>"].join(""),t=['<span class="icon_next">',"</span>"].join("");$("#profiling-table ul.pagination .page-pre .page-link").append(a),$("#profiling-table ul.pagination .page-next .page-link").append(t)}}),$("#profiling-query").on("sort.bs.table",function(){($(".table tbody .no-records-found").length||$(".table tbody .nodata-container").length)&&setTimeout(function(){$(".table tbody").empty(),$(".table tbody").html(l.noData())})})},e.prototype.initSelector=function(){var a={timeFilter:"30m",queryStatus:""};for(var t in a){var e=$(".selector[data-query='"+t+"'] ul>li>[data-value='"+a[t]+"']");e.parent().parent().find(".active").removeClass("active"),e.addClass("active");var n=e.parents(".selector[data-query]").attr("data-query"),l=e.text();n&&$(".selector[data-query='"+n+"'] button span").text(l)}},e.prototype.loadData=function(a){var t=a==={}?"":"?",e=[],n=[];for(var o in a)a.hasOwnProperty(o)&&(e.push(o),n.push(a[o]));for(var r=0;r<e.length;r++){var s=n[r];Array.isArray(s)&&(s=s.toString()),t+=e[r]+"="+s,r+1!==e.length&&(t+="&")}var d=sensorsdata.api.get("profiling_query"),c=a&&a!=={}?d+t:d;sensorsdata.ajax({url:c,success:function(a){var t=$("#profiling-table .fixed-table-body"),e=$("#profiling-table .sortable .icon_selector");i(a),$("#profiling-query").bootstrapTable("load",a),0===a.length?($("#profiling-table .table tbody").empty().html(l.noData()),e.hide(),t.scrollLeft(0),t.css("overflow-x","hidden")):(e.show(),t.css("overflow-x","auto"))}})},e.prototype.showDialog=function(a,t){t&&($("#profiling-modal .modal-title").html($("[data-field="+a+"]").text()),$("#profiling-modal .modal-body .modal-text").html(t),$("#profiling-modal").modal("show"))},e.prototype.destroy=function(){this.$container.empty()};var i=function(a){var t="-",e=function(a){if(0===a)return"0KB";if(isNaN(a))return t;var e=["Bytes","KB","MB","GB","TB","PB"],n=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(n))).toFixed(2)+e[n]},l=function(a){return n.formatDuration(a)||t};a.forEach(function(a){for(var n in a)a[n]&&"undefined"!==a[n]&&"null"!==a[n]&&0!==a[n].length||(a[n]=t);a.memory_accrual=e(parseFloat(a.memory_accrual)),a.hdfs_byte_read=e(parseFloat(a.hdfs_byte_read)),a.duration=l(a.duration/=1e3,"second"),a.start_to_end=a.start_time+" ~ "+a.end_time,a.thread_cpu_time+="毫秒"})};t.create=function(a,t){return new e(a,t)}});
;/*!components/qrCodeModal/qrCodeModal.js*/
define("components/qrCodeModal/qrCodeModal",function(a,e,s){var n=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a){return'<div class="modal fade modal-qrcode" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">\n  <div class="modal-dialog" role="document" style="width: 325px; height: 415px;">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n      </div>\n      <div class="modal-body">\n        <label class="qr-title">- 快速安全登录 -</label>\n        <p class="qr-subtitle">打开<span class="green-text">掌上神策 APP</span>，扫码登录</p>\n        <div class="qr-content">\n          <img src="'+this.escapeExpression(this.lambda(a,a))+'" class="qr-code"/>\n          <img src="/res/img/qr-side.png" class="qr-side"/>\n        </div>\n      </div>\n      <div class="modal-footer"></div>\n    </div>\n  </div>\n</div>\n'},useData:!0}),d={show:function(){var a="/api/app/login/qr?project="+sensorsdata.cache.project.name+"&"+(sensorsdata.guid()+""+(new Date).getTime()),e=$(n(a));e.modal(),e.modal("show"),e.on("hidden.bs.modal",function(){this.remove()})}};s.exports=d});
;/*!components/queryChannelManage/queryChannelManage.js*/
define("components/queryChannelManage/queryChannelManage",function(n,e){var a={queryChannelTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="modal fade" id="queryChannel" tabindex="-1" role="dialog"\n   aria-labelledby="queryChannelLabel" aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal"\n           aria-hidden="true">×\n        </button>\n        <h4 class="modal-title">查询渠道信息工具<!--{en}Query channel information tool--></h4>\n      </div>\n      <div class="modal-body">\n        <div class="query-form">\n          <div>\n            <label>测试设备 IP :<!--{en}Test device IP:--></label>\n            <input type="text" class="ip" placeholder="请输入测试设备的ip" data-lang-placeholder="<!--{en}Please enter the IP of the test device-->">\n          </div>\n          <div>\n            <label>测试设备号:<!--{en}Test device number:--></label>\n            <input type="text" class="devices" placeholder="请输入 IDFA 或 IMEI ，非必填" data-lang-placeholder="<!--{en}Please enter IDFA or IMEI, not required-->">\n          </div>\n        </div>\n        <div class="result-content" style="display: none;">\n          <div class="tip">最多展示20条，请输入更多信息后再次查询</div>\n          <div class="result-json"></div>\n          <a data-method="copy-channel" data-clipboard-target=".result-json">复制</a>\n          <span data-method="copy-success" style="display: none;">已复制</span>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-link btn-small" data-dismiss="modal">取消<!--{en}Cancel--></button>\n        <button type="button" class="btn btn-primary btn-small changeOk">查询<!--{en}Ok--></button>\n      </div>\n    </div>\n  </div>\n</div>'},useData:!0})},t=$.extend(!0,{},sensorsdata.EventsModule,{isinit:!1,init:function(){this.isinit||(this.isinit=!0,$("body").append(a.queryChannelTpl()),this.initEvents_())},initEvents_:function(){$("#queryChannel").find('a[data-method="copy-channel"]').on("click",function(){var n=$(this).attr("data-index"),e='#queryChannel a[data-method="copy-channel"][data-index="'+n+'"]',a=new Clipboard(e,{container:document.getElementById("queryChannel")});a.on("success",function(){$(e).hide(),$('span[data-method="copy-success"]').show()})}),$("#queryChannel").find(".changeOk").on("click",sensorsdata.bind(this.queryChannel_,this))},popQueryChannel_:function(){this.isinit||this.init(),this.show(),console.log("popQueryChannel_")},show:function(){var n=$("#queryChannel");n.find(".tip, .result-content").hide(),n.find("input[type=text]").val(""),n.find("a[data-method=copy-channel]").show(),n.modal("show")},beautifyJSON_:function(n,e){var a={dom:n,imgCollapsed:"/res/img/Collapsed.gif",imgExpanded:"/res/img/Expanded.gif",isCollapsible:!1},t=new JsonFormater(a);t.doFormat(e)},queryChannel_:function(){var n=this,e=$("#queryChannel"),a=$.trim(e.find(".ip").val()),t=$.trim(e.find(".devices").val()),i=[];return a||t?(a&&i.push(a),t&&i.push(t),void sensorsdata.ajax({type:"post",url:"track_installation/query",data:JSON.stringify(i),customErrorStatusCode:403,success:function(a){var t=a.is_all||!1,i=a.data||[];t?e.find(".tip").hide():e.find(".tip").show();var s=e.find(".result-json")[0];n.beautifyJSON_(s,i),e.find('span[data-method="copy-success"]').hide();var d=e.find("a[data-method=copy-channel]"),l=d.attr("data-index")||0;d.attr("data-index",++l).show(),e.find(".result-content").show()}})):void sensorsdata.info.show('"测试设备 IP "和"测试设备号"至少要输入一个才能查询')}});e.popQueryChannel=function(){return t.popQueryChannel_()}});
;/*!components/reportLoading/reportLoading.js*/
define("components/reportLoading/reportLoading",function(i,e,n){var t={loadingTime:3e4},o=function(i){this.options=i||{},this.container_=i.container,this.needHideDom=[].concat(i.needHideDom||[]),this.hideType=i.hideType||"none",this.sampling_factor=i.sampling_factor,this.tpl=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(i,e,n,t){var o,s=e.helperMissing,a="function",r=this.escapeExpression;return'<section class="report-no-data sa-self-loader" id="sa-self-loader">\n  <div class="content-box">\n    <span class="loader loader-circles"></span>\n    <span class="loader-info">'+r((o=null!=(o=e.msg1||(null!=i?i.msg1:i))?o:s,typeof o===a?o.call(i,{name:"msg1",hash:{},data:t}):o))+'<span class="open-quick-query">'+r((o=null!=(o=e.quickQuery||(null!=i?i.quickQuery:i))?o:s,typeof o===a?o.call(i,{name:"quickQuery",hash:{},data:t}):o))+"</span>"+r((o=null!=(o=e.msg2||(null!=i?i.msg2:i))?o:s,typeof o===a?o.call(i,{name:"msg2",hash:{},data:t}):o))+"</span>\n  </div>\n</section>"},useData:!0}),this.timer=null};o.prototype.showLoading=function(){var i=this;0===i.container_.children()&&(i.container_=$(i.container_.selector)),i.container_.children().hide(),i.needHideDom.length>0&&i.handleNeedHideDom("hide"),i.container_.children(".sa-self-loader").remove(),i.container_.prepend(i.tpl(i.buildTip("first"))),i.options.second||"none"===i.sampling_factor||(i.timer=setTimeout(function(){this.timer&&(i.container_.children(".sa-self-loader").remove(),i.container_.prepend(i.tpl(i.buildTip())),i.openQuickQuery())}.bind(this),t.loadingTime))},o.prototype.closeLoading=function(i){"success"===i&&(0===this.container_.children()&&(this.container_=$(this.container_.selector)),this.container_.children(".sa-self-loader").remove(),this.needHideDom.length>0&&this.handleNeedHideDom("show")),this.options={},clearTimeout(this.timer),this.timer=null},o.prototype.buildTip=function(i){var e={msg1:"查询中 ",quickQuery:"",msg2:" "};return"first"===i?(this.options.sampling_factor&&"none"!==this.options.sampling_factor&&64!==this.options.sampling_factor&&(e.msg1="已开启 1/"+64/this.options.sampling_factor+"抽样计算，查询中"),e):(64===this.options.sampling_factor?(e.msg1="查询比较耗时请耐心等待，也可 ",e.msg2=" 1/4 抽样计算加速",e.quickQuery="开启"):"none"!==this.options.sampling_factor&&(e.msg1="已开启 1/"+64/this.options.sampling_factor+"抽样计算，查询中",e.msg2=" ",e.quickQuery=""),e)},o.prototype.openQuickQuery=function(){this.container_.find(".open-quick-query").off("click").on("click",function(){var i=this.options.openQuickQuery();$.isFunction(i)&&i(),this.options.second=!0,this.options.quickType="none"}.bind(this))},o.prototype.handleNeedHideDom=function(i){for(var e=0,n=this.needHideDom.length;n>e;e++)"hide"===i?"hidden"===this.hideType?this.needHideDom[e].css({height:"1px",visibility:"hidden"}):this.needHideDom[e].hide():"hidden"===this.hideType?this.needHideDom[e].css({height:"auto",visibility:"visible"}):this.needHideDom[e].show()},n.exports=o});
;/*!components/retentionTable/retentionTable.js*/
define("components/retentionTable/retentionTable",function(n,t){function e(n,t){this.$container=n,this.options=t,this.createTable()}var a={retentionTableContainerTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div class="retention-table">\n  <div class="table-container">\n  </div>\n  <div class="table-pagination" class="sa-pagination"></div>\n</div>'},useData:!0}),retentionTableTableTpl:Handlebars.template({1:function(n){return"      <th>"+this.escapeExpression(this.lambda(n,n))+"</th>\n"},3:function(n,t,e,a){var l,s,i,o=t.helperMissing,r="function",p=this.escapeExpression,c=t.blockHelperMissing,h='    <tr data-index="'+p((s=null!=(s=t.rowIndex||(null!=n?n.rowIndex:n))?s:o,typeof s===r?s.call(n,{name:"rowIndex",hash:{},data:a}):s))+'">\n      <td class="by-overflow" ';return s=null!=(s=t.tooltip||(null!=n?n.tooltip:n))?s:o,i={name:"tooltip",hash:{},fn:this.program(4,a,0),inverse:this.noop,data:a},l=typeof s===r?s.call(n,i):s,t.tooltip||(l=c.call(n,l,i)),null!=l&&(h+=l),h+=' style="width:200px;">\n        '+p((s=null!=(s=t.name||(null!=n?n.name:n))?s:o,typeof s===r?s.call(n,{name:"name",hash:{},data:a}):s))+'\n      </td>\n      <td style="width:100px;" class="retention-total">\n        <span class="icon-user-line"></span>\n        <span>'+p((s=null!=(s=t.total_people||(null!=n?n.total_people:n))?s:o,typeof s===r?s.call(n,{name:"total_people",hash:{},data:a}):s))+" 人</span>\n      </td>\n",s=null!=(s=t.cells||(null!=n?n.cells:n))?s:o,i={name:"cells",hash:{},fn:this.program(6,a,0),inverse:this.noop,data:a},l=typeof s===r?s.call(n,i):s,t.cells||(l=c.call(n,l,i)),null!=l&&(h+=l),h+"    </tr>\n"},4:function(n,t,e,a){var l;return'data-toggle="tooltip" title="'+this.escapeExpression((l=null!=(l=t.tooltip||(null!=n?n.tooltip:n))?l:t.helperMissing,"function"==typeof l?l.call(n,{name:"tooltip",hash:{},data:a}):l))+'" data-container="body" data-placement="right"'},6:function(n,t,e,a){var l;return'      <td style="width:50px;" '+(null!=(l=t["if"].call(n,null!=n?n.className:n,{name:"if",hash:{},fn:this.program(7,a,0),inverse:this.noop,data:a}))?l:"")+" "+(null!=(l=t["if"].call(n,null!=n?n.tip:n,{name:"if",hash:{},fn:this.program(9,a,0),inverse:this.noop,data:a}))?l:"")+">\n"+(null!=(l=t["if"].call(n,null!=n?n.tip:n,{name:"if",hash:{},fn:this.program(11,a,0),inverse:this.noop,data:a}))?l:"")+"      </td>\n"},7:function(n,t,e,a){var l;return'class="'+this.escapeExpression((l=null!=(l=t.className||(null!=n?n.className:n))?l:t.helperMissing,"function"==typeof l?l.call(n,{name:"className",hash:{},data:a}):l))+'"'},9:function(n,t,e,a){var l;return' title="'+this.escapeExpression((l=null!=(l=t.tip||(null!=n?n.tip:n))?l:t.helperMissing,"function"==typeof l?l.call(n,{name:"tip",hash:{},data:a}):l))+'" data-toggle="tooltip" data-placement="top" '},11:function(n,t,e,a){var l,s=t.helperMissing,i="function",o=this.escapeExpression;return"        <span>"+o((l=null!=(l=t.people||(null!=n?n.people:n))?l:s,typeof l===i?l.call(n,{name:"people",hash:{},data:a}):l))+' 人</span>\n        <span class="retention-ratio">'+o((l=null!=(l=t.percent||(null!=n?n.percent:n))?l:s,typeof l===i?l.call(n,{name:"percent",hash:{},data:a}):l))+"%</span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(n,t,e,a){var l,s,i,o=t.helperMissing,r="function",p=t.blockHelperMissing,c='<table class="table table-bordered heat-map">\n  <thead>\n    <tr>\n      <th>'+this.escapeExpression((s=null!=(s=t.field||(null!=n?n.field:n))?s:o,typeof s===r?s.call(n,{name:"field",hash:{},data:a}):s))+'</th>\n      <th class="retention-total">总人数<!--{en}Total number of users--></th>\n';return s=null!=(s=t.series||(null!=n?n.series:n))?s:o,i={name:"series",hash:{},fn:this.program(1,a,0),inverse:this.noop,data:a},l=typeof s===r?s.call(n,i):s,t.series||(l=p.call(n,l,i)),null!=l&&(c+=l),c+="    </tr>\n  </thead>\n  <tbody>\n",s=null!=(s=t.rows||(null!=n?n.rows:n))?s:o,i={name:"rows",hash:{},fn:this.program(3,a,0),inverse:this.noop,data:a},l=typeof s===r?s.call(n,i):s,t.rows||(l=p.call(n,l,i)),null!=l&&(c+=l),c+"  </tbody>\n</table>"},useData:!0})};e.prototype=$.extend({},sensorsdata.EventsModule,{initEvents:function(){this.$container.find('[data-toggle="tooltip"]').tooltip({container:"body",html:!0})},createTable:function(){this.$container.html(a.retentionTableContainerTpl()),this.showTable()},showTable:function(){var n=this.options.data,t=this.$container,e=function(e,l){e-=1;var s=n.rows.slice(e,l),i=$.extend({},!0,n);i.rows=s,t.find(".table-container").html(a.retentionTableTableTpl(i))};sensorsdata.pagination({tableElement:t.find(".table-pagination").show(),totalItems:n.num,pageItems:50,clickHandle:sensorsdata.bind(function(n){e(n.range[0],n.range[1])},this)}),this.initEvents()},destroy:function(){this.$container.empty()}}),t.create=function(n,t){return new e(n,t)}});
;/*!components/searchTool/searchTool.js*/
define("components/searchTool/searchTool",function(e,n){var a=e("components/router/router"),s={searchToolTpl:Handlebars.template({1:function(e,n,a,s){var t,i,r=n.helperMissing,c="function",l=this.escapeExpression;return'          <li>\n            <a data-value="'+l((i=null!=(i=n.name||(null!=e?e.name:e))?i:r,typeof i===c?i.call(e,{name:"name",hash:{},data:s}):i))+'" data-dict="'+l((i=null!=(i=n.has_dict||(null!=e?e.has_dict:e))?i:r,typeof i===c?i.call(e,{name:"has_dict",hash:{},data:s}):i))+'" data-type="'+l((i=null!=(i=n.data_type||(null!=e?e.data_type:e))?i:r,typeof i===c?i.call(e,{name:"data_type",hash:{},data:s}):i))+'">'+l((i=null!=(i=n.cname||(null!=e?e.cname:e))?i:r,typeof i===c?i.call(e,{name:"cname",hash:{},data:s}):i))+"</a>\n"+(null!=(t=n["if"].call(e,null!=e?e.has_dict:e,{name:"if",hash:{},fn:this.program(2,s,0),inverse:this.program(4,s,0),data:s}))?t:"")+"          </li>\n"},2:function(){return'              <span class="icon-data-type-dict"></span>\n'},4:function(){return""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,a,s){var t,i,r,c='<div id="searchTool">\n  <div class="shadows"></div>\n  <div class="search-container">\n    <div class="search clearfix">\n      <div class="selector">\n        <button type="button" class="search-type btn-selector dropdown-toggle ellipsis" data-toggle="dropdown" data-value="$id">\n          用户ID\n        </button>\n        <ul class="dropdown-menu" role="menu">\n';return i=null!=(i=n.options||(null!=e?e.options:e))?i:n.helperMissing,r={name:"options",hash:{},fn:this.program(1,s,0),inverse:this.noop,data:s},t="function"==typeof i?i.call(e,r):i,n.options||(t=n.blockHelperMissing.call(e,t,r)),null!=t&&(c+=t),c+'        </ul>\n      </div>\n      <input id="test" class="search-content" type="text" placeholder="按用户 ID搜索用户，请输入完整的用户 ID">\n      <span class="search-btn">\n        <span class="icon-search"></span>\n      </span>\n    </div>\n    <div class="search-result-content">\n      <div class="search-loader">\n        <ul>\n          <li></li>\n          <li></li>\n          <li></li>\n          <li></li>\n        </ul>\n      </div>\n      <div class="search-none-result ellipsis">\n        未查询到相关结果，<span>请输入完整的用户ID</span>\n      </div>\n      <div class="search-result">\n      </div>\n    </div>\n  </div>\n</div>'},useData:!0}),searchResultTpl:Handlebars.template({1:function(e,n,a,s){var t,i,r=n.helperMissing,c="function",l=this.escapeExpression;return'  <div class="search-item" data-firstId="'+l((i=null!=(i=n.first_id||(null!=e?e.first_id:e))?i:r,typeof i===c?i.call(e,{name:"first_id",hash:{},data:s}):i))+'" data-id="'+l((i=null!=(i=n.id||(null!=e?e.id:e))?i:r,typeof i===c?i.call(e,{name:"id",hash:{},data:s}):i))+'">\n    <span class="iconc-user"></span>\n    <span class="ellipsis" title="'+(null!=(i=null!=(i=n.first_id||(null!=e?e.first_id:e))?i:r,t=typeof i===c?i.call(e,{name:"first_id",hash:{},data:s}):i)?t:"")+'">'+(null!=(i=null!=(i=n.first_id_replace||(null!=e?e.first_id_replace:e))?i:r,t=typeof i===c?i.call(e,{name:"first_id_replace",hash:{},data:s}):i)?t:"")+'</span>\n    <span class="ellipsis" title="'+(null!=(i=null!=(i=n.show_name||(null!=e?e.show_name:e))?i:r,t=typeof i===c?i.call(e,{name:"show_name",hash:{},data:s}):i)?t:"")+'">'+(null!=(i=null!=(i=n.show_name_replace||(null!=e?e.show_name_replace:e))?i:r,t=typeof i===c?i.call(e,{name:"show_name_replace",hash:{},data:s}):i)?t:"")+"</span>\n  </div>\n"},3:function(){return'  <div class="search-more"><a>查看全部</a></div>\n'},5:function(){return""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,n,a,s){var t,i,r,c='<p>用户</p>\n<div class="search-items">\n';return i=null!=(i=n.users||(null!=e?e.users:e))?i:n.helperMissing,r={name:"users",hash:{},fn:this.program(1,s,0),inverse:this.noop,data:s},t="function"==typeof i?i.call(e,r):i,n.users||(t=n.blockHelperMissing.call(e,t,r)),null!=t&&(c+=t),c+(null!=(t=n["if"].call(e,null!=e?e.viewMore:e,{name:"if",hash:{},fn:this.program(3,s,0),inverse:this.program(5,s,0),data:s}))?t:"")+"</div>\n"},useData:!0})},t=$.extend(!0,{},sensorsdata.EventsModule,{isinit:!1,$container:null,searchType:"$id",searchFunction:"equal",measures:[{aggregator:"count",field:""}],filter:{},queryId:"",searchTip:"请输入完整的用户ID",selectItemIndex:-1,createSearchTool:function(){$("body").css({overflow:"hidden"}),this.isinit?this.show():this.init()},init:function(){var e=this;if(!this.isinit){this.isinit=!0;var n=[];sensorsdata.ajax({showLoader:!1,url:sensorsdata.api.get("profile_prop"),success:function(e){n=e.filter(function(e){return e.is_segmenter||"string"!==e.data_type&&"number"!==e.data_type?void 0:e})}}).then(function(){$("body").append(s.searchToolTpl({options:n})),e.$container=$("#searchTool"),e.$container.find(".search-type").saDropdown({value:"$id",onSelected:function(n,a){var s=a.data("type"),t=a.html(),i=a.data("dict"),r="",c=e.searchTip;e.interruptQuery(),e.reset(),"string"!==s||i?(e.searchFunction="equal",r="按"+t+"搜索用户, 请输入完整的"+t,c="请输入完整的"+t):(e.searchFunction="contain",r="按"+t+"搜索用户",c="请输入正确的"+t),e.type=s,e.searchType=n,e.searchTip=c;var l=e.$container.find(".search-type").width();e.$container.find(".search-content").attr("placeholder",r).css({width:400-l}),e.$container.find(".search-content")[0].focus()}}),e.initEvent(),e.show()})}},initEvent:function(){var e=this;this.$container.find(".shadows").on("click",function(){e.hide()}),this.$container.find(".search-content").on("keydown.search",function(n){var a=n.keyCode?n.keyCode:n.which?n.which:n.charCode,s=[16,17,18,27,9,20,91,93,37,38,39,40];n.metaKey&&75===a||-1!==$.inArray(a,s)||(e.interruptQuery(),e.reset(),13===a&&e.handleSearch())}),this.$container.find(".search-btn").on("click.search",function(){e.handleSearch()}),this.$container.delegate(".search-more a","click",function(){var n={measures:e.measures,filter:e.filter};a.nav("/search-users/users/#"+$.param(n)),e.hide()}),this.$container.delegate(".search-item","click",function(){var n=$(this),s={distinct_id:n.data("firstid"),user_id:n.data("id"),measures:e.measures,filter:e.filter,all_page:!1,page:"0"};a.nav("/search-users/users/sequence/#"+$.param(s)),e.hide()})},show:function(){if(this.$container&&(this.$container.show(),this.$container.find(".search-content")[0].focus(),$("body").on("keydown.selectItem",sensorsdata.bind(this.changeSelect,this)),$("body").width()<500)){var e=this.$container.find(".search-container").width();this.$container.find(".search-container").css({"margin-left":-e/2})}},hide:function(){$("body").css({overflow:"auto"}),$("body").off("keydown.selectItem"),this.$container.hide()},reset:function(){this.$container.find(".search").removeClass("search-complete"),this.$container.find(".search-result").empty(),this.$container.find(".search-none-result").hide(),this.selectItemIndex=-1},interruptQuery:function(){var e=(new Date).valueOf();this.queryId=e,this.$container.find(".search-result, .search-loader, .search-none-result").attr("data-queryId",e),this.$container.find(".search-loader").hide()},destroy:function(){},changeSelect:function(e){var n=this,a=e.keyCode?e.keyCode:e.which?e.which:e.charCode;(37===a||39===a)&&n.$container.find(".search-content")[0].focus(),(38===a||40===a)&&(n.$container.find(".search-content")[0].blur(),n.handleSelect(a)),13===a&&n.selectItemIndex>=0&&n.$container.find(".search-item").eq(n.selectItemIndex).trigger("click")},handleSelect:function(e){var n=this,a=this.$container.find(".search-item"),s=a.length,t=this.selectItemIndex,i=0,r=0,c=function(e){var a=n.$container.find(".search-items").offset().top,s=a+294,t=e.offset().top;return t>a&&s>=t?0:t-a};s>0&&(38===e&&t>0?(t--,i=c(a.eq(t)),i&&(r=42*t,this.$container.find(".search-items").animate({scrollTop:r},100)),a.removeClass("active").eq(t).addClass("active")):40===e&&s-1>t&&(t++,i=c(a.eq(t)),i&&(r=t===s-1?42*(t-7)+42:42*(t-7),this.$container.find(".search-items").animate({scrollTop:r},100)),a.removeClass("active").eq(t).addClass("active")),this.selectItemIndex=t)},handleSearch:function(){var e=this.$container.find(".search-content").val(),n=this.searchType,a=this.searchFunction;if(e){if("number"===this.type&&isNaN(e)){var s=this.queryId||(new Date).valueOf();return this.$container.find(".search-none-result[data-queryId="+s+"] span").html(this.searchTip),this.$container.find(".search-none-result[data-queryId="+s+"]").show(),void this.$container.find(".search").addClass("search-complete")}this.searchUserList(n,a,e),this.$container.find(".search").addClass("search-complete")}},searchUserList:function(e,n,a){this.$container.find(".search-loader").show(),this.reset();var t=this.queryId,i=sensorsdata.api.get("defaultQueryUserList"),r="user."+e,c={measures:this.measures,num_per_page:21,page:0,all_page:!1,use_cache:!1};c.limit=sensorsdata.CONSTSET.limit,c.profiles=[r];var l={conditions:[{field:r,"function":n,params:[a]}]};c.filter=l,this.filter=l,sensorsdata.reportAjax({type:"post",url:i,showLoader:!1,data:c,error:function(){},success:sensorsdata.bind(function(n){var i=n.users,r=i.length;if(r>0){var c=new RegExp(a,"ig");i=i.filter(function(n,s){return n.show_name=n.profiles[e]+"","$id"===e?(n.show_name="",n.first_id_replace=n.first_id.replace(c,"<span>"+a+"</span>")):(n.first_id_replace=n.first_id,n.show_name_replace=n.show_name.replace(c,"<span>"+a+"</span>")),20>s}),this.$container.find(".search-result[data-queryId="+t+"]").html(s.searchResultTpl({users:i,viewMore:r>20,searchType:e}))}else this.$container.find(".search-none-result[data-queryId="+t+"] span").html(this.searchTip),this.$container.find(".search-none-result[data-queryId="+t+"]").show()},this),complete:sensorsdata.bind(function(){this.$container.find(".search-loader[data-queryId="+t+"]").hide()},this)})}});n.createSearchTool=function(){return t.createSearchTool()}});
;/*!components/tableFilterPanel/tableFilterPanel.js*/
define("components/tableFilterPanel/tableFilterPanel",function(e,t){function a(e){this.options=e,this.$ele=e.ele,this.data=$.extend(!0,[],e.data),this.init()}var n=e("components/util/util"),l={emptyItemsTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<li>\n  <label class="common-radio">无对应结果<!--{en}No corresponding result--></label>\n</li>'},useData:!0}),itemsTpl:Handlebars.template({1:function(e,t,a,n){var l,i,o,s="";return i=null!=(i=t.data||(null!=e?e.data:e))?i:t.helperMissing,o={name:"data",hash:{},fn:this.program(2,n,0),inverse:this.noop,data:n},l="function"==typeof i?i.call(e,o):i,t.data||(l=t.blockHelperMissing.call(e,l,o)),null!=l&&(s+=l),s},2:function(e,t,a,n){var l,i,o=t.helperMissing,s="function",r=this.escapeExpression;return'<li>\n  <label class="common-radio">\n    <input value="'+r((i=null!=(i=t.value||(null!=e?e.value:e))?i:o,typeof i===s?i.call(e,{name:"value",hash:{},data:n}):i))+'" name="table-filter" type="radio" '+(null!=(l=t["if"].call(e,null!=e?e.checked:e,{name:"if",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?l:"")+'/>\n    <span class="radio-icon"></span>\n    '+r((i=null!=(i=t.name||(null!=e?e.name:e))?i:o,typeof i===s?i.call(e,{name:"name",hash:{},data:n}):i))+"\n  </label>\n</li>\n"},3:function(){return'checked="true"'},5:function(e,t,a,n){var l,i,o,s="";return i=null!=(i=t.data||(null!=e?e.data:e))?i:t.helperMissing,o={name:"data",hash:{},fn:this.program(6,n,0),inverse:this.noop,data:n},l="function"==typeof i?i.call(e,o):i,t.data||(l=t.blockHelperMissing.call(e,l,o)),null!=l&&(s+=l),s},6:function(e,t,a,n){var l,i;return'<li>\n  <label class="common-checkbox">\n    <input value="'+this.escapeExpression((i=null!=(i=t.value||(null!=e?e.value:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{name:"value",hash:{},data:n}):i))+'" name="table-filter" type="checkbox" '+(null!=(l=t["if"].call(e,null!=e?e.checked:e,{name:"if",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?l:"")+'/>\n    <span class="checkbox-icon"></span>\n    '+(null!=(l=t["if"].call(e,null!=e?e.name:e,{name:"if",hash:{},fn:this.program(7,n,0),inverse:this.program(9,n,0),data:n}))?l:"")+"\n  </label>\n</li>\n"},7:function(e,t,a,n){var l;return"<span>"+this.escapeExpression((l=null!=(l=t.name||(null!=e?e.name:e))?l:t.helperMissing,"function"==typeof l?l.call(e,{name:"name",hash:{},data:n}):l))+"</span>"},9:function(){return'<span class="unknow">未填写</span>'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,a,n){var l;return null!=(l=t["if"].call(e,null!=e?e.isRadio:e,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.program(5,n,0),data:n}))?l:""},useData:!0}),tableFilterPanelTpl:Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,a,n){var l,i=t.helperMissing,o="function",s=this.escapeExpression;return'<div class="table-filter-panel" data-type='+s((l=null!=(l=t.type||(null!=e?e.type:e))?l:i,typeof l===o?l.call(e,{name:"type",hash:{},data:n}):l))+' style="top: '+s((l=null!=(l=t.top||(null!=e?e.top:e))?l:i,typeof l===o?l.call(e,{name:"top",hash:{},data:n}):l))+"px;left: "+s((l=null!=(l=t.left||(null!=e?e.left:e))?l:i,typeof l===o?l.call(e,{name:"left",hash:{},data:n}):l))+'px;">\n  <div class="search">\n    <input class="common-input" type="text" placeholder="搜索">\n    <span class="icon-search"></span>\n  </div>\n  <ul class="items">\n  </ul>\n  <div class="ft">\n    <a data-method="reset">重置<!--{en}Reset--></a>\n    <a data-method="confirm">确认<!--{en}Confirm--></a>\n  </div>\n</div>'},useData:!0})};a.prototype=$.extend(!0,{},sensorsdata.EventsModule,{init:function(){this.render(this.options),this.show(),this.initEvents(),sensorsdata.languages.update()},getElementRight:function(e){for(var t=e.offsetLeft,a=e.offsetParent;null!==a;)t+=a.offsetLeft,a=a.offsetParent;return t},getElementTop:function(e){for(var t=e.offsetTop,a=e.offsetParent;null!==a;)t+=a.offsetTop,a=a.offsetParent;return t+$(e).height()},render:function(e){var t=this,a=e.ele;$(".table-filter-panel").remove(),$("body").append(l.tableFilterPanelTpl({type:t.options.type,top:t.getElementTop(a[0])+8,left:t.getElementRight(a[0])-10-$(".dataTables_scrollHead").scrollLeft()})),t.renderItems({isRadio:t.options.isRadio,data:t.options.data})},renderItems:function(e){var t=$(".table-filter-panel .items");return $.isEmptyObject(e.data)?void t.html(l.emptyItemsTpl()):void t.html(l.itemsTpl(e))},show:function(){var e=this;this.hide(),$(".table-filter-panel").show(),$("body").off("click.tableFilterPanel").on("click.tableFilterPanel",function(t){var a=$(t.target);return a.is(e.$ele)?!1:void e.hide()})},hide:function(){$(".table-filter-panel").hide(),$("body").off("click.tableFilterPanel")},initEvents:function(){var e=this,t=$(".table-filter-panel");t.off("click.preventdefault").on("click.preventdefault",function(e){return e&&e.preventDefault&&e.preventDefault(),!1}),t.delegate(".common-input","keydown",function(){var t=$(this),a=t.attr("data-timeout");a&&window.clearTimeout(a),a=window.setTimeout(function(){var a=t.val().trim(),l=n.fuzzySearch(e.data,a,"name");e.renderItems({isRadio:e.options.isRadio,data:l})},500),t.attr("data-timeout",a)}),t.delegate(".common-checkbox","click",function(){var e=$(this).find('[type="checkbox"]');e.attr("checked")?e.removeAttr("checked"):e.attr("checked","true")}),t.delegate(".common-radio","click",function(){var e=$(this).find('[type="radio"]');e.attr("checked")||($('.table-filter-panel [type="radio"]').removeAttr("checked"),e.attr("checked","true"))}),t.delegate('[data-method="reset"]',"click",function(){var t=$(this).parents(".table-filter-panel"),a=t.attr("data-type"),n={};n[a]=[],e.options.searchFun(n),e.hide()}),t.delegate('[data-method="confirm"]',"click",function(){var t=$(this).parents(".table-filter-panel"),a=t.attr("data-type"),n=[],l={};t.find('[name="table-filter"][checked]').each(function(e,t){n.push(t.value)}),l[a]=n,e.options.searchFun(l),e.hide()})},destroy:function(){$(".table-filter-panel").remove()}}),t.create=function(e){return new a(e)}});
;/*!components/util/convertSeriesRows.js*/
define("components/util/convertSeriesRows",function(n,e,o){var r=function(n,e){if("function"!=typeof e)throw new Error("convertSeriesRows 方法的第二个参数必须是 function 类型");var o=n.series,r=n.rows,t=[],s=[],i=[];r.map(function(n){s.push(n.name)});for(var a=0;a<s.length;a++)o.map(function(n,e){i[e]||(i[e]=[]),i[e].push(r[a].cells[e])});o.map(function(n,e){var o={name:n,rowIndex:e,data:i[e]};t.push(o)});var u={num:o.length,series:s,rows:t};e(u)};o.exports=r});