sensorsdata.UsersListPage=function(e){sensorsdata.BasePage.call(this),this.options=e,this.options.container=e.container||$("body"),this.pageName=window.location.pathname,this.paramObj_=null,this.tableData_={tag:null,type:null},this.userList_=null,this.naviPath_=window.location.pathname.split("/").filter(function(e){return""!==e}),this.apiMap_={segmentation:"events/",funnel:"funnels/",retention:"retentions/",addiction:"addictions/","behavior-path":"path/analytics/","web-click":"heat_map/","app-click":"events/"},this.userProps_={},this.tplTable_=$("#tpl_user_list_table").html(),this.options.container.html(this.tplTable_),this.breadCrumbContainer_=this.options.container.find("#breadcrumb-wrap"),this.tplTableHeader_=$("#tpl_user_list_header").html(),this.headerContainer_=this.options.container.find("#headerContainer"),this.tableContainer_=this.options.container.find("#user-table-container"),this.tplTableBody_=$("#tpl_user_list_body").html(),this.bodyContainer_=this.options.container.find("#bodyContainer"),this.$searchUsersInfo_=this.options.container.find(".search-users-info"),this.usersJqXHR_=null,this.propsJqXHR_=null,this.currentState=!1,this.currentPage_=-1,this.tplWithNoData_=$("#tpl_user_list_no_data").html(),this.tplUserItemTotal_=$("#tpl_user_list_total").html(),this.tplWithNoAuthority_=$("#tpl_user_list_no_authority").html(),this.selectedCols=[],this.init()},sensorsdata.inherits(sensorsdata.UsersListPage,sensorsdata.BasePage),sensorsdata.UsersListPage.prototype.init=function(){if(sensorsdata.UsersListPage.superClass_.init.call(this),this.initBreadCrumb_(),sensorsdata.authority.isNormal)return this.breadCrumbContainer_.find("button[data-method]").attr("disabled","true"),this.tableContainer_.html(this.tplWithNoAuthority_),void this.options.closeLoading();this.initToolsBar_(),this.paramObj_=sensorsdata.unparam(window.location.hash);var e=this;sensorsdata.disableReportAjaxCache(),e.propsJqXHR_=e.getProps_(),e.propsJqXHR_.then(function(){e.paramObj_=e.dealParam_(e.paramObj_),e.currentPage_=e.paramObj_.page,e.usersJqXHR_=e.getUsersList_(e.paramObj_),e.usersJqXHR_.then(function(){e.userList_&&0!==e.tableData_.size&&0!==e.tableData_.users.length?(e.formatHeaderData_(),e.formatBodyData_(),e.renderTable_(e.tableData_),e.currentState=!0,sensorsdata.enableReportAjaxCache()):e.tableContainer_.html(e.tplWithNoData_),e.options.closeLoading()})}),this.setSearchUsersInfo_()},sensorsdata.UsersListPage.prototype.setSearchUsersInfo_=function(){if(this.$searchUsersInfo_.empty(),"search-users"===this.naviPath_[0]){var e=this.paramObj_.filter?this.paramObj_.filter.conditions[0].params[0]:"",t=sensorsdata.languages.get("按<!--{en}By-->")+'"'+e+'"'+sensorsdata.languages.get("搜索的用户<!--{en}Users you are searching for-->");this.$searchUsersInfo_.html(t)}},sensorsdata.UsersListPage.prototype.renderTable_=function(e){this.renderTableHeader_(e.column_name),this.initTablePagition_(e),this.initEvents_()},sensorsdata.UsersListPage.prototype.getUsersList_=function(e){var t;t=this.apiMap_.hasOwnProperty(this.naviPath_[0])?this.apiMap_[this.naviPath_[0]]+"user/list":"users/list",e.limit=sensorsdata.CONSTSET.limit;var a={from_analytics:sensorsdata.CONSTSET.urlMap["/"+this.naviPath_[0]+"/"],success:!0,use_cache:!!e.use_cache};return sensorsdata.reportAjax({type:"post",url:t,data:e,error:function(e){a.success=!1,a.fail_reason=e.status,sensorsdata.track("user_list",a)},success:sensorsdata.bind(function(e){sensorsdata.track("user_list",a),this.userList_=e,this.tableData_=$.extend(this.tableData_,e)},this)})},sensorsdata.UsersListPage.prototype.getProps_=function(){var e=this;return sensorsdata.ajax({url:"property/user/properties",useCache:!0,success:function(t){e.userProps_.list=[],e.userProps_.list=t,e.userProps_.list=e.userProps_.list.filter(function(e){return"$id"!==e.name})}})},sensorsdata.UsersListPage.prototype.sortTableData_=function(e,t,a,s){e.tag===t?e.users.reverse():e=this.compareSort_(e,t,a,s),this.renderTableBody_(e)},sensorsdata.UsersListPage.prototype.compareSort_=function(e,t,a,s){var n=function(e,t){var a=-1;return $.each(t,function(t,s){s.name===e&&(a=t)}),a},r=n(t,this.tableData_.column_name),i="-";e.tag=t;var o=function(e){switch(e){case"string":case"bool":case"list":return function(e,t){return e.list[r].localeCompare(t.list[r])};case"number":return function(e,t){var a=e.list[r]===i?Number.MAX_SAFE_INTEGER:parseInt(e.list[r]),s=t.list[r]===i?Number.MAX_SAFE_INTEGER:parseInt(t.list[r]);return a-s};case"datetime":case"date":return function(e,t){var a=moment(e.list[r]===i?0:e.list[r]),s=moment(t.list[r]===i?0:t.list[r]);return a-s};default:return void sensorsdata.error.show(sensorsdata.languages.get("数据类型错误<!--{en}Data type error-->"))}};return e.users.sort(o(s)),"ascend"===a?(e.type="ascend",e):(e.users.reverse(),e.type="descend",e)},sensorsdata.UsersListPage.prototype.initEvents_=function(){var e=this;e.tableContainer_.unbind("click").bind("click",sensorsdata.bind(e.usersTableClick_,e));var t=function(e){var t=e.clone().css({display:"inline",padding:e.css("padding"),width:"auto",visibility:"hidden"}).appendTo("body"),a=t.width();return t.remove(),a>e.width()?!0:!1};this.tableContainer_.find("th, td").on("mouseover",function(){if(t($(this))){var e=$(this).html();0===$(this).index()&&(e=$(this).find("a").html()),$(this).tooltip({container:"body",placement:"bottom",title:e,html:!0}),$(this).tooltip("show")}}).on("mouseleave",function(){$(this).tooltip("destroy")})},sensorsdata.UsersListPage.prototype.usersTableClick_=function(e){var t=$(e.target||e.srcElement);t.attr("data-method")||(t=t.parents("[data-method]:first"));var a=this,s=t.attr("data-method");switch(s){case"sort":var n=t.attr("data-sort"),r=t.attr("data-type"),i=t.attr("data-flag-sort");n?t.attr("data-sort","ascend"===n?"descend":"ascend"):t.attr("data-sort","descend"),n=t.attr("data-sort"),t.siblings().attr("data-sort",""),a.sortTableData_(a.tableData_,i,n,r),a.initEvents_();break;case"navigator":var o=window.location.hash,l=sensorsdata.unparam(o),c=a.selectedCols,u=t.attr("data-href");l=$.extend(l,{user_id:u,selectedProfiles:c});var d=$.grep(a.userList_.users,function(e){return e.id===u})[0];sensorsdata.sessionStorage.setItem("user-sequence-"+u,JSON.stringify(d));var h=JSON.parse(sensorsdata.sessionStorage.getItem("visitedLinks"))||[];h.push(u),sensorsdata.sessionStorage.setItem("visitedLinks",JSON.stringify(h)),l.slice_by_value||(l.slice_by_value=null),l.distinct_id=t.html(),l.all_page=!1;var p=window.location.pathname;"/"!==p[p.length-1]&&(p+="/"),a.options.initPage(p+"sequence/#"+$.param(l))}},sensorsdata.UsersListPage.prototype.renderTableHeader_=function(e){this.headerContainer_.html(Mustache.render(this.tplTableHeader_,e))},sensorsdata.UsersListPage.prototype.renderTableBody_=function(e){this.bodyContainer_.html(Mustache.render(this.tplTableBody_,e));var t=this.bodyContainer_.find("tr"),a=JSON.parse(sensorsdata.sessionStorage.getItem("visitedLinks"))||[];t.each(function(e,t){var s=t.children[0].innerHTML||t.children[0].innerText,n=$(t).attr("data-user");$(t.children[0]).html("<a data-method=navigator data-href="+n+">"+s+"</a>"),a&&-1!==a.indexOf(n)&&$(t).find('[data-method="navigator"]').addClass("visited")}),this.toggleColsShow()},sensorsdata.UsersListPage.prototype.initTablePagition_=function(e){var t=sensorsdata.CONSTSET.paginationSize,a=sensorsdata.bind(function(e){e-=1;var a=this,s=e/t,n=sensorsdata.unparam(window.location.hash);n=$.param($.extend(n,{page:s})),a.currentState?window.history.pushState("currentPage","","#"+n):window.history.replaceState("currentPage","","#"+n),a.currentState=!0,a.currentPage_!==s?(a.paramObj_.page=s,a.getUsersList_(a.paramObj_).then(function(){a.getProps_().then(function(){a.formatHeaderData_(),a.formatBodyData_(),a.renderTableBody_(a.tableData_),a.currentPage_=s})})):a.renderTableBody_(a.tableData_)},this);($.isEmptyObject(e)||e.users)&&(0===e.size?(this.bodyContainer_.html(""),this.options.container.find("#table-pagination").hide()):e.size<=t?(a(1,e.users.length),this.options.container.find("#table-pagination").show(),this.options.container.find("#table-pagination").html(Mustache.render(this.tplUserItemTotal_,e))):sensorsdata.pagination({tableElement:this.options.container.find("#table-pagination").show(),totalItems:e.size,formatTitle:function(e,t){return e>=1e3?sensorsdata.util.format(sensorsdata.languages.get("最多展示 #{total} 行，当前展示 #{range_start}-#{range_end} 行<!--{en}#{total} lines in total, currently display line #{range_start}-#{range_end}-->"),{total:e,range_start:t[0],range_end:t[1]}):sensorsdata.util.format(sensorsdata.languages.get("共 #{total} 行，当前展示 #{range_start}-#{range_end} 行<!--{en}A total of #{total} rows, the current display of #{range_start}-#{range_end} rows-->"),{total:e,range_start:t[0],range_end:t[1]})},pageIndex:this.paramObj_.page?Number(this.paramObj_.page)+1:1,clickHandle:sensorsdata.bind(function(e){a(e.range[0],e.range[1])},this)}))},sensorsdata.UsersListPage.prototype.formatHeaderData_=function(){var e=this,t=e.tableData_,a={cname:"distinct_id",name:"id",data_type:"string",has_dict:!1};e.userProps_.list=e.userProps_.list.filter(function(e){return e.name!==a.name});var s=[];s.push(a),$.each(e.userProps_.list,function(e,a){for(var n=0;n<t.column_name.length;n++)a.name===t.column_name[n]&&s.push(a)}),e.tableData_.column_name=s},sensorsdata.UsersListPage.prototype.formatBodyData_=function(){var e=this,t=e.tableData_,a=[];$.each(t.users,function(t,s){var n=[],r={user_id:s.id},i=s.second_id?s.second_id:s.first_id;n.push(i);for(var o=1;o<e.tableData_.column_name.length;o++){var l=e.tableData_.column_name[o].name,c=e.tableData_.column_name[o].data_type,u=sensorsdata.formatByValue(s.profiles[l],c,"-");n.push(u)}r.list=n,a.push(r)}),e.tableData_.users=a},sensorsdata.UsersListPage.prototype.initBreadCrumb_=function(){for(var e=this.naviPath_,t="/",a=[],s=0;s<e.length;s++){t=t+e[s]+"/";var n={cname:sensorsdata.CONSTSET.urlMap["/"+e[s]+"/"],href:t,parent:s!==e.length-1};"/search-users/"===t&&(n.parent=!1),a.push(n)}var r={list:a,clusterTag:!0,userTag:!0};"clustering"===this.naviPath_[0]&&(r.clusterTag=!1),this.breadCrumbContainer_.html(Mustache.render($("#tpl_breadcrumb").html(),r));var i=this;i.options.container.find("#breadcrumb-wrap li").unbind("click").bind("click",function(){var e=$(this).attr("data-href");if(e){var t=sensorsdata.unparam(window.location.hash);i.apiMap_.hasOwnProperty(e)||(t.hasOwnProperty("page")&&delete t.page,i.options.initPage($(this).attr("data-href")+"#"+$.param(t)))}})},sensorsdata.UsersListPage.prototype.initToolsBar_=function(){var e=this,t=function(e){return e.page&&delete e.page,e.num_per_page&&delete e.num_per_page,e.all_page=!0,e};e.breadCrumbContainer_.find('[data-toggle="tooltip"]').tooltip(),e.options.container.find('[data-method="download"]').unbind("click.list").bind("click.list",function(){var a=t(e.paramObj_);"boolean"!=typeof e.userList_.truncated||e.userList_.truncated?delete a.limit:a.limit=sensorsdata.CONSTSET.limit;var s;s="clustering"===e.naviPath_[0]||"user_analytics"===e.naviPath_[0]?"users/list/csv":e.apiMap_[e.naviPath_[0]]+"user/list/csv";var n=e.naviPath_.map(function(e){var t="/"+e+"/";return sensorsdata.CONSTSET.urlMap[t]}).join("_");a.from_date&&a.to_date&&(n+="_"+a.from_date+sensorsdata.CONSTSET.dateRangeSplit+a.to_date),n+="_SensorsAnalytics",a.profiles=[],e.selectedCols.forEach(function(e){var t=e.name;"id"!==t&&a.profiles.push("user."+t)}),0===e.selectedCols.length&&(a.detail=!1),sensorsdata.download(s,a,n)}),e.breadCrumbContainer_.find('[data-method="select-column"]').unbind("click.select").bind("click.select",function(){sensorsdata.popover({ele:$(this),template:$("#tpl_custom_popover_select").html(),placement:"bottom",title:function(){return sensorsdata.languages.get("选择列目<!--{en}Select column items-->")+'<span class="pull-right"><input type="checkbox" data-method="select-all"/> 全选</span>'}(),content:function(){return Mustache.render($("#tpl_custom_column_content").html(),e.userProps_.list)}(),container:e.breadCrumbContainer_,onShow:function(){var t=$(this.container);sensorsdata.log(e.tableData_);var a=function(){e.selectedCols=[],t.find(".checkbox input[type=checkbox]:checked").each(function(t,a){sensorsdata.log($(a).val()),e.selectedCols.push({name:$(a).val(),cname:$(a).attr("data-cname"),checked:!0})}),sensorsdata.log(e.selectedCols.length),e.selectedCols.length===e.userProps_.list.length?t.find('[data-method="select-all"]').prop("checked",!0):t.find('[data-method="select-all"]').prop("checked","")},s=function(){t.find(".checkbox input[type=checkbox]").prop("checked",""),e.selectedCols.forEach(function(e){t.find('input[value="'+e.name+'"]').prop("checked",!0)}),e.selectedCols.length===e.userProps_.list.length?t.find('[data-method="select-all"]').prop("checked",!0):t.find('[data-method="select-all"]').prop("checked","")};s(),t.find('[data-method="select-all"]').unbind("click.select-all").bind("click.select-all",function(){t.find(".checkbox input[type=checkbox]").prop("checked",$(this).prop("checked")),a()}),t.find(".checkbox input[type=checkbox]").unbind("click.select").bind("click.select",function(){a()})},success:function(){var t=sensorsdata.cache.project.name||"default";sensorsdata.localStorage.setItem("selected-cols-"+t,JSON.stringify(e.selectedCols)),e.paramObj_.profiles=[],e.selectedCols.forEach(function(t){"distinct_id"!==t.name&&e.paramObj_.profiles.push("user."+t.name)}),e.usersJqXHR_=e.getUsersList_(e.paramObj_),e.usersJqXHR_.then(function(){e.formatHeaderData_(),e.formatBodyData_(),e.renderTable_(e.tableData_),e.currentState=!0,sensorsdata.enableReportAjaxCache()})},showNow:!0})}),e.options.container.find('[data-method="refresh"]').unbind("click.refresh").bind("click.refresh",function(){sensorsdata.disableReportAjaxCache();var t=$.extend(!0,{},e.paramObj_);t.use_cache=!1,e.usersJqXHR_=e.getUsersList_(t),e.usersJqXHR_.then(function(){e.userList_&&0!==e.tableData_.size&&0!==e.tableData_.users.length?(e.currentPage_=e.paramObj_.page,e.propsJqXHR_=e.getProps_(),e.propsJqXHR_.then(function(){e.formatHeaderData_(),e.formatBodyData_(),e.renderTable_(e.tableData_),e.currentState=!0})):e.tableContainer_.html(e.tplWithNoData_),sensorsdata.enableReportAjaxCache(),e.options.closeLoading()})}),sensorsdata.popover({ele:e.options.container.find('[data-method="save-cluster"]'),placement:"bottom",title:sensorsdata.languages.get("保存新的用户分群<!--{en}Save new user groups-->"),content:$("#tpl_save_as_cluster").html(),container:e.breadCrumbContainer_,footer:$("#tpl_popover_footer_state_1").html(),beforeShow:function(){},onShow:function(){var a=this.container;sensorsdata.ajax({url:"app_push_config",showLoader:!1,success:function(e){if(sensorsdata.cache.appPushConfigs=$.isArray(e)&&e.length>0?e:[],a.find("#push-config").toggle(sensorsdata.cache.appPushConfigs.length>0),sensorsdata.cache.appPushConfigs.length>0){var t="";sensorsdata.cache.appPushConfigs.map(function(e){t+='<option value="'+e.id+'">'+e.cname+"</option>"});var s=a.find("#push-config select").html(t);s.multiselect("destroy").multiselect({nonSelectedText:sensorsdata.languages.get("可选择<!--{en}Select the push configuration-->"),allSelectedText:sensorsdata.languages.get("推送配置<!--{en}Push configuration-->"),numberDisplayed:1,enableCaseInsensitiveFiltering:!1,buttonText:function(e){return 0===e.length?sensorsdata.languages.get("可选择<!--{en}Select the push configuration-->"):sensorsdata.util.format(sensorsdata.languages.get("推送配置(#{length})<!--{en}Push Configuration(#{length})-->"),e)}})}}});var s=a.find("#edit_new_cluster_name"),n=a.find("#edit_new_cluster_cname");s.focus(),a.find("#edit_new_cluster_name").unbind("focusout.save-as-cluster-name").bind("focusout.save-as-cluster-name",function(){var t={container:e.breadCrumbContainer_,placement:"left"};s[0].value&&sensorsdata.form.check($(this),!0,1,t)}),a.find("#edit_new_cluster_cname").unbind("focusout.save-as-cluster-cname").bind("focusout.save-as-cluster-cname",function(){var t={container:e.breadCrumbContainer_,placement:"left"};n[0].value&&sensorsdata.form.check($(this),!0,1,t)}),a.find("button.pop-is-success").unbind("click.confirm").bind("click.confirm",function(){if(n.length&&s.length){var r=[];if(a.find("#push-config :checkbox:checked").each(function(e,t){var a=$(t).val();$.isNumeric(a)&&r.push(parseInt(a,10))}),!s[0].value||!n[0].value)return void sensorsdata.info.show(sensorsdata.languages.get("您没有输入用户分群的名称，请重新创建<!--{en}You did not enter the name of the group clustering, please recreate.-->"));var i=sensorsdata.form.check(s,!0),o=sensorsdata.form.check(n,!0);if(!i||!o)return i||s.tooltip("show"),void(o||n.tooltip("show"));var l=window.location.pathname+window.location.hash,c=t(e.paramObj_),u={original_request:c,name:s[0].value,cname:n[0].value,query_url:l,app_push_config_id_list:r};e.saveAsCluster_(u)}}),a.on("hidden.bs.popover",function(){n.tooltip("hide"),s.tooltip("hide")})}})},sensorsdata.UsersListPage.prototype.toggleColsShow=function(){this.tableContainer_.find("td, th").hide(),this.tableContainer_.find("th:nth-child(1), td:nth-child(1)").show();var e=this;this.selectedCols.forEach(function(t){var a=e.tableContainer_.find('[data-flag-sort="'+t.name+'"]').index()+1;e.tableContainer_.find("th:nth-child("+a+"), td:nth-child("+a+")").show()})},sensorsdata.UsersListPage.prototype.saveAsCluster_=function(e){var t=null;t=this.apiMap_[this.naviPath_[0]]?this.apiMap_[this.naviPath_[0]]+"user/list/save":"user/list/save";var a={success:!0,clustering_type:sensorsdata.CONSTSET.urlMap["/"+this.naviPath_[0]+"/"]};return sensorsdata.ajax({data:JSON.stringify(e),url:t,type:"post",error:function(e){a.success=!1,a.fail_reason=e.status},success:sensorsdata.bind(function(e){sensorsdata.track("create_clustering",a),sensorsdata.info.show(sensorsdata.languages.get("保存成功，且已发起执行，待执行成功后方可使用<!--{en}Save successfully, the execution has been initiated and can be used until the execution is successful-->")),this.options.initPage("/clustering/#type=2&id="+e.id)},this)})},sensorsdata.UsersListPage.prototype.unload=function(){this.eventJqXHR&&$.isFunction(this.eventJqXHR.abort)&&(this.eventJqXHR.abort(),this.eventJqXHR=null),this.usersJqXHR_&&$.isFunction(this.usersJqXHR_.abort)&&(this.usersJqXHR_.abort(),this.usersJqXHR_=null),this.propsJqXHR_&&$.isFunction(this.propsJqXHR_.abort)&&(this.propsJqXHR_.abort(),this.propsJqXHR_=null),this.currentState=!1,this.breadCrumbContainer_.find('[data-toggle="tooltip"]').tooltip("destroy"),this.tableContainer_.find("table>thead>tr>th").tooltip("destroy"),this.tableContainer_.find("table>tbody>tr>td").tooltip("destroy")},sensorsdata.UsersListPage.prototype.reload=function(){window.location.pathname===this.pageName&&this.init()},sensorsdata.UsersListPage.prototype.dealParam_=function(e){if(e=$.extend(e,{num_per_page:sensorsdata.CONSTSET.paginationSize,page:e.page?Number(e.page):0}),e.is_wastage&&(e.is_wastage="true"===e.is_wastage),e.hasOwnProperty("slice_freq")&&!e.slice_freq&&(e.slice_freq=null),e.hasOwnProperty("slice_max_freq")&&!e.slice_max_freq&&(e.slice_max_freq=null),e.hasOwnProperty("slice_by_value"))switch(e.slice_by_value){case sensorsdata.CONSTSET.unknownByValueText:case"":e.slice_by_value=null;break;case sensorsdata.CONSTSET.emptyStringByValueText:e.slice_by_value=""}var t=null;if(e.hasOwnProperty("slice_by_values")&&e.slice_by_values.length>0)for(t=0;t<e.slice_by_values.length;t++)switch(e.slice_by_values[t]){case sensorsdata.CONSTSET.unknownByValueText:case"":e.slice_by_values[t]=null;break;case sensorsdata.CONSTSET.emptyStringByValueText:e.slice_by_values[t]=""}else delete e.slice_by_values;e.hasOwnProperty("request_type")&&delete e.request_type;var a=null;if(e.hasOwnProperty("bucket_param")&&e.bucket_param)for(a in e.bucket_param)e.bucket_param.hasOwnProperty(a)&&(e.bucket_param[a]=e.bucket_param[a]?parseInt(e.bucket_param[a],10):null);if(e.hasOwnProperty("bucket_params")&&e.bucket_params)for(a in e.bucket_params)if(e.bucket_params.hasOwnProperty(a))for(var s=0;s<e.bucket_params[a].length;s++)e.bucket_params[a][s]=e.bucket_params[a][s]?parseInt(e.bucket_params[a][s],10):null;e.all_page||(e.all_page=!1),e.hasOwnProperty("slice_date")&&!e.slice_date&&(e.slice_date=null),e.hasOwnProperty("filter")||(e.filter={}),e.hasOwnProperty("segmenter_partition")&&(e.segmenter_partition=parseInt(e.segmenter_partition,10)),$.isNumeric(e.sampling_factor)?e.sampling_factor=parseInt(e.sampling_factor,10):delete e.sampling_factor,"true"===e.rollup_date?e.rollup_date=!0:"false"===e.rollup_date&&(e.rollup_date=!1);var n=this,r=sensorsdata.cache.project.name||"default",i=sensorsdata.localStorage.getItem("selected-cols-"+r)?$.parseJSON(sensorsdata.localStorage.getItem("selected-cols-"+r)):[];if(i instanceof Array&&0!==i.length?this.selectedCols=i.filter(function(e){var t=n.userProps_.list.filter(function(t){return t.name===e.name});return t.length?e:void 0}):(n.selectedCols=[],this.userProps_.list.forEach(function(e){e.is_segmenter||n.selectedCols.push({name:e.name,cname:e.cname})})),e.profiles=[],this.selectedCols.forEach(function(t){e.profiles.push("user."+t.name)}),e.hasOwnProperty("detail")&&(e.detail=!0),e.hasOwnProperty("type")&&(e.type=parseInt(e.type,10)),e.hasOwnProperty("result_bucket_param"))if(e.result_bucket_param instanceof Array)for(t=0;t<e.result_bucket_param.length;t++)e.result_bucket_param[t]=+e.result_bucket_param[t];else e.result_bucket_param=[];return $.isArray(e.measures)&&e.measures.length>0&&(e.measures=e.measures.map(function(e){return e.event_name===sensorsdata.CONSTSET.sessionGeneral.name&&(e.event_name="$Anything"),e})),$.isArray(e.slice_element_filter)&&e.slice_element_filter.length>0&&(e.slice_element_filter=e.slice_element_filter.map(function(e){return e.slice_by_value=e.slice_by_value||null,e})),$.isArray(e.next_slice_element_filter)&&e.next_slice_element_filter.length>0&&(e.next_slice_element_filter=e.next_slice_element_filter.map(function(e){return e.slice_by_value=e.slice_by_value||null,e})),e};