sensorsdata.DataSimulator=function(t){this.para=t,this.para.container.html($("#tpl_simulator_manage").html()),this.eleContainerEventMeta=$("#data_simulator_event_meta"),this.eleContainerMetaProps=$("#data_simulator_meta_props"),this.eleContainerProps=$("#data_simulator_props"),this.eleContainerDataImport=$("#data_simulator_data_import"),this.eleContainersAll=this.eleContainerEventMeta.add(this.eleContainerProps).add(this.eleContainerMetaProps).add(this.eleContainerDataImport),this.eleFloatEventAdd=$("#simulator_meta_floatlayer_fix"),this.tplFloatEventAdd=$("#tpl_simulator_meta_add").html(),this.tplFloatEventAddSingle=$("#tpl_simulator_meta_add_single").html(),this.tplFloatEventEdit=$("#tpl_simulator_meta_eidt").html(),this.eleFloatPropsAddEdit=$("#simulator_props_floatlayer_fix"),this.tplFloatPropsAdd=$("#tpl_simulator_props_add").html(),this.tplFloatPropsEdit=$("#tpl_simulator_props_edit").html(),this.eleTabs=$("#simulator_manage_tabs"),this.eleLiTabs=this.eleTabs.find(".mega-tab-link"),this.eleLiTabs0=this.eleLiTabs.eq(0),this.eleLiTabs1=this.eleLiTabs.eq(1),this.eleLiTabs2=this.eleLiTabs.eq(2),this.dataSelectedIndex=null,this.dataSelectedTr=null,this.dataAjaxEvents=null,this.dataMetaEvents=null,this.dataVirtualEvents=null,this.eleEventsMetaBtn=$("#events_meta_head_checkbox"),this.tplMetaTable=$("#tpl_simulator_manage_meta_table").html(),this.tplPropsTable=$("#tpl_simulator_props_table").html(),this.tplMetaPropsTable=$("#tpl_simulator_meta_props_table").html(),this.eleProcessBar=this.para.container.find('[data_ele_name="processbar"]'),this.eleMetaTableContainer=this.eleContainerEventMeta.find(".events-meta-table"),this.init()},sensorsdata.DataSimulator.prototype={constructor:sensorsdata.DataSimulator,showMetaEvents:function(t){var e=this;t?e.showMetaEventsContent(t):this.getAllEvents().then(function(t){t="object"==typeof t?t:{},e.dataMetaEvents=t.simulate_event,e.showMetaEventsContent(t)})},showAllProps:function(){var t=this,e={1:sensorsdata.languages.get("数值<!--{en}number-->"),2:sensorsdata.languages.get("字符串<!--{en}String-->"),3:sensorsdata.languages.get("列表<!--{en}List-->"),4:sensorsdata.languages.get("日期<!--{en}date-->"),5:sensorsdata.languages.get("日期时间<!--{en}datetime-->"),6:sensorsdata.languages.get("布尔<!--{en}Boolean-->"),"-1":sensorsdata.languages.get("未知<!--{en}Unknown-->")},a={0:sensorsdata.languages.get("事件属性<!--{en}Event properties-->"),1:sensorsdata.languages.get("用户属性<!--{en}User properties-->")};this.eleContainerProps.find('[data_ele_name="data_simulator_props_input"]').val(""),this.getAllProps().then(function(s){s&&s.simulate_property&&(t.dataAllProps=[],$.each(s.simulate_property,function(s,n){n.data_type_origin=n.data_type,n.data_type=e[n.data_type]||sensorsdata.languages.get("未知<!--{en}Unknown-->"),n.table_type_origin=n.table_type,n.table_type=a[n.table_type]||sensorsdata.languages.get("未知<!--{en}Unknown-->"),n.sample_origin=n.sample,$.isArray(n.sample)?1===n.data_type_origin?n.sample=2===n.sample.length&&n.sample[1]?sensorsdata.languages.get("从<!--{en}From-->")+n.sample.join(sensorsdata.languages.get("到<!--{en}to-->")):"":2===n.data_type_origin&&(n.sample=n.sample.length>=1&&n.sample[1]?n.sample.join("，").slice(0,30)+"...":""):n.sample="",n.name&&("$"!==n.name.slice(0,1)?n.isNotPre=!0:(n.isNotPre=!1,n.table_type=sensorsdata.languages.get(0===n.table_type_origin?"事件预置<!--{en}Event preset-->":"用户预置<!--{en}User preset-->"))),t.dataAllProps.push(n)}),t.showPropsContent({props:sensorsdata.seniorSort(s.simulate_property,"table_type").reverse()}))})},showPropsContent:function(t){this.eleContainerProps.find('[data_ele_name="props-total-num"]').text(t.props.length);var e=Mustache.render(this.tplPropsTable,t);this.eleContainerProps.find("table").html(e)},showMetaEventsContent:function(t){var e=$("#simulator_table_none_state");this.eleMetaTableContainer.html(""),$.isArray(t.meta_event)&&0===t.meta_event.length&&$.isArray(t.simulate_event)&&0===t.simulate_event.length?e.show():e.hide(),this.eleContainerEventMeta.find('[data-sign="meta-total-num"]').text(t.simulate_event.length);var a=Mustache.render(this.tplMetaTable,t);this.eleMetaTableContainer.html(a)},showEditEventFloat:function(t){var e=this;this.floatMetaEdit=new sensorsdata.floatLayerRight({ele:this.eleFloatEventAdd,width:500,data:{id:t}}),this.floatMetaEdit.showView();var a=$.grep(this.dataMetaEvents,function(e){return String(t)===String(e.id)})[0];this.ajaxMetaPropRelation(t).then(function(t){if(t&&t.simulate_properties){var s=[];$.each(t.simulate_properties,function(t,e){e.name&&"$"!==e.name.slice(0,1)&&s.push(e)}),a.props=s;var n=Mustache.render(e.tplFloatEventEdit,a);e.eleFloatEventAdd.html(n)}})},showAddEventFloat:function(){this.floatMetaAdd=new sensorsdata.floatLayerRight({ele:this.eleFloatEventAdd,width:800}),this.floatMetaAdd.showView();var t=Mustache.render(this.tplFloatEventAdd,{});this.eleFloatEventAdd.html(t)},showAddEventFloatSingle:function(){this.floatMetaAddSingle=new sensorsdata.floatLayerRight({ele:this.eleFloatEventAdd,width:500}),this.floatMetaAddSingle.showView();var t=Mustache.render(this.tplFloatEventAddSingle,{});this.eleFloatEventAdd.html(t)},showAddPropsFloat:function(){this.floatPropsAdd=new sensorsdata.floatLayerRight({ele:this.eleFloatPropsAddEdit,width:800}),this.floatPropsAdd.showView();var t=Mustache.render(this.tplFloatPropsAdd,{});this.eleFloatPropsAddEdit.html(t)},showEditPropsFloat:function(t){this.floatPropsEdit=new sensorsdata.floatLayerRight({ele:this.eleFloatPropsAddEdit,width:800}),this.floatPropsEdit.showView();var e=$.grep(this.dataAllProps,function(e){return String(e.id)===String(t)})[0],a=Mustache.render(this.tplFloatPropsEdit,e);this.eleFloatPropsAddEdit.html(a),this.eleFloatPropsAddEdit.find('[data_ele_name="props_attr"]').val(e.table_type_origin),this.eleFloatPropsAddEdit.find('[data_ele_name="props_prop"]').val(e.data_type_origin);var s=$.isArray(e.sample_origin)?e.sample_origin.join("  "):"";this.eleFloatPropsAddEdit.find('[data_ele_name="props_input"]').val(s)},saveMetaEvent:function(){var t=[],e=this;if(this.floatMetaAdd&&this.floatMetaAdd.state===!0){var a=this.eleFloatEventAdd.find('[data_ele_name="meta_input"]').val();(""===a||1===a.split(" ").length)&&sensorsdata.error.show(sensorsdata.languages.get("请输入事件名格式为，英文名＋空格＋中文名<!--{en}The format of the event name is English name+Space+Chinese name-->")),a=a.split("\n"),$.each(a,function(e,a){var s=a.match(/[^\s]+/g),n={};$.isArray(s)&&sensorsdata.CONSTSET.eventReg.test(s[0])&&(n.name=s[0],""===s[1]||/^\s+$/.test(s[1])||(n.cname=s[1]),t.push(n))})}sensorsdata.ajax({url:"simulator/event",type:"post",contentType:"application/json",data:JSON.stringify(t),success:function(){e.floatMetaAdd.hideView(),e.showMetaEvents()},error:function(){e.floatMetaAdd.hideView()}})},saveMetaEventEdit:function(){var t,e,a=this,s=this.floatMetaEdit.data.id,n=this.eleFloatEventAdd.find('[data_ele_name="eng_name"]').val(),o=this.eleFloatEventAdd.find('[data_ele_name="chs_name"]').val(),i=this.eleFloatEventAdd.find('[data_ele_name="eng_name"]').attr("data-default"),r=this.eleFloatEventAdd.find('[data_ele_name="chs_name"]').attr("data-default");if(""===n||""===o)return sensorsdata.error.show(sensorsdata.languages.get("事件名不能为空<!--{en}The event name can not be empty-->")),!1;t=n!==i||o!==r?sensorsdata.ajax({url:"simulator/event/"+s,type:"post",contentType:"application/json",data:JSON.stringify({name:n,cname:o})}):$.Deferred().resolve();var l=[];this.eleFloatEventAdd.find(".data-simulator-event-edit-relation input").each(function(t,e){$(e).prop("checked")&&l.push($(e).closest("li").attr("data-index"))}),e=sensorsdata.ajax({url:"simulator/event/"+s+"/properties",type:"post",data:JSON.stringify(l),contentType:"application/json"}),this.floatMetaEdit.hideView(),$.when(t,e).then(function(){a.showMetaEvents()})},saveProps:function(){var t=this,e={};e.cname=this.eleFloatPropsAddEdit.find('[data_ele_name="chs_name"]').val(),e.table_type=this.eleFloatPropsAddEdit.find('[data_ele_name="props_attr"]').val(),e.data_type=this.eleFloatPropsAddEdit.find('[data_ele_name="props_prop"]').val();var a=this.eleFloatPropsAddEdit.find('[data_ele_name="props_input"]').val();return e.sample=/^\s+$/.test(a)?[]:a.split(/\s+/),e.name=this.eleFloatPropsAddEdit.find('[data_ele_name="eng_name"]').val(),e.name&&sensorsdata.CONSTSET.eventReg.test(e.name)?void(this.floatPropsAdd&&this.floatPropsAdd.state===!0?sensorsdata.ajax({url:"simulator/property",type:"post",contentType:"application/json",data:JSON.stringify(e),success:function(){t.floatPropsAdd.hideView(),t.showAllProps()},error:function(){t.floatPropsAdd.hideView()}}):this.floatPropsEdit&&this.floatPropsEdit.state===!0&&sensorsdata.ajax({url:"simulator/property/"+t.dataPropEditIndex,type:"post",contentType:"application/json",data:JSON.stringify(e),success:function(){t.floatPropsEdit.hideView(),t.showAllProps()},error:function(){t.floatPropsEdit.hideView()}})):(sensorsdata.error.show(sensorsdata.languages.get("属性名不合法<!--{en}The property name is not valid-->")),!1)},showMetaProps:function(){var t=this;this.getAllEvents().then(function(e){e=e.simulate_event;var a="";$.each(e,function(t,e){a+='<option value="'+e.id+'">'+e.cname+"("+e.name+")</option>"}),t.eleContainerMetaProps.find('[data-method="simulator_select_event"]').html(a)})},ajaxMetaPropRelation:function(t){return sensorsdata.ajax({url:"simulator/event/"+t+"/properties",type:"get",contentType:"application/json"})},showMetaPropRelation:function(t){var e=this,a={1:sensorsdata.languages.get("数值<!--{en}number-->"),2:sensorsdata.languages.get("字符串<!--{en}String-->")};sensorsdata.ajax({url:"simulator/event/"+t+"/properties",type:"get",contentType:"application/json",success:function(t){if(t&&t.simulate_properties){var s=[];$.each(t.simulate_properties,function(t,e){e.name&&"$"!==e.name.slice(0,1)&&(e.data_type=a[e.data_type]||sensorsdata.languages.get("未知<!--{en}Unknown-->"),e.sample=$.isArray(e.sample)?e.sample.join("，"):"",s.push(e))});var n=Mustache.render(e.tplMetaPropsTable,{props:s});e.eleContainerMetaProps.find("table").html(n)}},error:function(){}})},saveMetaPropRelation:function(){var t=this.eleContainerMetaProps.find('[data-method="simulator_select_event"]').val(),e=[];this.eleContainerMetaProps.find("table input").each(function(t,a){$(a).prop("checked")&&e.push($(a).closest("tr").attr("data-index"))}),sensorsdata.ajax({url:"simulator/event/"+t+"/properties",type:"post",data:JSON.stringify(e),contentType:"application/json"})},showDataImport:function(){this.showLoadingStatus();var t=this.eleContainerDataImport.find('[data_ele_name="date-range-picker"]');t.daterangepicker({containerClass:"no-ranges",maxDate:moment().add(15,"days").startOf("day"),startDate:moment().subtract(30,"days").startOf("day"),endDate:moment().add(15,"days").startOf("day"),dateTemplate:sensorsdata.languages.get("YYYY年M月<!--{en}YYYY/MM-->"),separator:sensorsdata.languages.get("至<!--{en} To -->"),locale:{applyLabel:sensorsdata.languages.get("确定<!--{en}Ok-->"),cancelLabel:sensorsdata.languages.get("取消<!--{en}Cancel-->"),fromLabel:sensorsdata.languages.get("从<!--{en}from-->"),toLabel:sensorsdata.languages.get("到<!--{en}to-->"),weekLabel:sensorsdata.languages.get("周<!--{en}week-->"),customRangeLabel:"",daysOfWeek:[sensorsdata.languages.get("日<!--{en}SUN-->"),sensorsdata.languages.get("一<!--{en}MON-->"),sensorsdata.languages.get("二<!--{en}THU-->"),sensorsdata.languages.get("三<!--{en}WED-->"),sensorsdata.languages.get("四<!--{en}THU-->"),sensorsdata.languages.get("五<!--{en}FRI-->"),sensorsdata.languages.get("六<!--{en}SAT-->")],monthNames:[sensorsdata.languages.get("一月<!--{en}Jan-->"),sensorsdata.languages.get("二月<!--{en}Feb-->"),sensorsdata.languages.get("三月<!--{en}Mar-->"),sensorsdata.languages.get("四月<!--{en}Apr-->"),sensorsdata.languages.get("五月<!--{en}May-->"),sensorsdata.languages.get("六月<!--{en}Jun-->"),sensorsdata.languages.get("七月<!--{en}Jul-->"),sensorsdata.languages.get("八月<!--{en}Aug-->"),sensorsdata.languages.get("九月<!--{en}Sept-->"),sensorsdata.languages.get("十月<!--{en}Oct-->"),sensorsdata.languages.get("十一月<!--{en}Nov-->"),sensorsdata.languages.get("十二月<!--{en}Dec-->")],firstDay:moment.localeData()._week.dow},getTplHourSelect:function(){var t=sensorsdata.languages.get("时<!--{en} hours-->");return'<select class="hour"><option value="0">0'+t+'</option><option value="1">1'+t+'</option><option value="2">2'+t+'</option><option value="3">3'+t+'</option><option value="4">4'+t+'</option><option value="5">5'+t+'</option><option value="6">6'+t+'</option><option value="7">7'+t+'</option><option value="8">8'+t+'</option><option value="9">9'+t+'</option><option value="10">10'+t+'</option><option value="11">11'+t+'</option><option value="12">12'+t+'</option><option value="13">13'+t+'</option><option value="14">14'+t+'</option><option value="15">15'+t+'</option><option value="16">16'+t+'</option><option value="17">17'+t+'</option><option value="18">18'+t+'</option><option value="19">19'+t+'</option><option value="20">20'+t+'</option><option value="21">21'+t+'</option><option value="22">22'+t+'</option><option value="23">23'+t+"</option></select>"},getDRPTemplate:function(t){return sensorsdata.languages.replace('<div class="daterangepicker dropdown-menu"><div class="title"><div>时间范围<!--{en}Ranges--></div><div>起始时间<!--{en}Starting--></div><div>终止时间<!--{en}Ending--></div></div><div class="calendar-wrap"><div class="calendar first left"></div><div class="calendar second right"></div><div class="ranges"><div class="range_inputs"><div class="daterangepicker_start_input"><label for="daterangepicker_start"></label><input class="input-mini" type="text" name="daterangepicker_start" value="" /></div><div class="daterangepicker_end_input"><label for="daterangepicker_end"></label><input class="input-mini" type="text" name="daterangepicker_end" value="" /></div><button class="applyBtn" disabled="disabled"></button>&nbsp;<button class="cancelBtn"></button></div></div></div><div class="toolbar"><span class="item time-extend"><label class="sa-checkbox"><input id="'+t+'-time-extend" type="checkbox"><label for="'+t+'-time-extend"></label><span></span></label>&nbsp;<span class="icon-help"></span></span><span class="item compare"><label class="sa-checkbox"><input id="'+t+'1" type="checkbox"><label for="'+t+'1"></label><span>对比日期<!--{en}Contrast date--></span></label><span style="display:none;"><div class="dropdown"><button type="button" class="btn btn-default dropdown-toggle btn-small" data-toggle="dropdown" aria-expanded="false"><span class="selected" data-value="last period">上一时段</span><span class="caret"></span></button><ul class="dropdown-menu pull-right sa-small" role="menu"><li><a data-value="last period">上一时段</a></li><li><a data-value="last year">去年同期</a></li><li style="display:none;"><a data-value="custom">自定义</a></li></ul></div><input type="text" class="sa-small"/>&nbsp;-&nbsp;<input type="text" class="sa-small"/></span></span><span class="item relative-date"><label class="sa-checkbox"><input id="'+t+'2" type="checkbox"><label for="'+t+'2"></label>静态时间</label><span>过去 1 天 - 过去 3 天</span></span><span class="item"><button class="cancelBtn btn btn-link btn-small"></button>&nbsp;<button class="applyBtn btn btn-primary btn-small" disabled="disabled"></button></span></div></div>')}})},checkToShow:function(t){function e(){a.eleLiTabs.removeClass("on"),a.eleContainersAll.hide(),n[s]()}this.dataHashType=sensorsdata.unparam(location.hash).type;var a=this,s=t||this.dataHashType,n={meta:function(){a.eleLiTabs1.addClass("on"),a.eleContainerEventMeta.show(),a.showMetaEvents()},props:function(){a.eleLiTabs0.addClass("on"),a.eleContainerProps.show(),a.showAllProps()},data_import:function(){a.eleLiTabs2.addClass("on"),a.eleContainerDataImport.show(),a.showDataImport()}};s in n||(s="props"),sensorsdata.ajax({url:"simulator/enter",success:function(t){if(a.dataEnterStatus=t,"object"==typeof t&&t.first_enter===!1){"data_import"!==s&&(s="data_import",e());var n=a.eleContainerDataImport.find(".data-simulator-data-import-sec").eq(0).css({paddingLeft:20,letterSpacing:2}).find(">div");n.eq(0).hide(),n.eq(1).show()}else e()}})},isLoading:!1,showLoadingStatus:function(t){function e(t){var e=parseInt(t.write/t.read*100)+"%";return parseInt(e)>=100?(n.eleProcessBar.css({visibility:"hidden"}),!1):(n.eleProcessBar.css({visibility:"visible"}),void n.eleProcessBar.find(".pull-left span").text("finished"===t.status?e:sensorsdata.languages.get("，准备中<!--{en},in preparation-->")))}function a(){sensorsdata.ajax({url:"simulator/enter",success:function(t){void 0!==t.read&&void 0!==t.write&&t.read>t.write?(e(t),s()):(n.isLoading=!1,n.eleProcessBar.css({visibility:"hidden"}))}})}function s(){setTimeout(a,2e4)}var n=this;this.isLoading===!1&&(t?a():void 0!==this.dataEnterStatus.read&&void 0!==this.dataEnterStatus.write&&this.dataEnterStatus.read>=this.dataEnterStatus.write?(e(this.dataEnterStatus),this.isLoading=!0,s()):(this.isLoading=!1,n.eleProcessBar.css({visibility:"hidden"})))},events_:function(){function t(t){var e=sensorsdata.AJAX_CONST.BASE_URL+"simulator/easy/mode/upload";return sensorsdata.cache.project.name&&-1===e.indexOf("project=")?(e=e+"?project="+sensorsdata.cache.project.name,e=e+"&"+t):e=e+"?"+t,e}var e=this;this.eleTabs.on("click","li",function(){return $(this).hasClass("on")?!1:(window.history.pushState("simulator-type","","#type="+$(this).attr("data-type")),void e.reload())}),this.eleContainerEventMeta.on("click",'[data-method="btn_click_add_event"]',function(){e.showAddEventFloat()}),this.eleContainerEventMeta.on("click",'[data-method="btn_click_add_event_single"]',function(){e.showAddEventFloatSingle()}),this.eleContainerEventMeta.on("click",'[data-method="delete"]',function(){var t=$(this).closest("tr").attr("data-id"),a=$(this);a.data("bs.popover")||sensorsdata.popover({className:"popover-edit-dashboard-delete",ele:a,showNow:!0,footer:$("#tpl_popover_footer_state_3").html(),content:sensorsdata.languages.get("确认删除吗？<!--{en}Are you sure to delete?-->"),success:function(){sensorsdata.ajax({url:"simulator/event/"+t,type:"delete",success:function(){e.showMetaEvents()},error:function(){}})}}),sensorsdata.languages.update()}),this.eleContainerEventMeta.on("click",'[data-method="data-event-edit"]',function(){e.showEditEventFloat($(this).closest("tr").attr("data-id"))}),this.eleFloatEventAdd.on("click",'[data-method="float_save"]',function(){e.floatMetaAdd&&e.floatMetaAdd.state===!0?e.saveMetaEvent():e.saveMetaEventEdit()}),this.eleContainerProps.on("click",'[data-method="btn_click_add_props"]',function(){e.showAddPropsFloat()}),this.eleFloatPropsAddEdit.on("click",'[data-method="float_save"]',function(){e.saveProps()}),this.eleContainerProps.on("click",".events-manage-edit-btn",function(){e.dataPropEditIndex=$(this).closest("tr").attr("data-index"),e.showEditPropsFloat(e.dataPropEditIndex)}),this.eleContainerProps.on("keyup",'[data_ele_name="data_simulator_props_input"]',function(){var t=$(this).val(),a=$.grep(e.dataAllProps,function(e){return e.name&&e.cname?-1!==e.name.indexOf(t)||-1!==e.cname.indexOf(t):void 0});e.showPropsContent({props:a})}),this.eleContainerProps.on("click",'[data-method="delete"]',function(){var t=$(this),a=$(this).closest("tr").attr("data-index");t.data("bs.popover")||sensorsdata.popover({className:"popover-edit-dashboard-delete",ele:t,showNow:!0,footer:$("#tpl_popover_footer_state_3").html(),content:sensorsdata.languages.get("确认删除吗？<!--{en}Are you sure to delete?-->"),success:function(){sensorsdata.ajax({url:"simulator/property/"+a,type:"delete",success:function(){e.showAllProps()}})}}),sensorsdata.languages.update()}),this.eleContainerProps.on("click","table thead [data-sort]",function(){var t=$(this).attr("data-sort-name"),a=$(this).attr("data-sort")||"descend",s=e.dataAllProps,n=[],o="";"descend"===a?(n=sensorsdata.seniorSort(s,t).reverse(),o="ascend"):(n=sensorsdata.seniorSort(s,t),o="descend"),e.showPropsContent({props:n}),e.eleContainerProps.find('table [data-sort-name="'+t+'"]').attr("data-sort",o)}),this.eleContainerMetaProps.on("change",'[data-method="simulator_select_event"]',function(){e.showMetaPropRelation($(this).val())}),this.eleContainerMetaProps.on("change",".table-ms-common tbody tr td input",function(){e.saveMetaPropRelation($(this).closest("tr").attr("data-index"))});var a={start:moment().subtract(30,"days").format("YYYY-MM-DD"),end:moment().add(15,"days").format("YYYY-MM-DD")};this.eleContainerDataImport.on("apply.daterangepicker",".report-date-picker-wrap input",function(t,e){var s=e.startDate.format(sensorsdata.CONSTSET.dateFormat),n=e.endDate.format(sensorsdata.CONSTSET.dateFormat);a={start:s,end:n}}),this.eleContainerDataImport.on("click",'[data_ele_name="btn_import_data"]',function(){return a?void sensorsdata.ajax({type:"post",url:"simulator/import?beginDate="+a.start+"&endDate="+a.end,contentType:"application/json",success:function(){sensorsdata.info.show(sensorsdata.languages.get("提交成功，正在导入模拟数据<!--{en}Submit successfully, it is importing simulated data-->")),e.showLoadingStatus(!0)},showCommonError:!1,error:function(t){try{sensorsdata.error.show(400===t.status?t.responseJSON.error:sensorsdata.languages.get("上传失败<!--{en}Upload failed-->"))}catch(e){sensorsdata.log(e)}}}):(sensorsdata.error.show(sensorsdata.languages.get("请选择时间范围<!--{en}Please select the time range-->")),!1)}),this.fullImport=new Uploader({name:"file",trigger:this.eleContainerDataImport.find('[data_ele_name="btn_code_select_full"]'),action:t("isIncrement=false"),progress:function(t,e,a,s){sensorsdata.log(sensorsdata.util.format(sensorsdata.languages.get("上传 ... #{percent}%<!--{en}Upload... #{percent}%-->")),{percent:s})},error:function(t){e.fullImport.form[0].reset();try{sensorsdata.error.show(400===t.status?t.responseJSON.error:sensorsdata.languages.get("上传失败<!--{en}Upload failed-->"))}catch(a){sensorsdata.log(a)}},success:function(){e.fullImport.form[0].reset(),e.checkToShow("meta")}}),this.appendImport=new Uploader({name:"file",trigger:this.eleContainerDataImport.find('[data_ele_name="btn_code_select_append"]'),action:t("isIncrement=true"),progress:function(t,e,a,s){sensorsdata.log(sensorsdata.util.format(sensorsdata.languages.get("上传 ... #{percent}%<!--{en}Upload... #{percent}%-->")),{percent:s})},error:function(t){e.appendImport.form[0].reset();try{sensorsdata.error.show(400===t.status?t.responseJSON.error:sensorsdata.languages.get("上传失败<!--{en}Upload failed-->"))}catch(a){sensorsdata.log(a)}},success:function(){e.appendImport.form[0].reset(),e.checkToShow("meta")}}),this.eleContainerDataImport.on("click",'[data_ele_name="simulator_clear_data"]',function(){sensorsdata.ajax({url:"simulator/clear_data",type:"post",success:function(){location.reload()}})});var s=sensorsdata.AJAX_CONST.BASE_URL+"simulator/upload";sensorsdata.cache.project.name&&-1===s.indexOf("project=")&&(s=s+"?project="+sensorsdata.cache.project.name),this.csvImport=new Uploader({name:"file",trigger:this.eleContainerDataImport.find('[data_ele_name="btn_csv_import"]'),action:s,progress:function(t,e,a,s){sensorsdata.log(sensorsdata.util.format(sensorsdata.languages.get("上传 ... #{percent}%<!--{en}Upload... #{percent}%-->")),{percent:s})},error:function(t){e.csvImport.form[0].reset();try{sensorsdata.error.show(400===t.status?t.responseJSON.error:sensorsdata.languages.get("导入配置失败<!--{en}Import configuration failed-->"))}catch(a){sensorsdata.log(a)}},success:function(){e.csvImport.form[0].reset(),e.checkToShow("meta")}}),this.eleContainerDataImport.on("click",'[data_ele_name="btn_csv_export"]',function(){sensorsdata.download(sensorsdata.languages.get("simulator/template?filename=模拟数据<!--{en}simulator/template?filename=simulated data-->")+moment().format("YYYY-MM-DD-HH-MM")+".csv")})},getAllEvents:function(){return sensorsdata.ajax({url:"simulator/event/all",ContentType:"application/json"})},getAllProps:function(){return sensorsdata.ajax({url:"simulator/property/all",ContentType:"application/json"})}},sensorsdata.DataSimulator.prototype.init=function(){this.para.closeLoading(),this.checkToShow(),this.events_()},sensorsdata.DataSimulator.prototype.unload=function(){},sensorsdata.DataSimulator.prototype.reload=function(){this.checkToShow()};