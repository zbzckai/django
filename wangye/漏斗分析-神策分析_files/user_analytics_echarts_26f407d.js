sensorsdata.UserAnalyticsChart=function(t){!$.isEmptyObject(t.userObj_)&&$.isArray(t.userObj_.rows)&&$.isArray(t.userObj_.series)||t.container.html(sensorsdata.languages.get("无效的图形数据<!--{en}Invalid graphic data-->")),this.option_={queryData:{},container:this.chartsContainer_,limit:10,userObj_:this.userObj_,widgetModel:!1,userRollObj_:this.userRollObj_},$.extend(!0,this.option_,t),this.chart_=null,this.usedColor_={},this.dataZoomNum_=10,this.bucket=["hour","day","week","month"]},sensorsdata.UserAnalyticsChart.prototype.destroy=function(){this.chart_&&$.isFunction(this.chart_.dispose)&&this.chart_.dispose(),this.option_.container.html("")},sensorsdata.UserAnalyticsChart.prototype.resize=function(){this.chart_&&$.isFunction(this.chart_.resize)&&this.chart_.resize()},sensorsdata.UserAnalyticsChart.prototype.findColor_=function(t,e){var a=sensorsdata.CONSTSET.chartsColors;if(t[e])return t[e];for(var s=Object.keys(t),r=s.map(function(e){return t[e]}),n=0,o=a.length;o>n;n++)if(-1===r.indexOf(a[n]))return t[e]=a[n],a[n];return t[e]=a[(r.length+1)%a.length],a[(r.length+1)%a.length]},sensorsdata.UserAnalyticsLineChart=function(t){sensorsdata.UserAnalyticsChart.call(this,t)},sensorsdata.inherits(sensorsdata.UserAnalyticsLineChart,sensorsdata.UserAnalyticsChart),sensorsdata.UserAnalyticsLineChart.prototype.show=function(t){var e=this.option_;this.destroy();var a=this,s=echarts.init(e.container[0]),r=sensorsdata.echarts,n=e.widgetModel?6:9,o=e.widgetModel?1.4:1.6,i=[],d=e.userObj_.series.map(function(t){return sensorsdata.trimConstHtml(t)}),l=[];this.names_=$.isArray(t)?$.extend(!0,[],t):[];var h=e.userObj_.rows.filter(function(t){return-1!==a.names_.indexOf(t.name)}),u=e.measureUnit[0];h.forEach(function(t){var e=[];t.data.forEach(function(t){e.push(t[0])}),l.push(e)});var c={show:!e.widgetModel,data:[]},m=e.widgetModel&&d.length<=10||!e.widgetModel&&d.length<=30;h.forEach(function(t,s){var r=sensorsdata.trimConstHtml(t.name);c.data.push({name:r});var h=a.findColor_(a.usedColor_,r);i.push({name:r,type:"line",showbolSize:!e.widgetModel,symbol:"circle",symbolSize:n,showAllSymbol:m,lineStyle:{normal:{color:h,width:o}},data:l[s].map(function(t,e){return{value:t,measureUnit:u,xLabel:sensorsdata.trimConstHtml(d[e]),itemStyle:{normal:{color:h}}}})})});var f={show:!1};if(!e.widgetModel){var p=d.length,g=this.dataZoomNum_;p>g&&(f.show=!0,f.start=0,f.end=100)}var y=function(t){var a=1===e.queryData.by_fields.length?"":"</br>"+r.truncateLabel(t.seriesName,50);return t.data.xLabel+a+"："+t.data.value+t.data.measureUnit},_={trigger:"axis",axisPointer:{lineStyle:{width:0}},formatter:function(t){return $.isArray(t)&&(t=t[0]),sensorsdata.echarts.wrapTriangleTooltip(y(t))},position:function(t,e,a){return r.lineTooltipPosition(s,t,e,a,y)}},b={color:sensorsdata.CONSTSET.chartsColors,tooltip:_,legend:c,dataZoom:f,xAxis:{data:d},yAxis:{axisLabel:{formatter:function(t){return e.widgetModel?sensorsdata.formatNumber(t,!0):sensorsdata.formatNumber(t,!0)}}},series:i};e.widgetModel&&(b.grid={bottom:0,left:10},_.axisPointer={lineStyle:{width:1,color:"#aaa"}},_.formatter=function(){return""},_.backgroundColor="rgba(50,50,50,0)",_.borderWidth=0,delete _.position),s.on("mouseover",function(t){s.dispatchAction({type:"highlight",seriesIndex:t.seriesIndex})}),s.on("mouseout",function(t){s.dispatchAction({type:"downplay",seriesIndex:t.seriesIndex})}),s.on("showtip",function(t){if($.isFunction(e.onPointChanged)){var a=s.getModel().getSeriesByIndex(t.seriesIndex).getData(),r=a.indexOfRawIndex(t.dataIndex);e.onPointChanged(r)}}),b=$.extend(!0,{},sensorsdata.echarts.option,b),b.dataZoom.show&&(b.legend.bottom=40,b.grid.bottom=90),this.chart_=s,s.setOption(b)},sensorsdata.UserAnalyticsLineChart.prototype.remove=function(t){var e=this.names_.indexOf(t);return e>=0?(this.names_.splice(e,1),this.show(this.names_),$.extend(!0,[],this.names_)):void 0},sensorsdata.UserAnalyticsPieChart=function(t){sensorsdata.UserAnalyticsChart.call(this,t),this.tplPieContainer_=$("#tpl-user-analytics-index-pie-container").html()},sensorsdata.inherits(sensorsdata.UserAnalyticsPieChart,sensorsdata.UserAnalyticsChart),sensorsdata.UserAnalyticsPieChart.prototype.show=function(t){var e=this.option_;this.destroy();var a=this,s=sensorsdata.echarts,r=e.measureName,n=sensorsdata.languages.get("其它...<!--{en}Other...-->"),o=echarts.init(e.container[0]);this.names_=$.isArray(t)?$.extend(!0,[],t):[];var i=function(t,e){var s=t.map(function(t){var e=a.findColor_(a.usedColor_,t.name);return{value:t.data[0],name:t.name,color:e}});if(t.length<e.length){var r=0;e.map(function(t){-1===a.names_.indexOf(t.name)&&(r+=t.data[0][0])}),s.push({name:n,value:Math.round(100*r)/100,color:a.findColor_(a.usedColor_,n)})}return s},d=e.userRollObj_.rows.filter(function(t){return-1!==a.names_.indexOf(t.name)}),l=e.userRollObj_.rows,h=i(d,l),u={color:sensorsdata.CONSTSET.chartsColors,selectedOffset:0,label:$.extend(!0,{},s.legendLabel),tooltip:$.extend(!0,{},s.option.tooltip),itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},series:[{name:r,type:"pie",selectedOffset:0,radius:["31%","55%"],label:$.extend(!0,{},s.legendLabel),itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:h}]};u.tooltip.formatter=function(t){return t.seriesName+"</br>"+s.truncateLabel(t.data.name,50)+"："+t.value+sensorsdata.languages.get("占<!--{en}take-->")+t.percent+"%"},u.series[0].label.normal.formatter=function(t){return s.truncateLabel(t.name,e.widgetModel?10:20)+"\n"+t.percent+"%"},e.widgetModel===!0&&(u.series[0].radius=["35%","60%"]),this.chart_=o,o.setOption(u)},sensorsdata.UserAnalyticsPieChart.prototype.remove=function(t){var e=this.names_.indexOf(t);return e>=0&&(this.names_.splice(e,1),this.show(this.names_)),$.extend(!0,[],this.names_)},sensorsdata.UserAnalyticsBarChart=function(t){sensorsdata.UserAnalyticsChart.call(this,t)},sensorsdata.inherits(sensorsdata.UserAnalyticsBarChart,sensorsdata.UserAnalyticsChart),sensorsdata.UserAnalyticsBarChart.prototype.show=function(t){var e=this.option_;this.destroy();var a=this,s=echarts.init(e.container[0]),r=sensorsdata.echarts,n=[],o=e.userObj_.series.map(function(t){return sensorsdata.trimConstHtml(t)}),i=[];this.names_=$.isArray(t)?$.extend(!0,[],t):[];var d=e.userObj_.rows.filter(function(t){return-1!==a.names_.indexOf(t.name)}),l={show:!e.widgetModel,data:[]},h=[],u=e.measureUnit[0],c=e.measureName;d.forEach(function(t){var e=[];t.data.forEach(function(t){e.push(t[0])}),i.push(e)}),o.forEach(function(t,e){var a=0;d.map(function(t){a+=t.data[e][0]}),h.push(a)}),d.forEach(function(t,e){var s=sensorsdata.trimConstHtml(t.name);l.data.push({name:s});var r=a.findColor_(a.usedColor_,s);n.push({name:s,type:"bar",barGap:"10%",barMaxWidth:"40%",itemStyle:{normal:{color:r}},stack:c,data:i[e].map(function(t,e){return{value:t,measureUnit:u,xLabel:o[e],totalValue:h[e],measureName:c}})})});var m={show:!1};if(!e.widgetModel){var f=o.length,p=this.dataZoomNum_;f>p&&(m.show=!0,m.start=0,m.end=100)}var g={formatter:function(t){var a=1===e.queryData.by_fields.length?"":"</br>"+r.truncateLabel(t.seriesName,50);return t.data.xLabel+a+"："+t.data.value+t.data.measureUnit}};e.widgetModel&&(g.trigger="axis",g.axisPointer={lineStyle:{width:1,color:"#aaa"}},g.formatter=function(){return""},g.backgroundColor="rgba(50,50,50,0)",g.borderWidth=0);var y={color:sensorsdata.CONSTSET.chartsColors,tooltip:g,legend:l,dataZoom:m,xAxis:{data:o},series:n};e.widgetModel===!0&&(y.grid={bottom:0,left:10}),s.on("showtip",function(t){if($.isFunction(e.onPointChanged)){var a=s.getModel().getSeriesByIndex(t.seriesIndex).getData(),r=a.indexOfRawIndex(t.dataIndex);e.onPointChanged(r)}}),y=$.extend(!0,{},sensorsdata.echarts.option,y),y.dataZoom.show&&(y.legend.bottom=40,y.grid.bottom=90),this.chart_=s,s.setOption(y)},sensorsdata.UserAnalyticsBarChart.prototype.remove=function(t){var e=this.names_.indexOf(t);return e>=0?(this.names_.splice(e,1),this.show(this.names_,this.measureIndexs_),$.extend(!0,[],this.names_)):void 0};