function JsonFormater(a){this.options=$.extend({dom:"",tabSize:2,singleTab:"  ",quoteKeys:true,imgCollapsed:"images/Collapsed.gif",imgExpanded:"images/Expanded.gif",isCollapsible:true},a||{});this.isFormated=false;this.obj={_dateObj:new Date(),_regexpObj:new RegExp()};this.init()}JsonFormater.prototype={init:function(){this.tab=this.multiplyString(this.options.tabSize,this.options.singleTab);this.bindEvent()},doFormat:function(json){var html;var obj;try{if(typeof json=="object"){obj=[json]}else{if(json==""){json='""'}obj=eval("["+json+"]")}html=this.ProcessObject(obj[0],0,false,false,false);$(this.options.dom).html("<pre class='jf-CodeContainer'>"+html+"</pre>");this.isFormated=true}catch(e){alert("JSON数据格式不正确:\n"+e.message);$(this.options.dom).html("");this.isFormated=false}},bindEvent:function(){var a=this;$(this.options.dom).off("click",".imgToggle");$(this.options.dom).on("click",".imgToggle",function(){if(a.isFormated==false){return}a.makeContentVisible($(this).parent().next(),!$(this).data("status"))})},expandAll:function(){if(this.isFormated==false){return}var a=this;this.traverseChildren($(this.options.dom),function(b){if(b.hasClass("jf-collapsible")){a.makeContentVisible(b,true)}},0)},collapseAll:function(){if(this.isFormated==false){return}var a=this;this.traverseChildren($(this.options.dom),function(b){if(b.hasClass("jf-collapsible")){a.makeContentVisible(b,false)}},0)},collapseLevel:function(b){if(this.isFormated==false){return}var a=this;this.traverseChildren($(this.options.dom),function(c,d){if(c.hasClass("jf-collapsible")){if(d>=b){a.makeContentVisible(c,false)}else{a.makeContentVisible(c,true)}}},0)},isArray:function(a){return a&&typeof a==="object"&&typeof a.length==="number"&&!(a.propertyIsEnumerable("length"))},getRow:function(a,c,d){var b="";if(!d){b=this.multiplyString(a,this.tab)}if(c!=null&&c.length>0&&c.charAt(c.length-1)!="\n"){c=c+"\n"}return b+c},formatLiteral:function(f,d,b,a,c,e){if(typeof f=="string"){f=f.split("<").join("&lt;").split(">").join("&gt;")}var g="<span class='jf-"+e+"'>"+d+f+d+b+"</span>";if(c){g=this.getRow(a,g)}return g},formatFunction:function(a,d){var c;var b;var f=d.toString().split("\n");var e="";c=this.multiplyString(a,this.tab);for(b=0;b<f.length;b++){e+=((b==0)?"":c)+f[b]+"\n"}return e},multiplyString:function(b,d){var a="";for(var c=0;c<b;c++){a+=d}return a},traverseChildren:function(b,d,e){var c=b.children().length;for(var a=0;a<c;a++){this.traverseChildren(b.children().eq(a),d,e+1)}d(b,e)},makeContentVisible:function(b,c){var a=b.prev().find("img");if(c){b.show();a.attr("src",this.options.imgExpanded);a.data("status",1)}else{b.hide();a.attr("src",this.options.imgCollapsed);a.data("status",0)}},ProcessObject:function(g,c,d,k,l){var h="";var p=(d)?"<span class='jf-Comma'>,</span> ":"";var m=typeof g;var o="";var b;if(this.isArray(g)){if(g.length==0){h+=this.getRow(c,"<span class='jf-ArrayBrace'>[ ]</span>"+p,l)}else{o=this.options.isCollapsible?"<span><img class='imgToggle' data-status='1' src='"+this.options.imgExpanded+"'/></span><span class='jf-collapsible'>":"";h+=this.getRow(c,"<span class='jf-ArrayBrace'>[</span>"+o,l);for(var f=0;f<g.length;f++){h+=this.ProcessObject(g[f],c+1,f<(g.length-1),true,false)}o=this.options.isCollapsible?"</span>":"";h+=this.getRow(c,o+"<span class='jf-ArrayBrace'>]</span>"+p)}}else{if(m=="object"){if(g==null){h+=this.formatLiteral("null","",p,c,k,"Null")}else{var n=0;for(b in g){n++}if(n==0){h+=this.getRow(c,"<span class='jf-ObjectBrace'>{ }</span>"+p,l)}else{o=this.options.isCollapsible?"<span><img class='imgToggle' data-status='1' src='"+this.options.imgExpanded+"'/></span><span class='jf-collapsible'>":"";h+=this.getRow(c,"<span class='jf-ObjectBrace'>{</span>"+o,l);var e=0;for(b in g){var a=this.options.quoteKeys?'"':"";h+=this.getRow(c+1,"<span class='jf-PropertyName'>"+a+b+a+"</span>: "+this.ProcessObject(g[b],c+1,++e<n,false,true))}o=this.options.isCollapsible?"</span>":"";h+=this.getRow(c,o+"<span class='jf-ObjectBrace'>}</span>"+p)}}}else{if(m=="number"){h+=this.formatLiteral(g,"",p,c,k,"Number")}else{if(m=="boolean"){h+=this.formatLiteral(g,"",p,c,k,"Boolean")}else{if(m=="undefined"){h+=this.formatLiteral("undefined","",p,c,k,"Null")}else{h+=this.formatLiteral(g.toString().split("\\").join("\\\\").split('"').join('\\"'),'"',p,c,k,"String")}}}}}return h}};