sensorsdata.MonitorManage=function(t){var e=this;this.options=$.extend(!0,{},t),this.$container=t.container||$("body"),this.$container.html($("#tpl-sensorsdata-monitor-manager").html()).delegate("[data-method]","click",function(t){t.preventDefault(),t.$target=$(this),e.actionHandle(t)}),this.$content=this.$container.find(".content"),this.tplMonitorContent=$("#tpl-sensorsdata-monitor-manager-content").html(),this.request(),sensorsdata.monitorModel.on("update",function(){e.request()})},sensorsdata.MonitorManage.prototype.request=function(){sensorsdata.monitorModel.get(sensorsdata.bind(this.loadedHandle,this),sensorsdata.bind(this.loadedErrorHandle,this))},sensorsdata.MonitorManage.prototype.loadedHandle=function(t){this.data=t,this.options.closeLoading(),this.render(this.buildTplData())},sensorsdata.MonitorManage.prototype.loadedErrorHandle=function(t){t&&t.responseJSON&&t.responseJSON.error&&sensorsdata.error.show(t.responseJSON.error)},sensorsdata.MonitorManage.prototype.buildTplData=function(){for(var t=$.extend(!0,[],this.data),e=0,n=t.length;n>e;e++){var a=t[e],o=a.detail,r=a.filter[0].conditions[0];if(o&&"none"===r.reference&&(o.last_value=r.value),o&&o.last_value){o.current_value=Number(o.current_value),o.last_value=Number(o.last_value),o.current_value>o.last_value?o.isup=!0:o.current_value<o.last_value?o.isdown=!0:o.flat=!0;var s=Math.abs(o.current_value-o.last_value);o.rate="none"===r.reference||"int"===r.unit?s:(s/o.last_value*100).toFixed(2)+"%",o.reference=sensorsdata.CONSTSET.monitorReference[r.reference].cname,o.current_value=sensorsdata.util.numberFormat(o.current_value)}else a.detail=null}return t},sensorsdata.MonitorManage.prototype.render=function(t){this.$content.html(Mustache.render(this.tplMonitorContent,{monitors:t}))},sensorsdata.MonitorManage.prototype.actionHandle=function(t){var e=t.$target,n=e.attr("data-method"),a=Number(e.attr("data-id"));switch(n){case"edit":sensorsdata.monitor.show(a);break;case"onoff":this.onoffHandle(a,e)}},sensorsdata.MonitorManage.prototype.onoffHandle=function(t,e){sensorsdata.monitorModel.onoff(t,"on"===e.attr("data-state")?!0:!1)};